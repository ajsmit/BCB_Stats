<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.6.4">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Albertus J. Smit">

<title>&lt;span id="sec-nonlinear-regression" class="quarto-section-identifier"&gt;&lt;span class="chapter-number"&gt;7&lt;/span&gt;&nbsp; &lt;span class="chapter-title"&gt;Nonlinear Models&lt;/span&gt;&lt;/span&gt; | Albertus J. Smit â€“ The Biostatistics Book</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
/* CSS for citations */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
}
.hanging-indent div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<link href="./regularisation.html" rel="next">
<link href="./generalised_linear_models.html" rel="prev">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<style>html{ scroll-behavior: smooth; }</style>
<script async="" src="https://hypothes.is/embed.js"></script>
<script>
  window.document.addEventListener("DOMContentLoaded", function (_event) {
    document.body.classList.add('hypothesis-enabled');
  });
</script>

  <script>window.backupDefine = window.define; window.define = undefined;</script><script src="https://cdn.jsdelivr.net/npm/katex@latest/dist/katex.min.js"></script>
  <script>document.addEventListener("DOMContentLoaded", function () {
 var mathElements = document.getElementsByClassName("math");
 var macros = [];
 for (var i = 0; i < mathElements.length; i++) {
  var texText = mathElements[i].firstChild;
  if (mathElements[i].tagName == "SPAN") {
   katex.render(texText.data, mathElements[i], {
    displayMode: mathElements[i].classList.contains('display'),
    throwOnError: false,
    macros: macros,
    fleqn: false
   });
}}});
  </script>
  <script>window.define = window.backupDefine; window.backupDefine = undefined;</script><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@latest/dist/katex.min.css">

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

</head>

<body class="nav-sidebar floating nav-fixed slimcontent">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a href="./index.html" class="navbar-brand navbar-brand-logo">
    <img src="./logo.png" alt="" class="navbar-logo">
    </a>
    <a class="navbar-brand" href="./index.html">
    <span class="navbar-title">The Biostatistics Book</span>
    </a>
  </div>
        <div class="quarto-navbar-tools tools-wide tools-end">
    <a href="https://github.com/ajsmit/BCB_Stats" title="Source Code" class="quarto-navigation-tool px-1" aria-label="Source Code"><i class="bi bi-github"></i></a>
    <div class="dropdown">
      <a href="" title="Download" id="quarto-navigation-tool-dropdown-0" class="quarto-navigation-tool dropdown-toggle px-1" data-bs-toggle="dropdown" aria-expanded="false" role="link" aria-label="Download"><i class="bi bi-download"></i></a>
      <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="quarto-navigation-tool-dropdown-0">
          <li>
            <a class="dropdown-item quarto-navbar-tools-item" href="./The-Biostatistics-Book.pdf">
              <i class="bi bi-file-pdf pe-1"></i>
            Download PDF
            </a>
          </li>
          <li>
            <a class="dropdown-item quarto-navbar-tools-item" href="./The-Biostatistics-Book.epub">
              <i class="bi bi-journal pe-1"></i>
            Download ePub
            </a>
          </li>
      </ul>
    </div>
    <div class="dropdown">
      <a href="" title="Share" id="quarto-navigation-tool-dropdown-1" class="quarto-navigation-tool dropdown-toggle px-1" data-bs-toggle="dropdown" aria-expanded="false" role="link" aria-label="Share"><i class="bi bi-share"></i></a>
      <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="quarto-navigation-tool-dropdown-1">
          <li>
            <a class="dropdown-item quarto-navbar-tools-item" href="https://twitter.com/intent/tweet?url=|url|">
              <i class="bi bi-twitter pe-1"></i>
            Twitter
            </a>
          </li>
          <li>
            <a class="dropdown-item quarto-navbar-tools-item" href="https://www.facebook.com/sharer/sharer.php?u=|url|">
              <i class="bi bi-facebook pe-1"></i>
            Facebook
            </a>
          </li>
      </ul>
    </div>
</div>
          <div id="quarto-search" class="" title="Search"></div>
      </div> <!-- /container-fluid -->
    </nav>
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" role="button" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./part_A.html">Parametric Methods</a></li><li class="breadcrumb-item"><a href="./non-linear_regression.html"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">Nonlinear Models</span></a></li></ol></nav>
        <a class="flex-grow-1" role="navigation" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation floating overflow-auto">
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Preface</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./intro.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Introduction</span></span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="./part_A.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Parametric Methods</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./correlation.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Correlation</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./simple_linear_regression.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Linear Regression</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./polynomial_regression.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Polynomial Regression</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./multiple_linear_regression.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Multiple Linear Regression</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./generalised_linear_models.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Generalised Linear Models (GLM)</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./non-linear_regression.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">Nonlinear Models</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./regularisation.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">Regularisation Techniques</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="./part_B.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Non-Parametric Methods</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./assumption_tests.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">9</span>&nbsp; <span class="chapter-title">Testing Assumptions</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./quantile_regression.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">10</span>&nbsp; <span class="chapter-title">Quantile Regression</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="./part_C.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Semi-Parametric Methods</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-3" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./generalised_additive_models.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">11</span>&nbsp; <span class="chapter-title">Generalised Additive Models</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./summary.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">12</span>&nbsp; <span class="chapter-title">Summary</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./references.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">References</span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" role="navigation" aria-expanded="true">
 <span class="menu-text">Appendices</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-4" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./appendix_1.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">A</span>&nbsp; <span class="chapter-title">Appendix A</span></span></a>
  </div>
</li>
      </ul>
  </li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul class="collapse">
  <li><a href="#extension-of-nonlinear-models" id="toc-extension-of-nonlinear-models" class="nav-link active" data-scroll-target="#extension-of-nonlinear-models"><span class="header-section-number">7.1</span> Extension of Nonlinear Models</a></li>
  <li><a href="#considerations-for-model-selection" id="toc-considerations-for-model-selection" class="nav-link" data-scroll-target="#considerations-for-model-selection"><span class="header-section-number">7.2</span> Considerations for Model Selection</a></li>
  <li><a href="#sec-assumptions" id="toc-sec-assumptions" class="nav-link" data-scroll-target="#sec-assumptions"><span class="header-section-number">7.3</span> Requirements and Assumptions</a></li>
  <li><a href="#r-functions-and-packages" id="toc-r-functions-and-packages" class="nav-link" data-scroll-target="#r-functions-and-packages"><span class="header-section-number">7.4</span> R Functions and Packages</a></li>
  <li><a href="#sec-ex1" id="toc-sec-ex1" class="nav-link" data-scroll-target="#sec-ex1"><span class="header-section-number">7.5</span> Example: Algal Nutrient Uptake Kinetcis</a></li>
  <li><a href="#sec-vonbertalanffy" id="toc-sec-vonbertalanffy" class="nav-link" data-scroll-target="#sec-vonbertalanffy"><span class="header-section-number">7.6</span> Example: The Growth Rate of Fish (NLMM)</a></li>
  <li><a href="#scrathpad" id="toc-scrathpad" class="nav-link" data-scroll-target="#scrathpad"><span class="header-section-number">7.7</span> Scrathpad</a></li>
  </ul>
<div class="toc-actions"><ul class="collapse"><li><a href="https://github.com/ajsmit/BCB_Stats/edit/main/non-linear_regression.qmd" class="toc-action"><i class="bi bi-github"></i>Edit this page</a></li></ul></div></nav>
    </div>
<!-- main -->
<main class="content page-columns page-full" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default"><nav class="quarto-page-breadcrumbs quarto-title-breadcrumbs d-none d-lg-block" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./part_A.html">Parametric Methods</a></li><li class="breadcrumb-item"><a href="./non-linear_regression.html"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">Nonlinear Models</span></a></li></ol></nav>
<div class="quarto-title">
<div class="quarto-title-block"><div><h1 class="title"><span id="sec-nonlinear-regression" class="quarto-section-identifier"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">Nonlinear Models</span></span></h1><button type="button" class="btn code-tools-button" id="quarto-code-tools-source"><i class="bi"></i> Code</button></div></div>
</div>


<div class="quarto-title-meta-author">
  <div class="quarto-title-meta-heading">Author</div>
  <div class="quarto-title-meta-heading">Affiliation</div>
  
    <div class="quarto-title-meta-contents">
    <p class="author"><a href="https://tangledbank.netlify.app">Albertus J. Smit</a> <a href="https://orcid.org/0000-0002-3799-6126" class="quarto-title-author-orcid"> <img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAA2ZpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuMC1jMDYwIDYxLjEzNDc3NywgMjAxMC8wMi8xMi0xNzozMjowMCAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wTU09Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9tbS8iIHhtbG5zOnN0UmVmPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvc1R5cGUvUmVzb3VyY2VSZWYjIiB4bWxuczp4bXA9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC8iIHhtcE1NOk9yaWdpbmFsRG9jdW1lbnRJRD0ieG1wLmRpZDo1N0NEMjA4MDI1MjA2ODExOTk0QzkzNTEzRjZEQTg1NyIgeG1wTU06RG9jdW1lbnRJRD0ieG1wLmRpZDozM0NDOEJGNEZGNTcxMUUxODdBOEVCODg2RjdCQ0QwOSIgeG1wTU06SW5zdGFuY2VJRD0ieG1wLmlpZDozM0NDOEJGM0ZGNTcxMUUxODdBOEVCODg2RjdCQ0QwOSIgeG1wOkNyZWF0b3JUb29sPSJBZG9iZSBQaG90b3Nob3AgQ1M1IE1hY2ludG9zaCI+IDx4bXBNTTpEZXJpdmVkRnJvbSBzdFJlZjppbnN0YW5jZUlEPSJ4bXAuaWlkOkZDN0YxMTc0MDcyMDY4MTE5NUZFRDc5MUM2MUUwNEREIiBzdFJlZjpkb2N1bWVudElEPSJ4bXAuZGlkOjU3Q0QyMDgwMjUyMDY4MTE5OTRDOTM1MTNGNkRBODU3Ii8+IDwvcmRmOkRlc2NyaXB0aW9uPiA8L3JkZjpSREY+IDwveDp4bXBtZXRhPiA8P3hwYWNrZXQgZW5kPSJyIj8+84NovQAAAR1JREFUeNpiZEADy85ZJgCpeCB2QJM6AMQLo4yOL0AWZETSqACk1gOxAQN+cAGIA4EGPQBxmJA0nwdpjjQ8xqArmczw5tMHXAaALDgP1QMxAGqzAAPxQACqh4ER6uf5MBlkm0X4EGayMfMw/Pr7Bd2gRBZogMFBrv01hisv5jLsv9nLAPIOMnjy8RDDyYctyAbFM2EJbRQw+aAWw/LzVgx7b+cwCHKqMhjJFCBLOzAR6+lXX84xnHjYyqAo5IUizkRCwIENQQckGSDGY4TVgAPEaraQr2a4/24bSuoExcJCfAEJihXkWDj3ZAKy9EJGaEo8T0QSxkjSwORsCAuDQCD+QILmD1A9kECEZgxDaEZhICIzGcIyEyOl2RkgwAAhkmC+eAm0TAAAAABJRU5ErkJggg=="></a></p>
  </div>
  <div class="quarto-title-meta-contents">
        <p class="affiliation">
            <a href="https://uwc.ac.za">
            University of the Western Cape
            </a>
          </p>
      </div>
  </div>

<div class="quarto-title-meta">

      
  
    
  </div>
  


</header>


<p><strong>In This Chapter</strong></p>
<ul>
<li><a href="@sec-nonlinear-regression">Nonlinear Regression</a></li>
</ul>
<p><strong>Elsewhere in the Book</strong></p>
<ul>
<li><a href="@sec-simple-linear-regression">Simple Linear Regression</a></li>
<li><a href="@sec-polynomial-regression">Polynomial Regression</a></li>
<li><a href="@sec-multiple-linear-regression">Multiple Linear Regression</a></li>
<li><a href="@sec-generalised-linear-models">Generalised Linear Models</a></li>
<li><a href="@sec-generalised-additive-models">Generalised Additive Models</a></li>
</ul>
<p>Nonlinear regression models are used when the relationship between the response variable (dependent variable, <span class="math inline">Y</span>) and the predictor variables (independent variables, <span class="math inline">X</span>) is not linear. In other words, they are employed when a straight line is not an appropriate representation of the relationship between the variables.</p>
<p>As we have seen in <a href="simple_linear_regression.html#sec-simple-linear-regression" class="quarto-xref"><span>Section 3.1</span></a>, polynomial regressions provide a nonlinear relationship between the response and predictor variables (as seen in the regression line fit to the data, <a href="#fig-plts" class="quarto-xref">Figure&nbsp;<span>7.1</span></a> A), but they are considered linear models because the parameters are estimated using linear least squares. Another type of nonlinear model is a semi-parametric model where the relationship between the response and predictor variables is described by a function that includes both parametric and non-parametric components. An example of a semi-parametric model is the generalised additive model (GAM) that includes a non-parametric component in the form of a spline function (<a href="generalised_additive_models.html" class="quarto-xref"><span>Chapter 11</span></a>; <a href="#fig-plts" class="quarto-xref">Figure&nbsp;<span>7.1</span></a> B).</p>
<p>The type of nonlinear model I cover in this chapter is a parametric model where the relationship between the response and predictor variables is described by a specific nonlinear function (<a href="#fig-plts" class="quarto-xref">Figure&nbsp;<span>7.1</span></a> C). The model still assumes that the residuals are normally distributed and exhibit homoscedasticity. The model parameters are estimated by minimising the sum of squared differences between the observed and predicted values, a method commonly referred to as nonlinear least squares (NLS) regression. This is the term I will adopt.</p>
<p>The primary purpose of nonlinear regression is to derive a formula (model), analyse data, and predict new values where the phenomenon exhibits a nonlinear causal pattern or behaviour. Nonlinear models include a variety of response forms, such as exponential growth models, logistic growth models, and other mechanistic models derived from physical, chemical, or biological processes. Examples of such models include trigonometric, logarithmic, and user-defined functions like the von Bertalanffy model or seasonal cycle represented by a sine curve (<a href="#fig-plts" class="quarto-xref">Figure&nbsp;<span>7.1</span></a> C). These models are explicitly nonlinear in both their form and parameters. Unlike polynomial regression, where only the terms of <span class="math inline">X</span> are transformed, nonlinear models involve an entirely nonlinear function relating <span class="math inline">X</span> and <span class="math inline">Y</span>. They are often used when there is a theoretical basis for the specific form of the relationship, providing interpretable parameters that carry specific meanings based on the underlying theory, making them useful for detailed applications where the dynamics of the system are well-understood.</p>
<p>A general formula for a nonlinear regression model is:</p>
<p><span id="eq-nonlin"><span class="math display">Y_i = f(X_i; \theta) + \epsilon_i \tag{7.1}</span></span></p>
<p>Where:</p>
<ul>
<li><span class="math inline">Y_i</span> is the response variable for the <span class="math inline">i</span>-th observation,</li>
<li><span class="math inline">X_i</span> is the predictor variable for the <span class="math inline">i</span>-th observation,</li>
<li><span class="math inline">f(X_i; \theta)</span> is a nonlinear function of <span class="math inline">X_i</span> parameterised by the vector <span class="math inline">\theta</span>,</li>
<li><span class="math inline">\theta</span> is the vector of parameters to be estimated, and</li>
<li><span class="math inline">\epsilon_i</span> is the error term for the <span class="math inline">i</span>-th observation and is assumed to be i.i.d. with a normal distribution.</li>
</ul>
<p>An example of a specific nonlinear regression model is the exponential growth model:</p>
<p><span id="eq-exp"><span class="math display">Y_i = \alpha e^{\beta X_i} + \epsilon_i \tag{7.2}</span></span></p>
<p>Where:</p>
<ul>
<li><span class="math inline">\alpha</span> and <span class="math inline">\beta</span> are the parameters to be estimated,</li>
<li><span class="math inline">e</span> is the base of the natural logarithm, and</li>
<li><span class="math inline">\epsilon_i</span> is the error term for the <span class="math inline">i</span>-th observation.</li>
</ul>
<p>This model is nonlinear in the parameters <span class="math inline">\alpha</span> and <span class="math inline">\beta</span>, and it describes an exponential relationship between the predictor <span class="math inline">X</span> and the response <span class="math inline">Y</span>.</p>
<div class="cell page-columns page-full" data-layout-align="center" data-messages="false">
<div class="cell-output-display page-columns page-full">
<div id="fig-plts" class="quarto-float quarto-figure quarto-figure-center anchored page-columns page-full" data-fig-align="center" data-fig-pos="t">
<figure class="quarto-float quarto-float-fig figure page-columns page-full">
<div aria-describedby="fig-plts-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="non-linear_regression_files/figure-html/fig-plts-1.svg" class="img-fluid quarto-figure quarto-figure-center figure-img" style="width:80.0%" data-fig-pos="t">
</div>
<figcaption class="quarto-float-caption-margin quarto-float-caption quarto-float-fig margin-caption" id="fig-plts-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;7.1: Nonlinear regression models fitted to simulated data. A) a cubic polynomial model, B) a GAM with a thin plate regression spline, and C) a NLS sine curve as a seasonal cycle.
</figcaption>
</figure>
</div>
</div>
</div>
<section id="extension-of-nonlinear-models" class="level2" data-number="7.1">
<h2 data-number="7.1" class="anchored" data-anchor-id="extension-of-nonlinear-models"><span class="header-section-number">7.1</span> Extension of Nonlinear Models</h2>
<p>Like linear models, nonlinear models have also been extended to include multiple predictors, interactions, and other terms to capture complex relationships between the variables. The first type of more complex nonlinear models accommodates a wider range of data distributions by generalising to non-normal error distributions through link functions. These models are called generalised nonlinear models (GNLMs). The examples of GLMs in <a href="generalised_linear_models.html" class="quarto-xref"><span>Chapter 6</span></a> should prepare you sufficiently to handle nonlinear models too. The other type deals with hierarchical data structures and incorporates fixed and random effects. As such, you can also correctly model repeated measures and longitudinal, and nested (grouped) designs. These hierarchical models are called nonlinear mixed models (NLMMs). Examples of NLMMs are provided in <a href="#sec-mf-treatments" class="quarto-xref"><span>Section 7.5.2.3</span></a> and <a href="#sec-perturbation" class="quarto-xref"><span>Section 7.5.3</span></a>.</p>
</section>
<section id="considerations-for-model-selection" class="level2 page-columns page-full" data-number="7.2">
<h2 data-number="7.2" class="anchored" data-anchor-id="considerations-for-model-selection"><span class="header-section-number">7.2</span> Considerations for Model Selection</h2>
<div class="cell page-columns page-full" data-layout-align="center" data-messages="false">
<div class="cell-output-display page-columns page-full">
<div id="fig-combo" class="quarto-float quarto-figure quarto-figure-center anchored page-columns page-full" data-fig-align="center" data-fig-pos="t">
<figure class="quarto-float quarto-float-fig figure page-columns page-full">
<div aria-describedby="fig-combo-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="non-linear_regression_files/figure-html/fig-combo-1.svg" class="img-fluid quarto-figure quarto-figure-center figure-img" style="width:80.0%" data-fig-pos="t">
</div>
<figcaption class="quarto-float-caption-margin quarto-float-caption quarto-float-fig margin-caption" id="fig-combo-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;7.2: Plot of growth rate data fitted with a von Bertalanffy model, a first- (straight line), second- and third-order polynomial, and a GAM.
</figcaption>
</figure>
</div>
</div>
</div>
<p>There are a few practical considerations to keep in mind when choosing a suitable nonlinear (in shape) model. Sometimes different models can provide similar fits to the same data, but they may have different implications for the interpretation of the relationship between the variables. See for example <a href="#fig-combo" class="quarto-xref">Figure&nbsp;<span>7.2</span></a>. The plot shows growth rate data fitted with a first-, second- and third-order polynomial, a GAM, and a NLS von Bertalanffy model. To the untrained eye and inexperienced biologist, all models seem to provide a good fit to the data, but they do differ subtly in the shape of the fitted curve. The von Bertalanffy model is a saturating growth model (it reaches a plateau), while the polynomial models and the GAM are more flexible and can capture a wider range of shapes. The choice of model should be guided by the underlying biological or physical processes that generated the data and the research question you are trying to answer.</p>
<p>Since you will often have to decide among polynomial regressions, nonlinear models, and GAMs, Iâ€™ll outline some general guidelines to help you make an informed decision.</p>
<ul>
<li><p><strong>Linearity vs.&nbsp;Nonlinearity:</strong> If the relationship between the variables is linear or can be adequately approximated by a polynomial function, polynomial regression is a suitable choice. Nonlinear models or GAMs may be more appropriate if the relationship is nonlinear and does not follow a specific polynomial form. In <a href="#fig-combo" class="quarto-xref">Figure&nbsp;<span>7.2</span></a>, it is obvious that the straight line model is not a good fit for the data, but the second- and third-order polynomial models, the GAM, and the von Bertalanffy model all provide better fits.</p></li>
<li><p><strong>Complexity of the Relationship:</strong> Polynomial regression is limited in its ability to capture complex nonlinear relationships, especially those with more bends, peaks, or valleys than a polynomial of order &lt;3 (or even 4 at a push) can capture. Another consideration is the process the data represent: if it is inherently nonlinear according to a known function such as exponential growth or decay, seasonal sinusoidal patterns, or logistic growth, then nonlinear models or GAMs are more flexible and can capture a wider range of nonlinear responses. In <a href="#fig-combo" class="quarto-xref">Figure&nbsp;<span>7.2</span></a>, the von Bertalanffy model is a saturating growth model, which is a known biological process that can be captured by a nonlinear model. The 3rd-order polynomial model also seems to capture a saturating growth pattern, but it also somewhat influenced by the dip in the raw data around 12.5 years (in addition to some other nuances), but this is likely due to some random variation and is not part of the growth response.</p></li>
<li><p><strong>Interpretability vs.&nbsp;Flexibility:</strong> Polynomial regression provides coefficients that relate to the powers of the predictor variables, but the interpretation of the <span class="math inline">\beta</span> parameters is not as intuitive as in a linear model of order 1. In contrast, nonlinear models and GAMs offer greater flexibility in capturing complex patterns. GAMs may lack direct interpretability of the coefficients, but the nonlinear model offers coefficients that can be interpreted in the context of the modelâ€™s structure. In <a href="#fig-combo" class="quarto-xref">Figure&nbsp;<span>7.2</span></a>, the von Bertalanffy model has a clear biological interpretation (see <a href="#sec-vonbertalanffy" class="quarto-xref"><span>Section 7.6</span></a>), while the 3rd-order polynomial model and the GAM are more flexible and can capture a wider range of shapes (it follows the dips and peaks in the raw data closer). The 2nd-order polynomial does not fit the data as well at very low ages at 20 year, but it is still a better fit than the linear model.</p></li>
<li><p><strong>Overfitting Concerns:</strong> Polynomial regression with high-degree polynomials can lead to overfitting, especially when the model complexity exceeds the underlying data patterns. Nonlinear models and GAMs can also overfit if not properly regularised or constrained. These insights can be seen when we examine the summaries of the regression fits, and can be formally assessed using cross-validation or information criteria. In <a href="#fig-combo" class="quarto-xref">Figure&nbsp;<span>7.2</span></a>, the 3rd-order polynomial model seems to capture some of the random variation in the data, which may be an indication of overfitting. The GAM also seems to capture some of the random variation, but it is less pronounced than in the 3rd-order polynomial model.</p></li>
<li><p><strong>Data Size and Complexity:</strong> For small to moderate-sized datasets with complex nonlinear relationships, GAMs may be more suitable due to their flexibility and ability to capture intricate patterns. For simpler relationships or when interpretability is important, nonlinear regression (with mechanistically-informed parameters) may be preferred. These are not of concern in <a href="#fig-combo" class="quarto-xref">Figure&nbsp;<span>7.2</span></a>.</p></li>
<li><p><strong>Model Complexity and Assumptions:</strong> Polynomial regression assumes a specific polynomial form for the relationship, which may not hold in practice. Nonlinear models and GAMs are more flexible and do not always impose strict parametric assumptions (see <a href="#sec-assumptions" class="quarto-xref"><span>Section 7.3</span></a>), making them more robust to deviations from the assumed form. A detailed assessment of the model assumptions and the complexity of the relationship can help guide the choice of model. We need to add to this our biologist specialist knowledge to make the best choice.</p></li>
<li><p><strong>Computational Considerations:</strong> Polynomial regression is relatively simple to implement and computationally efficient, especially for low-degree polynomials. Nonlinear models and GAMs may require more computational resources, especially for large datasets or complex models. Not a concern for the models represented in <a href="#fig-combo" class="quarto-xref">Figure&nbsp;<span>7.2</span></a>.</p></li>
</ul>
</section>
<section id="sec-assumptions" class="level2" data-number="7.3">
<h2 data-number="7.3" class="anchored" data-anchor-id="sec-assumptions"><span class="header-section-number">7.3</span> Requirements and Assumptions</h2>
<p>Polynomial regression, nonlinear regression, and GAMs are built upon the principles of linear regression; therefore, the fundamental assumptions of normality and homoscedasticity of residuals usually still apply. Specifically, these models assume that the residuals are independent and identically distributed (i.i.d.), which implies that they are normally distributed with a constant variance (homoscedasticity). However, the specifics can vary depending on the model and the distribution of the response variable. Of course, there is also the requirement for the response variable to be continuous and independent. These assumptions help ensure that the error terms (residuals) in the model are well-behaved so that reliable inference and predictions can be obtained.</p>
<p>Nuances:</p>
<ul>
<li><strong>Polynomial Regression:</strong> While a type of nonlinear regression, polynomial models are still linear in their parameters. This means that they are more bound to the classic regression assumptions and can be more sensitive to violations.</li>
<li><strong>GAMs:</strong> Offer more flexibility in handling nonlinear relationships. Depending on the distributions used for the outcome variable and the link functions employed, GAMs can potentially relax some of the strict normality assumptions.</li>
<li><strong>Nonlinear Models in General:</strong> Some truly nonlinear models (like those based on exponential or logarithmic functions) may have inherently different error structures and may not strictly require the same assumptions of normality and homoscedasticity. However, these models come with their own set of assumptions and considerations.</li>
</ul>
<p>Important considerations:</p>
<ul>
<li><strong>Diagnostic Checks:</strong> Regardless of the model type, itâ€™s <em>essential</em> to perform residual diagnostics to assess if assumptions are met. Visualisations (e.g., histograms, Q-Q plots, residuals vs. fitted plots) are well-known tools.</li>
<li><strong>Transformations:</strong> If violations of assumptions are found, data transformation techniques (e.g., Box-Cox, log) could be considered to improve model validity.</li>
<li><strong>Generalised Linear Models (GLMs):</strong> An important class of models designed to handle various non-normal responses (e.g., count, binary) while extending the linear modeling framework. GLMs are good alternative to both polynomial regression and GAMs in certain contexts.</li>
<li><strong>Mixed models:</strong> Linear Mixed Models (LLMs), Generalised Linear Mixed Models (GLMMs), and Generalised Nonlinear Models (GNLMs) can be used to account for dependencies in the data, such as repeated measures or hierarchical structures. GAMs also accommodate mixed data structures.</li>
</ul>
<p>The rest of this chapter will focus on the practical aspects of fitting polynomial regression models and nonlinear regressions in R. GAMs will be covered in a separate chapter due to their unique characteristics and implementation details.</p>
</section>
<section id="r-functions-and-packages" class="level2 page-columns page-full" data-number="7.4">
<h2 data-number="7.4" class="anchored" data-anchor-id="r-functions-and-packages"><span class="header-section-number">7.4</span> R Functions and Packages</h2>
<section id="polynomial-regression" class="level3 page-columns page-full">
<h3 class="anchored" data-anchor-id="polynomial-regression">Polynomial Regression</h3>
<p>To fit a polynomial model in R, use the simple linear regression function <code>lm()</code> to fit the model. The purpose of <code>poly()</code> is to generate polynomial terms of a specified degree. The basic form is:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1"></a>poly_model <span class="ot">&lt;-</span> <span class="fu">lm</span>(y <span class="sc">~</span> <span class="fu">poly</span>(x, <span class="at">degree =</span> <span class="dv">2</span>), <span class="at">data =</span> data)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>GLMs are a generalisation of ordinary linear regression that allows for the response variable to have non-Gaussian error distributions such as one of the exponential family distributions (e.g., binomial, Poisson, gamma). These distributions are accommodated via so-called link functions within the GLM framework. The most common R function for fitting GLMs is <code>glm()</code>.</p>
<p>Mixed models that include random and fixed effects (see box â€˜Fixed and Random Effectsâ€™) are also available. These are necessary for the analysis of data that have correlations within groups or hierarchies (e.g., repeated measures<a href="#fn1" class="footnote-ref" id="fnref1" role="doc-noteref"><sup>1</sup></a> or the inclusion of grouped variables). Commonly used are <code>lmer()</code> for LLMs and <code>glmer()</code> for GLMMs. Both functions are in the <strong>lme4</strong> package. Another package that accommodates LLMs is <strong>nlme</strong> and its <code>lme()</code> function. It has somewhat different capabilities and syntax compared to <strong>lme4</strong>.</p>
<div class="no-row-height column-margin column-container"><div id="fn1"><p><sup>1</sup>&nbsp;Repeated measures are multiple observations taken on the same subject or unit over time or under different conditions. Sometimes this is called longitudinal data.</p></div></div><div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Fixed and Random Effects
</div>
</div>
<div class="callout-body-container callout-body">
<p>Random effects and fixed effects are used in regression models to account for different sources of variation in the data.</p>
<p><em>Fixed effects</em> are variables or factors that represent sources of variation that are of primary interest in the study or that have a finite and fixed number of levels or categories. These effects are assumed to have an influence on the mean response. Examples of fixed effects include:</p>
<ul>
<li>Treatment groups in an experiment (e.g., fertiliser A, fertiliser B, control)</li>
<li>Categorical variables (e.g., sex, age group, species)</li>
<li>Continuous variables (e.g., time, temperature, concentration)</li>
</ul>
<p>The coefficients associated with fixed effects are estimated and interpreted as the primary effects of interest in the model.</p>
<p><em>Random effects</em> are variables or factors that represent sources of variation that are not of primary interest but need to be accounted for in the model. These effects are assumed to be randomly sampled from a larger population, and their levels are theoretically infinite or too numerous to be modeled as fixed effects. Examples of random effects include:</p>
<ul>
<li>Subjects or individuals in a study (e.g., individual plants or animals)</li>
<li>Clusters or groups (e.g., plots, aquaria, transects)</li>
<li>Repeated measures or time points within subjects</li>
</ul>
<p>Random effects are used to model the correlation or dependence among observations within the same cluster, subject, or time series. They allow for subject-specific or cluster-specific adjustments to the overall model, accounting for the fact that observations within the same group are more similar than observations from different groups.</p>
<p>In LMMs and GLMMs, both fixed and random effects are included. The fixed effects represent the primary effects of interest and the random effects account for the correlation or dependence within clusters or subjects.</p>
</div>
</div>
</section>
<section id="nonlinear-regression" class="level3">
<h3 class="anchored" data-anchor-id="nonlinear-regression">Nonlinear Regression</h3>
<p>In R, nonlinear regressions can be performed using the <code>nls()</code> function in the <strong>base</strong> package. It uses iterative algorithms to minimise the residual sum of squares and find the best-fit parameters for the user-specified nonlinear model.</p>
<p>The <code>nls()</code> function is most frequently used to fit user-specified nonlinear functions. The basic syntax is:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1"></a>nls_model <span class="ot">&lt;-</span> <span class="fu">nls</span>(y <span class="sc">~</span> <span class="fu">f</span>(x, theta1, theta2, ...), <span class="at">data =</span> data,</span>
<span id="cb2-2"><a href="#cb2-2"></a>                 <span class="at">start =</span> <span class="fu">list</span>(<span class="at">theta1 =</span> value1, <span class="at">theta2 =</span> value2, ...))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>GNLMs extend nonlinear models by allowing the response variable to follow one of the exponential family distributions, such as binomial, Poisson, or gamma, etc. This is done through a link function that relates the mean of the distribution to the predictors through the nonlinear model. GNLMs are fit using maximum likelihood estimation, which is flexible enough to handle various types of error distribution and link functions. The <strong>gnm</strong> package rovides the <code>gnm()</code> function designed for this purpose.</p>
<p>For data with dependencies within groups or hierarchies (such as in longitudinal studies), NLMMs are available within <code>nlme()</code>. NLMMs incorporate fixed effects (associated with the nonlinear terms) and random effects (to account for correlation and variation within groups).</p>
</section>
</section>
<section id="sec-ex1" class="level2 page-columns page-full" data-number="7.5">
<h2 data-number="7.5" class="anchored" data-anchor-id="sec-ex1"><span class="header-section-number">7.5</span> Example: Algal Nutrient Uptake Kinetcis</h2>
<p>We can measure algal nutrient uptake rates using two types of experiments: multiple flask experiments and perturbation experiments. The fundamental concept underlying both methods is to introduce a known quantity of nutrients (termed the substrate) into a flask or a series of flasks and then measure the rate of nutrient uptake (<span class="math inline">V</span>) at different substrate concentrations (<span class="math inline">[S]</span>). We calculate the nutrient uptake rate as the change in nutrient concentration in the flask over a predefined time interval (<span class="math inline">V = \Delta [S]/\Delta t</span>). Consequently, both experiments generate data that relate the nutrient uptake rate to the corresponding substrate concentration. The primary difference between the two methods lies in the experimental setup and the data analysis.</p>
<p>In the <strong>multiple flask method</strong>, we prepare a series of flasks, each containing a different initial concentration of the substrate nutrient to span the range typically encountered by the specimen in its natural environment. We then measure the nutrient uptake rate in <em>each individual flask</em> over a specific time period, for example by taking measurements at the start (<span class="math inline">t=0</span>) and end (<span class="math inline">t=30</span> minutes) of the incubation. We calculate the change in substrate concentration over this time interval in each flask to determine the corresponding nutrient uptake rate. The resulting data from this method therefore consists of the different initial substrate concentrations used in each flask, paired with their respective measured nutrient uptake rates over the incubation period.</p>
<!-- ChatGPT query to simulate data for the experiment -->
<!-- Please refer to the above text about the multiple flask experiment. Develop R code that will simulate data for seven replicate flasks participating in a multiple flask experiment. These are the conditions per each set of multiple flasks: -->
<!--   - the concentrations of nutrient at $t=0$ are 50, 40, 30, 25, 20, 15, 12.5, 10, 7.5, 5, 2.5, and 0 $\mu M$ nitrate -->
<!--   - the disappearance of nitrate is measured at $t=0$ and $t=30$ minutes -->
<!--   - there is ~1.5 g of seaweed per 150 ml incubation medium per flask -->
<!--   - there are 7 replicate flasks per each concentration of nutrients -->
<!-- Produce R code to simulate random data from the Michaelis-Menten relationship with a $V_{max} = 35.0 \pm 1.8 \, \mu \text{M} \, N \, g^{-1} \, hr^{-1}$ and a $K_m = 5.6 \pm 1.3 \mu \text{M} N$. The data should be normally distributed. Present this data in a table of $[S]$, which is the nutrient concentration at $t=0$ and the corresponding $V$. -->
<p>The <strong>perturbation method</strong> uses a single flask to which we add a high initial concentration of the substrate nutrient, set at a level that is ecologically meaningful and relevant to the study system. Instead of using multiple flasks, we measure the change in the remaining substrate concentration at multiple time points within this <em>same flask</em>, for example by taking samples every 10 or 20 minutes until all the substrate is depleted, say at 120 minutes. We calculate the change in substrate concentration between each successive time point to determine the corresponding nutrient uptake rate over that time interval. The resulting data, therefore, consist of a time series of substrate concentrations at each measurement time point, paired with the nutrient uptake rates calculated over the periods between those time points.</p>
<p>The important differences between the multiple flask and perturbation experiments are summarised in <a href="#tbl-diffs" class="quarto-xref">Table&nbsp;<span>7.1</span></a>.</p>
<div id="tbl-diffs" class="quarto-float quarto-figure quarto-figure-center anchored page-columns page-full">
<figure class="quarto-float quarto-float-tbl figure page-columns page-full">
<div aria-describedby="tbl-diffs-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<table class="table">
<colgroup>
<col style="width: 17%">
<col style="width: 39%">
<col style="width: 42%">
</colgroup>
<thead>
<tr class="header">
<th>Feature</th>
<th>Multiple Flask Experiments</th>
<th>Perturbation Experiments</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Experimental Setup</td>
<td>Multiple flasks, each with different <span class="math inline">[S]</span></td>
<td>Single flask with initial high <span class="math inline">[S]</span></td>
</tr>
<tr class="even">
<td>Data Independence</td>
<td>Data points are independent</td>
<td>Data points are correlated (repeated measures)</td>
</tr>
<tr class="odd">
<td>Analysis</td>
<td>Nonlinear least squares regression (NLS)</td>
<td>Nonlinear mixed model (NLMM)</td>
</tr>
<tr class="even">
<td>R Function</td>
<td><code>nls()</code></td>
<td><code>nlme::nlme()</code></td>
</tr>
</tbody>
</table>
</div>
<figcaption class="quarto-float-caption-margin quarto-float-caption quarto-float-tbl margin-caption" id="tbl-diffs-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Table&nbsp;7.1: Key differences between multiple flask and perturbation experiments.
</figcaption>
</figure>
</div>
<p>Our choice between multiple flask and perturbation experiments depends on our research questions and experimental constraints. In both methods, we must consider all sources of error and variability, such as measurement error, the type of nutrient, the physiological state of the alga, the light intensity, the experimental temperature, and other variables that might affect the uptake response.</p>
<p>We apply the Michaelis-Menten model (<a href="#eq-mm" class="quarto-xref">Equation&nbsp;<span>7.3</span></a>) to data from multiple flask and perturbation experiments to characterise nutrient uptake. Applied to algae, this model assumes an irreversible uptake process that saturates at high substrate concentrations. It effectively quantifies key characteristics of the nutrient uptake system, including the maximum uptake rate and the algaeâ€™s affinity for the nutrient.</p>
<p>We use the <code>nls()</code> function to fit the Michaelis-Menten model to the data from multiple flask experiments. For the perturbation experiment, things are a bit more complicated. This method includes dependent data points because the measurements are taken from the same flask at different times, introducing a correlation between observations. This violates the independence assumption required for standard regression models. To accurately analyse these data, I recommend a <em>nonlinear mixed-effects model</em> implemented in the <code>nlme()</code> function. Mixed-effects models account for fixed effects (overall trends across all observations) and random effects (variations specific to individual experimental units, in this case, time points within the same flask). This helps handle the correlation between repeated measures and produces reliable estimates of the uptake dynamics within the flask.</p>
<p>The Michaelis-Menten equation is given by:</p>
<p><span id="eq-mm"><span class="math display">V_i = \frac{V_{max} \cdot [S_i]}{K_m + [S_i]} + \epsilon_i \tag{7.3}</span></span></p>
<p>Where:</p>
<ul>
<li><span class="math inline">V_i</span> is the uptake rate at the <span class="math inline">i</span>-th observation,</li>
<li><span class="math inline">V_{max}</span> is the maximum nutrient uptake rate achieved,</li>
<li><span class="math inline">[S_i]</span> is the substrate concentration at the <span class="math inline">i</span>-th observation,</li>
<li><span class="math inline">K_m</span> is the Michaelis constant, which represents the substrate concentration at which the uptake rate is half of <span class="math inline">V_{max}</span>, and</li>
<li><span class="math inline">\epsilon_i</span> is the error term at the <span class="math inline">i</span>-th observation. and</li>
</ul>
<p>The two parameters of the Michaelis-Menten model are rooted in theory and have ecophysiological interpretations. <span class="math inline">K_m</span> is a measure of the algaâ€™s affinity for the nutrient and is determined by the kinetic constants governing the formation and dissociation of the enzyme-substrate complex responsible for taking up the nutrient; lower values indicate a higher affinity. <span class="math inline">V_{max}</span> represents the maximum capacity of the alga to utilise the nutrient.</p>
<section id="hypothesis-testing-and-the-michaelis-menten-model" class="level3">
<h3 class="anchored" data-anchor-id="hypothesis-testing-and-the-michaelis-menten-model">Hypothesis Testing and the Michaelis-Menten Model</h3>
<section id="sec-linear-vs-mm" class="level4">
<h4 class="anchored" data-anchor-id="sec-linear-vs-mm">Linear vs.&nbsp;Michaelis-Menten Model</h4>
<p>Often, we aim to understand the relationship between two variables but we may not yet know which model best describes this relationship. For instance, in algal nutrient uptake kinetics, both a linear model and a nonlinear Michaelis-Menten model can be used to describe the relationship between nutrient uptake rate and substrate concentration. Both models are valid but they have different interpretations and unique ecophysiological implications. The choice between the two models depends on the biological system.</p>
<ul>
<li><strong>Linear models</strong> indicate that the uptake process is inherently unsaturated, such as with the uptake of ammonium. In this case, the uptake rate continues to increase linearly with substrate concentration.</li>
<li>The <strong>Michaelis-Menten model</strong> suggests that the uptake rate eventually saturates as the substrate concentration increases, which is often the case with nitrate.</li>
</ul>
<p>The key question is: How do we decide which model fits our data best?</p>
<p>The simplest way is to visually inspect the scatter of points on a plot of the <span class="math inline">V</span> vs.&nbsp;<span class="math inline">[S]</span> data, which would be part of any exploratory data analysis. If the data exhibit a clear saturation pattern, where the uptake rate levels off at high substrate concentrations, the Michaelis-Menten model is likely to provide a better fit. Conversely, if the data show a linear relationship over the observed range of substrate concentrations, the linear model may be more appropriate.</p>
<p>It is also important to consider the biological plausibility of the models. If there is prior knowledge or theoretical reasons to expect a saturating relationship between the uptake rate and substrate concentration, the Michaelis-Menten model may be more appropriate, even if both models provide a similar fit to the data.</p>
<p>Confirmation can be obtained by fitting both models to our data and comparing their performance using statistical measures such as the sum of squared residuals (SSR), Akaike Information Criterion (AIC), Bayesian Information Criterion (BIC), or log-likelihood test.</p>
<p>To proceed with the statistical approach, we must first set hypotheses such as these to compare the models:</p>
<p><strong><span class="math inline">H_0</span>:</strong> The Michaelis-Menten model does not provide a better fit to the data than a simple linear model.</p>
<p>In other words, we suggest with the null hypothesis that the relationship between nutrient uptake rate and the substrate concentration is adequately described by a linear model rather than the Michaelis-Menten nonlinear model. The implication is that the uptake rate increases linearly with substrate concentration, without saturation.</p>
<p><strong><span class="math inline">H_a</span>:</strong> The Michaelis-Menten model provides a significantly better fit to the data than a simple linear model.</p>
<p>With the alternative hypothesis we propose that the relationship between the nutrient uptake rate and the substrate concentration is best described by the nonlinear Michaelis-Menten model, so the uptake rate initially increases with substrate concentration but eventually levels off, indicating saturation.</p>
<p>To test these hypotheses, we can:</p>
<ol type="1">
<li>Fit both the Michaelis-Menten model and a linear model to the data.</li>
<li>Compare the goodness-of-fit of both models using statistical measures such as the SSR, AIC, or BIC.</li>
<li>Perform a model comparison test (such as an <em>F</em>-test or likelihood ratio test) to determine if the improvement in fit provided by the Michaelis-Menten model is statistically significant compared to the linear model.</li>
</ol>
<p>In the above scenario, which is to decide among the linear and Michaelis-Menten models, hypotheses concerning the parameters of the models are not directly tested as they are not really of interest (except for estimating their magnitude, perhaps). Instead, the focus is on the overall goodness-of-fit of the models to the data.</p>
</section>
<section id="sec-mm-comparison" class="level4">
<h4 class="anchored" data-anchor-id="sec-mm-comparison">Comparing Two Michaelis-Menten Models</h4>
<p>Here, we may be interested in testing whether the parameters <span class="math inline">V_\text{max}</span> and <span class="math inline">K_m</span> differ from some hypothesised values or across different experimental conditions.</p>
<p>In the first instance, we can set up the hypotheses as follows:</p>
<p><strong><span class="math inline">H_0:</span></strong> <span class="math inline">V_\text{max} = V_\text{max}^*</span> and <span class="math inline">K_m = K_m^*</span></p>
<p>where <span class="math inline">V_\text{max}^*</span> and <span class="math inline">K_m^*</span> are the hypothesised values (or values from a reference condition) for the maximum uptake rate and Michaelis constant, respectively.</p>
<p><strong><span class="math inline">H_a:</span></strong> <span class="math inline">V_\text{max} \neq V_\text{max}^*</span> or <span class="math inline">K_m \neq K_m^*</span></p>
<p>This alternative hypothesis states that at least one of the parameters (<span class="math inline">V_\text{max}</span> or <span class="math inline">K_m</span>) differs from the hypothesised value.</p>
<p>If the experiment involves different experimental conditions or treatments, we can modify the hypotheses accordingly. For example, if we want to test whether the parameters differ between two experimental conditions (A and B), the hypotheses could be:</p>
<p><span class="math inline">H_0: V_\text{max}^A = V_\text{max}^B</span> and <span class="math inline">K_m^A = K_m^B</span></p>
<p><span class="math inline">H_a: V_\text{max}^A \neq V_\text{max}^B</span> or <span class="math inline">K_m^A \neq K_m^B</span></p>
<p>In this case, the null hypothesis states that the maximum uptake rate and Michaelis constant are the same for both experimental conditions, while the alternative hypothesis states that at least one of the parameters differs between the two conditions.</p>
<p>After fitting the Michaelis-Menten model to the data using the <code>nls()</code> or <code>nlme()</code> functions in R, appropriate statistical tests (e.g., likelihood ratio tests, Wald tests, or other model comparison techniques) can be performed to evaluate the hypotheses and determine whether the parameter estimates significantly differ from the hypothesised values or across experimental conditions.</p>
</section>
</section>
<section id="multiple-flask-experiment" class="level3 page-columns page-full">
<h3 class="anchored" data-anchor-id="multiple-flask-experiment">Multiple Flask Experiment</h3>
<section id="sec-mf-single" class="level4 page-columns page-full">
<h4 class="anchored" data-anchor-id="sec-mf-single">Fitting a single model (NLS)</h4>
<p>To demonstrate fitting a nonlinear model to <span class="math inline">V</span> vs <span class="math inline">[S]</span> data produced from a multiple flask experiment, I simulate data across a range of substrate concentrations. We then fit the model to the data using the <code>nls()</code> function in R. The dataset consists of five replicate flask sets (<span class="math inline">n=5</span>) for each of 13 substrate concentrations. Each set therefore results in independently estimated uptake rates for the initial nutrient concentrations. The dataset is shown in <a href="#tbl-mf1" class="quarto-xref">Table&nbsp;<span>7.2</span></a>, and a plot of <span class="math inline">V</span> as a function of <span class="math inline">[S]</span> is shown in <a href="#fig-mf1" class="quarto-xref">Figure&nbsp;<span>7.3</span></a>.</p>
<div class="cell page-columns page-full" data-messages="false">
<div id="tbl-mf1" class="cell quarto-float quarto-figure quarto-figure-center anchored page-columns page-full" data-messages="false">
<figure class="quarto-float quarto-float-tbl figure page-columns page-full">
<div aria-describedby="tbl-mf1-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="cell-output-display">
<div id="sogcehzjwl" style="padding-left:0px;padding-right:0px;padding-top:10px;padding-bottom:10px;overflow-x:auto;overflow-y:auto;width:auto;height:auto;">
<style>#sogcehzjwl table {
  font-family: system-ui, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol', 'Noto Color Emoji';
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
}

#sogcehzjwl thead, #sogcehzjwl tbody, #sogcehzjwl tfoot, #sogcehzjwl tr, #sogcehzjwl td, #sogcehzjwl th {
  border-style: none;
}

#sogcehzjwl p {
  margin: 0;
  padding: 0;
}

#sogcehzjwl .gt_table {
  display: table;
  border-collapse: collapse;
  line-height: normal;
  margin-left: auto;
  margin-right: auto;
  color: #333333;
  font-size: 16px;
  font-weight: normal;
  font-style: normal;
  background-color: #FFFFFF;
  width: auto;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #A8A8A8;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #A8A8A8;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
}

#sogcehzjwl .gt_caption {
  padding-top: 4px;
  padding-bottom: 4px;
}

#sogcehzjwl .gt_title {
  color: #333333;
  font-size: 125%;
  font-weight: initial;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-color: #FFFFFF;
  border-bottom-width: 0;
}

#sogcehzjwl .gt_subtitle {
  color: #333333;
  font-size: 85%;
  font-weight: initial;
  padding-top: 3px;
  padding-bottom: 5px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-color: #FFFFFF;
  border-top-width: 0;
}

#sogcehzjwl .gt_heading {
  background-color: #FFFFFF;
  text-align: center;
  border-bottom-color: #FFFFFF;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#sogcehzjwl .gt_bottom_border {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#sogcehzjwl .gt_col_headings {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#sogcehzjwl .gt_col_heading {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 6px;
  padding-left: 5px;
  padding-right: 5px;
  overflow-x: hidden;
}

#sogcehzjwl .gt_column_spanner_outer {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  padding-top: 0;
  padding-bottom: 0;
  padding-left: 4px;
  padding-right: 4px;
}

#sogcehzjwl .gt_column_spanner_outer:first-child {
  padding-left: 0;
}

#sogcehzjwl .gt_column_spanner_outer:last-child {
  padding-right: 0;
}

#sogcehzjwl .gt_column_spanner {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 5px;
  overflow-x: hidden;
  display: inline-block;
  width: 100%;
}

#sogcehzjwl .gt_spanner_row {
  border-bottom-style: hidden;
}

#sogcehzjwl .gt_group_heading {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  text-align: left;
}

#sogcehzjwl .gt_empty_group_heading {
  padding: 0.5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: middle;
}

#sogcehzjwl .gt_from_md > :first-child {
  margin-top: 0;
}

#sogcehzjwl .gt_from_md > :last-child {
  margin-bottom: 0;
}

#sogcehzjwl .gt_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  margin: 10px;
  border-top-style: solid;
  border-top-width: 1px;
  border-top-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  overflow-x: hidden;
}

#sogcehzjwl .gt_stub {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
}

#sogcehzjwl .gt_stub_row_group {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
  vertical-align: top;
}

#sogcehzjwl .gt_row_group_first td {
  border-top-width: 2px;
}

#sogcehzjwl .gt_row_group_first th {
  border-top-width: 2px;
}

#sogcehzjwl .gt_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#sogcehzjwl .gt_first_summary_row {
  border-top-style: solid;
  border-top-color: #D3D3D3;
}

#sogcehzjwl .gt_first_summary_row.thick {
  border-top-width: 2px;
}

#sogcehzjwl .gt_last_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#sogcehzjwl .gt_grand_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#sogcehzjwl .gt_first_grand_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: double;
  border-top-width: 6px;
  border-top-color: #D3D3D3;
}

#sogcehzjwl .gt_last_grand_summary_row_top {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: double;
  border-bottom-width: 6px;
  border-bottom-color: #D3D3D3;
}

#sogcehzjwl .gt_striped {
  background-color: rgba(128, 128, 128, 0.05);
}

#sogcehzjwl .gt_table_body {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#sogcehzjwl .gt_footnotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#sogcehzjwl .gt_footnote {
  margin: 0px;
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#sogcehzjwl .gt_sourcenotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#sogcehzjwl .gt_sourcenote {
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#sogcehzjwl .gt_left {
  text-align: left;
}

#sogcehzjwl .gt_center {
  text-align: center;
}

#sogcehzjwl .gt_right {
  text-align: right;
  font-variant-numeric: tabular-nums;
}

#sogcehzjwl .gt_font_normal {
  font-weight: normal;
}

#sogcehzjwl .gt_font_bold {
  font-weight: bold;
}

#sogcehzjwl .gt_font_italic {
  font-style: italic;
}

#sogcehzjwl .gt_super {
  font-size: 65%;
}

#sogcehzjwl .gt_footnote_marks {
  font-size: 75%;
  vertical-align: 0.4em;
  position: initial;
}

#sogcehzjwl .gt_asterisk {
  font-size: 100%;
  vertical-align: 0;
}

#sogcehzjwl .gt_indent_1 {
  text-indent: 5px;
}

#sogcehzjwl .gt_indent_2 {
  text-indent: 10px;
}

#sogcehzjwl .gt_indent_3 {
  text-indent: 15px;
}

#sogcehzjwl .gt_indent_4 {
  text-indent: 20px;
}

#sogcehzjwl .gt_indent_5 {
  text-indent: 25px;
}

#sogcehzjwl .katex-display {
  display: inline-flex !important;
  margin-bottom: 0.75em !important;
}

#sogcehzjwl div.Reactable > div.rt-table > div.rt-thead > div.rt-tr.rt-tr-group-header > div.rt-th-group:after {
  height: 0px !important;
}
</style>

<table class="gt_table do-not-create-environment cell table table-sm table-striped small" data-quarto-postprocess="true" data-quarto-disable-processing="false" data-quarto-bootstrap="false">
<thead>
<tr class="header gt_col_headings">
<th id="Replicate flask" class="gt_col_heading gt_columns_bottom_border gt_center" data-quarto-table-cell-role="th" scope="col">Replicate flask</th>
<th id="[S]" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" scope="col">[S]</th>
<th id="V" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" scope="col">V</th>
</tr>
</thead>
<tbody class="gt_table_body">
<tr class="odd">
<td class="gt_row gt_center" headers="rep">1</td>
<td class="gt_row gt_right" headers="S">0</td>
<td class="gt_row gt_right" headers="V">0.00</td>
</tr>
<tr class="even">
<td class="gt_row gt_center" headers="rep">2</td>
<td class="gt_row gt_right" headers="S">0</td>
<td class="gt_row gt_right" headers="V">0.00</td>
</tr>
<tr class="odd">
<td class="gt_row gt_center" headers="rep">3</td>
<td class="gt_row gt_right" headers="S">0</td>
<td class="gt_row gt_right" headers="V">0.00</td>
</tr>
<tr class="even">
<td class="gt_row gt_center" headers="rep">3</td>
<td class="gt_row gt_right" headers="S">30</td>
<td class="gt_row gt_right" headers="V">37.64</td>
</tr>
<tr class="odd">
<td class="gt_row gt_center" headers="rep">4</td>
<td class="gt_row gt_right" headers="S">30</td>
<td class="gt_row gt_right" headers="V">37.97</td>
</tr>
<tr class="even">
<td class="gt_row gt_center" headers="rep">5</td>
<td class="gt_row gt_right" headers="S">30</td>
<td class="gt_row gt_right" headers="V">35.95</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<figcaption class="quarto-float-caption-margin quarto-float-caption quarto-float-tbl margin-caption" id="tbl-mf1-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Table&nbsp;7.2: Simulated data for a multiple flask experiment on an alga (showing only the top and bottom three rows).
</figcaption>
</figure>
</div>
</div>
<!-- ```{r} -->
<!-- #| echo: true -->
<!-- # html only -->
<!-- DT::datatable(mf_data, rownames = FALSE, options = list(pageLength = 5)) -->
<!-- ``` -->
<div class="cell page-columns page-full" data-layout-align="center" data-messages="false">
<div class="cell-output-display page-columns page-full">
<div id="fig-mf1" class="quarto-float quarto-figure quarto-figure-center anchored page-columns page-full" data-fig-align="center" data-fig-pos="t">
<figure class="quarto-float quarto-float-fig figure page-columns page-full">
<div aria-describedby="fig-mf1-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="non-linear_regression_files/figure-html/fig-mf1-1.svg" class="img-fluid quarto-figure quarto-figure-center figure-img" style="width:80.0%" data-fig-pos="t">
</div>
<figcaption class="quarto-float-caption-margin quarto-float-caption quarto-float-fig margin-caption" id="fig-mf1-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;7.3: Plot of <span class="math inline">V</span> as a function of <span class="math inline">[S]</span> for a multiple flask experiment involving seven replicate flask sets.
</figcaption>
</figure>
</div>
</div>
</div>
<p>In <a href="#fig-mf1" class="quarto-xref">Figure&nbsp;<span>7.3</span></a>, there is a clear indication that the uptake rates plateau at higher substrate concentrations, suggesting that fitting a Michaelis-Menten model is advisable. Later, I will compare this with a linear model for completeness. A central feature of this dataset is that the data were collected independently, with each flask set representing a separate experimental unit. There is no correlation between flasks within a set, and no correlation across the initial substrate concentrations. Consequently, the assumption of independence is fully met, allowing the simplest expression of the <code>nls()</code> function to be used to fit the Michaelis-Menten model to the data.</p>
<p>The Michaelis-Menten model is fit to the data using the <code>nls()</code> function in R. It is specified as:</p>
<div class="cell" data-messages="false">
<div class="sourceCode cell-code" id="annotated-cell-3"><pre class="sourceCode numberSource r code-annotation-code number-lines code-with-copy code-annotated"><code class="sourceCode r"><span id="annotated-cell-3-1"><a href="#annotated-cell-3-1"></a><span class="co"># Define the model function</span></span>
<span id="annotated-cell-3-2"><a href="#annotated-cell-3-2"></a>mm_fun <span class="ot">&lt;-</span> <span class="cf">function</span>(S, Vmax, Km) {</span>
<span id="annotated-cell-3-3"><a href="#annotated-cell-3-3"></a>  Vmax <span class="sc">*</span> S <span class="sc">/</span> (Km <span class="sc">+</span> S)</span>
<span id="annotated-cell-3-4"><a href="#annotated-cell-3-4"></a>}</span>
<span id="annotated-cell-3-5"><a href="#annotated-cell-3-5"></a></span>
<span id="annotated-cell-3-6"><a href="#annotated-cell-3-6"></a><span class="co"># Fit the nonlinear model Michaelis-Menten model</span></span>
<a class="code-annotation-anchor" data-target-cell="annotated-cell-3" data-target-annotation="1" onclick="event.preventDefault();">1</a><span id="annotated-cell-3-7" class="code-annotation-target"><a href="#annotated-cell-3-7"></a>nls_mod <span class="ot">&lt;-</span> <span class="fu">nls</span>(V <span class="sc">~</span> <span class="fu">mm_fun</span>(S, Vmax, Km),</span>
<span id="annotated-cell-3-8"><a href="#annotated-cell-3-8"></a>            <span class="at">data =</span> mf_data,</span>
<a class="code-annotation-anchor" data-target-cell="annotated-cell-3" data-target-annotation="2" onclick="event.preventDefault();">2</a><span id="annotated-cell-3-9" class="code-annotation-target"><a href="#annotated-cell-3-9"></a>            <span class="at">start =</span> <span class="fu">c</span>(<span class="at">Vmax =</span> <span class="dv">30</span>, <span class="at">Km =</span> <span class="dv">5</span>))</span><div class="code-annotation-gutter-bg"></div><div class="code-annotation-gutter"></div></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-annotation">
<dl class="code-annotation-container-grid">
<dt data-target-cell="annotated-cell-3" data-target-annotation="1">1</dt>
<dd>
<span data-code-cell="annotated-cell-3" data-code-lines="7" data-code-annotation="1">The model formula specifies the Michaelis-Menten equation, with <code>V</code> as the dependent variable on the left-hand side and <code>S</code> as the independent variable on the right. The model parameters <code>Vmax</code> and <code>Km</code> will be estimated when fitting the model.</span>
</dd>
<dt data-target-cell="annotated-cell-3" data-target-annotation="2">2</dt>
<dd>
<span data-code-cell="annotated-cell-3" data-code-lines="9" data-code-annotation="2">The <code>start</code> argument provides initial values for the model parameters. The <code>Vmax</code> and <code>Km</code> parameters are estimated by minimising the sum of squared residuals between the observed and predicted values of <code>V</code>. The <code>nls()</code> function uses an iterative process to find the best-fitting values for these parameters, and the starting values improve the success of model convergence.</span>
</dd>
</dl>
</div>
</div>
<p>Here is the model summary:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1"></a><span class="fu">summary</span>(nls_mod)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Formula: V ~ mm_fun(S, Vmax, Km)

Parameters:
     Estimate Std. Error t value Pr(&gt;|t|)    
Vmax  49.2444     0.8924   55.18   &lt;2e-16 ***
Km     9.4953     0.4474   21.22   &lt;2e-16 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Residual standard error: 1.092 on 63 degrees of freedom

Number of iterations to convergence: 4 
Achieved convergence tolerance: 4.705e-07</code></pre>
</div>
</div>
<p>The above output provides the estimates for <span class="math inline">V_{\max}</span> and <span class="math inline">K_m</span>, along with their standard errors, <em>t</em>-values, and <em>p</em>-values:</p>
<ul>
<li>The estimated maximum uptake rate (<span class="math inline">V_{\max}</span>) is approximately 49.24 <span class="math inline">\mu M N g^{-1} hr^{-1}</span> and the small standard error associated with this parameter (0.89) indicates a precise estimate. The <em>t</em>-value (55.18) is very high, and the corresponding <em>p</em>-value is extremely small (&lt;0.0001), indicating that <span class="math inline">V_{\max}</span> is highly significantly different from zero.</li>
<li>The estimated Michaelis constant (<span class="math inline">K_m</span>) is approximately 9.50 <span class="math inline">\mu M</span> and its standard error (0.45) is also small, suggesting a precise estimate. The <em>t</em>-value (21.22) and the very small <em>p</em>-value (&lt;0.0001) indicate that <span class="math inline">K_m</span> is also highly significantly different from zero.</li>
<li>The residual standard error is 1.10 on 63 degrees of freedom, indicating the average deviation of the observed uptake rates from the fitted model values.</li>
<li>The model converged in 4 iterations with a very small convergence tolerance, indicating a good fit and stability of the model.</li>
</ul>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Results
</div>
</div>
<div class="callout-body-container callout-body">
<p>The Michaelis-Menten parameters, maximum uptake rate (<span class="math inline">V_{\max}</span>) and half-saturation constant (<span class="math inline">K_m</span>), were estimated using nonlinear regression (<a href="#fig-mf2" class="quarto-xref">Figure&nbsp;<span>7.4</span></a>). The estimated <span class="math inline">V_{\max}</span> was 49.24 <span class="math inline">\mu</span>M N g<span class="math inline">^{-1}</span> hr<span class="math inline">^{-1}</span> (SE = 0.89, <span class="math inline">t = 55.18</span>, <span class="math inline">p &lt; 0.0001</span>), and the estimated <span class="math inline">K_m</span> was 9.50 <span class="math inline">\mu</span>M (SE = 0.45, <span class="math inline">t = 21.22</span>, <span class="math inline">p &lt; 0.0001</span>). Both parameters were significantly different from zero. The model fit was good, converging in 3 iterations with a residual standard error of 1.10 (63 degrees of freedom).</p>
</div>
</div>
<div class="cell page-columns page-full" data-layout-align="center" data-messages="false">
<div class="cell-output-display page-columns page-full">
<div id="fig-mf2" class="quarto-float quarto-figure quarto-figure-center anchored page-columns page-full" data-fig-align="center">
<figure class="quarto-float quarto-float-fig figure page-columns page-full">
<div aria-describedby="fig-mf2-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="non-linear_regression_files/figure-html/fig-mf2-1.svg" class="img-fluid quarto-figure quarto-figure-center figure-img" style="width:80.0%">
</div>
<figcaption class="quarto-float-caption-margin quarto-float-caption quarto-float-fig margin-caption" id="fig-mf2-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;7.4: Plot of the Michaelis-Menten model fitted to the data in <a href="#fig-mf1" class="quarto-xref">Figure&nbsp;<span>7.3</span></a>. The vertical and horizontal dashed lines indicate the estimated <span class="math inline">K_m</span> and <span class="math inline">V_{max}</span> values, respectively.
</figcaption>
</figure>
</div>
</div>
</div>
<p>The text is clear and concise, but here are a few minor changes for improved readability and precision:</p>
<p><strong>Assumption tests</strong> Since these data are simulated and drawn from a normal distribution with equal variances across the range of substrate concentrations, the assumptions of homoscedasticity and normality of residuals are inherently met. In this example, we fit the model solely to obtain estimates of the Michaelis-Menten parameters, rather than to make predictions, inferences, or calculate confidence intervals. Therefore, assumption tests are not critical at this stage. We will formally test assumptions in <a href="#sec-mf-treatments" class="quarto-xref"><span>Section 7.5.2.3</span></a> when comparing the effects of experimental treatments on kinetic parameters.</p>
</section>
<section id="is-the-michaelis-menten-model-a-better-fit-than-a-linear-model" class="level4">
<h4 class="anchored" data-anchor-id="is-the-michaelis-menten-model-a-better-fit-than-a-linear-model">Is the Michaelis-Menten model a better fit than a linear model?</h4>
<p>In <a href="#sec-linear-vs-mm" class="quarto-xref"><span>Section 7.5.1.1</span></a>, we pose a hypothesis that requires comparing a linear model to a Michaelis-Menten model fitted to the same data. <a href="#fig-mf2" class="quarto-xref">Figure&nbsp;<span>7.4</span></a> indicates the nonlinear model indeed provides a very good fit but in some situations this distinction may be less clear and require verification. Let us fit a linear model to the above data and compare it to the Michaelis-Menten model.</p>
<div class="cell" data-messages="false">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1"></a><span class="co"># Fit the linear model</span></span>
<span id="cb5-2"><a href="#cb5-2"></a>lm_mod <span class="ot">&lt;-</span> <span class="fu">lm</span>(V <span class="sc">~</span> S, <span class="at">data =</span> mf_data)</span>
<span id="cb5-3"><a href="#cb5-3"></a></span>
<span id="cb5-4"><a href="#cb5-4"></a><span class="fu">summary</span>(lm_mod)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
lm(formula = V ~ S, data = mf_data)

Residuals:
   Min     1Q Median     3Q    Max 
-9.354 -4.791  0.580  4.948  8.293 

Coefficients:
            Estimate Std. Error t value Pr(&gt;|t|)    
(Intercept)  6.46005    0.98044   6.589 1.03e-08 ***
S            1.29488    0.06683  19.376  &lt; 2e-16 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Residual standard error: 5.13 on 63 degrees of freedom
Multiple R-squared:  0.8563,    Adjusted R-squared:  0.854 
F-statistic: 375.4 on 1 and 63 DF,  p-value: &lt; 2.2e-16</code></pre>
</div>
</div>
<p>The linear model summary shows that the slope and intercept are significantly different from zero, indicating a good fit. The <span class="math inline">R^2</span> value is 0.86, which is very high, suggesting that the linear model explains 86% of the variance in the data. The residual standard error is 5.13, which is higher than the Michaelis-Menten model, indicating a worse fit. We can test the difference between the models formally by examining the AIC, BIC, or SSR, and the likelihood ratio test.</p>
<div class="cell" data-messages="false">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1"></a><span class="fu">AIC</span>(lm_mod, nls_mod)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>        df      AIC
lm_mod   3 400.9933
nls_mod  3 199.8814</code></pre>
</div>
</div>
<div class="cell" data-messages="false">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1"></a><span class="fu">BIC</span>(lm_mod, nls_mod)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>        df      BIC
lm_mod   3 407.5164
nls_mod  3 206.4046</code></pre>
</div>
</div>
<div class="cell" data-messages="false">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1"></a><span class="co"># Calculate the sum of squared residuals (SSR)</span></span>
<span id="cb11-2"><a href="#cb11-2"></a><span class="fu">sum</span>(<span class="fu">residuals</span>(lm_mod)<span class="sc">^</span><span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 1657.938</code></pre>
</div>
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1"></a><span class="fu">sum</span>(<span class="fu">residuals</span>(nls_mod)<span class="sc">^</span><span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 75.13611</code></pre>
</div>
</div>
<div class="cell" data-messages="false">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1"></a><span class="fu">anova</span>(lm_mod, nls_mod)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Analysis of Variance Table

Response: V
          Df Sum Sq Mean Sq F value    Pr(&gt;F)    
S          1 9879.9  9879.9  375.43 &lt; 2.2e-16 ***
Residuals 63 1657.9    26.3                      
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</code></pre>
</div>
</div>
<p>The AIC, BIC, and SSR values for the Michaelis-Menten model are lower than those for the linear model. Low is good, and we conclude that the Michaelis-Menten model is a better fit. The likelihood ratio test also shows that the Michaelis-Menten model is significantly better than the linear model (d.f. = 1, <span class="math inline">F=375.43</span>, <span class="math inline">p&lt;0.0001</span>). Therefore, we can conclude that the Michaelis-Menten model is the most appropriate model for these data and that the rate of nutrient uptake by the seaweed (in this example) is saturated at high nutrient concentrations.</p>
</section>
<section id="sec-mf-treatments" class="level4 page-columns page-full">
<h4 class="anchored" data-anchor-id="sec-mf-treatments">Comparing treatment effects (NLS and NLMM)</h4>
<p>Experiments are seldom as simple as the one above. To develop our example further, consider an experiment designed to assess whether an experimental treatment, such as light intensity or seawater temperature, affects the nutrient uptake rate of a seaweed. It is biologically plausible to expect that each treatment will result in unique <span class="math inline">V_{max}</span> and/or <span class="math inline">K_m</span> values. For example, we know that the uptake rate of nitrate () might increase at higher light intensities and higher temperatures. Therefore, our hypothesis for this experiment is that the nutrient uptake kinetics of the seaweed is influenced by the treatment, as more formally stated in <a href="#sec-mm-comparison" class="quarto-xref"><span>Section 7.5.1.2</span></a>. To test this hypothesis, we fit a Michaelis-Menten model so that it allows estimates of <span class="math inline">V_{max}</span> and <span class="math inline">K_m</span> to vary among treatment groups.</p>
<p>The data for a multiple flask experiment with a treatment effect comprised of three levels are provided in <a href="#tbl-mf2" class="quarto-xref">Table&nbsp;<span>7.3</span></a>. Except for a new variable (treatment), the data are in all other respects identical to those in <a href="#sec-mf-single" class="quarto-xref"><span>Section 7.5.2.1</span></a>.</p>
<div class="cell page-columns page-full" data-messages="false">
<div id="tbl-mf2" class="cell quarto-float quarto-figure quarto-figure-center anchored page-columns page-full" data-messages="false">
<figure class="quarto-float quarto-float-tbl figure page-columns page-full">
<div aria-describedby="tbl-mf2-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="cell-output-display">
<div id="pfibgcgfos" style="padding-left:0px;padding-right:0px;padding-top:10px;padding-bottom:10px;overflow-x:auto;overflow-y:auto;width:auto;height:auto;">
<style>#pfibgcgfos table {
  font-family: system-ui, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol', 'Noto Color Emoji';
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
}

#pfibgcgfos thead, #pfibgcgfos tbody, #pfibgcgfos tfoot, #pfibgcgfos tr, #pfibgcgfos td, #pfibgcgfos th {
  border-style: none;
}

#pfibgcgfos p {
  margin: 0;
  padding: 0;
}

#pfibgcgfos .gt_table {
  display: table;
  border-collapse: collapse;
  line-height: normal;
  margin-left: auto;
  margin-right: auto;
  color: #333333;
  font-size: 16px;
  font-weight: normal;
  font-style: normal;
  background-color: #FFFFFF;
  width: auto;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #A8A8A8;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #A8A8A8;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
}

#pfibgcgfos .gt_caption {
  padding-top: 4px;
  padding-bottom: 4px;
}

#pfibgcgfos .gt_title {
  color: #333333;
  font-size: 125%;
  font-weight: initial;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-color: #FFFFFF;
  border-bottom-width: 0;
}

#pfibgcgfos .gt_subtitle {
  color: #333333;
  font-size: 85%;
  font-weight: initial;
  padding-top: 3px;
  padding-bottom: 5px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-color: #FFFFFF;
  border-top-width: 0;
}

#pfibgcgfos .gt_heading {
  background-color: #FFFFFF;
  text-align: center;
  border-bottom-color: #FFFFFF;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#pfibgcgfos .gt_bottom_border {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#pfibgcgfos .gt_col_headings {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#pfibgcgfos .gt_col_heading {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 6px;
  padding-left: 5px;
  padding-right: 5px;
  overflow-x: hidden;
}

#pfibgcgfos .gt_column_spanner_outer {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  padding-top: 0;
  padding-bottom: 0;
  padding-left: 4px;
  padding-right: 4px;
}

#pfibgcgfos .gt_column_spanner_outer:first-child {
  padding-left: 0;
}

#pfibgcgfos .gt_column_spanner_outer:last-child {
  padding-right: 0;
}

#pfibgcgfos .gt_column_spanner {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 5px;
  overflow-x: hidden;
  display: inline-block;
  width: 100%;
}

#pfibgcgfos .gt_spanner_row {
  border-bottom-style: hidden;
}

#pfibgcgfos .gt_group_heading {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  text-align: left;
}

#pfibgcgfos .gt_empty_group_heading {
  padding: 0.5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: middle;
}

#pfibgcgfos .gt_from_md > :first-child {
  margin-top: 0;
}

#pfibgcgfos .gt_from_md > :last-child {
  margin-bottom: 0;
}

#pfibgcgfos .gt_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  margin: 10px;
  border-top-style: solid;
  border-top-width: 1px;
  border-top-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  overflow-x: hidden;
}

#pfibgcgfos .gt_stub {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
}

#pfibgcgfos .gt_stub_row_group {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
  vertical-align: top;
}

#pfibgcgfos .gt_row_group_first td {
  border-top-width: 2px;
}

#pfibgcgfos .gt_row_group_first th {
  border-top-width: 2px;
}

#pfibgcgfos .gt_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#pfibgcgfos .gt_first_summary_row {
  border-top-style: solid;
  border-top-color: #D3D3D3;
}

#pfibgcgfos .gt_first_summary_row.thick {
  border-top-width: 2px;
}

#pfibgcgfos .gt_last_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#pfibgcgfos .gt_grand_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#pfibgcgfos .gt_first_grand_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: double;
  border-top-width: 6px;
  border-top-color: #D3D3D3;
}

#pfibgcgfos .gt_last_grand_summary_row_top {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: double;
  border-bottom-width: 6px;
  border-bottom-color: #D3D3D3;
}

#pfibgcgfos .gt_striped {
  background-color: rgba(128, 128, 128, 0.05);
}

#pfibgcgfos .gt_table_body {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#pfibgcgfos .gt_footnotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#pfibgcgfos .gt_footnote {
  margin: 0px;
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#pfibgcgfos .gt_sourcenotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#pfibgcgfos .gt_sourcenote {
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#pfibgcgfos .gt_left {
  text-align: left;
}

#pfibgcgfos .gt_center {
  text-align: center;
}

#pfibgcgfos .gt_right {
  text-align: right;
  font-variant-numeric: tabular-nums;
}

#pfibgcgfos .gt_font_normal {
  font-weight: normal;
}

#pfibgcgfos .gt_font_bold {
  font-weight: bold;
}

#pfibgcgfos .gt_font_italic {
  font-style: italic;
}

#pfibgcgfos .gt_super {
  font-size: 65%;
}

#pfibgcgfos .gt_footnote_marks {
  font-size: 75%;
  vertical-align: 0.4em;
  position: initial;
}

#pfibgcgfos .gt_asterisk {
  font-size: 100%;
  vertical-align: 0;
}

#pfibgcgfos .gt_indent_1 {
  text-indent: 5px;
}

#pfibgcgfos .gt_indent_2 {
  text-indent: 10px;
}

#pfibgcgfos .gt_indent_3 {
  text-indent: 15px;
}

#pfibgcgfos .gt_indent_4 {
  text-indent: 20px;
}

#pfibgcgfos .gt_indent_5 {
  text-indent: 25px;
}

#pfibgcgfos .katex-display {
  display: inline-flex !important;
  margin-bottom: 0.75em !important;
}

#pfibgcgfos div.Reactable > div.rt-table > div.rt-thead > div.rt-tr.rt-tr-group-header > div.rt-th-group:after {
  height: 0px !important;
}
</style>

<table class="gt_table do-not-create-environment cell table table-sm table-striped small" data-quarto-postprocess="true" data-quarto-disable-processing="false" data-quarto-bootstrap="false">
<thead>
<tr class="header gt_col_headings">
<th id="Treatment" class="gt_col_heading gt_columns_bottom_border gt_center" data-quarto-table-cell-role="th" scope="col">Treatment</th>
<th id="Replicate flask" class="gt_col_heading gt_columns_bottom_border gt_center" data-quarto-table-cell-role="th" scope="col">Replicate flask</th>
<th id="[S]" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" scope="col">[S]</th>
<th id="V" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" scope="col">V</th>
</tr>
</thead>
<tbody class="gt_table_body">
<tr class="odd">
<td class="gt_row gt_center" headers="trt">Treatment 1</td>
<td class="gt_row gt_center" headers="rep">1</td>
<td class="gt_row gt_right" headers="S">0</td>
<td class="gt_row gt_right" headers="V">0.00</td>
</tr>
<tr class="even">
<td class="gt_row gt_center" headers="trt">Treatment 1</td>
<td class="gt_row gt_center" headers="rep">2</td>
<td class="gt_row gt_right" headers="S">0</td>
<td class="gt_row gt_right" headers="V">0.00</td>
</tr>
<tr class="odd">
<td class="gt_row gt_center" headers="trt">Treatment 1</td>
<td class="gt_row gt_center" headers="rep">3</td>
<td class="gt_row gt_right" headers="S">0</td>
<td class="gt_row gt_right" headers="V">0.00</td>
</tr>
<tr class="even">
<td class="gt_row gt_center" headers="trt">Treatment 3</td>
<td class="gt_row gt_center" headers="rep">3</td>
<td class="gt_row gt_right" headers="S">30</td>
<td class="gt_row gt_right" headers="V">17.19</td>
</tr>
<tr class="odd">
<td class="gt_row gt_center" headers="trt">Treatment 3</td>
<td class="gt_row gt_center" headers="rep">4</td>
<td class="gt_row gt_right" headers="S">30</td>
<td class="gt_row gt_right" headers="V">16.66</td>
</tr>
<tr class="even">
<td class="gt_row gt_center" headers="trt">Treatment 3</td>
<td class="gt_row gt_center" headers="rep">5</td>
<td class="gt_row gt_right" headers="S">30</td>
<td class="gt_row gt_right" headers="V">16.00</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<figcaption class="quarto-float-caption-margin quarto-float-caption quarto-float-tbl margin-caption" id="tbl-mf2-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Table&nbsp;7.3: Simulated data with three treatment levels for a multiple flask experiment on a seaweed species.
</figcaption>
</figure>
</div>
</div>
<p><strong>Option 1</strong> The <code>nls()</code> function in R does not handle factor variables directly, which means we cannot include the treatment variable as a factor in the model formula. To address this limitation, we fit the <code>nls()</code> model separately for each treatment group. This approach allows each treatment to have its own <span class="math inline">V_{\max}</span> and <span class="math inline">K_m</span> values, effectively accommodating the variability in the Michaelis-Menten parameters across treatments.</p>
<p>In addition to fitting separate models for each treatment, we also fit a global model (a null model) to all the data. The global model assumes that the effect of the experimental treatment is negligible, meaning that all treatments share the same <span class="math inline">V_{\max}</span> and <span class="math inline">K_m</span>. This global fit serves as a baseline for comparison.</p>
<p>To determine whether the Michaelis-Menten parameters significantly differ among the treatment groups, we perform a likelihood ratio test. The likelihood ratio test compares the fit of the global model (where parameters are shared across treatments) to the combined fit of the separate models (where parameters vary by treatment). The test statistic is the difference in the log-likelihoods of the two models, which follows a <span class="math inline">\chi^2</span> distribution with degrees of freedom equal to the difference in the number of parameters between the two models.</p>
<div class="cell" data-messages="false">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1"></a><span class="co"># Fit separate models</span></span>
<span id="cb17-2"><a href="#cb17-2"></a>separate_models <span class="ot">&lt;-</span> mf_data2 <span class="sc">|&gt;</span></span>
<span id="cb17-3"><a href="#cb17-3"></a>  <span class="fu">group_by</span>(trt) <span class="sc">|&gt;</span></span>
<span id="cb17-4"><a href="#cb17-4"></a>  <span class="fu">nest</span>() <span class="sc">|&gt;</span></span>
<span id="cb17-5"><a href="#cb17-5"></a>  <span class="fu">mutate</span>(<span class="at">model =</span> <span class="fu">map</span>(data, <span class="sc">~</span><span class="fu">nls</span>(V <span class="sc">~</span> <span class="fu">mm_fun</span>(S, Vmax, Km),</span>
<span id="cb17-6"><a href="#cb17-6"></a>                                <span class="at">data =</span> .x,</span>
<span id="cb17-7"><a href="#cb17-7"></a>                                <span class="at">start =</span> <span class="fu">list</span>(<span class="at">Vmax =</span> <span class="dv">40</span>, <span class="at">Km =</span> <span class="dv">10</span>))))</span>
<span id="cb17-8"><a href="#cb17-8"></a></span>
<span id="cb17-9"><a href="#cb17-9"></a><span class="co"># Extract model summaries of separate models</span></span>
<span id="cb17-10"><a href="#cb17-10"></a>model_summaries <span class="ot">&lt;-</span> separate_models<span class="sc">|&gt;</span></span>
<span id="cb17-11"><a href="#cb17-11"></a>  <span class="fu">mutate</span>(<span class="at">summary =</span> <span class="fu">map</span>(model, broom<span class="sc">::</span>tidy))</span>
<span id="cb17-12"><a href="#cb17-12"></a></span>
<span id="cb17-13"><a href="#cb17-13"></a><span class="co"># Display summaries of separate models</span></span>
<span id="cb17-14"><a href="#cb17-14"></a>model_summaries <span class="sc">|&gt;</span></span>
<span id="cb17-15"><a href="#cb17-15"></a>  <span class="fu">select</span>(trt, summary) <span class="sc">|&gt;</span></span>
<span id="cb17-16"><a href="#cb17-16"></a>  <span class="fu">unnest</span>(summary)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 6 Ã— 6
# Groups:   trt [3]
  trt         term  estimate std.error statistic  p.value
  &lt;fct&gt;       &lt;chr&gt;    &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;    &lt;dbl&gt;
1 Treatment 1 Vmax     49.2      0.958      51.4 3.94e-53
2 Treatment 1 Km        9.55     0.482      19.8 9.50e-29
3 Treatment 2 Vmax     39.4      0.865      45.5 6.66e-50
4 Treatment 2 Km        7.54     0.481      15.7 2.14e-23
5 Treatment 3 Vmax     19.2      0.558      34.5 1.34e-42
6 Treatment 3 Km        5.87     0.560      10.5 1.97e-15</code></pre>
</div>
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1"></a><span class="co"># Fit the global model</span></span>
<span id="cb19-2"><a href="#cb19-2"></a>global_model <span class="ot">&lt;-</span> <span class="fu">nls</span>(V <span class="sc">~</span> <span class="fu">mm_fun</span>(S, Vmax, Km),</span>
<span id="cb19-3"><a href="#cb19-3"></a>                    <span class="at">data =</span> mf_data2,</span>
<span id="cb19-4"><a href="#cb19-4"></a>                    <span class="at">start =</span> <span class="fu">list</span>(<span class="at">Vmax =</span> <span class="dv">45</span>, <span class="at">Km =</span> <span class="dv">9</span>))</span>
<span id="cb19-5"><a href="#cb19-5"></a></span>
<span id="cb19-6"><a href="#cb19-6"></a><span class="co"># Extract log-likelihoods and degrees of freedom</span></span>
<span id="cb19-7"><a href="#cb19-7"></a>logLik_global <span class="ot">&lt;-</span> <span class="fu">logLik</span>(global_model)</span>
<span id="cb19-8"><a href="#cb19-8"></a>df_global <span class="ot">&lt;-</span> <span class="fu">attr</span>(logLik_global, <span class="st">"df"</span>)</span>
<span id="cb19-9"><a href="#cb19-9"></a></span>
<span id="cb19-10"><a href="#cb19-10"></a><span class="co"># Combined log-likelihoods and degrees of freedom</span></span>
<span id="cb19-11"><a href="#cb19-11"></a>logLik_separate <span class="ot">&lt;-</span> <span class="fu">sum</span>(<span class="fu">sapply</span>(separate_models<span class="sc">$</span>model, logLik))</span>
<span id="cb19-12"><a href="#cb19-12"></a>df_separate <span class="ot">&lt;-</span> <span class="fu">sum</span>(<span class="fu">sapply</span>(separate_models<span class="sc">$</span>model,</span>
<span id="cb19-13"><a href="#cb19-13"></a>                          <span class="cf">function</span>(m) <span class="fu">attr</span>(<span class="fu">logLik</span>(m), <span class="st">"df"</span>)))</span>
<span id="cb19-14"><a href="#cb19-14"></a></span>
<span id="cb19-15"><a href="#cb19-15"></a><span class="co"># Perform the likelihood ratio test</span></span>
<span id="cb19-16"><a href="#cb19-16"></a>lrt_stat <span class="ot">&lt;-</span> <span class="dv">2</span> <span class="sc">*</span> (logLik_separate <span class="sc">-</span> logLik_global)</span>
<span id="cb19-17"><a href="#cb19-17"></a>p_value <span class="ot">&lt;-</span> <span class="fu">pchisq</span>(lrt_stat, <span class="at">df =</span> df_separate <span class="sc">-</span> df_global,</span>
<span id="cb19-18"><a href="#cb19-18"></a>                  <span class="at">lower.tail =</span> <span class="cn">FALSE</span>)</span>
<span id="cb19-19"><a href="#cb19-19"></a></span>
<span id="cb19-20"><a href="#cb19-20"></a><span class="co"># Display results</span></span>
<span id="cb19-21"><a href="#cb19-21"></a><span class="fu">cat</span>(<span class="st">"Global model log-likelihood:"</span>, logLik_global, <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Global model log-likelihood: -620.5374 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1"></a><span class="fu">cat</span>(<span class="st">"Separate models log-likelihood:"</span>, logLik_separate, <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Separate models log-likelihood: -300.2111 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1"></a><span class="fu">cat</span>(<span class="st">"Degree of freedom:"</span>, df_separate <span class="sc">-</span> df_global, <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Degree of freedom: 6 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1"></a><span class="fu">cat</span>(<span class="st">"Likelihood ratio test statistic:"</span>, lrt_stat, <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Likelihood ratio test statistic: 640.6525 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1"></a><span class="fu">cat</span>(<span class="st">"p-value:"</span>, p_value, <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>p-value: 3.953134e-135 </code></pre>
</div>
</div>
<p>The results of the likelihood ratio test indicate whether the variation in <span class="math inline">V_{\max}</span> and <span class="math inline">K_m</span> among the treatments is statistically significant. If the test is significant, it suggests that the Michaelis-Menten parameters differ across treatments. We interpret the results as follows:</p>
<ul>
<li>The log-likelihood value (-620.7498) for the global model, indicating the fit of the model with shared parameters.</li>
<li>The combined log-likelihood value (-313.1862) for the separate models, indicating the fit of the models with parameters varying by treatment.</li>
<li>The calculated test statistic (615.1273) for the likelihood ratio test on 6 degrees of freedom.</li>
<li>The <em>p</em>-value of the test is less than 0.0001 and provides strong evidence that <span class="math inline">V_{\max}</span> and <span class="math inline">K_m</span> differ significantly among the treatment groups.</li>
</ul>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Results
</div>
</div>
<div class="callout-body-container callout-body">
<p>The analysis aimed to determine if the Michaelis-Menten parameters <span class="math inline">V_{\max}</span> and <span class="math inline">K_m</span> significantly differed among the three experimental treatments. This was evaluated by fitting a global model with shared <span class="math inline">V_{\max}</span> and <span class="math inline">K_m</span> values across all treatments and comparing it to a model allowing separate <span class="math inline">V_{\max}</span> and <span class="math inline">K_m</span> estimates for each treatment. The log-likelihood value for the global model, which assumes shared <span class="math inline">V_{\max}</span> and <span class="math inline">K_m</span> values across all treatments, was -620.75, indicating the fit of the model with common parameters. In contrast, the combined log-likelihood value for the separate models, which allow <span class="math inline">V_{\max}</span> and <span class="math inline">K_m</span> to vary by treatment, was -313.19, indicating the fit of the models with treatment-specific parameters. The calculated test statistic for the likelihood ratio test was 615.13 (d.f. = 6, <em>p</em> &lt; 0.001), providing strong evidence that the Michaelis-Menten parameters <span class="math inline">V_{\max}</span> and <span class="math inline">K_m</span> differ significantly among the treatment groups. Consequently we estimate a <span class="math inline">V_{max}</span> of 49.2 Â± 0.96, 39.4 Â± 0.87 <span class="math inline">\mu</span>M N g<span class="math inline">^{-1}</span> hr<span class="math inline">^{-1}</span> and 18.9 Â± 0.65 and a <span class="math inline">K_m</span> of 9.55 Â± 0.48, 7.54 Â± 0.48 and 5.50 Â± 0.64 <span class="math inline">\mu</span>M for treatments 1, 2 and 3 respectively.</p>
</div>
</div>
<p><strong>Option 2</strong> If Option 1 seems cumbersome, we can fit a NLMM using the <strong>nlme</strong> package instead. This package allows us to fit a mixed model with random effects for each treatment group. In this model, the fixed effects are the Michaelis-Menten parameters <span class="math inline">V_{\max}</span> and <span class="math inline">K_m</span>, which vary by treatment, while the random effects are the replicate-specific intercepts. Thus, the cumbersome <code>nls()</code> formulation is replaced by the compact but more fiddly <code>nlme()</code> model specification. Pick your poison. The model is specified as follows:</p>
<div class="cell" data-messages="false">
<div class="sourceCode cell-code" id="annotated-cell-17"><pre class="sourceCode numberSource r code-annotation-code number-lines code-with-copy code-annotated"><code class="sourceCode r"><span id="annotated-cell-17-1"><a href="#annotated-cell-17-1"></a><span class="co"># Fit the model with the same parameters for both treatments</span></span>
<span id="annotated-cell-17-2"><a href="#annotated-cell-17-2"></a><span class="co"># Starting values for Vmax and Km</span></span>
<span id="annotated-cell-17-3"><a href="#annotated-cell-17-3"></a>start_vals <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="at">Vmax =</span> <span class="dv">50</span>, <span class="at">Km =</span> <span class="dv">10</span>)</span>
<span id="annotated-cell-17-4"><a href="#annotated-cell-17-4"></a>global_model <span class="ot">&lt;-</span> <span class="fu">nlme</span>(</span>
<span id="annotated-cell-17-5"><a href="#annotated-cell-17-5"></a>  V <span class="sc">~</span> <span class="fu">mm_fun</span>(S, Vmax, Km),</span>
<span id="annotated-cell-17-6"><a href="#annotated-cell-17-6"></a>  <span class="at">data =</span> mf_data2,</span>
<a class="code-annotation-anchor" data-target-cell="annotated-cell-17" data-target-annotation="1" onclick="event.preventDefault();">1</a><span id="annotated-cell-17-7" class="code-annotation-target"><a href="#annotated-cell-17-7"></a>  <span class="at">fixed =</span> Vmax <span class="sc">+</span> Km <span class="sc">~</span> <span class="dv">1</span>,</span>
<a class="code-annotation-anchor" data-target-cell="annotated-cell-17" data-target-annotation="2" onclick="event.preventDefault();">2</a><span id="annotated-cell-17-8" class="code-annotation-target"><a href="#annotated-cell-17-8"></a>  <span class="at">random =</span> Vmax <span class="sc">~</span> <span class="dv">1</span> <span class="sc">|</span> trt<span class="sc">/</span>rep,</span>
<span id="annotated-cell-17-9"><a href="#annotated-cell-17-9"></a>  <span class="at">start =</span> start_vals</span>
<span id="annotated-cell-17-10"><a href="#annotated-cell-17-10"></a>)</span>
<span id="annotated-cell-17-11"><a href="#annotated-cell-17-11"></a></span>
<span id="annotated-cell-17-12"><a href="#annotated-cell-17-12"></a><span class="co"># Fit the model with parameters varying by treatment</span></span>
<span id="annotated-cell-17-13"><a href="#annotated-cell-17-13"></a><span class="co"># Starting values for Vmax and Km for each treatment</span></span>
<span id="annotated-cell-17-14"><a href="#annotated-cell-17-14"></a>start_vals <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="at">Vmax1 =</span> <span class="dv">50</span>, <span class="at">Vmax2 =</span> <span class="dv">40</span>, <span class="at">Vmax3 =</span> <span class="dv">30</span>,</span>
<a class="code-annotation-anchor" data-target-cell="annotated-cell-17" data-target-annotation="3" onclick="event.preventDefault();">3</a><span id="annotated-cell-17-15" class="code-annotation-target"><a href="#annotated-cell-17-15"></a>                <span class="at">Km1 =</span> <span class="dv">10</span>, <span class="at">Km2 =</span> <span class="dv">10</span>, <span class="at">Km3 =</span> <span class="dv">5</span>)</span>
<span id="annotated-cell-17-16"><a href="#annotated-cell-17-16"></a>separate_models <span class="ot">&lt;-</span> <span class="fu">nlme</span>(</span>
<span id="annotated-cell-17-17"><a href="#annotated-cell-17-17"></a>  V <span class="sc">~</span> <span class="fu">mm_fun</span>(S, Vmax, Km),</span>
<span id="annotated-cell-17-18"><a href="#annotated-cell-17-18"></a>  <span class="at">data =</span> mf_data2,</span>
<a class="code-annotation-anchor" data-target-cell="annotated-cell-17" data-target-annotation="4" onclick="event.preventDefault();">4</a><span id="annotated-cell-17-19" class="code-annotation-target"><a href="#annotated-cell-17-19"></a>  <span class="at">fixed =</span> <span class="fu">list</span>(Vmax <span class="sc">~</span> trt, Km <span class="sc">~</span> trt),</span>
<span id="annotated-cell-17-20"><a href="#annotated-cell-17-20"></a>  <span class="at">random =</span> Vmax <span class="sc">~</span> <span class="dv">1</span> <span class="sc">|</span> trt<span class="sc">/</span>rep,</span>
<span id="annotated-cell-17-21"><a href="#annotated-cell-17-21"></a>  <span class="at">start =</span> start_vals</span>
<span id="annotated-cell-17-22"><a href="#annotated-cell-17-22"></a>)</span><div class="code-annotation-gutter-bg"></div><div class="code-annotation-gutter"></div></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-annotation">
<dl class="code-annotation-container-grid">
<dt data-target-cell="annotated-cell-17" data-target-annotation="1">1</dt>
<dd>
<span data-code-cell="annotated-cell-17" data-code-lines="7" data-code-annotation="1">The fixed effects indicate that both <span class="math inline">V_{\max}</span> and <span class="math inline">K_m</span> are fixed (do not vary) across treatments.</span>
</dd>
<dt data-target-cell="annotated-cell-17" data-target-annotation="2">2</dt>
<dd>
<span data-code-cell="annotated-cell-17" data-code-lines="8" data-code-annotation="2">The random effects indicate that the <span class="math inline">V_{\max}</span> parameter varies by treatment and replicate.</span>
</dd>
<dt data-target-cell="annotated-cell-17" data-target-annotation="3">3</dt>
<dd>
<span data-code-cell="annotated-cell-17" data-code-lines="15" data-code-annotation="3">The starting values for the <span class="math inline">V_{\max}</span> and <span class="math inline">K_m</span> parameters are specified for each treatment group. Because we are now fitting a separate model for each treatment, we need to provide starting values for each treatment.</span>
</dd>
<dt data-target-cell="annotated-cell-17" data-target-annotation="4">4</dt>
<dd>
<span data-code-cell="annotated-cell-17" data-code-lines="19" data-code-annotation="4">The fixed effects now indicate that both <span class="math inline">V_{\max}</span> and <span class="math inline">K_m</span> vary by treatment.</span>
</dd>
</dl>
</div>
</div>
<p>The estimated parameters for the global model and the separate models can be extracted using the <code>summary()</code> function:</p>
<div class="cell" data-messages="false">
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1"></a><span class="co"># Extract the estimated parameters (abbreviated output)</span></span>
<span id="cb29-2"><a href="#cb29-2"></a><span class="co"># summary(global_model) # for verbose output</span></span>
<span id="cb29-3"><a href="#cb29-3"></a><span class="fu">summary</span>(global_model)<span class="sc">$</span>tTable</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>         Value Std.Error  DF   t-value      p-value
Vmax 36.248519  6.287216 179  5.765432 3.504878e-08
Km    8.271727  0.304345 179 27.178780 1.952829e-65</code></pre>
</div>
</div>
<div class="cell" data-messages="false">
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1"></a><span class="co"># Extract the estimated parameters (abbreviated output)</span></span>
<span id="cb31-2"><a href="#cb31-2"></a><span class="co"># summary(separate_models) # for verbose output</span></span>
<span id="cb31-3"><a href="#cb31-3"></a><span class="fu">summary</span>(separate_models)<span class="sc">$</span>tTable</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>                         Value Std.Error  DF    t-value       p-value
Vmax.(Intercept)     49.199643 0.9498953 175  51.794808 4.546825e-108
Vmax.trtTreatment 2  -9.879910 1.2312719 175  -8.024150  1.422499e-13
Vmax.trtTreatment 3 -29.971535 1.1529098 175 -25.996427  5.425758e-62
Km.(Intercept)        9.542071 0.4707903 175  20.268197  8.782004e-48
Km.trtTreatment 2    -2.027313 0.6350017 175  -3.192611  1.671900e-03
Km.trtTreatment 3    -3.689268 0.7898830 175  -4.670651  5.961284e-06</code></pre>
</div>
</div>
<p>The log-likelihood ratio test can then easily be performed using the <code>anova()</code> function, which compares the global model with the separate models:</p>
<div class="cell" data-messages="false">
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb33-1"><a href="#cb33-1"></a><span class="fu">anova</span>(global_model, separate_models)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>                Model df      AIC      BIC    logLik   Test  L.Ratio p-value
global_model        1  5 657.9763 674.3413 -323.9882                        
separate_models     2  9 621.5038 650.9608 -301.7519 1 vs 2 44.47252  &lt;.0001</code></pre>
</div>
</div>
<p>Again, the results of the likelihood ratio test indicate that the variation in <span class="math inline">V_{\max}</span> and <span class="math inline">K_m</span> among the treatments is statistically significant (log-likelihood = 45.20, <em>p</em> &lt; 0.0001). The AIC values can also be used to compare the models, with lower AIC values indicating a better fit. In this case, the separate models have a lower AIC value (644.28), suggesting that they provide a better fit to the data than the global model (681.479). The data fitted with the global and separate models is presented in <a href="#fig-mf3" class="quarto-xref">Figure&nbsp;<span>7.6</span></a>.</p>
<p><strong>Assumption tests</strong> To complete our example comparing the Michaelis-Menten parameters among treatments, letâ€™s confirm the assumptions by examining the residuals. Residuals in nonlinear regression models have the same interpretation as in linear models, and therefore, the assumption tests available for linear models can be applied here as well. For instance, we can use the <code>shapiro.test()</code> function to check the normality of residuals, as shown below, and the <code>hist()</code> and <code>plot()</code> functions for diagnostic plots. In real-world data, it is advised to verify these assumptions before accepting the analysis and drawing conclusions from the nonlinear regression model. Letâ€™s check the normality of residuals for each treatment and plot the residuals to check for normality and homoscedasticity (<a href="#fig-mf-assump" class="quarto-xref">Figure&nbsp;<span>7.5</span></a>).</p>
<div class="cell" data-messages="false">
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb35-1"><a href="#cb35-1"></a><span class="co"># Add residuals and fitted information to the data frame</span></span>
<span id="cb35-2"><a href="#cb35-2"></a>mf_data2<span class="sc">$</span>residuals_separate <span class="ot">&lt;-</span> <span class="fu">residuals</span>(separate_models)</span>
<span id="cb35-3"><a href="#cb35-3"></a>mf_data2<span class="sc">$</span>fitted_values_separate <span class="ot">&lt;-</span> <span class="fu">fitted</span>(separate_models)</span>
<span id="cb35-4"><a href="#cb35-4"></a></span>
<span id="cb35-5"><a href="#cb35-5"></a><span class="co"># Perform the Shapiro-Wilk test for each treatment</span></span>
<span id="cb35-6"><a href="#cb35-6"></a><span class="fu">shapiro.test</span>(mf_data2<span class="sc">$</span>residuals_separate[mf_data2<span class="sc">$</span>trt <span class="sc">==</span> <span class="st">"Treatment 1"</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
    Shapiro-Wilk normality test

data:  mf_data2$residuals_separate[mf_data2$trt == "Treatment 1"]
W = 0.976, p-value = 0.2374</code></pre>
</div>
<div class="sourceCode cell-code" id="cb37"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb37-1"><a href="#cb37-1"></a><span class="fu">shapiro.test</span>(mf_data2<span class="sc">$</span>residuals_separate[mf_data2<span class="sc">$</span>trt <span class="sc">==</span> <span class="st">"Treatment 2"</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
    Shapiro-Wilk normality test

data:  mf_data2$residuals_separate[mf_data2$trt == "Treatment 2"]
W = 0.97125, p-value = 0.1344</code></pre>
</div>
<div class="sourceCode cell-code" id="cb39"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb39-1"><a href="#cb39-1"></a><span class="fu">shapiro.test</span>(mf_data2<span class="sc">$</span>residuals_separate[mf_data2<span class="sc">$</span>trt <span class="sc">==</span> <span class="st">"Treatment 3"</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
    Shapiro-Wilk normality test

data:  mf_data2$residuals_separate[mf_data2$trt == "Treatment 3"]
W = 0.95091, p-value = 0.01177</code></pre>
</div>
</div>
<div class="cell page-columns page-full" data-layout-align="center" data-messages="false">
<div class="cell-output-display page-columns page-full">
<div id="fig-mf-assump" class="quarto-float quarto-figure quarto-figure-center anchored page-columns page-full" data-fig-align="center">
<figure class="quarto-float quarto-float-fig figure page-columns page-full">
<div aria-describedby="fig-mf-assump-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="non-linear_regression_files/figure-html/fig-mf-assump-1.svg" class="img-fluid quarto-figure quarto-figure-center figure-img" style="width:80.0%">
</div>
<figcaption class="quarto-float-caption-margin quarto-float-caption quarto-float-fig margin-caption" id="fig-mf-assump-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;7.5: Histograms (A) of residuals and plots of residuals vs.&nbsp;the fitted values (B) for residuals for the three treatments in the multiple-flask experiment.
</figcaption>
</figure>
</div>
</div>
</div>
<p>The Shapiro-Wilk test results indicate that the residuals are normally distributed for Treatments 1 and 2 (<em>p</em> &gt; 0.05) but not for Treatment 3 (<em>p</em> &lt; 0.05). However, the histograms in <a href="#fig-mf-assump" class="quarto-xref">Figure&nbsp;<span>7.5</span></a> show that the residuals are approximately normally distributed for all treatment groups, with the median roughly in the middle of the distribution in each case. This apparent discrepancy can be explained by the sensitivity of the Shapiro-Wilk test to sample size. With large sample sizes, even minor deviations from normality can be detected as statistically significant. In situations such as this one, I suggest that it is important to consider the sample size and visual inspection of the data when interpreting the results of normality tests. Here, given the relatively large sample size and the visual assessment of the histograms, we can reasonably conclude that the residuals are approximately normally distributed for all treatment groups.</p>
<p>Another normality tests such as the Kolmogorov-Smirnov (K-S) test might be less sensitive to sample size and could be considered for comparison. The K-S test is a non-parametric statistical test that is used to determine if a sample comes from a specific probability distribution. Here I use it to test if a sample follows a normal distribution (<code>pnorm</code>), but it can also be used to test against other theoretical distributions or to compare two empirical distributions. The K-S test can be performed using the <code>ks.test()</code>, as shown below.</p>
<div class="cell" data-messages="false">
<div class="sourceCode cell-code" id="cb41"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb41-1"><a href="#cb41-1"></a>perform_ks_test <span class="ot">&lt;-</span> <span class="cf">function</span>(data, treatment) {</span>
<span id="cb41-2"><a href="#cb41-2"></a>  <span class="fu">ks.test</span>(data<span class="sc">$</span>residuals_separate[data<span class="sc">$</span>trt <span class="sc">==</span> treatment], <span class="st">"pnorm"</span>, </span>
<span id="cb41-3"><a href="#cb41-3"></a>          <span class="at">mean =</span> <span class="fu">mean</span>(data<span class="sc">$</span>residuals_separate[data<span class="sc">$</span>trt <span class="sc">==</span> treatment]), </span>
<span id="cb41-4"><a href="#cb41-4"></a>          <span class="at">sd =</span> <span class="fu">sd</span>(data<span class="sc">$</span>residuals_separate[data<span class="sc">$</span>trt <span class="sc">==</span> treatment]))</span>
<span id="cb41-5"><a href="#cb41-5"></a>}</span>
<span id="cb41-6"><a href="#cb41-6"></a></span>
<span id="cb41-7"><a href="#cb41-7"></a><span class="co"># Perform the test for each treatment group</span></span>
<span id="cb41-8"><a href="#cb41-8"></a><span class="fu">perform_ks_test</span>(mf_data2, <span class="st">"Treatment 1"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
    Asymptotic one-sample Kolmogorov-Smirnov test

data:  data$residuals_separate[data$trt == treatment]
D = 0.10658, p-value = 0.4513
alternative hypothesis: two-sided</code></pre>
</div>
<div class="sourceCode cell-code" id="cb43"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb43-1"><a href="#cb43-1"></a><span class="fu">perform_ks_test</span>(mf_data2, <span class="st">"Treatment 2"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
    Asymptotic one-sample Kolmogorov-Smirnov test

data:  data$residuals_separate[data$trt == treatment]
D = 0.1246, p-value = 0.2652
alternative hypothesis: two-sided</code></pre>
</div>
<div class="sourceCode cell-code" id="cb45"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb45-1"><a href="#cb45-1"></a><span class="fu">perform_ks_test</span>(mf_data2, <span class="st">"Treatment 3"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
    Asymptotic one-sample Kolmogorov-Smirnov test

data:  data$residuals_separate[data$trt == treatment]
D = 0.14151, p-value = 0.148
alternative hypothesis: two-sided</code></pre>
</div>
</div>
<p>We see that the K-S test indicates that the residuals are normally distributed for all treatment groups (<em>p</em> &gt; 0.05). As already noted, this test is less sensitive to sample size than the Shapiro-Wilk test, and the results are consistent with the visual assessment of the histograms.</p>
<p>We should also check for homoscedasticity (here I use the Levene test) and a plot of residuals versus fitted values.</p>
<div class="cell" data-messages="false">
<div class="sourceCode cell-code" id="cb47"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb47-1"><a href="#cb47-1"></a><span class="co"># Perform the Levene test</span></span>
<span id="cb47-2"><a href="#cb47-2"></a>car<span class="sc">::</span><span class="fu">leveneTest</span>(residuals_separate <span class="sc">~</span> trt, <span class="at">data =</span> mf_data2)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Levene's Test for Homogeneity of Variance (center = median)
       Df F value Pr(&gt;F)
group   2  1.4933 0.2272
      192               </code></pre>
</div>
</div>
<p>The Levene test shows that the variances are the same across the three treatments and this is confirmed by the plot of residuals against the fitted values in <a href="#fig-mf-assump" class="quarto-xref">Figure&nbsp;<span>7.5</span></a>.</p>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Results
</div>
</div>
<div class="callout-body-container callout-body">
<p>Michaelis-Menten models were fitted to nutrient uptake data across three experimental treatments to investigate the effects of the treatments on seaweed nutrient kinetics. A global model, assuming shared kinetic parameters (<span class="math inline">V_{max}</span> and <span class="math inline">K_m</span>) across all treatments, was compared to a model with separate parameters for each treatment. The model allowing treatment-specific parameters (AIC = 644.3) provided a significantly better fit to the data than the global model (AIC = 681.5), a finding confirmed by the log-likelihood test (log-likelihood ratio = 45.20, d.f. = 4, <em>p</em> &lt; 0.0001). As the assumption tests do not indicate any cause for concern regarding the distribution of residuals, we conclude that the experimental treatments significantly influenced the nutrient uptake kinetics of the seaweed (<a href="#fig-mf3" class="quarto-xref">Figure&nbsp;<span>7.6</span></a>).</p>
<p>Specifically, all three treatments exhibited unique combinations of <span class="math inline">V_{max}</span> and <span class="math inline">K_m</span> values (Treatment 1: <span class="math inline">V_{max}</span> = 49.2, <span class="math inline">K_m</span> = 9.5; Treatment 2: <span class="math inline">V_{max}</span> = 39.3, <span class="math inline">K_m</span> = 7.5; Treatment 3: <span class="math inline">V_{max}</span> = 19.0, <span class="math inline">K_m</span> = 5.5). These findings support the hypothesis that nutrient uptake kinetics in this seaweed species are sensitive to environmental perturbations.</p>
</div>
</div>
<div class="cell page-columns page-full" data-layout-align="center" data-messages="false">
<div class="cell-output-display page-columns page-full">
<div id="fig-mf3" class="quarto-float quarto-figure quarto-figure-center anchored page-columns page-full" data-fig-align="center" data-fig-pos="t">
<figure class="quarto-float quarto-float-fig figure page-columns page-full">
<div aria-describedby="fig-mf3-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="non-linear_regression_files/figure-html/fig-mf3-1.svg" class="img-fluid quarto-figure quarto-figure-center figure-img" style="width:80.0%" data-fig-pos="t">
</div>
<figcaption class="quarto-float-caption-margin quarto-float-caption quarto-float-fig margin-caption" id="fig-mf3-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;7.6: Plot of the Michaelis-Menten model fitted to the data in <a href="#tbl-mf2" class="quarto-xref">Table&nbsp;<span>7.3</span></a>. Fits are provided for the separate models and the global model.
</figcaption>
</figure>
</div>
</div>
</div>
</section>
</section>
<section id="sec-perturbation" class="level3 page-columns page-full">
<h3 class="anchored" data-anchor-id="sec-perturbation">The Perturbation Method (NLMM)</h3>
<p>The data for this example is by <span class="citation" data-cites="smit2002nitrogen">Smit (<a href="references.html#ref-smit2002nitrogen" role="doc-biblioref">2002</a>)</span>. A perturbation experiment was conducted to determine the nutrient uptake rate versus nutrient concentration of the red seaweed, sp. The experiment involved flasks, initially enriched to approximately 55 Î¼M nitrate, sampled 16 times over approximately 2.5 hours. The uptake rates were measured under three rates of water movement (treatments): low, medium, and high. Each treatment had three replicate flasks (<a href="#tbl-mm1" class="quarto-xref">Table&nbsp;<span>7.4</span></a>). The primary objective was to determine if the Michaelis-Menten parameters significantly differ among the three levels of water movement, and we must state a hypothesis similar to those in <a href="#sec-mm-comparison" class="quarto-xref"><span>Section 7.5.1.2</span></a>.</p>
<div class="cell page-columns page-full" data-messages="false">
<div id="tbl-mm1" class="cell quarto-float quarto-figure quarto-figure-center anchored page-columns page-full" data-messages="false">
<figure class="quarto-float quarto-float-tbl figure page-columns page-full">
<div aria-describedby="tbl-mm1-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="cell-output-display">
<div id="zyznixndyx" style="padding-left:0px;padding-right:0px;padding-top:10px;padding-bottom:10px;overflow-x:auto;overflow-y:auto;width:auto;height:auto;">
<style>#zyznixndyx table {
  font-family: system-ui, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol', 'Noto Color Emoji';
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
}

#zyznixndyx thead, #zyznixndyx tbody, #zyznixndyx tfoot, #zyznixndyx tr, #zyznixndyx td, #zyznixndyx th {
  border-style: none;
}

#zyznixndyx p {
  margin: 0;
  padding: 0;
}

#zyznixndyx .gt_table {
  display: table;
  border-collapse: collapse;
  line-height: normal;
  margin-left: auto;
  margin-right: auto;
  color: #333333;
  font-size: 16px;
  font-weight: normal;
  font-style: normal;
  background-color: #FFFFFF;
  width: auto;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #A8A8A8;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #A8A8A8;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
}

#zyznixndyx .gt_caption {
  padding-top: 4px;
  padding-bottom: 4px;
}

#zyznixndyx .gt_title {
  color: #333333;
  font-size: 125%;
  font-weight: initial;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-color: #FFFFFF;
  border-bottom-width: 0;
}

#zyznixndyx .gt_subtitle {
  color: #333333;
  font-size: 85%;
  font-weight: initial;
  padding-top: 3px;
  padding-bottom: 5px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-color: #FFFFFF;
  border-top-width: 0;
}

#zyznixndyx .gt_heading {
  background-color: #FFFFFF;
  text-align: center;
  border-bottom-color: #FFFFFF;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#zyznixndyx .gt_bottom_border {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#zyznixndyx .gt_col_headings {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#zyznixndyx .gt_col_heading {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 6px;
  padding-left: 5px;
  padding-right: 5px;
  overflow-x: hidden;
}

#zyznixndyx .gt_column_spanner_outer {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  padding-top: 0;
  padding-bottom: 0;
  padding-left: 4px;
  padding-right: 4px;
}

#zyznixndyx .gt_column_spanner_outer:first-child {
  padding-left: 0;
}

#zyznixndyx .gt_column_spanner_outer:last-child {
  padding-right: 0;
}

#zyznixndyx .gt_column_spanner {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 5px;
  overflow-x: hidden;
  display: inline-block;
  width: 100%;
}

#zyznixndyx .gt_spanner_row {
  border-bottom-style: hidden;
}

#zyznixndyx .gt_group_heading {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  text-align: left;
}

#zyznixndyx .gt_empty_group_heading {
  padding: 0.5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: middle;
}

#zyznixndyx .gt_from_md > :first-child {
  margin-top: 0;
}

#zyznixndyx .gt_from_md > :last-child {
  margin-bottom: 0;
}

#zyznixndyx .gt_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  margin: 10px;
  border-top-style: solid;
  border-top-width: 1px;
  border-top-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  overflow-x: hidden;
}

#zyznixndyx .gt_stub {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
}

#zyznixndyx .gt_stub_row_group {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
  vertical-align: top;
}

#zyznixndyx .gt_row_group_first td {
  border-top-width: 2px;
}

#zyznixndyx .gt_row_group_first th {
  border-top-width: 2px;
}

#zyznixndyx .gt_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#zyznixndyx .gt_first_summary_row {
  border-top-style: solid;
  border-top-color: #D3D3D3;
}

#zyznixndyx .gt_first_summary_row.thick {
  border-top-width: 2px;
}

#zyznixndyx .gt_last_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#zyznixndyx .gt_grand_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#zyznixndyx .gt_first_grand_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: double;
  border-top-width: 6px;
  border-top-color: #D3D3D3;
}

#zyznixndyx .gt_last_grand_summary_row_top {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: double;
  border-bottom-width: 6px;
  border-bottom-color: #D3D3D3;
}

#zyznixndyx .gt_striped {
  background-color: rgba(128, 128, 128, 0.05);
}

#zyznixndyx .gt_table_body {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#zyznixndyx .gt_footnotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#zyznixndyx .gt_footnote {
  margin: 0px;
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#zyznixndyx .gt_sourcenotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#zyznixndyx .gt_sourcenote {
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#zyznixndyx .gt_left {
  text-align: left;
}

#zyznixndyx .gt_center {
  text-align: center;
}

#zyznixndyx .gt_right {
  text-align: right;
  font-variant-numeric: tabular-nums;
}

#zyznixndyx .gt_font_normal {
  font-weight: normal;
}

#zyznixndyx .gt_font_bold {
  font-weight: bold;
}

#zyznixndyx .gt_font_italic {
  font-style: italic;
}

#zyznixndyx .gt_super {
  font-size: 65%;
}

#zyznixndyx .gt_footnote_marks {
  font-size: 75%;
  vertical-align: 0.4em;
  position: initial;
}

#zyznixndyx .gt_asterisk {
  font-size: 100%;
  vertical-align: 0;
}

#zyznixndyx .gt_indent_1 {
  text-indent: 5px;
}

#zyznixndyx .gt_indent_2 {
  text-indent: 10px;
}

#zyznixndyx .gt_indent_3 {
  text-indent: 15px;
}

#zyznixndyx .gt_indent_4 {
  text-indent: 20px;
}

#zyznixndyx .gt_indent_5 {
  text-indent: 25px;
}

#zyznixndyx .katex-display {
  display: inline-flex !important;
  margin-bottom: 0.75em !important;
}

#zyznixndyx div.Reactable > div.rt-table > div.rt-thead > div.rt-tr.rt-tr-group-header > div.rt-th-group:after {
  height: 0px !important;
}
</style>

<table class="gt_table do-not-create-environment cell table table-sm table-striped small" data-quarto-postprocess="true" data-quarto-disable-processing="false" data-quarto-bootstrap="false">
<thead>
<tr class="header gt_col_headings">
<th id="Replicate flask" class="gt_col_heading gt_columns_bottom_border gt_center" data-quarto-table-cell-role="th" scope="col">Replicate flask</th>
<th id="Treatment" class="gt_col_heading gt_columns_bottom_border gt_center" data-quarto-table-cell-role="th" scope="col">Treatment</th>
<th id="V" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" scope="col">V</th>
<th id="[S]" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" scope="col">[S]</th>
</tr>
</thead>
<tbody class="gt_table_body">
<tr class="odd">
<td class="gt_row gt_center" headers="flask">1</td>
<td class="gt_row gt_center" headers="trt">low</td>
<td class="gt_row gt_right" headers="V">10.8</td>
<td class="gt_row gt_right" headers="S">60.2</td>
</tr>
<tr class="even">
<td class="gt_row gt_center" headers="flask">2</td>
<td class="gt_row gt_center" headers="trt">low</td>
<td class="gt_row gt_right" headers="V">10.0</td>
<td class="gt_row gt_right" headers="S">61.1</td>
</tr>
<tr class="odd">
<td class="gt_row gt_center" headers="flask">3</td>
<td class="gt_row gt_center" headers="trt">low</td>
<td class="gt_row gt_right" headers="V">14.1</td>
<td class="gt_row gt_right" headers="S">60.8</td>
</tr>
<tr class="even">
<td class="gt_row gt_center" headers="flask">1</td>
<td class="gt_row gt_center" headers="trt">high</td>
<td class="gt_row gt_right" headers="V">0.0</td>
<td class="gt_row gt_right" headers="S">0.1</td>
</tr>
<tr class="odd">
<td class="gt_row gt_center" headers="flask">2</td>
<td class="gt_row gt_center" headers="trt">high</td>
<td class="gt_row gt_right" headers="V">0.0</td>
<td class="gt_row gt_right" headers="S">0.1</td>
</tr>
<tr class="even">
<td class="gt_row gt_center" headers="flask">3</td>
<td class="gt_row gt_center" headers="trt">high</td>
<td class="gt_row gt_right" headers="V">0.0</td>
<td class="gt_row gt_right" headers="S">0.1</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<figcaption class="quarto-float-caption-margin quarto-float-caption quarto-float-tbl margin-caption" id="tbl-mm1-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Table&nbsp;7.4: Simulated data for a multiple flask experiment on an alga (showing only the top and bottom three rows).
</figcaption>
</figure>
</div>
</div>
<p>For the reasons discussed in <a href="#sec-ex1" class="quarto-xref"><span>Section 7.5</span></a>, we will use a nonlinear mixed effects model, <code>nlme()</code>, to analyse these data. Models such as these can be quite challenging to fit. There are several things we have to deal with. First and most obviously is the fact that the data are repeated measures, and the residuals may be correlated. Second, the flasks are nested within the treatment levels, and we need to account for this in the model. Finally, we need to account for the possibility that the Michaelis-Menten parameters may vary among the treatment levelsâ€”in fact, we want to test this! Here is the model:</p>
<div class="cell" data-messages="false">
<div class="sourceCode cell-code" id="annotated-cell-28"><pre class="sourceCode numberSource r code-annotation-code number-lines code-with-copy code-annotated"><code class="sourceCode r"><span id="annotated-cell-28-1"><a href="#annotated-cell-28-1"></a><span class="co"># Determine the number of levels in the factor 'trt'</span></span>
<span id="annotated-cell-28-2"><a href="#annotated-cell-28-2"></a>num_levels <span class="ot">&lt;-</span> <span class="fu">length</span>(<span class="fu">levels</span>(mm_data<span class="sc">$</span>trt))</span>
<span id="annotated-cell-28-3"><a href="#annotated-cell-28-3"></a></span>
<span id="annotated-cell-28-4"><a href="#annotated-cell-28-4"></a><span class="co"># Starting values for the fixed parameters</span></span>
<span id="annotated-cell-28-5"><a href="#annotated-cell-28-5"></a><span class="co"># (one set for each level of 'trt')</span></span>
<span id="annotated-cell-28-6"><a href="#annotated-cell-28-6"></a>start_vals <span class="ot">&lt;-</span> <span class="fu">list</span>(<span class="at">fixed =</span> <span class="fu">c</span>(<span class="at">Vmax =</span> <span class="fu">rep</span>(<span class="fu">max</span>(mm_data<span class="sc">$</span>V), num_levels),</span>
<span id="annotated-cell-28-7"><a href="#annotated-cell-28-7"></a>                             <span class="at">Km =</span> <span class="fu">rep</span>(<span class="fu">median</span>(mm_data<span class="sc">$</span>S), num_levels)))</span>
<span id="annotated-cell-28-8"><a href="#annotated-cell-28-8"></a></span>
<span id="annotated-cell-28-9"><a href="#annotated-cell-28-9"></a>nlme_mod2 <span class="ot">&lt;-</span> <span class="fu">nlme</span>(V <span class="sc">~</span> <span class="fu">mm_fun</span>(S, Vmax, Km),</span>
<span id="annotated-cell-28-10"><a href="#annotated-cell-28-10"></a>                  <span class="at">data =</span> mm_data,</span>
<a class="code-annotation-anchor" data-target-cell="annotated-cell-28" data-target-annotation="1" onclick="event.preventDefault();">1</a><span id="annotated-cell-28-11" class="code-annotation-target"><a href="#annotated-cell-28-11"></a>                  <span class="at">fixed =</span> Vmax <span class="sc">+</span> Km <span class="sc">~</span> trt,</span>
<a class="code-annotation-anchor" data-target-cell="annotated-cell-28" data-target-annotation="2" onclick="event.preventDefault();">2</a><span id="annotated-cell-28-12" class="code-annotation-target"><a href="#annotated-cell-28-12"></a>                  <span class="at">random =</span> Vmax <span class="sc">+</span> Km <span class="sc">~</span> <span class="dv">1</span> <span class="sc">|</span> flask,</span>
<span id="annotated-cell-28-13"><a href="#annotated-cell-28-13"></a>                  <span class="at">start =</span> start_vals,</span>
<span id="annotated-cell-28-14"><a href="#annotated-cell-28-14"></a>                  <span class="at">method =</span> <span class="st">"REML"</span>)</span><div class="code-annotation-gutter-bg"></div><div class="code-annotation-gutter"></div></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-annotation">
<dl class="code-annotation-container-grid">
<dt data-target-cell="annotated-cell-28" data-target-annotation="1">1</dt>
<dd>
<span data-code-cell="annotated-cell-28" data-code-lines="11" data-code-annotation="1">The <code>fixed</code> argument specifies that the Michaelis-Menten parameters <code>Vmax</code> and <code>Km</code> are fixed effects that vary among the treatment levels, and a grouping variable (<code>trt</code>) is used to specify the levels of the treatment factor.</span>
</dd>
<dt data-target-cell="annotated-cell-28" data-target-annotation="2">2</dt>
<dd>
<span data-code-cell="annotated-cell-28" data-code-lines="12" data-code-annotation="2">The <code>random</code> argument specifies that the Michaelis-Menten parameters <code>Vmax</code> and <code>Km</code> are random effects that vary among the replicate flasks.</span>
</dd>
</dl>
</div>
</div>
<p>This model brings us closer to our goal, but there are some notable omissions. The specification allows the Michaelis-Menten parameters to vary among the treatment levels, which is central to our hypothesis. We have also accounted for the replication structure of the data, recognising that random variations may arise not due to the treatment levels but due to the replicate flasks.</p>
<p>However, we have not accounted for the central feature of a perturbation experiment, which is the correlation structure of the residuals. We must deal with the fact that the residuals may be correlated due to the repeated measures nature of the data. Additionally, we have omitted the nesting of the flasks within the treatment levels.</p>
<p>Letâ€™s update our model accordingly:</p>
<div class="cell" data-messages="false">
<div class="sourceCode cell-code" id="annotated-cell-29"><pre class="sourceCode numberSource r code-annotation-code number-lines code-with-copy code-annotated"><code class="sourceCode r"><span id="annotated-cell-29-1"><a href="#annotated-cell-29-1"></a>nlme_mod3 <span class="ot">&lt;-</span> <span class="fu">nlme</span>(V <span class="sc">~</span> <span class="fu">mm_fun</span>(S, Vmax, Km),</span>
<span id="annotated-cell-29-2"><a href="#annotated-cell-29-2"></a>                  <span class="at">data =</span> mm_data,</span>
<span id="annotated-cell-29-3"><a href="#annotated-cell-29-3"></a>                  <span class="at">fixed =</span> <span class="fu">list</span>(Vmax <span class="sc">~</span> trt, Km <span class="sc">~</span> trt),</span>
<a class="code-annotation-anchor" data-target-cell="annotated-cell-29" data-target-annotation="1" onclick="event.preventDefault();">1</a><span id="annotated-cell-29-4" class="code-annotation-target"><a href="#annotated-cell-29-4"></a>                  <span class="at">random =</span> Vmax <span class="sc">~</span> <span class="dv">1</span> <span class="sc">|</span> trt<span class="sc">/</span>flask,</span>
<a class="code-annotation-anchor" data-target-cell="annotated-cell-29" data-target-annotation="2" onclick="event.preventDefault();">2</a><span id="annotated-cell-29-5" class="code-annotation-target"><a href="#annotated-cell-29-5"></a>                  <span class="at">groups =</span> <span class="sc">~</span> trt<span class="sc">/</span>flask,</span>
<a class="code-annotation-anchor" data-target-cell="annotated-cell-29" data-target-annotation="3" onclick="event.preventDefault();">3</a><span id="annotated-cell-29-6" class="code-annotation-target"><a href="#annotated-cell-29-6"></a>                  <span class="at">correlation =</span> <span class="fu">corAR1</span>(<span class="at">form =</span> <span class="sc">~</span> <span class="dv">1</span> <span class="sc">|</span> trt<span class="sc">/</span>flask),</span>
<span id="annotated-cell-29-7"><a href="#annotated-cell-29-7"></a>                  <span class="at">start =</span> start_vals,</span>
<span id="annotated-cell-29-8"><a href="#annotated-cell-29-8"></a>                  <span class="at">method =</span> <span class="st">"REML"</span>)</span><div class="code-annotation-gutter-bg"></div><div class="code-annotation-gutter"></div></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-annotation">
<dl class="code-annotation-container-grid">
<dt data-target-cell="annotated-cell-29" data-target-annotation="1">1</dt>
<dd>
<span data-code-cell="annotated-cell-29" data-code-lines="4" data-code-annotation="1">The <code>random</code> argument specifies that the Michaelis-Menten parameter <code>Vmax</code> is a random effect that varies among the replicate flasks nested within the treatment levels.</span>
</dd>
<dt data-target-cell="annotated-cell-29" data-target-annotation="2">2</dt>
<dd>
<span data-code-cell="annotated-cell-29" data-code-lines="5" data-code-annotation="2">The <code>groups</code> argument specifies that the replicate flasks are nested within the treatment levels.</span>
</dd>
<dt data-target-cell="annotated-cell-29" data-target-annotation="3">3</dt>
<dd>
<span data-code-cell="annotated-cell-29" data-code-lines="6" data-code-annotation="3">The <code>correlation</code> argument specifies that the residuals have a first-order autoregressive correlation structure. This structure assumes that the correlation between residuals decreases exponentially with the time lag between observations.</span>
</dd>
</dl>
</div>
</div>
<p>If we are not convinced that <code>nlme_mod3</code> is the best model, we can compare it to <code>nlme_mod2</code> using a likelihood ratio test. It is used to compare the fit of two models, where one model is a special case of the other. The test statistic is the difference in the log-likelihoods of the two models, and the null hypothesis is that the simpler model is the best fit.</p>
<div class="cell" data-messages="false">
<div class="sourceCode cell-code" id="cb49"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb49-1"><a href="#cb49-1"></a><span class="fu">anova</span>(nlme_mod2, nlme_mod3)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>          Model df      AIC      BIC    logLik
nlme_mod2     1 10 637.2782 665.6411 -308.6391
nlme_mod3     2 10 632.1053 660.4681 -306.0527</code></pre>
</div>
<div class="sourceCode cell-code" id="cb51"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb51-1"><a href="#cb51-1"></a><span class="co"># Likelihood ratio test</span></span>
<span id="cb51-2"><a href="#cb51-2"></a>lrt_stat <span class="ot">&lt;-</span> <span class="sc">-</span><span class="dv">2</span> <span class="sc">*</span> (<span class="fu">logLik</span>(nlme_mod2) <span class="sc">-</span> <span class="fu">logLik</span>(nlme_mod3))</span>
<span id="cb51-3"><a href="#cb51-3"></a></span>
<span id="cb51-4"><a href="#cb51-4"></a><span class="co"># Determine degrees of freedom and p-value</span></span>
<span id="cb51-5"><a href="#cb51-5"></a>df_diff <span class="ot">&lt;-</span> <span class="fu">attr</span>(<span class="fu">logLik</span>(nlme_mod3), <span class="st">"df"</span>) <span class="sc">-</span> <span class="fu">attr</span>(<span class="fu">logLik</span>(nlme_mod2), <span class="st">"df"</span>) </span>
<span id="cb51-6"><a href="#cb51-6"></a>p_value <span class="ot">&lt;-</span> <span class="fu">pchisq</span>(lrt_stat, <span class="at">df =</span> df_diff, <span class="at">lower.tail =</span> <span class="cn">FALSE</span>) </span>
<span id="cb51-7"><a href="#cb51-7"></a></span>
<span id="cb51-8"><a href="#cb51-8"></a><span class="fu">print</span>(<span class="fu">paste</span>(<span class="st">"LRT statistic:"</span>, lrt_stat))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "LRT statistic: 5.17293584867423"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb53"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb53-1"><a href="#cb53-1"></a><span class="fu">print</span>(<span class="fu">paste</span>(<span class="st">"Degrees of freedom:"</span>, df_diff))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "Degrees of freedom: 0"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb55"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb55-1"><a href="#cb55-1"></a><span class="fu">print</span>(<span class="fu">paste</span>(<span class="st">"P-value:"</span>, p_value))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "P-value: 0"</code></pre>
</div>
</div>
<p>The likelihood ratio test indicates that <code>nlme_mod3</code> is a better fit than <code>nlme_mod2</code> (p &lt; 0.001). This result suggests that the Michaelis-Menten parameters vary among the treatment levels, and the residuals have a first-order autoregressive correlation structure.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb57"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb57-1"><a href="#cb57-1"></a><span class="fu">summary</span>(nlme_mod3)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Nonlinear mixed-effects model fit by REML
  Model: V ~ mm_fun(S, Vmax, Km) 
  Data: mm_data 
       AIC      BIC    logLik
  632.1053 660.4681 -306.0527

Random effects:
 Formula: Vmax ~ 1 | trt
        Vmax.(Intercept)
StdDev:       0.00837941

 Formula: Vmax ~ 1 | flask %in% trt
        Vmax.(Intercept) Residual
StdDev:     0.0002584018 2.731378

Correlation Structure: AR(1)
 Formula: ~1 | trt/flask 
 Parameter estimate(s):
      Phi 
0.2048944 
Fixed effects:  list(Vmax ~ trt, Km ~ trt) 
                     Value Std.Error  DF   t-value p-value
Vmax.(Intercept) 15.394469  1.082697 118 14.218627  0.0000
Vmax.trtlow      -1.660245  2.381505 118 -0.697141  0.4871
Vmax.trtmed      -3.555246  1.503682 118 -2.364361  0.0197
Km.(Intercept)    5.381378  1.873000 118  2.873133  0.0048
Km.trtlow        11.448682  8.044641 118  1.423144  0.1573
Km.trtmed        -0.381246  3.147606 118 -0.121123  0.9038
 Correlation: 
               Vm.(I) Vmx.trtl Vmx.trtm Km.(I) Km.trtl
Vmax.trtlow    -0.455                                 
Vmax.trtmed    -0.720  0.327                          
Km.(Intercept)  0.726 -0.330   -0.523                 
Km.trtlow      -0.169  0.876    0.122   -0.233        
Km.trtmed      -0.432  0.196    0.734   -0.595  0.139 

Standardized Within-Group Residuals:
       Min         Q1        Med         Q3        Max 
-2.0222398 -0.7529003 -0.2362146  0.4364407  3.2055101 

Number of Observations: 132
Number of Groups: 
           trt flask %in% trt 
             3              9 </code></pre>
</div>
</div>
</section>
</section>
<section id="sec-vonbertalanffy" class="level2 page-columns page-full" data-number="7.6">
<h2 data-number="7.6" class="anchored" data-anchor-id="sec-vonbertalanffy"><span class="header-section-number">7.6</span> Example: The Growth Rate of Fish (NLMM)</h2>
<p>The von Bertalanffy model (<a href="#eq-vb" class="quarto-xref">Equation&nbsp;<span>7.4</span></a>) is used to describe the growth patterns of animals over time. For example, in a fish growth study, we measure the length of individual fish at regular intervals as the fish age. By fitting the von Bertalanffy model to these length-at-age data, we can estimate growth parameters specific to the fish species.</p>
<p>The model is given by:</p>
<p><span id="eq-vb"><span class="math display">L(t) = L_{\infty} \left(1 - e^{-k(t-t_0)}\right) \tag{7.4}</span></span></p>
<p>Where:</p>
<ul>
<li><span class="math inline">L(t)</span> is the length of the fish at time <span class="math inline">t</span>.</li>
<li><span class="math inline">L_{\infty}</span> is the asymptotic length, representing the theoretical maximum length that the individual would reach if it grew indefinitely.</li>
<li><span class="math inline">k</span> is the growth coefficient, indicating the rate at which the growth of the fish approaches its maximum size. A higher <span class="math inline">k</span> value means it reaches its asymptotic length more quickly.</li>
<li><span class="math inline">t_0</span> is the hypothetical age at which the individualâ€™s length would be zero according to the model.</li>
</ul>
<p><span class="math inline">L_{\infty}</span> (the asymptotic length) represents the length towards which the individual grows as time (<span class="math inline">t</span>) approaches infinity. The concept behind <span class="math inline">L_{\infty}</span> is that as the fish ages, its growth rate slows down and eventually approaches zero, with its length nearing the asymptotic value <span class="math inline">L_{\infty}</span>. <span class="math inline">k</span> (the growth rate coefficient) determines how quickly the fish reaches its asymptotic length. Physiologically, <span class="math inline">k</span> reflects the metabolic rates and general fitness of the fish, while ecologically, it can be influenced by environmental factors such as food availability and temperature. Lastly, <span class="math inline">t_0</span> (the theoretical age at zero length) is not directly observable in practice but provides a useful way to shift the growth curve along the time axis to provide a better fit to the data, especially in the early developmental stages.</p>
<p>Consider a study where the lengths of 30 Atlantic Cod, <em>Gadus morua</em>, in captivity are measured twice a year from hatching to 15 years. This creates a longitudinal dataset with repeated length measurements for each fish over time. In this experiment, we will focus on the growth patterns of individual fish, assuming they were raised under identical conditions. This allows us to attribute any growth differences to inherent biological variation among the fish. Apart from the repeated measures on individual fish, we will assume that the data are independent in all other respects.</p>
<p>The longitudinal nature of the data requires that we use appropriate statistical methods that account for the correlation among the repeated measures. We will use a nonlinear mixed-effects regression for the data in Table 1.</p>
<div class="cell page-columns page-full" data-messages="false">
<div class="cell-output-display page-columns page-full">
<div id="ctohwtcpne" style="padding-left:0px;padding-right:0px;padding-top:10px;padding-bottom:10px;overflow-x:auto;overflow-y:auto;width:auto;height:auto;" class="page-columns page-full">
<style>#ctohwtcpne table {
  font-family: system-ui, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol', 'Noto Color Emoji';
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
}

#ctohwtcpne thead, #ctohwtcpne tbody, #ctohwtcpne tfoot, #ctohwtcpne tr, #ctohwtcpne td, #ctohwtcpne th {
  border-style: none;
}

#ctohwtcpne p {
  margin: 0;
  padding: 0;
}

#ctohwtcpne .gt_table {
  display: table;
  border-collapse: collapse;
  line-height: normal;
  margin-left: auto;
  margin-right: auto;
  color: #333333;
  font-size: 16px;
  font-weight: normal;
  font-style: normal;
  background-color: #FFFFFF;
  width: auto;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #A8A8A8;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #A8A8A8;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
}

#ctohwtcpne .gt_caption {
  padding-top: 4px;
  padding-bottom: 4px;
}

#ctohwtcpne .gt_title {
  color: #333333;
  font-size: 125%;
  font-weight: initial;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-color: #FFFFFF;
  border-bottom-width: 0;
}

#ctohwtcpne .gt_subtitle {
  color: #333333;
  font-size: 85%;
  font-weight: initial;
  padding-top: 3px;
  padding-bottom: 5px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-color: #FFFFFF;
  border-top-width: 0;
}

#ctohwtcpne .gt_heading {
  background-color: #FFFFFF;
  text-align: center;
  border-bottom-color: #FFFFFF;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#ctohwtcpne .gt_bottom_border {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#ctohwtcpne .gt_col_headings {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#ctohwtcpne .gt_col_heading {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 6px;
  padding-left: 5px;
  padding-right: 5px;
  overflow-x: hidden;
}

#ctohwtcpne .gt_column_spanner_outer {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  padding-top: 0;
  padding-bottom: 0;
  padding-left: 4px;
  padding-right: 4px;
}

#ctohwtcpne .gt_column_spanner_outer:first-child {
  padding-left: 0;
}

#ctohwtcpne .gt_column_spanner_outer:last-child {
  padding-right: 0;
}

#ctohwtcpne .gt_column_spanner {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 5px;
  overflow-x: hidden;
  display: inline-block;
  width: 100%;
}

#ctohwtcpne .gt_spanner_row {
  border-bottom-style: hidden;
}

#ctohwtcpne .gt_group_heading {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  text-align: left;
}

#ctohwtcpne .gt_empty_group_heading {
  padding: 0.5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: middle;
}

#ctohwtcpne .gt_from_md > :first-child {
  margin-top: 0;
}

#ctohwtcpne .gt_from_md > :last-child {
  margin-bottom: 0;
}

#ctohwtcpne .gt_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  margin: 10px;
  border-top-style: solid;
  border-top-width: 1px;
  border-top-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  overflow-x: hidden;
}

#ctohwtcpne .gt_stub {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
}

#ctohwtcpne .gt_stub_row_group {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
  vertical-align: top;
}

#ctohwtcpne .gt_row_group_first td {
  border-top-width: 2px;
}

#ctohwtcpne .gt_row_group_first th {
  border-top-width: 2px;
}

#ctohwtcpne .gt_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#ctohwtcpne .gt_first_summary_row {
  border-top-style: solid;
  border-top-color: #D3D3D3;
}

#ctohwtcpne .gt_first_summary_row.thick {
  border-top-width: 2px;
}

#ctohwtcpne .gt_last_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#ctohwtcpne .gt_grand_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#ctohwtcpne .gt_first_grand_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: double;
  border-top-width: 6px;
  border-top-color: #D3D3D3;
}

#ctohwtcpne .gt_last_grand_summary_row_top {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: double;
  border-bottom-width: 6px;
  border-bottom-color: #D3D3D3;
}

#ctohwtcpne .gt_striped {
  background-color: rgba(128, 128, 128, 0.05);
}

#ctohwtcpne .gt_table_body {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#ctohwtcpne .gt_footnotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#ctohwtcpne .gt_footnote {
  margin: 0px;
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#ctohwtcpne .gt_sourcenotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#ctohwtcpne .gt_sourcenote {
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#ctohwtcpne .gt_left {
  text-align: left;
}

#ctohwtcpne .gt_center {
  text-align: center;
}

#ctohwtcpne .gt_right {
  text-align: right;
  font-variant-numeric: tabular-nums;
}

#ctohwtcpne .gt_font_normal {
  font-weight: normal;
}

#ctohwtcpne .gt_font_bold {
  font-weight: bold;
}

#ctohwtcpne .gt_font_italic {
  font-style: italic;
}

#ctohwtcpne .gt_super {
  font-size: 65%;
}

#ctohwtcpne .gt_footnote_marks {
  font-size: 75%;
  vertical-align: 0.4em;
  position: initial;
}

#ctohwtcpne .gt_asterisk {
  font-size: 100%;
  vertical-align: 0;
}

#ctohwtcpne .gt_indent_1 {
  text-indent: 5px;
}

#ctohwtcpne .gt_indent_2 {
  text-indent: 10px;
}

#ctohwtcpne .gt_indent_3 {
  text-indent: 15px;
}

#ctohwtcpne .gt_indent_4 {
  text-indent: 20px;
}

#ctohwtcpne .gt_indent_5 {
  text-indent: 25px;
}

#ctohwtcpne .katex-display {
  display: inline-flex !important;
  margin-bottom: 0.75em !important;
}

#ctohwtcpne div.Reactable > div.rt-table > div.rt-thead > div.rt-tr.rt-tr-group-header > div.rt-th-group:after {
  height: 0px !important;
}
</style>

<table class="gt_table table table-sm table-striped small" data-quarto-postprocess="true" data-quarto-disable-processing="false" data-quarto-bootstrap="false">

<thead>
<tr class="header gt_col_headings">
<th id="Fish ID" class="gt_col_heading gt_columns_bottom_border gt_center" data-quarto-table-cell-role="th" scope="col">Fish ID</th>
<th id="Age (yr)" class="gt_col_heading gt_columns_bottom_border gt_center" data-quarto-table-cell-role="th" scope="col">Age (yr)</th>
<th id="Length (cm)" class="gt_col_heading gt_columns_bottom_border gt_center" data-quarto-table-cell-role="th" scope="col">Length (cm)</th>
</tr>
</thead>
<tbody class="gt_table_body">
<tr class="odd">
<td class="gt_row gt_center" headers="Fish_ID">1</td>
<td class="gt_row gt_center" headers="Age">0.0</td>
<td class="gt_row gt_center" headers="Length">5.3</td>
</tr>
<tr class="even">
<td class="gt_row gt_center" headers="Fish_ID">1</td>
<td class="gt_row gt_center" headers="Age">0.5</td>
<td class="gt_row gt_center" headers="Length">16.8</td>
</tr>
<tr class="odd">
<td class="gt_row gt_center" headers="Fish_ID">1</td>
<td class="gt_row gt_center" headers="Age">1.0</td>
<td class="gt_row gt_center" headers="Length">27.2</td>
</tr>
<tr class="even">
<td class="gt_row gt_center" headers="Fish_ID">30</td>
<td class="gt_row gt_center" headers="Age">14.0</td>
<td class="gt_row gt_center" headers="Length">115.4</td>
</tr>
<tr class="odd">
<td class="gt_row gt_center" headers="Fish_ID">30</td>
<td class="gt_row gt_center" headers="Age">14.5</td>
<td class="gt_row gt_center" headers="Length">116.0</td>
</tr>
<tr class="even">
<td class="gt_row gt_center" headers="Fish_ID">30</td>
<td class="gt_row gt_center" headers="Age">15.0</td>
<td class="gt_row gt_center" headers="Length">116.5</td>
</tr>
</tbody>
</table>

<div class="quarto-table-caption margin-caption">The Atlantic Cod data set with 30 fish and 15 years of growth data (showing only the top and bottom three rows).</div></div>
</div>
</div>
<p>A plot of the data is shown in <a href="#fig-vb1" class="quarto-xref">Figure&nbsp;<span>7.7</span></a>; here, each line represents the growth trajectory of an individual fish over time.</p>
<div class="cell page-columns page-full" data-layout-align="center" data-messages="false">
<div class="cell-output cell-output-stdout">
<pre><code>List of 1
 $ legend.position: chr "none"
 - attr(*, "class")= chr [1:2] "theme" "gg"
 - attr(*, "complete")= logi FALSE
 - attr(*, "validate")= logi TRUE</code></pre>
</div>
<div class="cell-output-display page-columns page-full">
<div id="fig-vb1" class="quarto-float quarto-figure quarto-figure-center anchored page-columns page-full" data-fig-align="center">
<figure class="quarto-float quarto-float-fig figure page-columns page-full">
<div aria-describedby="fig-vb1-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="non-linear_regression_files/figure-html/fig-vb1-1.svg" class="img-fluid quarto-figure quarto-figure-center figure-img" style="width:80.0%">
</div>
<figcaption class="quarto-float-caption-margin quarto-float-caption quarto-float-fig margin-caption" id="fig-vb1-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;7.7: Plot of growth data measured in 30 Atlantic cod, <em>Gadus morua</em>.
</figcaption>
</figure>
</div>
</div>
</div>
<p>We will fit the von Bertalanffy growth model to the data using <code>nlme::nlme()</code> as follows, and the output is provided:</p>
<div class="cell" data-messages="false">
<div class="sourceCode cell-code" id="annotated-cell-35"><pre class="sourceCode numberSource r code-annotation-code number-lines code-with-copy code-annotated"><code class="sourceCode r"><span id="annotated-cell-35-1"><a href="#annotated-cell-35-1"></a><span class="co"># von Bertalanffy growth function</span></span>
<span id="annotated-cell-35-2"><a href="#annotated-cell-35-2"></a>vb_growth <span class="ot">&lt;-</span> <span class="cf">function</span>(age, L_inf, k, t0) {</span>
<span id="annotated-cell-35-3"><a href="#annotated-cell-35-3"></a>  L_inf <span class="sc">*</span> (<span class="dv">1</span> <span class="sc">-</span> <span class="fu">exp</span>(<span class="sc">-</span>k <span class="sc">*</span> (age <span class="sc">-</span> t0)))</span>
<span id="annotated-cell-35-4"><a href="#annotated-cell-35-4"></a>}</span>
<span id="annotated-cell-35-5"><a href="#annotated-cell-35-5"></a></span>
<span id="annotated-cell-35-6"><a href="#annotated-cell-35-6"></a><span class="co"># Define the nonlinear mixed-effects model</span></span>
<span id="annotated-cell-35-7"><a href="#annotated-cell-35-7"></a>nlme_model <span class="ot">&lt;-</span> <span class="fu">nlme</span>(Length <span class="sc">~</span> <span class="fu">vb_growth</span>(Age, L_inf, k, t0),</span>
<span id="annotated-cell-35-8"><a href="#annotated-cell-35-8"></a>                   <span class="at">data =</span> vb_data,</span>
<a class="code-annotation-anchor" data-target-cell="annotated-cell-35" data-target-annotation="1" onclick="event.preventDefault();">1</a><span id="annotated-cell-35-9" class="code-annotation-target"><a href="#annotated-cell-35-9"></a>                   <span class="at">fixed =</span> L_inf <span class="sc">+</span> k <span class="sc">+</span> t0 <span class="sc">~</span> <span class="dv">1</span>,</span>
<a class="code-annotation-anchor" data-target-cell="annotated-cell-35" data-target-annotation="2" onclick="event.preventDefault();">2</a><span id="annotated-cell-35-10" class="code-annotation-target"><a href="#annotated-cell-35-10"></a>                   <span class="at">random =</span> L_inf <span class="sc">+</span> k <span class="sc">~</span> <span class="dv">1</span> <span class="sc">|</span> Fish_ID,</span>
<a class="code-annotation-anchor" data-target-cell="annotated-cell-35" data-target-annotation="3" onclick="event.preventDefault();">3</a><span id="annotated-cell-35-11" class="code-annotation-target"><a href="#annotated-cell-35-11"></a>                   <span class="at">groups =</span> <span class="sc">~</span> Fish_ID,</span>
<a class="code-annotation-anchor" data-target-cell="annotated-cell-35" data-target-annotation="4" onclick="event.preventDefault();">4</a><span id="annotated-cell-35-12" class="code-annotation-target"><a href="#annotated-cell-35-12"></a>                   <span class="at">correlation =</span> <span class="fu">corAR1</span>(<span class="at">form =</span> <span class="sc">~</span> <span class="dv">1</span>),</span>
<span id="annotated-cell-35-13"><a href="#annotated-cell-35-13"></a>                   <span class="at">start =</span> <span class="fu">c</span>(<span class="at">L_inf =</span> <span class="dv">100</span>, <span class="at">k =</span> <span class="fl">0.2</span>, <span class="at">t0 =</span> <span class="sc">-</span><span class="fl">0.5</span>))</span>
<span id="annotated-cell-35-14"><a href="#annotated-cell-35-14"></a></span>
<span id="annotated-cell-35-15"><a href="#annotated-cell-35-15"></a><span class="co"># Print the summary of the model</span></span>
<span id="annotated-cell-35-16"><a href="#annotated-cell-35-16"></a><span class="fu">summary</span>(nlme_model)</span><div class="code-annotation-gutter-bg"></div><div class="code-annotation-gutter"></div></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-annotation">
<dl class="code-annotation-container-grid">
<dt data-target-cell="annotated-cell-35" data-target-annotation="1">1</dt>
<dd>
<span data-code-cell="annotated-cell-35" data-code-lines="9" data-code-annotation="1">The fixed effects are the parameters of the von Bertalanffy growth model which are invariant among fish.</span>
</dd>
<dt data-target-cell="annotated-cell-35" data-target-annotation="2">2</dt>
<dd>
<span data-code-cell="annotated-cell-35" data-code-lines="10" data-code-annotation="2">The random effects are the asymptotic length and growth rate to account for the intrinsic differences among fish.</span>
</dd>
<dt data-target-cell="annotated-cell-35" data-target-annotation="3">3</dt>
<dd>
<span data-code-cell="annotated-cell-35" data-code-lines="11" data-code-annotation="3">The grouping variable is the fish ID.</span>
</dd>
<dt data-target-cell="annotated-cell-35" data-target-annotation="4">4</dt>
<dd>
<span data-code-cell="annotated-cell-35" data-code-lines="12" data-code-annotation="4">The correlation structure is autoregressive of order 1 to account for the correlation among repeated measures within the same fish, the <code>~ 1</code> indicates that the order of the observations in the data must be used along which measurements are serially correlated, and since no grouping variable is provided, all fish will have the same correlation structure.</span>
</dd>
</dl>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Nonlinear mixed-effects model fit by maximum likelihood
  Model: Length ~ vb_growth(Age, L_inf, k, t0) 
  Data: vb_data 
        AIC       BIC  logLik
  -2833.361 -2794.679 1424.68

Random effects:
 Formula: list(L_inf ~ 1, k ~ 1)
 Level: Fish_ID
 Structure: General positive-definite, Log-Cholesky parametrization
         StdDev      Corr  
L_inf    1.857032547 L_inf 
k        0.008341198 -0.139
Residual 0.555742464       

Correlation Structure: AR(1)
 Formula: ~1 | Fish_ID 
 Parameter estimate(s):
      Phi 
0.9972623 
Fixed effects:  L_inf + k + t0 ~ 1 
          Value Std.Error  DF  t-value p-value
L_inf 124.80230 0.3551041 898 351.4527       0
k       0.20042 0.0015299 898 131.0050       0
t0     -0.20415 0.0040574 898 -50.3164       0
 Correlation: 
   L_inf  k     
k  -0.137       
t0 -0.260 -0.007

Standardized Within-Group Residuals:
       Min         Q1        Med         Q3        Max 
-2.2053004 -0.7552048  0.2402975  0.4902483  1.9150860 

Number of Observations: 930
Number of Groups: 30 </code></pre>
</div>
</div>
<div class="cell page-columns page-full" data-layout-align="center" data-messages="false">
<div class="cell-output-display page-columns page-full">
<div id="fig-vb2" class="quarto-float quarto-figure quarto-figure-center anchored page-columns page-full" data-fig-align="center">
<figure class="quarto-float quarto-float-fig figure page-columns page-full">
<div aria-describedby="fig-vb2-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="non-linear_regression_files/figure-html/fig-vb2-1.svg" class="img-fluid quarto-figure quarto-figure-center figure-img" style="width:80.0%">
</div>
<figcaption class="quarto-float-caption-margin quarto-float-caption quarto-float-fig margin-caption" id="fig-vb2-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;7.8: Fit of the von Bertalanffy model to experimental data obtained from 30 Atlantic Cod individuals.
</figcaption>
</figure>
</div>
</div>
</div>
</section>
<section id="scrathpad" class="level2" data-number="7.7">
<h2 data-number="7.7" class="anchored" data-anchor-id="scrathpad"><span class="header-section-number">7.7</span> Scrathpad</h2>
<section id="to-include-in-the-article" class="level3">
<h3 class="anchored" data-anchor-id="to-include-in-the-article">To include in the article</h3>
<ul>
<li><strong>Use Cases:</strong> Mentioning use cases like trend analysis in time-series data or other applications where the relationship between variables might be expected to follow a polynomial form (e.g., growth rates, trajectories) can provide practical context.</li>
<li><strong>Assumptions:</strong> Not necessary for simply estimating model parameters, but if the model is used for prediction or inference, it is important to state the assumptions of the model (e.g., linearity, homoscedasticity, independence of residuals) and test them.</li>
<li><strong>i.i.d.:</strong> The residuals are assumed to be independent and identically distributed (i.i.d.), which is a common assumption in linear regression models.</li>
<li><strong>Homoscedasticity:</strong></li>
<li><strong>i.i.d:</strong> The residuals are assumed to be independent and identically distributed (i.i.d.), which is a common assumption in linear regression models. For a normal distribution, this is written as <span class="math inline">\epsilon_i \sim N(0, \sigma^2)</span>, where <span class="math inline">\sigma^2</span> is the variance of the residuals.</li>
</ul>
</section>
<section id="contuinuing-the-mm-model" class="level3">
<h3 class="anchored" data-anchor-id="contuinuing-the-mm-model">Contuinuing the MM model</h3>


<!-- -->

<div id="refs" class="references csl-bib-body hanging-indent" role="list" style="display: none">
<div id="ref-smit2002nitrogen" class="csl-entry" role="listitem">
Smit A (2002) Nitrogen uptake by <em><span>Gracilaria</span> gracilis</em> (<span>Rhodophyta</span>): Adaptations to a temporally variable nitrogen environment. Bot Mar 45:196â€“209.
</div>
</div>
</section>
</section>


</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "î§‹";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    // For code content inside modals, clipBoardJS needs to be initialized with a container option
    // TODO: Check when it could be a function (https://github.com/zenorocha/clipboard.js/issues/860)
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
  const viewSource = window.document.getElementById('quarto-view-source') ||
                     window.document.getElementById('quarto-code-tools-source');
  if (viewSource) {
    const sourceUrl = viewSource.getAttribute("data-quarto-source-url");
    viewSource.addEventListener("click", function(e) {
      if (sourceUrl) {
        // rstudio viewer pane
        if (/\bcapabilities=\b/.test(window.location)) {
          window.open(sourceUrl);
        } else {
          window.location.href = sourceUrl;
        }
      } else {
        const modal = new bootstrap.Modal(document.getElementById('quarto-embedded-source-code-modal'));
        modal.show();
      }
      return false;
    });
  }
  function toggleCodeHandler(show) {
    return function(e) {
      const detailsSrc = window.document.querySelectorAll(".cell > details > .sourceCode");
      for (let i=0; i<detailsSrc.length; i++) {
        const details = detailsSrc[i].parentElement;
        if (show) {
          details.open = true;
        } else {
          details.removeAttribute("open");
        }
      }
      const cellCodeDivs = window.document.querySelectorAll(".cell > .sourceCode");
      const fromCls = show ? "hidden" : "unhidden";
      const toCls = show ? "unhidden" : "hidden";
      for (let i=0; i<cellCodeDivs.length; i++) {
        const codeDiv = cellCodeDivs[i];
        if (codeDiv.classList.contains(fromCls)) {
          codeDiv.classList.remove(fromCls);
          codeDiv.classList.add(toCls);
        } 
      }
      return false;
    }
  }
  const hideAllCode = window.document.getElementById("quarto-hide-all-code");
  if (hideAllCode) {
    hideAllCode.addEventListener("click", toggleCodeHandler(false));
  }
  const showAllCode = window.document.getElementById("quarto-show-all-code");
  if (showAllCode) {
    showAllCode.addEventListener("click", toggleCodeHandler(true));
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="./generalised_linear_models.html" class="pagination-link" aria-label="Generalised Linear Models (GLM)">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Generalised Linear Models (GLM)</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="./regularisation.html" class="pagination-link" aria-label="Regularisation Techniques">
        <span class="nav-page-text"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">Regularisation Techniques</span></span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav><div class="modal fade" id="quarto-embedded-source-code-modal" tabindex="-1" aria-labelledby="quarto-embedded-source-code-modal-label" aria-hidden="true"><div class="modal-dialog modal-dialog-scrollable"><div class="modal-content"><div class="modal-header"><h5 class="modal-title" id="quarto-embedded-source-code-modal-label">Source Code</h5><button class="btn-close" data-bs-dismiss="modal"></button></div><div class="modal-body"><div class="">
<div class="sourceCode" id="cb61" data-shortcodes="false"><pre class="sourceCode numberSource markdown number-lines code-with-copy"><code class="sourceCode markdown"><span id="cb61-1"><a href="#cb61-1"></a><span class="co">---</span></span>
<span id="cb61-2"><a href="#cb61-2"></a><span class="an">knitr:</span></span>
<span id="cb61-3"><a href="#cb61-3"></a><span class="co">  opts_chunk:</span></span>
<span id="cb61-4"><a href="#cb61-4"></a><span class="co">    dev:</span></span>
<span id="cb61-5"><a href="#cb61-5"></a><span class="co">      - svg</span></span>
<span id="cb61-6"><a href="#cb61-6"></a><span class="co">      - pdf</span></span>
<span id="cb61-7"><a href="#cb61-7"></a><span class="co">---</span></span>
<span id="cb61-8"><a href="#cb61-8"></a></span>
<span id="cb61-11"><a href="#cb61-11"></a><span class="in">```{r}</span></span>
<span id="cb61-12"><a href="#cb61-12"></a><span class="co">#| echo: false</span></span>
<span id="cb61-13"><a href="#cb61-13"></a><span class="co">#| messages: false</span></span>
<span id="cb61-14"><a href="#cb61-14"></a><span class="co">#| warning: false</span></span>
<span id="cb61-15"><a href="#cb61-15"></a><span class="co">#| include: true</span></span>
<span id="cb61-16"><a href="#cb61-16"></a></span>
<span id="cb61-17"><a href="#cb61-17"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb61-18"><a href="#cb61-18"></a><span class="fu">library</span>(ggpubr)</span>
<span id="cb61-19"><a href="#cb61-19"></a><span class="fu">library</span>(gt)</span>
<span id="cb61-20"><a href="#cb61-20"></a><span class="fu">library</span>(nlme)</span>
<span id="cb61-21"><a href="#cb61-21"></a><span class="fu">library</span>(mgcv)</span>
<span id="cb61-22"><a href="#cb61-22"></a><span class="fu">library</span>(emmeans) <span class="co"># For post-hoc comparisons</span></span>
<span id="cb61-23"><a href="#cb61-23"></a><span class="fu">library</span>(ggsci) <span class="co"># For color palettes</span></span>
<span id="cb61-24"><a href="#cb61-24"></a><span class="fu">library</span>(latex2exp) <span class="co"># For figure titles with LaTeX expressions</span></span>
<span id="cb61-25"><a href="#cb61-25"></a><span class="in">```</span></span>
<span id="cb61-26"><a href="#cb61-26"></a></span>
<span id="cb61-27"><a href="#cb61-27"></a><span class="fu"># Nonlinear Models {#sec-nonlinear-regression}</span></span>
<span id="cb61-28"><a href="#cb61-28"></a></span>
<span id="cb61-29"><a href="#cb61-29"></a>**In This Chapter**</span>
<span id="cb61-30"><a href="#cb61-30"></a></span>
<span id="cb61-31"><a href="#cb61-31"></a><span class="ss">- </span><span class="co">[</span><span class="ot">Nonlinear Regression</span><span class="co">](@sec-nonlinear-regression)</span></span>
<span id="cb61-32"><a href="#cb61-32"></a></span>
<span id="cb61-33"><a href="#cb61-33"></a>**Elsewhere in the Book**</span>
<span id="cb61-34"><a href="#cb61-34"></a></span>
<span id="cb61-35"><a href="#cb61-35"></a><span class="ss">- </span><span class="co">[</span><span class="ot">Simple Linear Regression</span><span class="co">](@sec-simple-linear-regression)</span></span>
<span id="cb61-36"><a href="#cb61-36"></a><span class="ss">- </span><span class="co">[</span><span class="ot">Polynomial Regression</span><span class="co">](@sec-polynomial-regression)</span></span>
<span id="cb61-37"><a href="#cb61-37"></a><span class="ss">- </span><span class="co">[</span><span class="ot">Multiple Linear Regression</span><span class="co">](@sec-multiple-linear-regression)</span></span>
<span id="cb61-38"><a href="#cb61-38"></a><span class="ss">- </span><span class="co">[</span><span class="ot">Generalised Linear Models</span><span class="co">](@sec-generalised-linear-models)</span></span>
<span id="cb61-39"><a href="#cb61-39"></a><span class="ss">- </span><span class="co">[</span><span class="ot">Generalised Additive Models</span><span class="co">](@sec-generalised-additive-models)</span></span>
<span id="cb61-40"><a href="#cb61-40"></a></span>
<span id="cb61-41"><a href="#cb61-41"></a>Nonlinear regression models\index{nonlinear regression} are used when the relationship between the response variable (dependent variable, $Y$) and the predictor variables (independent variables, $X$) is not linear. In other words, they are employed when a straight line is not an appropriate representation of the relationship between the variables.</span>
<span id="cb61-42"><a href="#cb61-42"></a></span>
<span id="cb61-43"><a href="#cb61-43"></a>As we have seen in @sec-simple-linear-regression, polynomial regressions provide a nonlinear relationship between the response and predictor variables (as seen in the regression line fit to the data, @fig-plts A), but they are considered linear models because the parameters are estimated using linear least squares. Another type of nonlinear model is a semi-parametric model where the relationship between the response and predictor variables is described by a function that includes both parametric and non-parametric components. An example of a semi-parametric model is the generalised additive model (GAM) that includes a non-parametric component in the form of a spline function (@sec-generalised-additive-models; @fig-plts B).</span>
<span id="cb61-44"><a href="#cb61-44"></a></span>
<span id="cb61-45"><a href="#cb61-45"></a>The type of nonlinear model I cover in this chapter is a parametric model where the relationship between the response and predictor variables is described by a specific nonlinear function (@fig-plts C). The model still assumes that the residuals are normally distributed and exhibit homoscedasticity. The model parameters are estimated by minimising the sum of squared differences between the observed and predicted values, a method commonly referred to as nonlinear least squares (NLS) regression. This is the term I will adopt.</span>
<span id="cb61-46"><a href="#cb61-46"></a></span>
<span id="cb61-47"><a href="#cb61-47"></a>The primary purpose of nonlinear regression is to derive a formula (model), analyse data, and predict new values where the phenomenon exhibits a nonlinear causal\index{causal} pattern or behaviour. Nonlinear models include a variety of response forms, such as exponential growth models, logistic growth models, and other mechanistic models derived from physical, chemical, or biological processes. Examples of such models include trigonometric, logarithmic, and user-defined functions like the von Bertalanffy model or seasonal cycle represented by a sine curve (@fig-plts C). These models are explicitly nonlinear in both their form and parameters. Unlike polynomial regression, where only the terms of $X$ are transformed, nonlinear models involve an entirely nonlinear function relating $X$ and $Y$. They are often used when there is a theoretical basis for the specific form of the relationship, providing interpretable parameters that carry specific meanings based on the underlying theory, making them useful for detailed applications where the dynamics of the system are well-understood.</span>
<span id="cb61-48"><a href="#cb61-48"></a></span>
<span id="cb61-49"><a href="#cb61-49"></a>A general formula for a nonlinear regression model is:</span>
<span id="cb61-50"><a href="#cb61-50"></a></span>
<span id="cb61-51"><a href="#cb61-51"></a>$$Y_i = f(X_i; \theta) + \epsilon_i$$ {#eq-nonlin}</span>
<span id="cb61-52"><a href="#cb61-52"></a></span>
<span id="cb61-53"><a href="#cb61-53"></a>Where:</span>
<span id="cb61-54"><a href="#cb61-54"></a>  </span>
<span id="cb61-55"><a href="#cb61-55"></a><span class="ss">- </span>$Y_i$ is the response variable for the $i$-th observation,</span>
<span id="cb61-56"><a href="#cb61-56"></a><span class="ss">- </span>$X_i$ is the predictor variable for the $i$-th observation,</span>
<span id="cb61-57"><a href="#cb61-57"></a><span class="ss">- </span>$f(X_i; \theta)$ is a nonlinear function of $X_i$ parameterised by the vector $\theta$,</span>
<span id="cb61-58"><a href="#cb61-58"></a><span class="ss">- </span>$\theta$ is the vector of parameters to be estimated, and</span>
<span id="cb61-59"><a href="#cb61-59"></a><span class="ss">- </span>$\epsilon_i$ is the error term for the $i$-th observation and is assumed to be i.i.d. with a normal distribution.</span>
<span id="cb61-60"><a href="#cb61-60"></a></span>
<span id="cb61-61"><a href="#cb61-61"></a>An example of a specific nonlinear regression model is the exponential growth model:</span>
<span id="cb61-62"><a href="#cb61-62"></a>  </span>
<span id="cb61-63"><a href="#cb61-63"></a>  $$Y_i = \alpha e^{\beta X_i} + \epsilon_i$$ {#eq-exp}</span>
<span id="cb61-64"><a href="#cb61-64"></a></span>
<span id="cb61-65"><a href="#cb61-65"></a>Where:</span>
<span id="cb61-66"><a href="#cb61-66"></a>  </span>
<span id="cb61-67"><a href="#cb61-67"></a><span class="ss">- </span>$\alpha$ and $\beta$ are the parameters to be estimated,</span>
<span id="cb61-68"><a href="#cb61-68"></a><span class="ss">- </span>$e$ is the base of the natural logarithm, and</span>
<span id="cb61-69"><a href="#cb61-69"></a><span class="ss">- </span>$\epsilon_i$ is the error term for the $i$-th observation.</span>
<span id="cb61-70"><a href="#cb61-70"></a></span>
<span id="cb61-71"><a href="#cb61-71"></a>This model is nonlinear in the parameters $\alpha$ and $\beta$, and it describes an exponential relationship between the predictor $X$ and the response $Y$.</span>
<span id="cb61-72"><a href="#cb61-72"></a></span>
<span id="cb61-73"><a href="#cb61-73"></a><span class="in">```{r, fig.width=c(9,6),fig.asp=c(0.65,0.65),out.width=list("80%","12cm")}</span></span>
<span id="cb61-74"><a href="#cb61-74"></a><span class="in">#| echo: false</span></span>
<span id="cb61-75"><a href="#cb61-75"></a><span class="in">#| messages: false</span></span>
<span id="cb61-76"><a href="#cb61-76"></a><span class="in">#| warning: false</span></span>
<span id="cb61-77"><a href="#cb61-77"></a><span class="in">#| fig.cap: "Nonlinear regression models fitted to simulated data. A) a cubic polynomial model, B) a GAM with a thin plate regression spline, and C) a NLS sine curve as a seasonal cycle."</span></span>
<span id="cb61-78"><a href="#cb61-78"></a><span class="in">#| label: fig-plts</span></span>
<span id="cb61-79"><a href="#cb61-79"></a><span class="in">#| fig.align: center</span></span>
<span id="cb61-80"><a href="#cb61-80"></a><span class="in">#| fig-pos: "t"</span></span>
<span id="cb61-81"><a href="#cb61-81"></a></span>
<span id="cb61-82"><a href="#cb61-82"></a><span class="in"># Load necessary libraries</span></span>
<span id="cb61-83"><a href="#cb61-83"></a><span class="in"># Set seed for reproducibility</span></span>
<span id="cb61-84"><a href="#cb61-84"></a><span class="in">set.seed(13)</span></span>
<span id="cb61-85"><a href="#cb61-85"></a></span>
<span id="cb61-86"><a href="#cb61-86"></a><span class="in"># Generate synthetic data for polynomial fit</span></span>
<span id="cb61-87"><a href="#cb61-87"></a><span class="in">x &lt;- seq(-10, 10, length.out = 30)</span></span>
<span id="cb61-88"><a href="#cb61-88"></a><span class="in">y &lt;- 1 - 2*x + 3*x^2 - 0.5*x^3 + rnorm(30, sd = 40)  # cubic equation with noise</span></span>
<span id="cb61-89"><a href="#cb61-89"></a></span>
<span id="cb61-90"><a href="#cb61-90"></a><span class="in">dat_poly &lt;- data.frame(x, y)</span></span>
<span id="cb61-91"><a href="#cb61-91"></a></span>
<span id="cb61-92"><a href="#cb61-92"></a><span class="in"># Fit a cubic polynomial model</span></span>
<span id="cb61-93"><a href="#cb61-93"></a><span class="in">mod_poly &lt;- lm(y ~ poly(x, 3, raw = FALSE), data = dat_poly)</span></span>
<span id="cb61-94"><a href="#cb61-94"></a></span>
<span id="cb61-95"><a href="#cb61-95"></a><span class="in"># Create a data frame for predictions</span></span>
<span id="cb61-96"><a href="#cb61-96"></a><span class="in">x_grid &lt;- seq(min(x), max(x), length.out = 300)</span></span>
<span id="cb61-97"><a href="#cb61-97"></a><span class="in">pred_poly &lt;- data.frame(x = x_grid)</span></span>
<span id="cb61-98"><a href="#cb61-98"></a><span class="in">pred_poly$y &lt;- predict(mod_poly, newdata = pred_poly)</span></span>
<span id="cb61-99"><a href="#cb61-99"></a></span>
<span id="cb61-100"><a href="#cb61-100"></a><span class="in"># Plot the data and the fitted model</span></span>
<span id="cb61-101"><a href="#cb61-101"></a><span class="in">plt_poly &lt;- ggplot(dat_poly, aes(x, y)) +</span></span>
<span id="cb61-102"><a href="#cb61-102"></a><span class="in">  geom_point(size = 2, shape = 1, colour = "royalblue2") +</span></span>
<span id="cb61-103"><a href="#cb61-103"></a><span class="in">  geom_line(data = pred_poly, aes(x, y), color = "black") +</span></span>
<span id="cb61-104"><a href="#cb61-104"></a><span class="in">  xlab("Predictor, X") +</span></span>
<span id="cb61-105"><a href="#cb61-105"></a><span class="in">  ylab("Response, Y")</span></span>
<span id="cb61-106"><a href="#cb61-106"></a></span>
<span id="cb61-107"><a href="#cb61-107"></a><span class="in"># Simulate data for a seasonal cycle</span></span>
<span id="cb61-108"><a href="#cb61-108"></a><span class="in">x &lt;- seq(0, 365, by = 7)  # Days of the year</span></span>
<span id="cb61-109"><a href="#cb61-109"></a><span class="in">amplitude &lt;- 6  # Amplitude (half the difference between longest and shortest day)</span></span>
<span id="cb61-110"><a href="#cb61-110"></a><span class="in">offset &lt;- 12   # Average day length</span></span>
<span id="cb61-111"><a href="#cb61-111"></a><span class="in">y &lt;- amplitude * sin(2 * pi * (x / 365 - 0.25)) + offset + rnorm(length(x), sd = 0.55)  # Sine curve with noise</span></span>
<span id="cb61-112"><a href="#cb61-112"></a></span>
<span id="cb61-113"><a href="#cb61-113"></a><span class="in"># Create data frame</span></span>
<span id="cb61-114"><a href="#cb61-114"></a><span class="in">dat_sin &lt;- data.frame(Day = x, DayLength = y)</span></span>
<span id="cb61-115"><a href="#cb61-115"></a></span>
<span id="cb61-116"><a href="#cb61-116"></a><span class="in"># Fit nonlinear regression model (using nls)</span></span>
<span id="cb61-117"><a href="#cb61-117"></a><span class="in">mod_sin &lt;- nls(DayLength ~ A * sin(2 * pi * (Day / 365 - phi)) + C, data = dat_sin, </span></span>
<span id="cb61-118"><a href="#cb61-118"></a><span class="in">             start = list(A = 6, phi = 0.25, C = 12))</span></span>
<span id="cb61-119"><a href="#cb61-119"></a></span>
<span id="cb61-120"><a href="#cb61-120"></a><span class="in"># Get predicted values</span></span>
<span id="cb61-121"><a href="#cb61-121"></a><span class="in">dat_sin$Predicted &lt;- predict(mod_sin)</span></span>
<span id="cb61-122"><a href="#cb61-122"></a></span>
<span id="cb61-123"><a href="#cb61-123"></a><span class="in"># Visualise results</span></span>
<span id="cb61-124"><a href="#cb61-124"></a><span class="in">plt_sin &lt;- ggplot(dat_sin, aes(x = Day)) +</span></span>
<span id="cb61-125"><a href="#cb61-125"></a><span class="in">  geom_point(aes(y = DayLength), size = 2, shape = 1, color = "royalblue2") +</span></span>
<span id="cb61-126"><a href="#cb61-126"></a><span class="in">  geom_line(aes(y = Predicted), color = "black") +</span></span>
<span id="cb61-127"><a href="#cb61-127"></a><span class="in">  labs(x = "Day of the Year", y = "Response, Y")</span></span>
<span id="cb61-128"><a href="#cb61-128"></a></span>
<span id="cb61-129"><a href="#cb61-129"></a><span class="in"># Parameters for the Michaelis-Menten model</span></span>
<span id="cb61-130"><a href="#cb61-130"></a><span class="in">V_max &lt;- 100  # maximum rate of the enzyme reaction</span></span>
<span id="cb61-131"><a href="#cb61-131"></a><span class="in">K_m &lt;- 25     # Michaelis constant</span></span>
<span id="cb61-132"><a href="#cb61-132"></a></span>
<span id="cb61-133"><a href="#cb61-133"></a><span class="in"># Generate substrate concentrations</span></span>
<span id="cb61-134"><a href="#cb61-134"></a><span class="in">S &lt;- seq(0, 100, length.out = 30)</span></span>
<span id="cb61-135"><a href="#cb61-135"></a></span>
<span id="cb61-136"><a href="#cb61-136"></a><span class="in"># Generate reaction rates using the Michaelis-Menten equation with added noise</span></span>
<span id="cb61-137"><a href="#cb61-137"></a><span class="in">V &lt;- (V_max * S) / (K_m + S) + rnorm(30, mean = 0, sd = 5)</span></span>
<span id="cb61-138"><a href="#cb61-138"></a></span>
<span id="cb61-139"><a href="#cb61-139"></a><span class="in"># Create a data frame</span></span>
<span id="cb61-140"><a href="#cb61-140"></a><span class="in">dat_mm &lt;- data.frame(S, V)</span></span>
<span id="cb61-141"><a href="#cb61-141"></a></span>
<span id="cb61-142"><a href="#cb61-142"></a><span class="in"># Fit the Michaelis-Menten model</span></span>
<span id="cb61-143"><a href="#cb61-143"></a><span class="in">mod_mm &lt;- nls(V ~ (V_max * S) / (K_m + S), data = dat_mm, start = list(V_max = 90, K_m = 40))</span></span>
<span id="cb61-144"><a href="#cb61-144"></a></span>
<span id="cb61-145"><a href="#cb61-145"></a><span class="in"># Create a grid for predictions</span></span>
<span id="cb61-146"><a href="#cb61-146"></a><span class="in">S_grid &lt;- seq(min(S), max(S), length.out = 300)</span></span>
<span id="cb61-147"><a href="#cb61-147"></a><span class="in">pred_mm &lt;- data.frame(S = S_grid)</span></span>
<span id="cb61-148"><a href="#cb61-148"></a><span class="in">pred_mm$V &lt;- predict(mod_mm, newdata = pred_mm)</span></span>
<span id="cb61-149"><a href="#cb61-149"></a></span>
<span id="cb61-150"><a href="#cb61-150"></a><span class="in"># Plot the data and the fitted model</span></span>
<span id="cb61-151"><a href="#cb61-151"></a><span class="in">plt_mic &lt;- ggplot(dat_mm, aes(S, V)) +</span></span>
<span id="cb61-152"><a href="#cb61-152"></a><span class="in">  geom_point(size = 2, shape = 1, colour = "royalblue2") +</span></span>
<span id="cb61-153"><a href="#cb61-153"></a><span class="in">  geom_line(data = pred_mm, aes(S, V), color = "black") +</span></span>
<span id="cb61-154"><a href="#cb61-154"></a><span class="in">  xlab("Substrate Concentration [S]") +</span></span>
<span id="cb61-155"><a href="#cb61-155"></a><span class="in">  ylab("Uptake Rate V")</span></span>
<span id="cb61-156"><a href="#cb61-156"></a></span>
<span id="cb61-157"><a href="#cb61-157"></a><span class="in"># Generate synthetic data</span></span>
<span id="cb61-158"><a href="#cb61-158"></a><span class="in">x &lt;- seq(-3, 3, length.out = 30)</span></span>
<span id="cb61-159"><a href="#cb61-159"></a><span class="in">y &lt;- x^2 * sin(x) + rnorm(30, sd = 0.5)  # Complex nonlinear relationship</span></span>
<span id="cb61-160"><a href="#cb61-160"></a></span>
<span id="cb61-161"><a href="#cb61-161"></a><span class="in">dat_gam &lt;- data.frame(x, y)</span></span>
<span id="cb61-162"><a href="#cb61-162"></a></span>
<span id="cb61-163"><a href="#cb61-163"></a><span class="in"># Fit a Generalized Additive Model using thin plate regression spline</span></span>
<span id="cb61-164"><a href="#cb61-164"></a><span class="in">mod_gam &lt;- gam(y ~ s(x, bs = "tp"), data = dat_gam)  # 'tp' specifies thin plate spline</span></span>
<span id="cb61-165"><a href="#cb61-165"></a></span>
<span id="cb61-166"><a href="#cb61-166"></a><span class="in"># Create a grid for predictions</span></span>
<span id="cb61-167"><a href="#cb61-167"></a><span class="in">x_grid &lt;- seq(min(x), max(x), length.out = 300)</span></span>
<span id="cb61-168"><a href="#cb61-168"></a><span class="in">pred_gam &lt;- data.frame(x = x_grid)</span></span>
<span id="cb61-169"><a href="#cb61-169"></a><span class="in">pred_gam$y &lt;- predict(mod_gam, newdata = pred_gam)</span></span>
<span id="cb61-170"><a href="#cb61-170"></a></span>
<span id="cb61-171"><a href="#cb61-171"></a><span class="in"># Plot the data and the fitted GAM</span></span>
<span id="cb61-172"><a href="#cb61-172"></a><span class="in">plt_gam &lt;- ggplot(dat_gam, aes(x, y)) +</span></span>
<span id="cb61-173"><a href="#cb61-173"></a><span class="in">  geom_point(size = 2, shape = 1, colour = "royalblue2") +</span></span>
<span id="cb61-174"><a href="#cb61-174"></a><span class="in">  geom_line(data = pred_gam, aes(x, y), color = "black") +</span></span>
<span id="cb61-175"><a href="#cb61-175"></a><span class="in">  xlab("Predictor, X") +</span></span>
<span id="cb61-176"><a href="#cb61-176"></a><span class="in">  ylab("Response, Y")</span></span>
<span id="cb61-177"><a href="#cb61-177"></a></span>
<span id="cb61-178"><a href="#cb61-178"></a><span class="in">ggarrange(plt_poly, plt_gam, plt_sin, ncol = 2, nrow = 2,</span></span>
<span id="cb61-179"><a href="#cb61-179"></a><span class="in">          labels = "AUTO")</span></span>
<span id="cb61-180"><a href="#cb61-180"></a><span class="in">```</span></span>
<span id="cb61-181"><a href="#cb61-181"></a></span>
<span id="cb61-182"><a href="#cb61-182"></a></span>
<span id="cb61-183"><a href="#cb61-183"></a><span class="fu">## Extension of Nonlinear Models</span></span>
<span id="cb61-184"><a href="#cb61-184"></a></span>
<span id="cb61-185"><a href="#cb61-185"></a>Like linear models, nonlinear models have also been extended to include multiple predictors, interactions, and other terms to capture complex relationships between the variables. The first type of more complex nonlinear models accommodates a wider range of data distributions by generalising to non-normal error distributions through link functions. These models are called generalised nonlinear models (GNLMs). The examples of GLMs in @sec-generalised-linear-model should prepare you sufficiently to handle nonlinear models too. The other type deals with hierarchical data structures and incorporates fixed and random effects. As such, you can also correctly model repeated measures and longitudinal, and nested (grouped) designs. These hierarchical models are called nonlinear mixed models (NLMMs). Examples of NLMMs are provided in @sec-mf-treatments and @sec-perturbation.</span>
<span id="cb61-186"><a href="#cb61-186"></a></span>
<span id="cb61-187"><a href="#cb61-187"></a></span>
<span id="cb61-188"><a href="#cb61-188"></a><span class="fu">## Considerations for Model Selection</span></span>
<span id="cb61-189"><a href="#cb61-189"></a></span>
<span id="cb61-190"><a href="#cb61-190"></a><span class="in">```{r, fig.width=c(6,5),fig.asp=0.5,out.width=c("80%","12cm")}</span></span>
<span id="cb61-191"><a href="#cb61-191"></a><span class="in">#| echo: false</span></span>
<span id="cb61-192"><a href="#cb61-192"></a><span class="in">#| messages: false</span></span>
<span id="cb61-193"><a href="#cb61-193"></a><span class="in">#| warning: false</span></span>
<span id="cb61-194"><a href="#cb61-194"></a><span class="in">#| fig.cap: "Plot of growth rate data fitted with a von Bertalanffy model, a first- (straight line), second- and third-order polynomial, and a GAM."</span></span>
<span id="cb61-195"><a href="#cb61-195"></a><span class="in">#| label: fig-combo</span></span>
<span id="cb61-196"><a href="#cb61-196"></a><span class="in">#| fig.align: center</span></span>
<span id="cb61-197"><a href="#cb61-197"></a><span class="in">#| fig-pos: "t"</span></span>
<span id="cb61-198"><a href="#cb61-198"></a></span>
<span id="cb61-199"><a href="#cb61-199"></a><span class="in">set.seed(13)</span></span>
<span id="cb61-200"><a href="#cb61-200"></a></span>
<span id="cb61-201"><a href="#cb61-201"></a><span class="in"># Parameters for the von Bertalanffy model</span></span>
<span id="cb61-202"><a href="#cb61-202"></a><span class="in">L_inf &lt;- 100  # theoretical maximum length</span></span>
<span id="cb61-203"><a href="#cb61-203"></a><span class="in">k &lt;- 0.2      # growth rate</span></span>
<span id="cb61-204"><a href="#cb61-204"></a><span class="in">t0 &lt;- -1      # hypothetical age at length zero</span></span>
<span id="cb61-205"><a href="#cb61-205"></a></span>
<span id="cb61-206"><a href="#cb61-206"></a><span class="in"># Generate time points</span></span>
<span id="cb61-207"><a href="#cb61-207"></a><span class="in">t &lt;- 0:20</span></span>
<span id="cb61-208"><a href="#cb61-208"></a></span>
<span id="cb61-209"><a href="#cb61-209"></a><span class="in"># Generate lengths using the von Bertalanffy equation with some added noise</span></span>
<span id="cb61-210"><a href="#cb61-210"></a><span class="in">L_t &lt;- L_inf * (1 - exp(-k * (t - t0))) + rnorm(21, mean = 0, sd = 5)</span></span>
<span id="cb61-211"><a href="#cb61-211"></a></span>
<span id="cb61-212"><a href="#cb61-212"></a><span class="in"># Create a data frame</span></span>
<span id="cb61-213"><a href="#cb61-213"></a><span class="in">dat_vb &lt;- data.frame(t, L_t)</span></span>
<span id="cb61-214"><a href="#cb61-214"></a></span>
<span id="cb61-215"><a href="#cb61-215"></a><span class="in"># Fit the von Bertalanffy model</span></span>
<span id="cb61-216"><a href="#cb61-216"></a><span class="in">mod_vb &lt;- nls(L_t ~ L_inf * (1 - exp(-k * (t - t0))), data = dat_vb, start = list(L_inf = 80, k = 0.1, t0 = 0))</span></span>
<span id="cb61-217"><a href="#cb61-217"></a></span>
<span id="cb61-218"><a href="#cb61-218"></a><span class="in"># Fit polynomial model2</span></span>
<span id="cb61-219"><a href="#cb61-219"></a><span class="in">mod_poly1 &lt;- lm(L_t ~ poly(t, 1, raw = FALSE), data = dat_vb)</span></span>
<span id="cb61-220"><a href="#cb61-220"></a><span class="in">mod_poly2 &lt;- lm(L_t ~ poly(t, 2, raw = FALSE), data = dat_vb)</span></span>
<span id="cb61-221"><a href="#cb61-221"></a><span class="in">mod_poly3 &lt;- lm(L_t ~ poly(t, 3, raw = FALSE), data = dat_vb)</span></span>
<span id="cb61-222"><a href="#cb61-222"></a></span>
<span id="cb61-223"><a href="#cb61-223"></a><span class="in"># Fit the GAM</span></span>
<span id="cb61-224"><a href="#cb61-224"></a><span class="in">mod_gam &lt;- gam(L_t ~ s(t), data = dat_vb)</span></span>
<span id="cb61-225"><a href="#cb61-225"></a></span>
<span id="cb61-226"><a href="#cb61-226"></a><span class="in"># Create a grid for predictions</span></span>
<span id="cb61-227"><a href="#cb61-227"></a><span class="in">t_grid &lt;- seq(min(t), max(t), length.out = 21)</span></span>
<span id="cb61-228"><a href="#cb61-228"></a><span class="in">pred_vb &lt;- data.frame(t = t_grid)</span></span>
<span id="cb61-229"><a href="#cb61-229"></a><span class="in">L_t_pred &lt;- predict(mod_vb, newdata = pred_vb)</span></span>
<span id="cb61-230"><a href="#cb61-230"></a><span class="in">y1_pred &lt;- predict(mod_poly1, newdata = pred_vb)</span></span>
<span id="cb61-231"><a href="#cb61-231"></a><span class="in">y2_pred &lt;- predict(mod_poly2, newdata = pred_vb)</span></span>
<span id="cb61-232"><a href="#cb61-232"></a><span class="in">y3_pred &lt;- predict(mod_poly3, newdata = pred_vb)</span></span>
<span id="cb61-233"><a href="#cb61-233"></a><span class="in">y_gam_pred &lt;- predict(mod_gam, newdata = pred_vb)</span></span>
<span id="cb61-234"><a href="#cb61-234"></a><span class="in">dat_vb &lt;- cbind(dat_vb, L_t_pred, y1_pred, y2_pred, y3_pred, y_gam_pred)</span></span>
<span id="cb61-235"><a href="#cb61-235"></a></span>
<span id="cb61-236"><a href="#cb61-236"></a><span class="in"># Combine the original data and predictions for consistent aes mapping</span></span>
<span id="cb61-237"><a href="#cb61-237"></a><span class="in">plot_data &lt;- data.frame(</span></span>
<span id="cb61-238"><a href="#cb61-238"></a><span class="in">  t = rep(t_grid, 5),</span></span>
<span id="cb61-239"><a href="#cb61-239"></a><span class="in">  Length = c(dat_vb$L_t_pred, dat_vb$y1_pred, dat_vb$y2_pred, dat_vb$y3_pred, dat_vb$y_gam_pred),</span></span>
<span id="cb61-240"><a href="#cb61-240"></a><span class="in">  Model = rep(c("von Bertalanffy", "poly1", "poly2", "poly3", "GAM"), each = length(t_grid))</span></span>
<span id="cb61-241"><a href="#cb61-241"></a><span class="in">)</span></span>
<span id="cb61-242"><a href="#cb61-242"></a></span>
<span id="cb61-243"><a href="#cb61-243"></a><span class="in"># Plot the data and the fitted model</span></span>
<span id="cb61-244"><a href="#cb61-244"></a><span class="in">ggplot(dat_vb, aes(t, L_t)) +</span></span>
<span id="cb61-245"><a href="#cb61-245"></a><span class="in">  geom_point(size = 2, shape = 1, colour = "royalblue2") +</span></span>
<span id="cb61-246"><a href="#cb61-246"></a><span class="in">  geom_line(data = plot_data, aes(t, Length, colour = Model), alpha = 0.6) +</span></span>
<span id="cb61-247"><a href="#cb61-247"></a><span class="in">  scale_color_manual(name = "Model",</span></span>
<span id="cb61-248"><a href="#cb61-248"></a><span class="in">                     values = c("von Bertalanffy" = "black", "poly1" = "coral3", "poly2" = "deepskyblue3", "poly3" = "deeppink3", "GAM" = "seagreen3")) +</span></span>
<span id="cb61-249"><a href="#cb61-249"></a><span class="in">  xlab("Time (years)") +</span></span>
<span id="cb61-250"><a href="#cb61-250"></a><span class="in">  ylab("Length (cm)") +</span></span>
<span id="cb61-251"><a href="#cb61-251"></a><span class="in">  theme(legend.position = "right")</span></span>
<span id="cb61-252"><a href="#cb61-252"></a><span class="in">```</span></span>
<span id="cb61-253"><a href="#cb61-253"></a></span>
<span id="cb61-254"><a href="#cb61-254"></a>There are a few practical considerations to keep in mind when choosing a suitable nonlinear (in shape) model. Sometimes different models can provide similar fits to the same data, but they may have different implications for the interpretation of the relationship between the variables. See for example @fig-combo. The plot shows growth rate data fitted with a first-, second- and third-order polynomial, a GAM, and a NLS von Bertalanffy model. To the untrained eye and inexperienced biologist, all models seem to provide a good fit to the data, but they do differ subtly in the shape of the fitted curve. The von Bertalanffy model is a saturating growth model (it reaches a plateau), while the polynomial models and the GAM are more flexible and can capture a wider range of shapes. The choice of model should be guided by the underlying biological or physical processes that generated the data and the research question you are trying to answer.</span>
<span id="cb61-255"><a href="#cb61-255"></a></span>
<span id="cb61-256"><a href="#cb61-256"></a>Since you will often have to decide among polynomial regressions, nonlinear models, and GAMs, I'll outline some general guidelines to help you make an informed decision.</span>
<span id="cb61-257"><a href="#cb61-257"></a></span>
<span id="cb61-258"><a href="#cb61-258"></a><span class="ss">-   </span>**Linearity vs. Nonlinearity:** If the relationship between the variables is linear or can be adequately approximated by a polynomial function, polynomial regression is a suitable choice. Nonlinear models or GAMs may be more appropriate if the relationship is nonlinear and does not follow a specific polynomial form. In @fig-combo, it is obvious that the straight line model is not a good fit for the data, but the second- and third-order polynomial models, the GAM, and the von Bertalanffy model all provide better fits.</span>
<span id="cb61-259"><a href="#cb61-259"></a></span>
<span id="cb61-260"><a href="#cb61-260"></a><span class="ss">-   </span>**Complexity of the Relationship:** Polynomial regression is limited in its ability to capture complex nonlinear relationships, especially those with more bends, peaks, or valleys than a polynomial of order &lt;3 (or even 4 at a push) can capture. Another consideration is the process the data represent: if it is inherently nonlinear according to a known function such as exponential growth or decay, seasonal sinusoidal patterns, or logistic growth, then nonlinear models or GAMs are more flexible and can capture a wider range of nonlinear responses. In @fig-combo, the von Bertalanffy model is a saturating growth model, which is a known biological process that can be captured by a nonlinear model. The 3rd-order polynomial model also seems to capture a saturating growth pattern, but it also somewhat influenced by the dip in the raw data around 12.5 years (in addition to some other nuances), but this is likely due to some random variation and is not part of the growth response.</span>
<span id="cb61-261"><a href="#cb61-261"></a></span>
<span id="cb61-262"><a href="#cb61-262"></a><span class="ss">-   </span>**Interpretability vs. Flexibility:** Polynomial regression provides coefficients that relate to the powers of the predictor variables, but the interpretation of the $\beta$ parameters is not as intuitive as in a linear model of order 1. In contrast, nonlinear models and GAMs offer greater flexibility in capturing complex patterns. GAMs may lack direct interpretability of the coefficients, but the nonlinear model offers coefficients that can be interpreted in the context of the model's structure. In @fig-combo, the von Bertalanffy model has a clear biological interpretation (see @sec-vonbertalanffy), while the 3rd-order polynomial model and the GAM are more flexible and can capture a wider range of shapes (it follows the dips and peaks in the raw data closer). The 2nd-order polynomial does not fit the data as well at very low ages at 20 year, but it is still a better fit than the linear model.</span>
<span id="cb61-263"><a href="#cb61-263"></a></span>
<span id="cb61-264"><a href="#cb61-264"></a><span class="ss">-   </span>**Overfitting Concerns:** Polynomial regression with high-degree polynomials can lead to overfitting, especially when the model complexity exceeds the underlying data patterns. Nonlinear models and GAMs can also overfit if not properly regularised or constrained. These insights can be seen when we examine the summaries of the regression fits, and can be formally assessed using cross-validation or information criteria. In @fig-combo, the 3rd-order polynomial model seems to capture some of the random variation in the data, which may be an indication of overfitting. The GAM also seems to capture some of the random variation, but it is less pronounced than in the 3rd-order polynomial model.</span>
<span id="cb61-265"><a href="#cb61-265"></a></span>
<span id="cb61-266"><a href="#cb61-266"></a><span class="ss">-   </span>**Data Size and Complexity:** For small to moderate-sized datasets with complex nonlinear relationships, GAMs may be more suitable due to their flexibility and ability to capture intricate patterns. For simpler relationships or when interpretability is important, nonlinear regression (with mechanistically-informed parameters) may be preferred. These are not of concern in @fig-combo.</span>
<span id="cb61-267"><a href="#cb61-267"></a></span>
<span id="cb61-268"><a href="#cb61-268"></a><span class="ss">-   </span>**Model Complexity and Assumptions:** Polynomial regression assumes a specific polynomial form for the relationship, which may not hold in practice. Nonlinear models and GAMs are more flexible and do not always impose strict parametric assumptions (see @sec-assumptions), making them more robust to deviations from the assumed form. A detailed assessment of the model assumptions and the complexity of the relationship can help guide the choice of model. We need to add to this our biologist specialist knowledge to make the best choice.</span>
<span id="cb61-269"><a href="#cb61-269"></a></span>
<span id="cb61-270"><a href="#cb61-270"></a><span class="ss">-   </span>**Computational Considerations:** Polynomial regression is relatively simple to implement and computationally efficient, especially for low-degree polynomials. Nonlinear models and GAMs may require more computational resources, especially for large datasets or complex models. Not a concern for the models represented in @fig-combo.</span>
<span id="cb61-271"><a href="#cb61-271"></a></span>
<span id="cb61-272"><a href="#cb61-272"></a><span class="fu">## Requirements and Assumptions {#sec-assumptions}</span></span>
<span id="cb61-273"><a href="#cb61-273"></a></span>
<span id="cb61-274"><a href="#cb61-274"></a>Polynomial regression, nonlinear regression, and GAMs are built upon the principles of linear regression; therefore, the fundamental assumptions of normality and homoscedasticity of residuals usually still apply. Specifically, these models assume that the residuals are independent and identically distributed (i.i.d.), which implies that they are normally distributed with a constant variance (homoscedasticity). However, the specifics can vary depending on the model and the distribution of the response variable. Of course, there is also the requirement for the response variable to be continuous and independent. These assumptions help ensure that the error terms (residuals) in the model are well-behaved so that reliable inference and predictions can be obtained.</span>
<span id="cb61-275"><a href="#cb61-275"></a></span>
<span id="cb61-276"><a href="#cb61-276"></a>Nuances:</span>
<span id="cb61-277"><a href="#cb61-277"></a></span>
<span id="cb61-278"><a href="#cb61-278"></a><span class="ss">-   </span>**Polynomial Regression:** While a type of nonlinear regression,</span>
<span id="cb61-279"><a href="#cb61-279"></a>    polynomial models are still linear in their parameters. This means</span>
<span id="cb61-280"><a href="#cb61-280"></a>    that they are more bound to the classic regression assumptions and</span>
<span id="cb61-281"><a href="#cb61-281"></a>    can be more sensitive to violations.</span>
<span id="cb61-282"><a href="#cb61-282"></a><span class="ss">-   </span>**GAMs:** Offer more flexibility in handling nonlinear</span>
<span id="cb61-283"><a href="#cb61-283"></a>    relationships. Depending on the distributions used for the outcome</span>
<span id="cb61-284"><a href="#cb61-284"></a>    variable and the link functions employed, GAMs can potentially relax</span>
<span id="cb61-285"><a href="#cb61-285"></a>    some of the strict normality assumptions.</span>
<span id="cb61-286"><a href="#cb61-286"></a><span class="ss">-   </span>**Nonlinear Models in General:** Some truly nonlinear models (like</span>
<span id="cb61-287"><a href="#cb61-287"></a>    those based on exponential or logarithmic functions) may have</span>
<span id="cb61-288"><a href="#cb61-288"></a>    inherently different error structures and may not strictly require</span>
<span id="cb61-289"><a href="#cb61-289"></a>    the same assumptions of normality and homoscedasticity. However,</span>
<span id="cb61-290"><a href="#cb61-290"></a>    these models come with their own set of assumptions and</span>
<span id="cb61-291"><a href="#cb61-291"></a>    considerations.</span>
<span id="cb61-292"><a href="#cb61-292"></a></span>
<span id="cb61-293"><a href="#cb61-293"></a>Important considerations:</span>
<span id="cb61-294"><a href="#cb61-294"></a></span>
<span id="cb61-295"><a href="#cb61-295"></a><span class="ss">-   </span>**Diagnostic Checks:** Regardless of the model type, it's</span>
<span id="cb61-296"><a href="#cb61-296"></a>    *essential* to perform residual diagnostics to assess if assumptions</span>
<span id="cb61-297"><a href="#cb61-297"></a>    are met. Visualisations (e.g., histograms, Q-Q plots, residuals vs.</span>
<span id="cb61-298"><a href="#cb61-298"></a>    fitted plots) are well-known tools.</span>
<span id="cb61-299"><a href="#cb61-299"></a><span class="ss">-   </span>**Transformations:** If violations of assumptions</span>
<span id="cb61-300"><a href="#cb61-300"></a>    are found, data transformation techniques (e.g., Box-Cox, log)</span>
<span id="cb61-301"><a href="#cb61-301"></a>    could be considered to improve model validity.</span>
<span id="cb61-302"><a href="#cb61-302"></a><span class="ss">-   </span>**Generalised Linear Models (GLMs):** An important class of models</span>
<span id="cb61-303"><a href="#cb61-303"></a>    designed to handle various non-normal responses (e.g., count,</span>
<span id="cb61-304"><a href="#cb61-304"></a>    binary) while extending the linear modeling framework. GLMs are good alternative to both polynomial regression and GAMs in</span>
<span id="cb61-305"><a href="#cb61-305"></a>    certain contexts.</span>
<span id="cb61-306"><a href="#cb61-306"></a><span class="ss">-   </span>**Mixed models:** Linear Mixed Models (LLMs), Generalised Linear Mixed Models (GLMMs), and Generalised Nonlinear Models (GNLMs) can be used to account for dependencies in the data, such as repeated measures or hierarchical</span>
<span id="cb61-307"><a href="#cb61-307"></a>    structures. GAMs also accommodate mixed data structures.</span>
<span id="cb61-308"><a href="#cb61-308"></a></span>
<span id="cb61-309"><a href="#cb61-309"></a>The rest of this chapter will focus on the practical aspects of fitting</span>
<span id="cb61-310"><a href="#cb61-310"></a>polynomial regression models and nonlinear regressions in R. GAMs will</span>
<span id="cb61-311"><a href="#cb61-311"></a>be covered in a separate chapter due to their unique characteristics and</span>
<span id="cb61-312"><a href="#cb61-312"></a>implementation details.</span>
<span id="cb61-313"><a href="#cb61-313"></a></span>
<span id="cb61-314"><a href="#cb61-314"></a><span class="fu">## R Functions and Packages</span></span>
<span id="cb61-315"><a href="#cb61-315"></a></span>
<span id="cb61-316"><a href="#cb61-316"></a><span class="fu">### Polynomial Regression</span></span>
<span id="cb61-317"><a href="#cb61-317"></a></span>
<span id="cb61-318"><a href="#cb61-318"></a>To fit a polynomial model in R, use the simple linear regression function <span class="in">`lm()`</span> to fit the model. The purpose of <span class="in">`poly()`</span> is to generate polynomial terms of a specified degree. The basic form is:</span>
<span id="cb61-319"><a href="#cb61-319"></a></span>
<span id="cb61-322"><a href="#cb61-322"></a><span class="in">```{r}</span></span>
<span id="cb61-323"><a href="#cb61-323"></a><span class="co">#| eval: FALSE</span></span>
<span id="cb61-324"><a href="#cb61-324"></a><span class="co">#| echo: TRUE</span></span>
<span id="cb61-325"><a href="#cb61-325"></a></span>
<span id="cb61-326"><a href="#cb61-326"></a>poly_model <span class="ot">&lt;-</span> <span class="fu">lm</span>(y <span class="sc">~</span> <span class="fu">poly</span>(x, <span class="at">degree =</span> <span class="dv">2</span>), <span class="at">data =</span> data)</span>
<span id="cb61-327"><a href="#cb61-327"></a><span class="in">```</span></span>
<span id="cb61-328"><a href="#cb61-328"></a></span>
<span id="cb61-329"><a href="#cb61-329"></a>GLMs are a generalisation of ordinary linear regression that allows for the response variable to have</span>
<span id="cb61-330"><a href="#cb61-330"></a>non-Gaussian error distributions such as one of the exponential family</span>
<span id="cb61-331"><a href="#cb61-331"></a>distributions (e.g., binomial, Poisson, gamma). These distributions are</span>
<span id="cb61-332"><a href="#cb61-332"></a>accommodated via so-called link functions within the GLM framework. The</span>
<span id="cb61-333"><a href="#cb61-333"></a>most common R function for fitting GLMs is <span class="in">`glm()`</span>.</span>
<span id="cb61-334"><a href="#cb61-334"></a></span>
<span id="cb61-335"><a href="#cb61-335"></a>Mixed models that include random and fixed effects (see box 'Fixed and</span>
<span id="cb61-336"><a href="#cb61-336"></a>Random Effects') are also available. These are necessary for the</span>
<span id="cb61-337"><a href="#cb61-337"></a>analysis of data that have correlations within groups or hierarchies</span>
<span id="cb61-338"><a href="#cb61-338"></a>(e.g., repeated measures<span class="ot">[^2]</span> or the inclusion of grouped variables).</span>
<span id="cb61-339"><a href="#cb61-339"></a>Commonly used are <span class="in">`lmer()`</span> for LLMs and <span class="in">`glmer()`</span> for GLMMs. Both functions are in the</span>
<span id="cb61-340"><a href="#cb61-340"></a>**lme4** package. Another package that accommodates LLMs is **nlme** and</span>
<span id="cb61-341"><a href="#cb61-341"></a>its <span class="in">`lme()`</span> function. It has somewhat different capabilities and syntax</span>
<span id="cb61-342"><a href="#cb61-342"></a>compared to **lme4**.</span>
<span id="cb61-343"><a href="#cb61-343"></a></span>
<span id="cb61-344"><a href="#cb61-344"></a><span class="ot">[^2]: </span>Repeated measures are multiple observations taken on the same</span>
<span id="cb61-345"><a href="#cb61-345"></a>    subject or unit over time or under different conditions. Sometimes</span>
<span id="cb61-346"><a href="#cb61-346"></a>    this is called longitudinal data.</span>
<span id="cb61-347"><a href="#cb61-347"></a></span>
<span id="cb61-348"><a href="#cb61-348"></a>::: callout-note</span>
<span id="cb61-349"><a href="#cb61-349"></a><span class="fu">## Fixed and Random Effects</span></span>
<span id="cb61-350"><a href="#cb61-350"></a></span>
<span id="cb61-351"><a href="#cb61-351"></a>Random effects and fixed effects are used in regression models to</span>
<span id="cb61-352"><a href="#cb61-352"></a>account for different sources of variation in the data.</span>
<span id="cb61-353"><a href="#cb61-353"></a></span>
<span id="cb61-354"><a href="#cb61-354"></a>*Fixed effects* are variables or factors that represent</span>
<span id="cb61-355"><a href="#cb61-355"></a>sources of variation that are of primary interest in the study or that</span>
<span id="cb61-356"><a href="#cb61-356"></a>have a finite and fixed number of levels or categories. These effects</span>
<span id="cb61-357"><a href="#cb61-357"></a>are assumed to have an influence on the mean response.</span>
<span id="cb61-358"><a href="#cb61-358"></a>Examples of fixed effects include:</span>
<span id="cb61-359"><a href="#cb61-359"></a></span>
<span id="cb61-360"><a href="#cb61-360"></a><span class="ss">-   </span>Treatment groups in an experiment (e.g., fertiliser A, fertiliser B, control)</span>
<span id="cb61-361"><a href="#cb61-361"></a><span class="ss">-   </span>Categorical variables (e.g., sex, age group, species)</span>
<span id="cb61-362"><a href="#cb61-362"></a><span class="ss">-   </span>Continuous variables (e.g., time, temperature, concentration)</span>
<span id="cb61-363"><a href="#cb61-363"></a></span>
<span id="cb61-364"><a href="#cb61-364"></a>The coefficients associated with fixed effects are estimated and</span>
<span id="cb61-365"><a href="#cb61-365"></a>interpreted as the primary effects of interest in the model.</span>
<span id="cb61-366"><a href="#cb61-366"></a></span>
<span id="cb61-367"><a href="#cb61-367"></a>*Random effects* are variables or factors that represent</span>
<span id="cb61-368"><a href="#cb61-368"></a>sources of variation that are not of primary interest but need to be</span>
<span id="cb61-369"><a href="#cb61-369"></a>accounted for in the model. These effects are assumed to be randomly</span>
<span id="cb61-370"><a href="#cb61-370"></a>sampled from a larger population, and their levels are theoretically</span>
<span id="cb61-371"><a href="#cb61-371"></a>infinite or too numerous to be modeled as fixed effects. Examples of</span>
<span id="cb61-372"><a href="#cb61-372"></a>random effects include:</span>
<span id="cb61-373"><a href="#cb61-373"></a></span>
<span id="cb61-374"><a href="#cb61-374"></a><span class="ss">-   </span>Subjects or individuals in a study (e.g., individual plants or animals)</span>
<span id="cb61-375"><a href="#cb61-375"></a><span class="ss">-   </span>Clusters or groups (e.g., plots, aquaria, transects)</span>
<span id="cb61-376"><a href="#cb61-376"></a><span class="ss">-   </span>Repeated measures or time points within subjects</span>
<span id="cb61-377"><a href="#cb61-377"></a></span>
<span id="cb61-378"><a href="#cb61-378"></a>Random effects are used to model the correlation or dependence among</span>
<span id="cb61-379"><a href="#cb61-379"></a>observations within the same cluster, subject, or time series. They allow for</span>
<span id="cb61-380"><a href="#cb61-380"></a>subject-specific or cluster-specific adjustments to the overall model,</span>
<span id="cb61-381"><a href="#cb61-381"></a>accounting for the fact that observations within the same group are more</span>
<span id="cb61-382"><a href="#cb61-382"></a>similar than observations from different groups.</span>
<span id="cb61-383"><a href="#cb61-383"></a></span>
<span id="cb61-384"><a href="#cb61-384"></a>In LMMs and GLMMs, both fixed and random effects are included. The fixed</span>
<span id="cb61-385"><a href="#cb61-385"></a>effects represent the primary effects of interest and the random</span>
<span id="cb61-386"><a href="#cb61-386"></a>effects account for the correlation or dependence within clusters or</span>
<span id="cb61-387"><a href="#cb61-387"></a>subjects.</span>
<span id="cb61-388"><a href="#cb61-388"></a>:::</span>
<span id="cb61-389"><a href="#cb61-389"></a></span>
<span id="cb61-390"><a href="#cb61-390"></a><span class="fu">### Nonlinear Regression</span></span>
<span id="cb61-391"><a href="#cb61-391"></a></span>
<span id="cb61-392"><a href="#cb61-392"></a>In R, nonlinear regressions can be performed using the <span class="in">`nls()`</span> function</span>
<span id="cb61-393"><a href="#cb61-393"></a>in the **base** package. It uses iterative algorithms to minimise the</span>
<span id="cb61-394"><a href="#cb61-394"></a>residual sum of squares and find the best-fit parameters for the</span>
<span id="cb61-395"><a href="#cb61-395"></a>user-specified nonlinear model.</span>
<span id="cb61-396"><a href="#cb61-396"></a></span>
<span id="cb61-397"><a href="#cb61-397"></a>The <span class="in">`nls()`</span> function is most frequently used to fit user-specified</span>
<span id="cb61-398"><a href="#cb61-398"></a>nonlinear functions. The basic syntax is:</span>
<span id="cb61-399"><a href="#cb61-399"></a></span>
<span id="cb61-402"><a href="#cb61-402"></a><span class="in">```{r}</span></span>
<span id="cb61-403"><a href="#cb61-403"></a><span class="co">#| eval: FALSE</span></span>
<span id="cb61-404"><a href="#cb61-404"></a><span class="co">#| echo: TRUE</span></span>
<span id="cb61-405"><a href="#cb61-405"></a></span>
<span id="cb61-406"><a href="#cb61-406"></a>nls_model <span class="ot">&lt;-</span> <span class="fu">nls</span>(y <span class="sc">~</span> <span class="fu">f</span>(x, theta1, theta2, ...), <span class="at">data =</span> data,</span>
<span id="cb61-407"><a href="#cb61-407"></a>                 <span class="at">start =</span> <span class="fu">list</span>(<span class="at">theta1 =</span> value1, <span class="at">theta2 =</span> value2, ...))</span>
<span id="cb61-408"><a href="#cb61-408"></a><span class="in">```</span></span>
<span id="cb61-409"><a href="#cb61-409"></a></span>
<span id="cb61-410"><a href="#cb61-410"></a>GNLMs extend nonlinear models by</span>
<span id="cb61-411"><a href="#cb61-411"></a>allowing the response variable to follow one of the exponential family</span>
<span id="cb61-412"><a href="#cb61-412"></a>distributions, such as binomial, Poisson, or gamma, etc. This is done</span>
<span id="cb61-413"><a href="#cb61-413"></a>through a link function that relates the mean of the distribution to the</span>
<span id="cb61-414"><a href="#cb61-414"></a>predictors through the nonlinear model. GNLMs are fit using maximum</span>
<span id="cb61-415"><a href="#cb61-415"></a>likelihood estimation, which is flexible enough to handle various types</span>
<span id="cb61-416"><a href="#cb61-416"></a>of error distribution and link functions. The **gnm** package rovides</span>
<span id="cb61-417"><a href="#cb61-417"></a>the <span class="in">`gnm()`</span> function designed for this purpose.</span>
<span id="cb61-418"><a href="#cb61-418"></a></span>
<span id="cb61-419"><a href="#cb61-419"></a>For data with dependencies within groups or hierarchies (such as in</span>
<span id="cb61-420"><a href="#cb61-420"></a>longitudinal studies), NLMMs are available</span>
<span id="cb61-421"><a href="#cb61-421"></a>within <span class="in">`nlme()`</span>. NLMMs incorporate fixed effects (associated with the</span>
<span id="cb61-422"><a href="#cb61-422"></a>nonlinear terms) and random effects (to account for correlation and</span>
<span id="cb61-423"><a href="#cb61-423"></a>variation within groups).</span>
<span id="cb61-424"><a href="#cb61-424"></a></span>
<span id="cb61-425"><a href="#cb61-425"></a><span class="fu">## Example: Algal Nutrient Uptake Kinetcis {#sec-ex1}</span></span>
<span id="cb61-426"><a href="#cb61-426"></a></span>
<span id="cb61-427"><a href="#cb61-427"></a>We can measure algal nutrient uptake rates using two types of experiments: multiple flask experiments and perturbation experiments. The fundamental concept underlying both methods is to introduce a known quantity of nutrients (termed the substrate) into a flask or a series of flasks and then measure the rate of nutrient uptake ($V$) at different substrate concentrations ($<span class="co">[</span><span class="ot">S</span><span class="co">]</span>$). We calculate the nutrient uptake rate as the change in nutrient concentration in the flask over a predefined time interval ($V = \Delta <span class="co">[</span><span class="ot">S</span><span class="co">]</span>/\Delta t$). Consequently, both experiments generate data that relate the nutrient uptake rate to the corresponding substrate concentration. The primary difference between the two methods lies in the experimental setup and the data analysis.</span>
<span id="cb61-428"><a href="#cb61-428"></a></span>
<span id="cb61-429"><a href="#cb61-429"></a>In the **multiple flask method**, we prepare a series of flasks, each containing a different initial concentration of the substrate nutrient to span the range typically encountered by the specimen in its natural environment. We then measure the nutrient uptake rate in *each individual flask* over a specific time period, for example by taking measurements at the start ($t=0$) and end ($t=30$ minutes) of the incubation. We calculate the change in substrate concentration over this time interval in each flask to determine the corresponding nutrient uptake rate. The resulting data from this method therefore consists of the different initial substrate concentrations used in each flask, paired with their respective measured nutrient uptake rates over the incubation period.</span>
<span id="cb61-430"><a href="#cb61-430"></a></span>
<span id="cb61-431"><a href="#cb61-431"></a><span class="co">&lt;!-- ChatGPT query to simulate data for the experiment --&gt;</span></span>
<span id="cb61-432"><a href="#cb61-432"></a></span>
<span id="cb61-433"><a href="#cb61-433"></a><span class="co">&lt;!-- Please refer to the above text about the multiple flask experiment. Develop R code that will simulate data for seven replicate flasks participating in a multiple flask experiment. These are the conditions per each set of multiple flasks: --&gt;</span></span>
<span id="cb61-434"><a href="#cb61-434"></a></span>
<span id="cb61-435"><a href="#cb61-435"></a><span class="co">&lt;!--   - the concentrations of nutrient at $t=0$ are 50, 40, 30, 25, 20, 15, 12.5, 10, 7.5, 5, 2.5, and 0 $\mu M$ nitrate --&gt;</span></span>
<span id="cb61-436"><a href="#cb61-436"></a><span class="co">&lt;!--   - the disappearance of nitrate is measured at $t=0$ and $t=30$ minutes --&gt;</span></span>
<span id="cb61-437"><a href="#cb61-437"></a><span class="co">&lt;!--   - there is ~1.5 g of seaweed per 150 ml incubation medium per flask --&gt;</span></span>
<span id="cb61-438"><a href="#cb61-438"></a><span class="co">&lt;!--   - there are 7 replicate flasks per each concentration of nutrients --&gt;</span></span>
<span id="cb61-439"><a href="#cb61-439"></a></span>
<span id="cb61-440"><a href="#cb61-440"></a><span class="co">&lt;!-- Produce R code to simulate random data from the Michaelis-Menten relationship with a $V_{max} = 35.0 \pm 1.8 \, \mu \text{M} \, N \, g^{-1} \, hr^{-1}$ and a $K_m = 5.6 \pm 1.3 \mu \text{M} N$. The data should be normally distributed. Present this data in a table of $[S]$, which is the nutrient concentration at $t=0$ and the corresponding $V$. --&gt;</span></span>
<span id="cb61-441"><a href="#cb61-441"></a></span>
<span id="cb61-444"><a href="#cb61-444"></a><span class="in">```{r}</span></span>
<span id="cb61-445"><a href="#cb61-445"></a><span class="co">#| echo: false</span></span>
<span id="cb61-446"><a href="#cb61-446"></a><span class="co">#| messages: false</span></span>
<span id="cb61-447"><a href="#cb61-447"></a><span class="co">#| warning: false</span></span>
<span id="cb61-448"><a href="#cb61-448"></a></span>
<span id="cb61-449"><a href="#cb61-449"></a><span class="co"># Define the model function</span></span>
<span id="cb61-450"><a href="#cb61-450"></a>mm_fun <span class="ot">&lt;-</span> <span class="cf">function</span>(S, Vmax, Km) {</span>
<span id="cb61-451"><a href="#cb61-451"></a>  Vmax <span class="sc">*</span> S <span class="sc">/</span> (Km <span class="sc">+</span> S)</span>
<span id="cb61-452"><a href="#cb61-452"></a>}</span>
<span id="cb61-453"><a href="#cb61-453"></a></span>
<span id="cb61-454"><a href="#cb61-454"></a>generate_data <span class="ot">&lt;-</span> <span class="cf">function</span>(n_trt, n_rep, conc_vec, Km_vec,</span>
<span id="cb61-455"><a href="#cb61-455"></a>                          Vmax_vec, Km_vec_sd, Vmax_vec_sd) {</span>
<span id="cb61-456"><a href="#cb61-456"></a>  <span class="co"># Define the substrate concentrations</span></span>
<span id="cb61-457"><a href="#cb61-457"></a>  concentrations <span class="ot">&lt;-</span> conc_vec</span>
<span id="cb61-458"><a href="#cb61-458"></a>  </span>
<span id="cb61-459"><a href="#cb61-459"></a>  <span class="co"># Create a dataframe with the specified structure</span></span>
<span id="cb61-460"><a href="#cb61-460"></a>  data <span class="ot">&lt;-</span> <span class="fu">expand.grid</span>(</span>
<span id="cb61-461"><a href="#cb61-461"></a>    <span class="at">trt =</span> <span class="fu">paste</span>(<span class="st">"Treatment"</span>, <span class="dv">1</span><span class="sc">:</span>n_trt),</span>
<span id="cb61-462"><a href="#cb61-462"></a>    <span class="at">S =</span> concentrations,</span>
<span id="cb61-463"><a href="#cb61-463"></a>    <span class="at">rep =</span> <span class="dv">1</span><span class="sc">:</span>n_rep</span>
<span id="cb61-464"><a href="#cb61-464"></a>  ) <span class="sc">|&gt;</span> </span>
<span id="cb61-465"><a href="#cb61-465"></a>    <span class="fu">arrange</span>(trt, S, rep)</span>
<span id="cb61-466"><a href="#cb61-466"></a>  </span>
<span id="cb61-467"><a href="#cb61-467"></a>  <span class="co"># Add Km and Vmax values</span></span>
<span id="cb61-468"><a href="#cb61-468"></a>  <span class="fu">set.seed</span>(<span class="dv">13</span>)</span>
<span id="cb61-469"><a href="#cb61-469"></a>  data <span class="ot">&lt;-</span> data <span class="sc">|&gt;</span> </span>
<span id="cb61-470"><a href="#cb61-470"></a>    <span class="fu">group_by</span>(trt)  <span class="sc">|&gt;</span> </span>
<span id="cb61-471"><a href="#cb61-471"></a>    <span class="fu">mutate</span>(</span>
<span id="cb61-472"><a href="#cb61-472"></a>      <span class="at">Km =</span> <span class="fu">rnorm</span>(<span class="fu">n</span>(), <span class="at">mean =</span> Km_vec[<span class="fu">as.numeric</span>(<span class="fu">str_extract</span>(trt, <span class="st">"</span><span class="sc">\\</span><span class="st">d+"</span>))], </span>
<span id="cb61-473"><a href="#cb61-473"></a>                 <span class="at">sd =</span> Km_vec_sd[<span class="fu">as.numeric</span>(<span class="fu">str_extract</span>(trt, <span class="st">"</span><span class="sc">\\</span><span class="st">d+"</span>))]),</span>
<span id="cb61-474"><a href="#cb61-474"></a>      <span class="at">Vmax =</span> <span class="fu">rnorm</span>(<span class="fu">n</span>(), <span class="at">mean =</span> Vmax_vec[<span class="fu">as.numeric</span>(<span class="fu">str_extract</span>(trt, <span class="st">"</span><span class="sc">\\</span><span class="st">d+"</span>))], </span>
<span id="cb61-475"><a href="#cb61-475"></a>                   <span class="at">sd =</span> Vmax_vec_sd[<span class="fu">as.numeric</span>(<span class="fu">str_extract</span>(trt, <span class="st">"</span><span class="sc">\\</span><span class="st">d+"</span>))])</span>
<span id="cb61-476"><a href="#cb61-476"></a>    ) <span class="sc">|&gt;</span> </span>
<span id="cb61-477"><a href="#cb61-477"></a>    <span class="fu">ungroup</span>() <span class="sc">|&gt;</span> </span>
<span id="cb61-478"><a href="#cb61-478"></a>    <span class="fu">mutate</span>(<span class="at">V =</span> <span class="fu">mm_fun</span>(S, Vmax, Km),</span>
<span id="cb61-479"><a href="#cb61-479"></a>           <span class="at">rep =</span> <span class="fu">as.factor</span>(rep),</span>
<span id="cb61-480"><a href="#cb61-480"></a>           <span class="at">trt =</span> <span class="fu">as.factor</span>(trt)) <span class="sc">|&gt;</span> </span>
<span id="cb61-481"><a href="#cb61-481"></a>    <span class="fu">select</span>(<span class="sc">-</span>Km, <span class="sc">-</span>Vmax)</span>
<span id="cb61-482"><a href="#cb61-482"></a>  </span>
<span id="cb61-483"><a href="#cb61-483"></a>  <span class="fu">return</span>(data)</span>
<span id="cb61-484"><a href="#cb61-484"></a>}</span>
<span id="cb61-485"><a href="#cb61-485"></a></span>
<span id="cb61-486"><a href="#cb61-486"></a><span class="co"># Example usage</span></span>
<span id="cb61-487"><a href="#cb61-487"></a>conc_vec <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="fl">0.1</span>, <span class="fl">0.5</span>, <span class="dv">2</span>, <span class="dv">5</span>, <span class="fl">7.5</span>, <span class="dv">10</span>, <span class="fl">12.5</span>, <span class="dv">15</span>, <span class="fl">17.5</span>, <span class="dv">20</span>, <span class="dv">25</span>, <span class="dv">30</span>)</span>
<span id="cb61-488"><a href="#cb61-488"></a>n_trt <span class="ot">&lt;-</span> <span class="dv">3</span>  <span class="co"># Number of treatment levels</span></span>
<span id="cb61-489"><a href="#cb61-489"></a>n_rep <span class="ot">&lt;-</span> <span class="dv">5</span>  <span class="co"># Number of replicates per treatment</span></span>
<span id="cb61-490"><a href="#cb61-490"></a>Km_vec <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">10</span>, <span class="dv">8</span>, <span class="dv">7</span>)  <span class="co"># Km means for each treatment</span></span>
<span id="cb61-491"><a href="#cb61-491"></a>Vmax_vec <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">50</span>, <span class="dv">40</span>, <span class="dv">20</span>)  <span class="co"># Vmax means for each treatment</span></span>
<span id="cb61-492"><a href="#cb61-492"></a>Km_vec_sd <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="fl">1.2</span>, <span class="fl">1.3</span>, <span class="fl">1.2</span>)  <span class="co"># Km SD for each treatment</span></span>
<span id="cb61-493"><a href="#cb61-493"></a>Vmax_vec_sd <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="fl">0.7</span>, <span class="fl">1.3</span>, <span class="fl">0.9</span>)  <span class="co"># Vmax SD for each treatment</span></span>
<span id="cb61-494"><a href="#cb61-494"></a></span>
<span id="cb61-495"><a href="#cb61-495"></a><span class="co"># Generate the data for one treatment</span></span>
<span id="cb61-496"><a href="#cb61-496"></a>mf_data <span class="ot">&lt;-</span> <span class="fu">generate_data</span>(<span class="at">n_trt =</span> <span class="dv">1</span>, n_rep, conc_vec, Km_vec,</span>
<span id="cb61-497"><a href="#cb61-497"></a>                         Vmax_vec, Km_vec_sd, Vmax_vec_sd)</span>
<span id="cb61-498"><a href="#cb61-498"></a><span class="in">```</span></span>
<span id="cb61-499"><a href="#cb61-499"></a></span>
<span id="cb61-500"><a href="#cb61-500"></a>The **perturbation method** uses a single flask to which we add a high initial concentration of the substrate nutrient, set at a level that is ecologically meaningful and relevant to the study system. Instead of using multiple flasks, we measure the change in the remaining substrate concentration at multiple time points within this *same flask*, for example by taking samples every 10 or 20 minutes until all the substrate is depleted, say at 120 minutes. We calculate the change in substrate concentration between each successive time point to determine the corresponding nutrient uptake rate over that time interval. The resulting data, therefore, consist of a time series of substrate concentrations at each measurement time point, paired with the nutrient uptake rates calculated over the periods between those time points.</span>
<span id="cb61-501"><a href="#cb61-501"></a></span>
<span id="cb61-502"><a href="#cb61-502"></a>The important differences between the multiple flask and perturbation experiments are summarised in @tbl-diffs.</span>
<span id="cb61-503"><a href="#cb61-503"></a></span>
<span id="cb61-504"><a href="#cb61-504"></a>| Feature            | Multiple Flask Experiments                 | Perturbation Experiments                       |</span>
<span id="cb61-505"><a href="#cb61-505"></a>|--------------------|--------------------------------------------|------------------------------------------------|</span>
<span id="cb61-506"><a href="#cb61-506"></a>| Experimental Setup | Multiple flasks, each with different $<span class="co">[</span><span class="ot">S</span><span class="co">]</span>$ | Single flask with initial high $<span class="co">[</span><span class="ot">S</span><span class="co">]</span>$           |</span>
<span id="cb61-507"><a href="#cb61-507"></a>| Data Independence  | Data points are independent                | Data points are correlated (repeated measures) |</span>
<span id="cb61-508"><a href="#cb61-508"></a>| Analysis           | Nonlinear least squares regression (NLS)  | Nonlinear mixed model (NLMM)                  |</span>
<span id="cb61-509"><a href="#cb61-509"></a>| R Function         | <span class="in">`nls()`</span>                                    | <span class="in">`nlme::nlme()`</span>                                 |</span>
<span id="cb61-510"><a href="#cb61-510"></a></span>
<span id="cb61-511"><a href="#cb61-511"></a>: Key differences between multiple flask and perturbation experiments. {#tbl-diffs}</span>
<span id="cb61-512"><a href="#cb61-512"></a></span>
<span id="cb61-513"><a href="#cb61-513"></a>Our choice between multiple flask and perturbation experiments depends on our research questions and experimental constraints. In both methods, we must consider all sources of error and variability, such as measurement error, the type of nutrient, the physiological state of the alga, the light intensity, the experimental temperature, and other variables that might affect the uptake response.</span>
<span id="cb61-514"><a href="#cb61-514"></a></span>
<span id="cb61-515"><a href="#cb61-515"></a>We apply the Michaelis-Menten model (@eq-mm) to data from multiple flask and perturbation experiments to characterise nutrient uptake. Applied to algae, this model assumes an irreversible uptake process that saturates at high substrate concentrations. It effectively quantifies key characteristics of the nutrient uptake system, including the maximum uptake rate and the algae's affinity for the nutrient.</span>
<span id="cb61-516"><a href="#cb61-516"></a></span>
<span id="cb61-517"><a href="#cb61-517"></a>We use the <span class="in">`nls()`</span> function to fit the Michaelis-Menten model to the data from multiple flask experiments. For the perturbation experiment, things are a bit more complicated. This method includes dependent data points because the measurements are taken from the same flask at different times, introducing a correlation between observations. This violates the independence assumption required for standard regression models. To accurately analyse these data, I recommend a *nonlinear mixed-effects model* implemented in the <span class="in">`nlme()`</span> function. Mixed-effects models account for fixed effects (overall trends across all observations) and random effects (variations specific to individual experimental units, in this case, time points within the same flask). This helps handle the correlation between repeated measures and produces reliable estimates of the uptake dynamics within the flask. </span>
<span id="cb61-518"><a href="#cb61-518"></a></span>
<span id="cb61-519"><a href="#cb61-519"></a>The Michaelis-Menten equation is given by:</span>
<span id="cb61-520"><a href="#cb61-520"></a></span>
<span id="cb61-521"><a href="#cb61-521"></a>$$V_i = \frac{V_{max} \cdot <span class="co">[</span><span class="ot">S_i</span><span class="co">]</span>}{K_m + <span class="co">[</span><span class="ot">S_i</span><span class="co">]</span>} + \epsilon_i$$ {#eq-mm}</span>
<span id="cb61-522"><a href="#cb61-522"></a></span>
<span id="cb61-523"><a href="#cb61-523"></a>Where:</span>
<span id="cb61-524"><a href="#cb61-524"></a></span>
<span id="cb61-525"><a href="#cb61-525"></a><span class="ss">-   </span>$V_i$ is the uptake rate at the $i$-th observation,</span>
<span id="cb61-526"><a href="#cb61-526"></a><span class="ss">-   </span>$V_{max}$ is the maximum nutrient uptake rate achieved,</span>
<span id="cb61-527"><a href="#cb61-527"></a><span class="ss">-   </span>$<span class="co">[</span><span class="ot">S_i</span><span class="co">]</span>$ is the substrate concentration at the $i$-th observation,</span>
<span id="cb61-528"><a href="#cb61-528"></a><span class="ss">-   </span>$K_m$ is the Michaelis constant, which represents the substrate concentration at which the uptake rate is half of $V_{max}$, and</span>
<span id="cb61-529"><a href="#cb61-529"></a><span class="ss">-   </span>$\epsilon_i$ is the error term at the $i$-th observation. and</span>
<span id="cb61-530"><a href="#cb61-530"></a></span>
<span id="cb61-531"><a href="#cb61-531"></a>The two parameters of the Michaelis-Menten model are rooted in theory and have ecophysiological interpretations. $K_m$ is a measure of the alga's affinity for the nutrient and is determined by the kinetic constants governing the formation and dissociation of the enzyme-substrate complex responsible for taking up the nutrient; lower values indicate a higher affinity. $V_{max}$ represents the maximum capacity of the alga to utilise the nutrient.</span>
<span id="cb61-532"><a href="#cb61-532"></a></span>
<span id="cb61-533"><a href="#cb61-533"></a><span class="fu">### Hypothesis Testing and the Michaelis-Menten Model</span></span>
<span id="cb61-534"><a href="#cb61-534"></a></span>
<span id="cb61-535"><a href="#cb61-535"></a><span class="fu">#### Linear vs. Michaelis-Menten Model {#sec-linear-vs-mm}</span></span>
<span id="cb61-536"><a href="#cb61-536"></a></span>
<span id="cb61-537"><a href="#cb61-537"></a>Often, we aim to understand the relationship between two variables but we may not yet know which model best describes this relationship. For instance, in algal nutrient uptake kinetics, both a linear model and a nonlinear Michaelis-Menten model can be used to describe the relationship between nutrient uptake rate and substrate concentration. Both models are valid but they have different interpretations and unique ecophysiological implications. The choice between the two models depends on the biological system.</span>
<span id="cb61-538"><a href="#cb61-538"></a></span>
<span id="cb61-539"><a href="#cb61-539"></a><span class="ss">- </span>**Linear models** indicate that the uptake process is inherently unsaturated, such as with the uptake of ammonium. In this case, the uptake rate continues to increase linearly with substrate concentration.</span>
<span id="cb61-540"><a href="#cb61-540"></a><span class="ss">- </span>The **Michaelis-Menten model** suggests that the uptake rate eventually saturates as the substrate concentration increases, which is often the case with nitrate.</span>
<span id="cb61-541"><a href="#cb61-541"></a></span>
<span id="cb61-542"><a href="#cb61-542"></a>The key question is: How do we decide which model fits our data best?</span>
<span id="cb61-543"><a href="#cb61-543"></a></span>
<span id="cb61-544"><a href="#cb61-544"></a>The simplest way is to visually inspect the scatter of points on a plot of the $V$ vs. $<span class="co">[</span><span class="ot">S</span><span class="co">]</span>$ data, which would be part of any exploratory data analysis. If the data exhibit a clear saturation pattern, where the uptake rate levels off at high substrate concentrations, the Michaelis-Menten model is likely to provide a better fit. Conversely, if the data show a linear relationship over the observed range of substrate concentrations, the linear model may be more appropriate.</span>
<span id="cb61-545"><a href="#cb61-545"></a></span>
<span id="cb61-546"><a href="#cb61-546"></a>It is also important to consider the biological plausibility of the models. If there is prior knowledge or theoretical reasons to expect a saturating relationship between the uptake rate and substrate concentration, the Michaelis-Menten model may be more appropriate, even if both models provide a similar fit to the data.</span>
<span id="cb61-547"><a href="#cb61-547"></a></span>
<span id="cb61-548"><a href="#cb61-548"></a>Confirmation can be obtained by fitting both models to our data and comparing their performance using statistical measures such as the sum of squared residuals (SSR), Akaike Information Criterion (AIC), Bayesian Information Criterion (BIC), or log-likelihood test.</span>
<span id="cb61-549"><a href="#cb61-549"></a></span>
<span id="cb61-550"><a href="#cb61-550"></a>To proceed with the statistical approach, we must first set hypotheses such as these to compare the models:</span>
<span id="cb61-551"><a href="#cb61-551"></a></span>
<span id="cb61-552"><a href="#cb61-552"></a>**$H_0$:** The Michaelis-Menten model does not provide a better fit to the data than a simple linear model.</span>
<span id="cb61-553"><a href="#cb61-553"></a></span>
<span id="cb61-554"><a href="#cb61-554"></a>In other words, we suggest with the null hypothesis that the relationship between nutrient uptake rate and the substrate concentration is adequately described by a linear model rather than the Michaelis-Menten nonlinear model. The implication is that the uptake rate increases linearly with substrate concentration, without saturation.</span>
<span id="cb61-555"><a href="#cb61-555"></a></span>
<span id="cb61-556"><a href="#cb61-556"></a>**$H_a$:** The Michaelis-Menten model provides a significantly better fit to the data than a simple linear model.</span>
<span id="cb61-557"><a href="#cb61-557"></a></span>
<span id="cb61-558"><a href="#cb61-558"></a>With the alternative hypothesis we propose that the relationship between the nutrient uptake rate and the substrate concentration is best described by the nonlinear Michaelis-Menten model, so the uptake rate initially increases with substrate concentration but eventually levels off, indicating saturation.</span>
<span id="cb61-559"><a href="#cb61-559"></a></span>
<span id="cb61-560"><a href="#cb61-560"></a>To test these hypotheses, we can:</span>
<span id="cb61-561"><a href="#cb61-561"></a></span>
<span id="cb61-562"><a href="#cb61-562"></a><span class="ss">1. </span>Fit both the Michaelis-Menten model and a linear model to the data.</span>
<span id="cb61-563"><a href="#cb61-563"></a><span class="ss">2. </span>Compare the goodness-of-fit of both models using statistical measures such as the SSR, AIC, or BIC.</span>
<span id="cb61-564"><a href="#cb61-564"></a><span class="ss">3. </span>Perform a model comparison test (such as an *F*-test or likelihood ratio test) to determine if the improvement in fit provided by the Michaelis-Menten model is statistically significant compared to the linear model.</span>
<span id="cb61-565"><a href="#cb61-565"></a></span>
<span id="cb61-566"><a href="#cb61-566"></a>In the above scenario, which is to decide among the linear and Michaelis-Menten models, hypotheses concerning the parameters of the models are not directly tested as they are not really of interest (except for estimating their magnitude, perhaps). Instead, the focus is on the overall goodness-of-fit of the models to the data.</span>
<span id="cb61-567"><a href="#cb61-567"></a></span>
<span id="cb61-568"><a href="#cb61-568"></a><span class="fu">#### Comparing Two Michaelis-Menten Models {#sec-mm-comparison}</span></span>
<span id="cb61-569"><a href="#cb61-569"></a></span>
<span id="cb61-570"><a href="#cb61-570"></a>Here, we may be interested in testing whether the parameters $V_\text{max}$ and $K_m$ differ from some hypothesised values or across different experimental conditions.</span>
<span id="cb61-571"><a href="#cb61-571"></a></span>
<span id="cb61-572"><a href="#cb61-572"></a>In the first instance, we can set up the hypotheses as follows:</span>
<span id="cb61-573"><a href="#cb61-573"></a></span>
<span id="cb61-574"><a href="#cb61-574"></a>**$H_0:$** $V_\text{max} = V_\text{max}^*$ and $K_m = K_m^*$</span>
<span id="cb61-575"><a href="#cb61-575"></a></span>
<span id="cb61-576"><a href="#cb61-576"></a>where $V_\text{max}^*$ and $K_m^*$ are the hypothesised values (or values from a reference condition) for the maximum uptake rate and Michaelis constant, respectively.</span>
<span id="cb61-577"><a href="#cb61-577"></a></span>
<span id="cb61-578"><a href="#cb61-578"></a>**$H_a:$** $V_\text{max} \neq V_\text{max}^*$ or $K_m \neq K_m^*$</span>
<span id="cb61-579"><a href="#cb61-579"></a></span>
<span id="cb61-580"><a href="#cb61-580"></a>This alternative hypothesis states that at least one of the parameters ($V_\text{max}$ or $K_m$) differs from the hypothesised value.</span>
<span id="cb61-581"><a href="#cb61-581"></a></span>
<span id="cb61-582"><a href="#cb61-582"></a>If the experiment involves different experimental conditions or treatments, we can modify the hypotheses accordingly. For example, if we want to test whether the parameters differ between two experimental conditions (A and B), the hypotheses could be:</span>
<span id="cb61-583"><a href="#cb61-583"></a></span>
<span id="cb61-584"><a href="#cb61-584"></a>$H_0: V_\text{max}^A = V_\text{max}^B$ and $K_m^A = K_m^B$</span>
<span id="cb61-585"><a href="#cb61-585"></a></span>
<span id="cb61-586"><a href="#cb61-586"></a>$H_a: V_\text{max}^A \neq V_\text{max}^B$ or $K_m^A \neq K_m^B$</span>
<span id="cb61-587"><a href="#cb61-587"></a></span>
<span id="cb61-588"><a href="#cb61-588"></a>In this case, the null hypothesis states that the maximum uptake rate and Michaelis constant are the same for both experimental conditions, while the alternative hypothesis states that at least one of the parameters differs between the two conditions.</span>
<span id="cb61-589"><a href="#cb61-589"></a></span>
<span id="cb61-590"><a href="#cb61-590"></a>After fitting the Michaelis-Menten model to the data using the <span class="in">`nls()`</span> or <span class="in">`nlme()`</span> functions in R, appropriate statistical tests (e.g., likelihood ratio tests, Wald tests, or other model comparison techniques) can be performed to evaluate the hypotheses and determine whether the parameter estimates significantly differ from the hypothesised values or across experimental conditions.</span>
<span id="cb61-591"><a href="#cb61-591"></a></span>
<span id="cb61-592"><a href="#cb61-592"></a><span class="fu">### Multiple Flask Experiment</span></span>
<span id="cb61-593"><a href="#cb61-593"></a></span>
<span id="cb61-594"><a href="#cb61-594"></a><span class="fu">#### Fitting a single model (NLS) {#sec-mf-single}</span></span>
<span id="cb61-595"><a href="#cb61-595"></a></span>
<span id="cb61-596"><a href="#cb61-596"></a>To demonstrate fitting a nonlinear model to $V$ vs $<span class="co">[</span><span class="ot">S</span><span class="co">]</span>$ data produced from a multiple flask experiment, I simulate data across a range of substrate concentrations. We then fit the model to the data using the <span class="in">`nls()`</span> function in R. The dataset consists of five replicate flask sets ($n=5$) for each of 13 substrate concentrations. Each set therefore results in independently estimated uptake rates for the initial nutrient concentrations. The dataset is shown in @tbl-mf1, and a plot of $V$ as a function of $<span class="co">[</span><span class="ot">S</span><span class="co">]</span>$ is shown in @fig-mf1. </span>
<span id="cb61-597"><a href="#cb61-597"></a></span>
<span id="cb61-600"><a href="#cb61-600"></a><span class="in">```{r}</span></span>
<span id="cb61-601"><a href="#cb61-601"></a><span class="co">#| echo: false</span></span>
<span id="cb61-602"><a href="#cb61-602"></a><span class="co">#| messages: false</span></span>
<span id="cb61-603"><a href="#cb61-603"></a><span class="co">#| warning: false</span></span>
<span id="cb61-604"><a href="#cb61-604"></a><span class="co">#| tbl-cap: "Simulated data for a multiple flask experiment on an alga (showing only the top and bottom three rows)."</span></span>
<span id="cb61-605"><a href="#cb61-605"></a><span class="co">#| label: tbl-mf1</span></span>
<span id="cb61-606"><a href="#cb61-606"></a></span>
<span id="cb61-607"><a href="#cb61-607"></a>mf_data <span class="sc">|&gt;</span> </span>
<span id="cb61-608"><a href="#cb61-608"></a>  <span class="fu">select</span>(rep, S, V) <span class="sc">|&gt;</span></span>
<span id="cb61-609"><a href="#cb61-609"></a>  <span class="fu">mutate</span>(<span class="at">V =</span> <span class="fu">round</span>(V, <span class="dv">2</span>)) <span class="sc">|&gt;</span></span>
<span id="cb61-610"><a href="#cb61-610"></a>  <span class="fu">filter</span>(<span class="fu">row_number</span>() <span class="sc">&lt;=</span> <span class="dv">3</span> <span class="sc">|</span> <span class="fu">row_number</span>() <span class="sc">&gt;</span> <span class="fu">n</span>() <span class="sc">-</span> <span class="dv">3</span>) <span class="sc">|&gt;</span> </span>
<span id="cb61-611"><a href="#cb61-611"></a>  <span class="fu">gt</span>() <span class="sc">|&gt;</span> </span>
<span id="cb61-612"><a href="#cb61-612"></a>  <span class="fu">cols_align</span>(</span>
<span id="cb61-613"><a href="#cb61-613"></a>    <span class="at">align =</span> <span class="st">"center"</span>,</span>
<span id="cb61-614"><a href="#cb61-614"></a>    <span class="at">columns =</span> <span class="st">"rep"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb61-615"><a href="#cb61-615"></a>  <span class="fu">cols_label</span>(<span class="at">rep =</span> <span class="fu">html</span>(<span class="st">"Replicate flask"</span>),</span>
<span id="cb61-616"><a href="#cb61-616"></a>             <span class="at">S =</span> <span class="fu">html</span>(<span class="st">"[S]"</span>),</span>
<span id="cb61-617"><a href="#cb61-617"></a>             <span class="at">V =</span> <span class="fu">html</span>(<span class="st">"V"</span>))</span>
<span id="cb61-618"><a href="#cb61-618"></a><span class="in">```</span></span>
<span id="cb61-619"><a href="#cb61-619"></a></span>
<span id="cb61-620"><a href="#cb61-620"></a><span class="co">&lt;!-- ```{r} --&gt;</span></span>
<span id="cb61-621"><a href="#cb61-621"></a><span class="co">&lt;!-- #| echo: true --&gt;</span></span>
<span id="cb61-622"><a href="#cb61-622"></a></span>
<span id="cb61-623"><a href="#cb61-623"></a><span class="co">&lt;!-- # html only --&gt;</span></span>
<span id="cb61-624"><a href="#cb61-624"></a><span class="co">&lt;!-- DT::datatable(mf_data, rownames = FALSE, options = list(pageLength = 5)) --&gt;</span></span>
<span id="cb61-625"><a href="#cb61-625"></a><span class="co">&lt;!-- ``` --&gt;</span></span>
<span id="cb61-626"><a href="#cb61-626"></a></span>
<span id="cb61-627"><a href="#cb61-627"></a><span class="in">```{r, fig.width=c(6,5),fig.asp=0.65,out.width=c("80%","12cm")}</span></span>
<span id="cb61-628"><a href="#cb61-628"></a><span class="in">#| echo: false</span></span>
<span id="cb61-629"><a href="#cb61-629"></a><span class="in">#| messages: false</span></span>
<span id="cb61-630"><a href="#cb61-630"></a><span class="in">#| warning: false</span></span>
<span id="cb61-631"><a href="#cb61-631"></a><span class="in">#| fig.cap: "Plot of $V$ as a function of $[S]$ for a multiple flask experiment involving seven replicate flask sets."</span></span>
<span id="cb61-632"><a href="#cb61-632"></a><span class="in">#| label: fig-mf1</span></span>
<span id="cb61-633"><a href="#cb61-633"></a><span class="in">#| fig.align: center</span></span>
<span id="cb61-634"><a href="#cb61-634"></a><span class="in">#| fig-pos: "t"</span></span>
<span id="cb61-635"><a href="#cb61-635"></a></span>
<span id="cb61-636"><a href="#cb61-636"></a><span class="in">ggplot(mf_data, aes(x = S, y = V, group = rep)) +</span></span>
<span id="cb61-637"><a href="#cb61-637"></a><span class="in">  geom_jitter(size = 2, shape = 1, colour = "royalblue2", width = 0.08) +</span></span>
<span id="cb61-638"><a href="#cb61-638"></a><span class="in">  labs(x = TeX("S [$\\mu$M]"),</span></span>
<span id="cb61-639"><a href="#cb61-639"></a><span class="in">       y = TeX("V [$\\mu$M $g^{-1}_{dry}$ $h^{-1}$]")) +</span></span>
<span id="cb61-640"><a href="#cb61-640"></a><span class="in">  theme(legend.position = "none")</span></span>
<span id="cb61-641"><a href="#cb61-641"></a><span class="in">```</span></span>
<span id="cb61-642"><a href="#cb61-642"></a></span>
<span id="cb61-643"><a href="#cb61-643"></a>In @fig-mf1, there is a clear indication that the uptake rates plateau at higher substrate concentrations, suggesting that fitting a Michaelis-Menten model is advisable. Later, I will compare this with a linear model for completeness. A central feature of this dataset is that the data were collected independently, with each flask set representing a separate experimental unit. There is no correlation between flasks within a set, and no correlation across the initial substrate concentrations. Consequently, the assumption of independence is fully met, allowing the simplest expression of the <span class="in">`nls()`</span> function to be used to fit the Michaelis-Menten model to the data.</span>
<span id="cb61-644"><a href="#cb61-644"></a></span>
<span id="cb61-645"><a href="#cb61-645"></a>The Michaelis-Menten model is fit to the data using the <span class="in">`nls()`</span> function in R. It is specified as:</span>
<span id="cb61-646"><a href="#cb61-646"></a></span>
<span id="cb61-649"><a href="#cb61-649"></a><span class="in">```{r}</span></span>
<span id="cb61-650"><a href="#cb61-650"></a><span class="co">#| echo: true</span></span>
<span id="cb61-651"><a href="#cb61-651"></a><span class="co">#| messages: false</span></span>
<span id="cb61-652"><a href="#cb61-652"></a><span class="co">#| warning: false</span></span>
<span id="cb61-653"><a href="#cb61-653"></a></span>
<span id="cb61-654"><a href="#cb61-654"></a><span class="co"># Define the model function</span></span>
<span id="cb61-655"><a href="#cb61-655"></a>mm_fun <span class="ot">&lt;-</span> <span class="cf">function</span>(S, Vmax, Km) {</span>
<span id="cb61-656"><a href="#cb61-656"></a>  Vmax <span class="sc">*</span> S <span class="sc">/</span> (Km <span class="sc">+</span> S)</span>
<span id="cb61-657"><a href="#cb61-657"></a>}</span>
<span id="cb61-658"><a href="#cb61-658"></a></span>
<span id="cb61-659"><a href="#cb61-659"></a><span class="co"># Fit the nonlinear model Michaelis-Menten model</span></span>
<span id="cb61-660"><a href="#cb61-660"></a>nls_mod <span class="ot">&lt;-</span> <span class="fu">nls</span>(V <span class="sc">~</span> <span class="fu">mm_fun</span>(S, Vmax, Km), <span class="co"># &lt;1&gt;</span></span>
<span id="cb61-661"><a href="#cb61-661"></a>            <span class="at">data =</span> mf_data,</span>
<span id="cb61-662"><a href="#cb61-662"></a>            <span class="at">start =</span> <span class="fu">c</span>(<span class="at">Vmax =</span> <span class="dv">30</span>, <span class="at">Km =</span> <span class="dv">5</span>)) <span class="co"># &lt;2&gt;</span></span>
<span id="cb61-663"><a href="#cb61-663"></a><span class="in">```</span></span>
<span id="cb61-664"><a href="#cb61-664"></a><span class="ss">1. </span>The model formula specifies the Michaelis-Menten equation, with <span class="in">`V`</span> as the dependent variable on the left-hand side and <span class="in">`S`</span> as the independent variable on the right. The model parameters <span class="in">`Vmax`</span> and <span class="in">`Km`</span> will be estimated when fitting the model.</span>
<span id="cb61-665"><a href="#cb61-665"></a><span class="ss">2. </span>The <span class="in">`start`</span> argument provides initial values for the model parameters. The <span class="in">`Vmax`</span> and <span class="in">`Km`</span> parameters are estimated by minimising the sum of squared residuals between the observed and predicted values of <span class="in">`V`</span>. The <span class="in">`nls()`</span> function uses an iterative process to find the best-fitting values for these parameters, and the starting values improve the success of model convergence.</span>
<span id="cb61-666"><a href="#cb61-666"></a></span>
<span id="cb61-667"><a href="#cb61-667"></a>Here is the model summary:</span>
<span id="cb61-668"><a href="#cb61-668"></a></span>
<span id="cb61-671"><a href="#cb61-671"></a><span class="in">```{r}</span></span>
<span id="cb61-672"><a href="#cb61-672"></a><span class="fu">summary</span>(nls_mod)</span>
<span id="cb61-673"><a href="#cb61-673"></a><span class="in">```</span></span>
<span id="cb61-674"><a href="#cb61-674"></a></span>
<span id="cb61-675"><a href="#cb61-675"></a>The above output provides the estimates for $V_{\max}$ and $K_m$, along with their standard errors, *t*-values, and *p*-values:</span>
<span id="cb61-676"><a href="#cb61-676"></a></span>
<span id="cb61-677"><a href="#cb61-677"></a><span class="ss">-   </span>The estimated maximum uptake rate ($V_{\max}$) is approximately 49.24 $\mu M N g^{-1} hr^{-1}$ and the small standard error associated with this parameter (0.89) indicates a precise estimate. The *t*-value (55.18) is very high, and the corresponding *p*-value is extremely small (&lt;0.0001), indicating that $V_{\max}$ is highly significantly different from zero.</span>
<span id="cb61-678"><a href="#cb61-678"></a><span class="ss">-   </span>The estimated Michaelis constant ($K_m$) is approximately 9.50 $\mu M$ and its standard error (0.45) is also small, suggesting a precise estimate. The *t*-value (21.22) and the very small *p*-value (&lt;0.0001) indicate that $K_m$ is also highly significantly different from zero.</span>
<span id="cb61-679"><a href="#cb61-679"></a><span class="ss">-   </span>The residual standard error is 1.10 on 63 degrees of freedom, indicating the average deviation of the observed uptake rates from the fitted model values.</span>
<span id="cb61-680"><a href="#cb61-680"></a><span class="ss">-   </span>The model converged in 4 iterations with a very small convergence tolerance, indicating a good fit and stability of the model.</span>
<span id="cb61-681"><a href="#cb61-681"></a></span>
<span id="cb61-682"><a href="#cb61-682"></a>::: {.callout-tip}</span>
<span id="cb61-683"><a href="#cb61-683"></a><span class="fu">## Results</span></span>
<span id="cb61-684"><a href="#cb61-684"></a></span>
<span id="cb61-685"><a href="#cb61-685"></a>The Michaelis-Menten parameters, maximum uptake rate ($V_{\max}$) and half-saturation constant ($K_m$), were estimated using nonlinear regression (@fig-mf2). The estimated $V_{\max}$ was 49.24 $\mu$M N g$^{-1}$ hr$^{-1}$ (SE = 0.89, $t = 55.18$, $p &lt; 0.0001$), and the estimated $K_m$ was 9.50 $\mu$M (SE = 0.45, $t = 21.22$, $p &lt; 0.0001$). Both parameters were significantly different from zero. The model fit was good, converging in 3 iterations with a residual standard error of 1.10 (63 degrees of freedom).</span>
<span id="cb61-686"><a href="#cb61-686"></a>:::</span>
<span id="cb61-687"><a href="#cb61-687"></a></span>
<span id="cb61-688"><a href="#cb61-688"></a><span class="in">```{r, fig.width=c(6,5),fig.asp=0.65,out.width=c("80%","12cm")}</span></span>
<span id="cb61-689"><a href="#cb61-689"></a><span class="in">#| echo: false</span></span>
<span id="cb61-690"><a href="#cb61-690"></a><span class="in">#| messages: false</span></span>
<span id="cb61-691"><a href="#cb61-691"></a><span class="in">#| warning: false</span></span>
<span id="cb61-692"><a href="#cb61-692"></a><span class="in">#| fig.cap: "Plot of the Michaelis-Menten model fitted to the data in @fig-mf1. The vertical and horizontal dashed lines indicate the estimated $K_m$ and $V_{max}$ values, respectively."</span></span>
<span id="cb61-693"><a href="#cb61-693"></a><span class="in">#| label: fig-mf2</span></span>
<span id="cb61-694"><a href="#cb61-694"></a><span class="in">#| fig-align: center</span></span>
<span id="cb61-695"><a href="#cb61-695"></a></span>
<span id="cb61-696"><a href="#cb61-696"></a><span class="in"># Extract coefficients</span></span>
<span id="cb61-697"><a href="#cb61-697"></a><span class="in">coefficients &lt;- coef(nls_mod)</span></span>
<span id="cb61-698"><a href="#cb61-698"></a><span class="in">Vmax_est &lt;- coefficients["Vmax"]</span></span>
<span id="cb61-699"><a href="#cb61-699"></a><span class="in">Km_est &lt;- coefficients["Km"]</span></span>
<span id="cb61-700"><a href="#cb61-700"></a></span>
<span id="cb61-701"><a href="#cb61-701"></a><span class="in"># Creating a sequence for smooth curve</span></span>
<span id="cb61-702"><a href="#cb61-702"></a><span class="in">conc_seq &lt;- seq(min(mf_data$S), max(mf_data$S), length.out = 100)</span></span>
<span id="cb61-703"><a href="#cb61-703"></a><span class="in">predicted_V &lt;- (Vmax_est * conc_seq) / (Km_est + conc_seq)</span></span>
<span id="cb61-704"><a href="#cb61-704"></a></span>
<span id="cb61-705"><a href="#cb61-705"></a><span class="in"># Plot</span></span>
<span id="cb61-706"><a href="#cb61-706"></a><span class="in">ggplot(mf_data, aes(x = S, y = V)) +</span></span>
<span id="cb61-707"><a href="#cb61-707"></a><span class="in">  geom_jitter(aes(colour = "Data Points", width = 0.08),</span></span>
<span id="cb61-708"><a href="#cb61-708"></a><span class="in">    shape = 1, size = 2, colour = "royalblue2") +</span></span>
<span id="cb61-709"><a href="#cb61-709"></a><span class="in">  geom_line(aes(x = conc_seq, y = predicted_V),</span></span>
<span id="cb61-710"><a href="#cb61-710"></a><span class="in">            data = data.frame(S = conc_seq, V = predicted_V),</span></span>
<span id="cb61-711"><a href="#cb61-711"></a><span class="in">            color = "black", size = 0.8) +</span></span>
<span id="cb61-712"><a href="#cb61-712"></a><span class="in">  geom_vline(xintercept = Km_est, linetype = "dashed",</span></span>
<span id="cb61-713"><a href="#cb61-713"></a><span class="in">             color = "hotpink1", size = 0.4, show.legend = TRUE) +</span></span>
<span id="cb61-714"><a href="#cb61-714"></a><span class="in">  geom_hline(yintercept = Vmax_est, linetype = "dashed",</span></span>
<span id="cb61-715"><a href="#cb61-715"></a><span class="in">             color = "hotpink1", size = 0.4, show.legend = TRUE) +</span></span>
<span id="cb61-716"><a href="#cb61-716"></a><span class="in">  labs(x = TeX("S [$\\mu$M]"),</span></span>
<span id="cb61-717"><a href="#cb61-717"></a><span class="in">       y = TeX("V [$\\mu$M $g^{-1}_{dry}$ $h^{-1}$]")) +</span></span>
<span id="cb61-718"><a href="#cb61-718"></a><span class="in">  # theme_minimal() +</span></span>
<span id="cb61-719"><a href="#cb61-719"></a><span class="in">  theme(legend.position = "none")</span></span>
<span id="cb61-720"><a href="#cb61-720"></a><span class="in">```</span></span>
<span id="cb61-721"><a href="#cb61-721"></a></span>
<span id="cb61-722"><a href="#cb61-722"></a>The text is clear and concise, but here are a few minor changes for improved readability and precision:</span>
<span id="cb61-723"><a href="#cb61-723"></a></span>
<span id="cb61-724"><a href="#cb61-724"></a>**Assumption tests** Since these data are simulated and drawn from a normal distribution with equal variances across the range of substrate concentrations, the assumptions of homoscedasticity and normality of residuals are inherently met. In this example, we fit the model solely to obtain estimates of the Michaelis-Menten parameters, rather than to make predictions, inferences, or calculate confidence intervals. Therefore, assumption tests are not critical at this stage. We will formally test assumptions in @sec-mf-treatments when comparing the effects of experimental treatments on kinetic parameters.</span>
<span id="cb61-725"><a href="#cb61-725"></a></span>
<span id="cb61-726"><a href="#cb61-726"></a><span class="fu">#### Is the Michaelis-Menten model a better fit than a linear model?</span></span>
<span id="cb61-727"><a href="#cb61-727"></a></span>
<span id="cb61-728"><a href="#cb61-728"></a>In @sec-linear-vs-mm, we pose a hypothesis that requires comparing a linear model to a Michaelis-Menten model fitted to the same data. @fig-mf2 indicates the nonlinear model indeed provides a very good fit but in some situations this distinction may be less clear and require verification. Let us fit a linear model to the above data and compare it to the Michaelis-Menten model.</span>
<span id="cb61-729"><a href="#cb61-729"></a></span>
<span id="cb61-732"><a href="#cb61-732"></a><span class="in">```{r}</span></span>
<span id="cb61-733"><a href="#cb61-733"></a><span class="co">#| echo: true</span></span>
<span id="cb61-734"><a href="#cb61-734"></a><span class="co">#| messages: false</span></span>
<span id="cb61-735"><a href="#cb61-735"></a><span class="co">#| warning: false</span></span>
<span id="cb61-736"><a href="#cb61-736"></a></span>
<span id="cb61-737"><a href="#cb61-737"></a><span class="co"># Fit the linear model</span></span>
<span id="cb61-738"><a href="#cb61-738"></a>lm_mod <span class="ot">&lt;-</span> <span class="fu">lm</span>(V <span class="sc">~</span> S, <span class="at">data =</span> mf_data)</span>
<span id="cb61-739"><a href="#cb61-739"></a></span>
<span id="cb61-740"><a href="#cb61-740"></a><span class="fu">summary</span>(lm_mod)</span>
<span id="cb61-741"><a href="#cb61-741"></a><span class="in">```</span></span>
<span id="cb61-742"><a href="#cb61-742"></a></span>
<span id="cb61-743"><a href="#cb61-743"></a>The linear model summary shows that the slope and intercept are significantly different from zero, indicating a good fit. The $R^2$ value is 0.86, which is very high, suggesting that the linear model explains 86% of the variance in the data. The residual standard error is 5.13, which is higher than the Michaelis-Menten model, indicating a worse fit. We can test the difference between the models formally by examining the AIC, BIC, or SSR, and the likelihood ratio test.</span>
<span id="cb61-744"><a href="#cb61-744"></a></span>
<span id="cb61-747"><a href="#cb61-747"></a><span class="in">```{r}</span></span>
<span id="cb61-748"><a href="#cb61-748"></a><span class="co">#| echo: true</span></span>
<span id="cb61-749"><a href="#cb61-749"></a><span class="co">#| messages: false</span></span>
<span id="cb61-750"><a href="#cb61-750"></a><span class="co">#| warning: false</span></span>
<span id="cb61-751"><a href="#cb61-751"></a></span>
<span id="cb61-752"><a href="#cb61-752"></a><span class="fu">AIC</span>(lm_mod, nls_mod)</span>
<span id="cb61-753"><a href="#cb61-753"></a><span class="in">```</span></span>
<span id="cb61-754"><a href="#cb61-754"></a></span>
<span id="cb61-757"><a href="#cb61-757"></a><span class="in">```{r}</span></span>
<span id="cb61-758"><a href="#cb61-758"></a><span class="co">#| echo: true</span></span>
<span id="cb61-759"><a href="#cb61-759"></a><span class="co">#| messages: false</span></span>
<span id="cb61-760"><a href="#cb61-760"></a><span class="co">#| warning: false</span></span>
<span id="cb61-761"><a href="#cb61-761"></a></span>
<span id="cb61-762"><a href="#cb61-762"></a><span class="fu">BIC</span>(lm_mod, nls_mod)</span>
<span id="cb61-763"><a href="#cb61-763"></a><span class="in">```</span></span>
<span id="cb61-764"><a href="#cb61-764"></a></span>
<span id="cb61-767"><a href="#cb61-767"></a><span class="in">```{r}</span></span>
<span id="cb61-768"><a href="#cb61-768"></a><span class="co">#| echo: true</span></span>
<span id="cb61-769"><a href="#cb61-769"></a><span class="co">#| messages: false</span></span>
<span id="cb61-770"><a href="#cb61-770"></a><span class="co">#| warning: false</span></span>
<span id="cb61-771"><a href="#cb61-771"></a></span>
<span id="cb61-772"><a href="#cb61-772"></a><span class="co"># Calculate the sum of squared residuals (SSR)</span></span>
<span id="cb61-773"><a href="#cb61-773"></a><span class="fu">sum</span>(<span class="fu">residuals</span>(lm_mod)<span class="sc">^</span><span class="dv">2</span>)</span>
<span id="cb61-774"><a href="#cb61-774"></a><span class="fu">sum</span>(<span class="fu">residuals</span>(nls_mod)<span class="sc">^</span><span class="dv">2</span>)</span>
<span id="cb61-775"><a href="#cb61-775"></a><span class="in">```</span></span>
<span id="cb61-776"><a href="#cb61-776"></a></span>
<span id="cb61-779"><a href="#cb61-779"></a><span class="in">```{r}</span></span>
<span id="cb61-780"><a href="#cb61-780"></a><span class="co">#| echo: true</span></span>
<span id="cb61-781"><a href="#cb61-781"></a><span class="co">#| messages: false</span></span>
<span id="cb61-782"><a href="#cb61-782"></a><span class="co">#| warning: false</span></span>
<span id="cb61-783"><a href="#cb61-783"></a></span>
<span id="cb61-784"><a href="#cb61-784"></a><span class="fu">anova</span>(lm_mod, nls_mod)</span>
<span id="cb61-785"><a href="#cb61-785"></a><span class="in">```</span></span>
<span id="cb61-786"><a href="#cb61-786"></a></span>
<span id="cb61-787"><a href="#cb61-787"></a>The AIC, BIC, and SSR values for the Michaelis-Menten model are lower than those for the linear model. Low is good, and we conclude that the Michaelis-Menten model is a better fit. The likelihood ratio test also shows that the Michaelis-Menten model is significantly better than the linear model (d.f. = 1, $F=375.43$, $p&lt;0.0001$). Therefore, we can conclude that the Michaelis-Menten model is the most appropriate model for these data and that the rate of nutrient uptake by the seaweed (in this example) is saturated at high nutrient concentrations.</span>
<span id="cb61-788"><a href="#cb61-788"></a></span>
<span id="cb61-789"><a href="#cb61-789"></a><span class="fu">#### Comparing treatment effects (NLS and NLMM) {#sec-mf-treatments}</span></span>
<span id="cb61-790"><a href="#cb61-790"></a></span>
<span id="cb61-791"><a href="#cb61-791"></a>Experiments are seldom as simple as the one above. To develop our example further, consider an experiment designed to assess whether an experimental treatment, such as light intensity or seawater temperature, affects the nutrient uptake rate of a seaweed. It is biologically plausible to expect that each treatment will result in unique $V_{max}$ and/or $K_m$ values. For example, we know that the uptake rate of nitrate (\ce{NO3-}) might increase at higher light intensities and higher temperatures. Therefore, our hypothesis for this experiment is that the nutrient uptake kinetics of the seaweed is influenced by the treatment, as more formally stated in @sec-mm-comparison. To test this hypothesis, we fit a Michaelis-Menten model so that it allows estimates of $V_{max}$ and $K_m$ to vary among treatment groups.</span>
<span id="cb61-792"><a href="#cb61-792"></a></span>
<span id="cb61-793"><a href="#cb61-793"></a>The data for a multiple flask experiment with a treatment effect comprised of three levels are provided in @tbl-mf2. Except for a new variable (treatment), the data are in all other respects identical to those in @sec-mf-single. </span>
<span id="cb61-794"><a href="#cb61-794"></a></span>
<span id="cb61-797"><a href="#cb61-797"></a><span class="in">```{r}</span></span>
<span id="cb61-798"><a href="#cb61-798"></a><span class="co">#| echo: false</span></span>
<span id="cb61-799"><a href="#cb61-799"></a><span class="co">#| messages: false</span></span>
<span id="cb61-800"><a href="#cb61-800"></a><span class="co">#| warning: false</span></span>
<span id="cb61-801"><a href="#cb61-801"></a><span class="co">#| tbl-cap: "Simulated data with three treatment levels for a multiple flask experiment on a seaweed species."</span></span>
<span id="cb61-802"><a href="#cb61-802"></a><span class="co">#| label: tbl-mf2</span></span>
<span id="cb61-803"><a href="#cb61-803"></a></span>
<span id="cb61-804"><a href="#cb61-804"></a><span class="fu">set.seed</span>(<span class="dv">13</span>)</span>
<span id="cb61-805"><a href="#cb61-805"></a>mf_data2 <span class="ot">&lt;-</span> <span class="fu">generate_data</span>(<span class="at">n_trt =</span> <span class="dv">3</span>, n_rep, conc_vec, Km_vec,</span>
<span id="cb61-806"><a href="#cb61-806"></a>                          Vmax_vec, Km_vec_sd, Vmax_vec_sd)</span>
<span id="cb61-807"><a href="#cb61-807"></a></span>
<span id="cb61-808"><a href="#cb61-808"></a>mf_data2 <span class="sc">|&gt;</span> </span>
<span id="cb61-809"><a href="#cb61-809"></a>  <span class="fu">select</span>(trt, rep, S, V) <span class="sc">|&gt;</span></span>
<span id="cb61-810"><a href="#cb61-810"></a>  <span class="fu">mutate</span>(<span class="at">V =</span> <span class="fu">round</span>(V, <span class="dv">2</span>)) <span class="sc">|&gt;</span></span>
<span id="cb61-811"><a href="#cb61-811"></a>  <span class="fu">filter</span>(<span class="fu">row_number</span>() <span class="sc">&lt;=</span> <span class="dv">3</span> <span class="sc">|</span> <span class="fu">row_number</span>() <span class="sc">&gt;</span> <span class="fu">n</span>() <span class="sc">-</span> <span class="dv">3</span>) <span class="sc">|&gt;</span> </span>
<span id="cb61-812"><a href="#cb61-812"></a>  <span class="fu">gt</span>() <span class="sc">|&gt;</span> </span>
<span id="cb61-813"><a href="#cb61-813"></a>  <span class="fu">cols_align</span>(</span>
<span id="cb61-814"><a href="#cb61-814"></a>    <span class="at">align =</span> <span class="st">"center"</span>,</span>
<span id="cb61-815"><a href="#cb61-815"></a>    <span class="at">columns =</span> <span class="fu">c</span>(<span class="st">"trt"</span>, <span class="st">"rep"</span>)) <span class="sc">|&gt;</span> </span>
<span id="cb61-816"><a href="#cb61-816"></a>  <span class="fu">cols_label</span>(<span class="at">trt =</span> <span class="fu">html</span>(<span class="st">"Treatment"</span>),</span>
<span id="cb61-817"><a href="#cb61-817"></a>             <span class="at">S =</span> <span class="fu">html</span>(<span class="st">"[S]"</span>),</span>
<span id="cb61-818"><a href="#cb61-818"></a>             <span class="at">rep =</span> <span class="fu">html</span>(<span class="st">"Replicate flask"</span>),</span>
<span id="cb61-819"><a href="#cb61-819"></a>             <span class="at">V =</span> <span class="fu">html</span>(<span class="st">"V"</span>))</span>
<span id="cb61-820"><a href="#cb61-820"></a><span class="in">```</span></span>
<span id="cb61-821"><a href="#cb61-821"></a></span>
<span id="cb61-822"><a href="#cb61-822"></a>**Option 1** The <span class="in">`nls()`</span> function in R does not handle factor variables directly, which means we cannot include the treatment variable as a factor in the model formula. To address this limitation, we fit the <span class="in">`nls()`</span> model separately for each treatment group. This approach allows each treatment to have its own $V_{\max}$ and $K_m$ values, effectively accommodating the variability in the Michaelis-Menten parameters across treatments.</span>
<span id="cb61-823"><a href="#cb61-823"></a></span>
<span id="cb61-824"><a href="#cb61-824"></a>In addition to fitting separate models for each treatment, we also fit a global model (a null model) to all the data. The global model assumes that the effect of the experimental treatment is negligible, meaning that all treatments share the same $V_{\max}$ and $K_m$. This global fit serves as a baseline for comparison.</span>
<span id="cb61-825"><a href="#cb61-825"></a></span>
<span id="cb61-826"><a href="#cb61-826"></a>To determine whether the Michaelis-Menten parameters significantly differ among the treatment groups, we perform a likelihood ratio test. The likelihood ratio test compares the fit of the global model (where parameters are shared across treatments) to the combined fit of the separate models (where parameters vary by treatment). The test statistic is the difference in the log-likelihoods of the two models, which follows a $\chi^2$ distribution with degrees of freedom equal to the difference in the number of parameters between the two models.</span>
<span id="cb61-827"><a href="#cb61-827"></a></span>
<span id="cb61-830"><a href="#cb61-830"></a><span class="in">```{r}</span></span>
<span id="cb61-831"><a href="#cb61-831"></a><span class="co">#| echo: true</span></span>
<span id="cb61-832"><a href="#cb61-832"></a><span class="co">#| messages: false</span></span>
<span id="cb61-833"><a href="#cb61-833"></a><span class="co">#| warning: false</span></span>
<span id="cb61-834"><a href="#cb61-834"></a></span>
<span id="cb61-835"><a href="#cb61-835"></a><span class="co"># Fit separate models</span></span>
<span id="cb61-836"><a href="#cb61-836"></a>separate_models <span class="ot">&lt;-</span> mf_data2 <span class="sc">|&gt;</span></span>
<span id="cb61-837"><a href="#cb61-837"></a>  <span class="fu">group_by</span>(trt) <span class="sc">|&gt;</span></span>
<span id="cb61-838"><a href="#cb61-838"></a>  <span class="fu">nest</span>() <span class="sc">|&gt;</span></span>
<span id="cb61-839"><a href="#cb61-839"></a>  <span class="fu">mutate</span>(<span class="at">model =</span> <span class="fu">map</span>(data, <span class="sc">~</span><span class="fu">nls</span>(V <span class="sc">~</span> <span class="fu">mm_fun</span>(S, Vmax, Km),</span>
<span id="cb61-840"><a href="#cb61-840"></a>                                <span class="at">data =</span> .x,</span>
<span id="cb61-841"><a href="#cb61-841"></a>                                <span class="at">start =</span> <span class="fu">list</span>(<span class="at">Vmax =</span> <span class="dv">40</span>, <span class="at">Km =</span> <span class="dv">10</span>))))</span>
<span id="cb61-842"><a href="#cb61-842"></a></span>
<span id="cb61-843"><a href="#cb61-843"></a><span class="co"># Extract model summaries of separate models</span></span>
<span id="cb61-844"><a href="#cb61-844"></a>model_summaries <span class="ot">&lt;-</span> separate_models<span class="sc">|&gt;</span></span>
<span id="cb61-845"><a href="#cb61-845"></a>  <span class="fu">mutate</span>(<span class="at">summary =</span> <span class="fu">map</span>(model, broom<span class="sc">::</span>tidy))</span>
<span id="cb61-846"><a href="#cb61-846"></a></span>
<span id="cb61-847"><a href="#cb61-847"></a><span class="co"># Display summaries of separate models</span></span>
<span id="cb61-848"><a href="#cb61-848"></a>model_summaries <span class="sc">|&gt;</span></span>
<span id="cb61-849"><a href="#cb61-849"></a>  <span class="fu">select</span>(trt, summary) <span class="sc">|&gt;</span></span>
<span id="cb61-850"><a href="#cb61-850"></a>  <span class="fu">unnest</span>(summary)</span>
<span id="cb61-851"><a href="#cb61-851"></a></span>
<span id="cb61-852"><a href="#cb61-852"></a><span class="co"># Fit the global model</span></span>
<span id="cb61-853"><a href="#cb61-853"></a>global_model <span class="ot">&lt;-</span> <span class="fu">nls</span>(V <span class="sc">~</span> <span class="fu">mm_fun</span>(S, Vmax, Km),</span>
<span id="cb61-854"><a href="#cb61-854"></a>                    <span class="at">data =</span> mf_data2,</span>
<span id="cb61-855"><a href="#cb61-855"></a>                    <span class="at">start =</span> <span class="fu">list</span>(<span class="at">Vmax =</span> <span class="dv">45</span>, <span class="at">Km =</span> <span class="dv">9</span>))</span>
<span id="cb61-856"><a href="#cb61-856"></a></span>
<span id="cb61-857"><a href="#cb61-857"></a><span class="co"># Extract log-likelihoods and degrees of freedom</span></span>
<span id="cb61-858"><a href="#cb61-858"></a>logLik_global <span class="ot">&lt;-</span> <span class="fu">logLik</span>(global_model)</span>
<span id="cb61-859"><a href="#cb61-859"></a>df_global <span class="ot">&lt;-</span> <span class="fu">attr</span>(logLik_global, <span class="st">"df"</span>)</span>
<span id="cb61-860"><a href="#cb61-860"></a></span>
<span id="cb61-861"><a href="#cb61-861"></a><span class="co"># Combined log-likelihoods and degrees of freedom</span></span>
<span id="cb61-862"><a href="#cb61-862"></a>logLik_separate <span class="ot">&lt;-</span> <span class="fu">sum</span>(<span class="fu">sapply</span>(separate_models<span class="sc">$</span>model, logLik))</span>
<span id="cb61-863"><a href="#cb61-863"></a>df_separate <span class="ot">&lt;-</span> <span class="fu">sum</span>(<span class="fu">sapply</span>(separate_models<span class="sc">$</span>model,</span>
<span id="cb61-864"><a href="#cb61-864"></a>                          <span class="cf">function</span>(m) <span class="fu">attr</span>(<span class="fu">logLik</span>(m), <span class="st">"df"</span>)))</span>
<span id="cb61-865"><a href="#cb61-865"></a></span>
<span id="cb61-866"><a href="#cb61-866"></a><span class="co"># Perform the likelihood ratio test</span></span>
<span id="cb61-867"><a href="#cb61-867"></a>lrt_stat <span class="ot">&lt;-</span> <span class="dv">2</span> <span class="sc">*</span> (logLik_separate <span class="sc">-</span> logLik_global)</span>
<span id="cb61-868"><a href="#cb61-868"></a>p_value <span class="ot">&lt;-</span> <span class="fu">pchisq</span>(lrt_stat, <span class="at">df =</span> df_separate <span class="sc">-</span> df_global,</span>
<span id="cb61-869"><a href="#cb61-869"></a>                  <span class="at">lower.tail =</span> <span class="cn">FALSE</span>)</span>
<span id="cb61-870"><a href="#cb61-870"></a></span>
<span id="cb61-871"><a href="#cb61-871"></a><span class="co"># Display results</span></span>
<span id="cb61-872"><a href="#cb61-872"></a><span class="fu">cat</span>(<span class="st">"Global model log-likelihood:"</span>, logLik_global, <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb61-873"><a href="#cb61-873"></a><span class="fu">cat</span>(<span class="st">"Separate models log-likelihood:"</span>, logLik_separate, <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb61-874"><a href="#cb61-874"></a><span class="fu">cat</span>(<span class="st">"Degree of freedom:"</span>, df_separate <span class="sc">-</span> df_global, <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb61-875"><a href="#cb61-875"></a><span class="fu">cat</span>(<span class="st">"Likelihood ratio test statistic:"</span>, lrt_stat, <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb61-876"><a href="#cb61-876"></a><span class="fu">cat</span>(<span class="st">"p-value:"</span>, p_value, <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb61-877"><a href="#cb61-877"></a><span class="in">```</span></span>
<span id="cb61-878"><a href="#cb61-878"></a></span>
<span id="cb61-879"><a href="#cb61-879"></a>The results of the likelihood ratio test indicate whether the variation in $V_{\max}$ and $K_m$ among the treatments is statistically significant. If the test is significant, it suggests that the Michaelis-Menten parameters differ across treatments. We interpret the results as follows:</span>
<span id="cb61-880"><a href="#cb61-880"></a></span>
<span id="cb61-881"><a href="#cb61-881"></a><span class="ss">- </span>The log-likelihood value (-620.7498) for the global model, indicating the fit of the model with shared parameters.</span>
<span id="cb61-882"><a href="#cb61-882"></a><span class="ss">- </span>The combined log-likelihood value (-313.1862) for the separate models, indicating the fit of the models with parameters varying by treatment.</span>
<span id="cb61-883"><a href="#cb61-883"></a><span class="ss">- </span>The calculated test statistic (615.1273) for the likelihood ratio test on 6 degrees of freedom.</span>
<span id="cb61-884"><a href="#cb61-884"></a><span class="ss">- </span>The *p*-value of the test is less than 0.0001 and provides strong evidence that $V_{\max}$ and $K_m$ differ significantly among the treatment groups.</span>
<span id="cb61-885"><a href="#cb61-885"></a></span>
<span id="cb61-886"><a href="#cb61-886"></a>::: {.callout-tip}</span>
<span id="cb61-887"><a href="#cb61-887"></a><span class="fu">## Results</span></span>
<span id="cb61-888"><a href="#cb61-888"></a></span>
<span id="cb61-889"><a href="#cb61-889"></a>The analysis aimed to determine if the Michaelis-Menten parameters $V_{\max}$ and $K_m$ significantly differed among the three experimental treatments. This was evaluated by fitting a global model with shared $V_{\max}$ and $K_m$ values across all treatments and comparing it to a model allowing separate $V_{\max}$ and $K_m$ estimates for each treatment. The log-likelihood value for the global model, which assumes shared $V_{\max}$ and $K_m$ values across all treatments, was -620.75, indicating the fit of the model with common parameters. In contrast, the combined log-likelihood value for the separate models, which allow $V_{\max}$ and $K_m$ to vary by treatment, was -313.19, indicating the fit of the models with treatment-specific parameters. The calculated test statistic for the likelihood ratio test was 615.13 (d.f. = 6, *p* &lt; 0.001), providing strong evidence that the Michaelis-Menten parameters $V_{\max}$ and $K_m$ differ significantly among the treatment groups. Consequently we estimate a $V_{max}$ of 49.2 Â± 0.96, 39.4 Â± 0.87 $\mu$M N g$^{-1}$ hr$^{-1}$ and 18.9 Â± 0.65 and a $K_m$ of 9.55 Â± 0.48, 7.54 Â± 0.48 and 5.50 Â± 0.64 $\mu$M for treatments 1, 2 and 3 respectively.</span>
<span id="cb61-890"><a href="#cb61-890"></a>:::</span>
<span id="cb61-891"><a href="#cb61-891"></a></span>
<span id="cb61-892"><a href="#cb61-892"></a>**Option 2** If Option 1 seems cumbersome, we can fit a NLMM using the **nlme** package instead. This package allows us to fit a mixed model with random effects for each treatment group. In this model, the fixed effects are the Michaelis-Menten parameters $V_{\max}$ and $K_m$, which vary by treatment, while the random effects are the replicate-specific intercepts. Thus, the cumbersome <span class="in">`nls()`</span> formulation is replaced by the compact but more fiddly <span class="in">`nlme()`</span> model specification. Pick your poison. The model is specified as follows:</span>
<span id="cb61-893"><a href="#cb61-893"></a></span>
<span id="cb61-896"><a href="#cb61-896"></a><span class="in">```{r}</span></span>
<span id="cb61-897"><a href="#cb61-897"></a><span class="co">#| echo: true</span></span>
<span id="cb61-898"><a href="#cb61-898"></a><span class="co">#| messages: false</span></span>
<span id="cb61-899"><a href="#cb61-899"></a><span class="co">#| warning: false</span></span>
<span id="cb61-900"><a href="#cb61-900"></a></span>
<span id="cb61-901"><a href="#cb61-901"></a><span class="co"># Fit the model with the same parameters for both treatments</span></span>
<span id="cb61-902"><a href="#cb61-902"></a><span class="co"># Starting values for Vmax and Km</span></span>
<span id="cb61-903"><a href="#cb61-903"></a>start_vals <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="at">Vmax =</span> <span class="dv">50</span>, <span class="at">Km =</span> <span class="dv">10</span>)</span>
<span id="cb61-904"><a href="#cb61-904"></a>global_model <span class="ot">&lt;-</span> <span class="fu">nlme</span>(</span>
<span id="cb61-905"><a href="#cb61-905"></a>  V <span class="sc">~</span> <span class="fu">mm_fun</span>(S, Vmax, Km),</span>
<span id="cb61-906"><a href="#cb61-906"></a>  <span class="at">data =</span> mf_data2,</span>
<span id="cb61-907"><a href="#cb61-907"></a>  <span class="at">fixed =</span> Vmax <span class="sc">+</span> Km <span class="sc">~</span> <span class="dv">1</span>, <span class="co"># &lt;1&gt;</span></span>
<span id="cb61-908"><a href="#cb61-908"></a>  <span class="at">random =</span> Vmax <span class="sc">~</span> <span class="dv">1</span> <span class="sc">|</span> trt<span class="sc">/</span>rep, <span class="co"># &lt;2&gt;</span></span>
<span id="cb61-909"><a href="#cb61-909"></a>  <span class="at">start =</span> start_vals</span>
<span id="cb61-910"><a href="#cb61-910"></a>)</span>
<span id="cb61-911"><a href="#cb61-911"></a></span>
<span id="cb61-912"><a href="#cb61-912"></a><span class="co"># Fit the model with parameters varying by treatment</span></span>
<span id="cb61-913"><a href="#cb61-913"></a><span class="co"># Starting values for Vmax and Km for each treatment</span></span>
<span id="cb61-914"><a href="#cb61-914"></a>start_vals <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="at">Vmax1 =</span> <span class="dv">50</span>, <span class="at">Vmax2 =</span> <span class="dv">40</span>, <span class="at">Vmax3 =</span> <span class="dv">30</span>,</span>
<span id="cb61-915"><a href="#cb61-915"></a>                <span class="at">Km1 =</span> <span class="dv">10</span>, <span class="at">Km2 =</span> <span class="dv">10</span>, <span class="at">Km3 =</span> <span class="dv">5</span>) <span class="co"># &lt;3&gt;</span></span>
<span id="cb61-916"><a href="#cb61-916"></a>separate_models <span class="ot">&lt;-</span> <span class="fu">nlme</span>(</span>
<span id="cb61-917"><a href="#cb61-917"></a>  V <span class="sc">~</span> <span class="fu">mm_fun</span>(S, Vmax, Km),</span>
<span id="cb61-918"><a href="#cb61-918"></a>  <span class="at">data =</span> mf_data2,</span>
<span id="cb61-919"><a href="#cb61-919"></a>  <span class="at">fixed =</span> <span class="fu">list</span>(Vmax <span class="sc">~</span> trt, Km <span class="sc">~</span> trt), <span class="co"># &lt;4&gt;</span></span>
<span id="cb61-920"><a href="#cb61-920"></a>  <span class="at">random =</span> Vmax <span class="sc">~</span> <span class="dv">1</span> <span class="sc">|</span> trt<span class="sc">/</span>rep,</span>
<span id="cb61-921"><a href="#cb61-921"></a>  <span class="at">start =</span> start_vals</span>
<span id="cb61-922"><a href="#cb61-922"></a>)</span>
<span id="cb61-923"><a href="#cb61-923"></a><span class="in">```</span></span>
<span id="cb61-924"><a href="#cb61-924"></a><span class="ss">1. </span>The fixed effects indicate that both $V_{\max}$ and $K_m$ are fixed (do not vary) across treatments.</span>
<span id="cb61-925"><a href="#cb61-925"></a><span class="ss">2. </span>The random effects indicate that the $V_{\max}$ parameter varies by treatment and replicate.</span>
<span id="cb61-926"><a href="#cb61-926"></a><span class="ss">3. </span>The starting values for the $V_{\max}$ and $K_m$ parameters are specified for each treatment group. Because we are now fitting a separate model for each treatment, we need to provide starting values for each treatment.</span>
<span id="cb61-927"><a href="#cb61-927"></a><span class="ss">4. </span>The fixed effects now indicate that both $V_{\max}$ and $K_m$ vary by treatment.</span>
<span id="cb61-928"><a href="#cb61-928"></a></span>
<span id="cb61-929"><a href="#cb61-929"></a>The estimated parameters for the global model and the separate models can be extracted using the <span class="in">`summary()`</span> function:</span>
<span id="cb61-930"><a href="#cb61-930"></a></span>
<span id="cb61-933"><a href="#cb61-933"></a><span class="in">```{r}</span></span>
<span id="cb61-934"><a href="#cb61-934"></a><span class="co">#| echo: true</span></span>
<span id="cb61-935"><a href="#cb61-935"></a><span class="co">#| messages: false</span></span>
<span id="cb61-936"><a href="#cb61-936"></a><span class="co">#| warning: false</span></span>
<span id="cb61-937"><a href="#cb61-937"></a></span>
<span id="cb61-938"><a href="#cb61-938"></a><span class="co"># Extract the estimated parameters (abbreviated output)</span></span>
<span id="cb61-939"><a href="#cb61-939"></a><span class="co"># summary(global_model) # for verbose output</span></span>
<span id="cb61-940"><a href="#cb61-940"></a><span class="fu">summary</span>(global_model)<span class="sc">$</span>tTable</span>
<span id="cb61-941"><a href="#cb61-941"></a><span class="in">```</span></span>
<span id="cb61-942"><a href="#cb61-942"></a></span>
<span id="cb61-945"><a href="#cb61-945"></a><span class="in">```{r}</span></span>
<span id="cb61-946"><a href="#cb61-946"></a><span class="co">#| echo: true</span></span>
<span id="cb61-947"><a href="#cb61-947"></a><span class="co">#| messages: false</span></span>
<span id="cb61-948"><a href="#cb61-948"></a><span class="co">#| warning: false</span></span>
<span id="cb61-949"><a href="#cb61-949"></a></span>
<span id="cb61-950"><a href="#cb61-950"></a><span class="co"># Extract the estimated parameters (abbreviated output)</span></span>
<span id="cb61-951"><a href="#cb61-951"></a><span class="co"># summary(separate_models) # for verbose output</span></span>
<span id="cb61-952"><a href="#cb61-952"></a><span class="fu">summary</span>(separate_models)<span class="sc">$</span>tTable</span>
<span id="cb61-953"><a href="#cb61-953"></a><span class="in">```</span></span>
<span id="cb61-954"><a href="#cb61-954"></a></span>
<span id="cb61-955"><a href="#cb61-955"></a>The log-likelihood ratio test can then easily be performed using the <span class="in">`anova()`</span> function, which compares the global model with the separate models:</span>
<span id="cb61-956"><a href="#cb61-956"></a></span>
<span id="cb61-959"><a href="#cb61-959"></a><span class="in">```{r}</span></span>
<span id="cb61-960"><a href="#cb61-960"></a><span class="co">#| echo: true</span></span>
<span id="cb61-961"><a href="#cb61-961"></a><span class="co">#| messages: false</span></span>
<span id="cb61-962"><a href="#cb61-962"></a><span class="co">#| warning: false</span></span>
<span id="cb61-963"><a href="#cb61-963"></a></span>
<span id="cb61-964"><a href="#cb61-964"></a><span class="fu">anova</span>(global_model, separate_models)</span>
<span id="cb61-965"><a href="#cb61-965"></a><span class="in">```</span></span>
<span id="cb61-966"><a href="#cb61-966"></a></span>
<span id="cb61-967"><a href="#cb61-967"></a>Again, the results of the likelihood ratio test indicate that the variation in $V_{\max}$ and $K_m$ among the treatments is statistically significant (log-likelihood = 45.20, *p* &lt; 0.0001). The AIC values can also be used to compare the models, with lower AIC values indicating a better fit. In this case, the separate models have a lower AIC value (644.28), suggesting that they provide a better fit to the data than the global model (681.479). The data fitted with the global and separate models is presented in @fig-mf3.</span>
<span id="cb61-968"><a href="#cb61-968"></a></span>
<span id="cb61-969"><a href="#cb61-969"></a>**Assumption tests** To complete our example comparing the Michaelis-Menten parameters among treatments, let's confirm the assumptions by examining the residuals. Residuals in nonlinear regression models have the same interpretation as in linear models, and therefore, the assumption tests available for linear models can be applied here as well. For instance, we can use the <span class="in">`shapiro.test()`</span> function to check the normality of residuals, as shown below, and the <span class="in">`hist()`</span> and <span class="in">`plot()`</span> functions for diagnostic plots. In real-world data, it is advised to verify these assumptions before accepting the analysis and drawing conclusions from the nonlinear regression model. Let's check the normality of residuals for each treatment and plot the residuals to check for normality and homoscedasticity (@fig-mf-assump).</span>
<span id="cb61-970"><a href="#cb61-970"></a></span>
<span id="cb61-973"><a href="#cb61-973"></a><span class="in">```{r}</span></span>
<span id="cb61-974"><a href="#cb61-974"></a><span class="co">#| echo: true</span></span>
<span id="cb61-975"><a href="#cb61-975"></a><span class="co">#| eval: true</span></span>
<span id="cb61-976"><a href="#cb61-976"></a><span class="co">#| messages: false</span></span>
<span id="cb61-977"><a href="#cb61-977"></a><span class="co">#| warning: false</span></span>
<span id="cb61-978"><a href="#cb61-978"></a></span>
<span id="cb61-979"><a href="#cb61-979"></a><span class="co"># Add residuals and fitted information to the data frame</span></span>
<span id="cb61-980"><a href="#cb61-980"></a>mf_data2<span class="sc">$</span>residuals_separate <span class="ot">&lt;-</span> <span class="fu">residuals</span>(separate_models)</span>
<span id="cb61-981"><a href="#cb61-981"></a>mf_data2<span class="sc">$</span>fitted_values_separate <span class="ot">&lt;-</span> <span class="fu">fitted</span>(separate_models)</span>
<span id="cb61-982"><a href="#cb61-982"></a></span>
<span id="cb61-983"><a href="#cb61-983"></a><span class="co"># Perform the Shapiro-Wilk test for each treatment</span></span>
<span id="cb61-984"><a href="#cb61-984"></a><span class="fu">shapiro.test</span>(mf_data2<span class="sc">$</span>residuals_separate[mf_data2<span class="sc">$</span>trt <span class="sc">==</span> <span class="st">"Treatment 1"</span>])</span>
<span id="cb61-985"><a href="#cb61-985"></a><span class="fu">shapiro.test</span>(mf_data2<span class="sc">$</span>residuals_separate[mf_data2<span class="sc">$</span>trt <span class="sc">==</span> <span class="st">"Treatment 2"</span>])</span>
<span id="cb61-986"><a href="#cb61-986"></a><span class="fu">shapiro.test</span>(mf_data2<span class="sc">$</span>residuals_separate[mf_data2<span class="sc">$</span>trt <span class="sc">==</span> <span class="st">"Treatment 3"</span>])</span>
<span id="cb61-987"><a href="#cb61-987"></a><span class="in">```</span></span>
<span id="cb61-988"><a href="#cb61-988"></a></span>
<span id="cb61-989"><a href="#cb61-989"></a><span class="in">```{r, fig.width=c(6,5),fig.asp=0.65,out.width=c("80%","12cm")}</span></span>
<span id="cb61-990"><a href="#cb61-990"></a><span class="in">#| echo: false</span></span>
<span id="cb61-991"><a href="#cb61-991"></a><span class="in">#| eval: true</span></span>
<span id="cb61-992"><a href="#cb61-992"></a><span class="in">#| messages: false</span></span>
<span id="cb61-993"><a href="#cb61-993"></a><span class="in">#| warning: false</span></span>
<span id="cb61-994"><a href="#cb61-994"></a><span class="in">#| fig.cap: "Histograms (A) of residuals and plots of residuals vs. the fitted values (B) for residuals for the three treatments in the multiple-flask experiment."</span></span>
<span id="cb61-995"><a href="#cb61-995"></a><span class="in">#| label: fig-mf-assump</span></span>
<span id="cb61-996"><a href="#cb61-996"></a><span class="in">#| fig-align: center</span></span>
<span id="cb61-997"><a href="#cb61-997"></a></span>
<span id="cb61-998"><a href="#cb61-998"></a><span class="in"># Make histograms with frequency polygons overlain</span></span>
<span id="cb61-999"><a href="#cb61-999"></a><span class="in"># for visual comfirmation (optional)</span></span>
<span id="cb61-1000"><a href="#cb61-1000"></a><span class="in">plt1 &lt;- ggplot(mf_data2, aes(x = residuals_separate)) +</span></span>
<span id="cb61-1001"><a href="#cb61-1001"></a><span class="in">  geom_histogram(aes(y = ..density..), bins = 10,</span></span>
<span id="cb61-1002"><a href="#cb61-1002"></a><span class="in">                 fill = "lightblue", colour = "lightblue") +</span></span>
<span id="cb61-1003"><a href="#cb61-1003"></a><span class="in">  geom_density(alpha = 0.5) +</span></span>
<span id="cb61-1004"><a href="#cb61-1004"></a><span class="in">  facet_wrap(~ trt) +</span></span>
<span id="cb61-1005"><a href="#cb61-1005"></a><span class="in">  labs(x = "Residuals", y = "Density")</span></span>
<span id="cb61-1006"><a href="#cb61-1006"></a></span>
<span id="cb61-1007"><a href="#cb61-1007"></a><span class="in">plt2 &lt;- ggplot(mf_data2, aes(x = fitted_values_separate, y = residuals_separate)) +</span></span>
<span id="cb61-1008"><a href="#cb61-1008"></a><span class="in">  geom_point(colour = "royalblue2", shape = 1) +</span></span>
<span id="cb61-1009"><a href="#cb61-1009"></a><span class="in">  geom_smooth(method = "gam", se = FALSE,</span></span>
<span id="cb61-1010"><a href="#cb61-1010"></a><span class="in">              linewidth = 0.6, colour = "indianred2") +</span></span>
<span id="cb61-1011"><a href="#cb61-1011"></a><span class="in">  facet_wrap(~trt) +</span></span>
<span id="cb61-1012"><a href="#cb61-1012"></a><span class="in">  theme(legend.position = "none") +  # Turn off the legend</span></span>
<span id="cb61-1013"><a href="#cb61-1013"></a><span class="in">  labs(x = "Fitted Values",</span></span>
<span id="cb61-1014"><a href="#cb61-1014"></a><span class="in">       y = "Residuals")</span></span>
<span id="cb61-1015"><a href="#cb61-1015"></a></span>
<span id="cb61-1016"><a href="#cb61-1016"></a><span class="in">ggarrange(plt1, plt2, nrow = 2, labels = c("A", "B"))</span></span>
<span id="cb61-1017"><a href="#cb61-1017"></a><span class="in">```</span></span>
<span id="cb61-1018"><a href="#cb61-1018"></a></span>
<span id="cb61-1019"><a href="#cb61-1019"></a>The Shapiro-Wilk test results indicate that the residuals are normally distributed for Treatments 1 and 2 (*p* &gt; 0.05) but not for Treatment 3 (*p* &lt; 0.05). However, the histograms in @fig-mf-assump show that the residuals are approximately normally distributed for all treatment groups, with the median roughly in the middle of the distribution in each case. This apparent discrepancy can be explained by the sensitivity of the Shapiro-Wilk test to sample size. With large sample sizes, even minor deviations from normality can be detected as statistically significant. In situations such as this one, I suggest that it is important to consider the sample size and visual inspection of the data when interpreting the results of normality tests. Here, given the relatively large sample size and the visual assessment of the histograms, we can reasonably conclude that the residuals are approximately normally distributed for all treatment groups. </span>
<span id="cb61-1020"><a href="#cb61-1020"></a></span>
<span id="cb61-1021"><a href="#cb61-1021"></a>Another normality tests such as the Kolmogorov-Smirnov (K-S) test might be less sensitive to sample size and could be considered for comparison. The K-S test is a non-parametric statistical test that is used to determine if a sample comes from a specific probability distribution. Here I use it to test if a sample follows a normal distribution (<span class="in">`pnorm`</span>), but it can also be used to test against other theoretical distributions or to compare two empirical distributions. The K-S test can be performed using the <span class="in">`ks.test()`</span>, as shown below.</span>
<span id="cb61-1022"><a href="#cb61-1022"></a></span>
<span id="cb61-1025"><a href="#cb61-1025"></a><span class="in">```{r}</span></span>
<span id="cb61-1026"><a href="#cb61-1026"></a><span class="co">#| echo: true</span></span>
<span id="cb61-1027"><a href="#cb61-1027"></a><span class="co">#| eval: true</span></span>
<span id="cb61-1028"><a href="#cb61-1028"></a><span class="co">#| messages: false</span></span>
<span id="cb61-1029"><a href="#cb61-1029"></a><span class="co">#| warning: false</span></span>
<span id="cb61-1030"><a href="#cb61-1030"></a></span>
<span id="cb61-1031"><a href="#cb61-1031"></a>perform_ks_test <span class="ot">&lt;-</span> <span class="cf">function</span>(data, treatment) {</span>
<span id="cb61-1032"><a href="#cb61-1032"></a>  <span class="fu">ks.test</span>(data<span class="sc">$</span>residuals_separate[data<span class="sc">$</span>trt <span class="sc">==</span> treatment], <span class="st">"pnorm"</span>, </span>
<span id="cb61-1033"><a href="#cb61-1033"></a>          <span class="at">mean =</span> <span class="fu">mean</span>(data<span class="sc">$</span>residuals_separate[data<span class="sc">$</span>trt <span class="sc">==</span> treatment]), </span>
<span id="cb61-1034"><a href="#cb61-1034"></a>          <span class="at">sd =</span> <span class="fu">sd</span>(data<span class="sc">$</span>residuals_separate[data<span class="sc">$</span>trt <span class="sc">==</span> treatment]))</span>
<span id="cb61-1035"><a href="#cb61-1035"></a>}</span>
<span id="cb61-1036"><a href="#cb61-1036"></a></span>
<span id="cb61-1037"><a href="#cb61-1037"></a><span class="co"># Perform the test for each treatment group</span></span>
<span id="cb61-1038"><a href="#cb61-1038"></a><span class="fu">perform_ks_test</span>(mf_data2, <span class="st">"Treatment 1"</span>)</span>
<span id="cb61-1039"><a href="#cb61-1039"></a><span class="fu">perform_ks_test</span>(mf_data2, <span class="st">"Treatment 2"</span>)</span>
<span id="cb61-1040"><a href="#cb61-1040"></a><span class="fu">perform_ks_test</span>(mf_data2, <span class="st">"Treatment 3"</span>)</span>
<span id="cb61-1041"><a href="#cb61-1041"></a><span class="in">```</span></span>
<span id="cb61-1042"><a href="#cb61-1042"></a></span>
<span id="cb61-1043"><a href="#cb61-1043"></a>We see that the K-S test indicates that the residuals are normally distributed for all treatment groups (*p* &gt; 0.05). As already noted, this test is less sensitive to sample size than the Shapiro-Wilk test, and the results are consistent with the visual assessment of the histograms.</span>
<span id="cb61-1044"><a href="#cb61-1044"></a></span>
<span id="cb61-1045"><a href="#cb61-1045"></a>We should also check for homoscedasticity (here I use the Levene test) and a plot of residuals versus fitted values. </span>
<span id="cb61-1046"><a href="#cb61-1046"></a></span>
<span id="cb61-1049"><a href="#cb61-1049"></a><span class="in">```{r}</span></span>
<span id="cb61-1050"><a href="#cb61-1050"></a><span class="co">#| echo: true</span></span>
<span id="cb61-1051"><a href="#cb61-1051"></a><span class="co">#| eval: true</span></span>
<span id="cb61-1052"><a href="#cb61-1052"></a><span class="co">#| messages: false</span></span>
<span id="cb61-1053"><a href="#cb61-1053"></a><span class="co">#| warning: false</span></span>
<span id="cb61-1054"><a href="#cb61-1054"></a></span>
<span id="cb61-1055"><a href="#cb61-1055"></a><span class="co"># Perform the Levene test</span></span>
<span id="cb61-1056"><a href="#cb61-1056"></a>car<span class="sc">::</span><span class="fu">leveneTest</span>(residuals_separate <span class="sc">~</span> trt, <span class="at">data =</span> mf_data2)</span>
<span id="cb61-1057"><a href="#cb61-1057"></a><span class="in">```</span></span>
<span id="cb61-1058"><a href="#cb61-1058"></a></span>
<span id="cb61-1059"><a href="#cb61-1059"></a>The Levene test shows that the variances are the same across the three treatments and this is confirmed by the plot of residuals against the fitted values in @fig-mf-assump. </span>
<span id="cb61-1060"><a href="#cb61-1060"></a></span>
<span id="cb61-1061"><a href="#cb61-1061"></a>::: {.callout-tip}</span>
<span id="cb61-1062"><a href="#cb61-1062"></a><span class="fu">## Results</span></span>
<span id="cb61-1063"><a href="#cb61-1063"></a></span>
<span id="cb61-1064"><a href="#cb61-1064"></a>Michaelis-Menten models were fitted to nutrient uptake data across three experimental treatments to investigate the effects of the treatments on seaweed nutrient kinetics. A global model, assuming shared kinetic parameters ($V_{max}$ and $K_m$) across all treatments, was compared to a model with separate parameters for each treatment. The model allowing treatment-specific parameters (AIC = 644.3) provided a significantly better fit to the data than the global model (AIC = 681.5), a finding confirmed by the log-likelihood test (log-likelihood ratio = 45.20, d.f. = 4, *p* &lt; 0.0001). As the assumption tests do not indicate any cause for concern regarding the distribution of residuals, we conclude that the experimental treatments significantly influenced the nutrient uptake kinetics of the seaweed (@fig-mf3).</span>
<span id="cb61-1065"><a href="#cb61-1065"></a></span>
<span id="cb61-1066"><a href="#cb61-1066"></a>Specifically, all three treatments exhibited unique combinations of $V_{max}$ and $K_m$ values (Treatment 1: $V_{max}$ = 49.2, $K_m$ = 9.5; Treatment 2: $V_{max}$ = 39.3, $K_m$ = 7.5; Treatment 3: $V_{max}$ = 19.0, $K_m$ = 5.5). These findings support the hypothesis that nutrient uptake kinetics in this seaweed species are sensitive to environmental perturbations.</span>
<span id="cb61-1067"><a href="#cb61-1067"></a>:::</span>
<span id="cb61-1068"><a href="#cb61-1068"></a></span>
<span id="cb61-1069"><a href="#cb61-1069"></a><span class="in">```{r, fig.width=c(6,5),fig.asp=0.5,out.width=c("80%","12cm")}</span></span>
<span id="cb61-1070"><a href="#cb61-1070"></a><span class="in">#| echo: false</span></span>
<span id="cb61-1071"><a href="#cb61-1071"></a><span class="in">#| messages: false</span></span>
<span id="cb61-1072"><a href="#cb61-1072"></a><span class="in">#| warning: false</span></span>
<span id="cb61-1073"><a href="#cb61-1073"></a><span class="in">#| fig.cap: "Plot of the Michaelis-Menten model fitted to the data in @tbl-mf2. Fits are provided for the separate models and the global model."</span></span>
<span id="cb61-1074"><a href="#cb61-1074"></a><span class="in">#| label: fig-mf3</span></span>
<span id="cb61-1075"><a href="#cb61-1075"></a><span class="in">#| fig-align: center</span></span>
<span id="cb61-1076"><a href="#cb61-1076"></a><span class="in">#| fig-pos: "t"</span></span>
<span id="cb61-1077"><a href="#cb61-1077"></a></span>
<span id="cb61-1078"><a href="#cb61-1078"></a><span class="in"># Extract coefficients for shared model</span></span>
<span id="cb61-1079"><a href="#cb61-1079"></a><span class="in">Vmax_est_shared &lt;- global_model$coefficients$fixed["Vmax"]</span></span>
<span id="cb61-1080"><a href="#cb61-1080"></a><span class="in">Km_est_shared &lt;- global_model$coefficients$fixed["Km"]</span></span>
<span id="cb61-1081"><a href="#cb61-1081"></a></span>
<span id="cb61-1082"><a href="#cb61-1082"></a><span class="in"># Extract coefficients for separate models</span></span>
<span id="cb61-1083"><a href="#cb61-1083"></a><span class="in">coeffs &lt;- separate_models$coefficients$fixed</span></span>
<span id="cb61-1084"><a href="#cb61-1084"></a><span class="in">Vmax_est_separate &lt;- coeffs["Vmax.(Intercept)"] +</span></span>
<span id="cb61-1085"><a href="#cb61-1085"></a><span class="in">  c(0, coeffs[paste0("Vmax.trtTreatment ", 2:3)])</span></span>
<span id="cb61-1086"><a href="#cb61-1086"></a><span class="in">Km_est_separate &lt;- coeffs["Km.(Intercept)"] +</span></span>
<span id="cb61-1087"><a href="#cb61-1087"></a><span class="in">  c(0, coeffs[paste0("Km.trtTreatment ", 2:3)])</span></span>
<span id="cb61-1088"><a href="#cb61-1088"></a></span>
<span id="cb61-1089"><a href="#cb61-1089"></a><span class="in"># Assign individual variables for clarity</span></span>
<span id="cb61-1090"><a href="#cb61-1090"></a><span class="in">Vmax_est_separate_1 &lt;- Vmax_est_separate[1]</span></span>
<span id="cb61-1091"><a href="#cb61-1091"></a><span class="in">Vmax_est_separate_2 &lt;- Vmax_est_separate[2]</span></span>
<span id="cb61-1092"><a href="#cb61-1092"></a><span class="in">Vmax_est_separate_3 &lt;- Vmax_est_separate[3]</span></span>
<span id="cb61-1093"><a href="#cb61-1093"></a><span class="in">Km_est_separate_1 &lt;- Km_est_separate[1]</span></span>
<span id="cb61-1094"><a href="#cb61-1094"></a><span class="in">Km_est_separate_2 &lt;- Km_est_separate[2]</span></span>
<span id="cb61-1095"><a href="#cb61-1095"></a><span class="in">Km_est_separate_3 &lt;- Km_est_separate[3]</span></span>
<span id="cb61-1096"><a href="#cb61-1096"></a></span>
<span id="cb61-1097"><a href="#cb61-1097"></a><span class="in"># Creating a sequence for smooth curve</span></span>
<span id="cb61-1098"><a href="#cb61-1098"></a><span class="in">conc_seq &lt;- seq(min(mf_data2$S), max(mf_data2$S), length.out = 100)</span></span>
<span id="cb61-1099"><a href="#cb61-1099"></a></span>
<span id="cb61-1100"><a href="#cb61-1100"></a><span class="in"># Predicting V values for shared and separate models</span></span>
<span id="cb61-1101"><a href="#cb61-1101"></a><span class="in">predicted_V &lt;- lapply(</span></span>
<span id="cb61-1102"><a href="#cb61-1102"></a><span class="in">  list(shared = list(Vmax = Vmax_est_shared, Km = Km_est_shared),</span></span>
<span id="cb61-1103"><a href="#cb61-1103"></a><span class="in">       trt1 = list(Vmax = Vmax_est_separate_1, Km = Km_est_separate_1),</span></span>
<span id="cb61-1104"><a href="#cb61-1104"></a><span class="in">       trt2 = list(Vmax = Vmax_est_separate_2, Km = Km_est_separate_2),</span></span>
<span id="cb61-1105"><a href="#cb61-1105"></a><span class="in">       trt3 = list(Vmax = Vmax_est_separate_3, Km = Km_est_separate_3)),</span></span>
<span id="cb61-1106"><a href="#cb61-1106"></a><span class="in">  function(params) {</span></span>
<span id="cb61-1107"><a href="#cb61-1107"></a><span class="in">    (params$Vmax * conc_seq) / (params$Km + conc_seq)</span></span>
<span id="cb61-1108"><a href="#cb61-1108"></a><span class="in">  }</span></span>
<span id="cb61-1109"><a href="#cb61-1109"></a><span class="in">)</span></span>
<span id="cb61-1110"><a href="#cb61-1110"></a></span>
<span id="cb61-1111"><a href="#cb61-1111"></a><span class="in"># Creating the dataframe</span></span>
<span id="cb61-1112"><a href="#cb61-1112"></a><span class="in">pred_df &lt;- data.frame(</span></span>
<span id="cb61-1113"><a href="#cb61-1113"></a><span class="in">  S = rep(conc_seq, 4),</span></span>
<span id="cb61-1114"><a href="#cb61-1114"></a><span class="in">  V = unlist(predicted_V),</span></span>
<span id="cb61-1115"><a href="#cb61-1115"></a><span class="in">  trt = rep(c("Global", "Treatment 1", "Treatment 2", "Treatment 3"),</span></span>
<span id="cb61-1116"><a href="#cb61-1116"></a><span class="in">            each = 100)</span></span>
<span id="cb61-1117"><a href="#cb61-1117"></a><span class="in">)</span></span>
<span id="cb61-1118"><a href="#cb61-1118"></a></span>
<span id="cb61-1119"><a href="#cb61-1119"></a><span class="in"># Plot the data and model fits</span></span>
<span id="cb61-1120"><a href="#cb61-1120"></a><span class="in">mf_data2 %&gt;%</span></span>
<span id="cb61-1121"><a href="#cb61-1121"></a><span class="in">  ggplot(aes(x = S, y = V, colour = trt)) +</span></span>
<span id="cb61-1122"><a href="#cb61-1122"></a><span class="in">  geom_jitter(shape = 1, width = 0.08) +</span></span>
<span id="cb61-1123"><a href="#cb61-1123"></a><span class="in">  geom_line(data = pred_df, aes(y = V, colour = trt, linewidth = trt)) +</span></span>
<span id="cb61-1124"><a href="#cb61-1124"></a><span class="in">  scale_colour_manual(values = c("#804145", "#51728E",</span></span>
<span id="cb61-1125"><a href="#cb61-1125"></a><span class="in">                                 "#5D995C", "#EE915C"),</span></span>
<span id="cb61-1126"><a href="#cb61-1126"></a><span class="in">                      name = NULL) +</span></span>
<span id="cb61-1127"><a href="#cb61-1127"></a><span class="in">  scale_linewidth_manual(values = c(1.0, 0.6, 0.6, 0.6)) +</span></span>
<span id="cb61-1128"><a href="#cb61-1128"></a><span class="in">  labs(x = "Substrate Concentration",</span></span>
<span id="cb61-1129"><a href="#cb61-1129"></a><span class="in">       y = "Reaction Velocity") +</span></span>
<span id="cb61-1130"><a href="#cb61-1130"></a><span class="in">  labs(x = TeX("S [$\\mu$M]"),</span></span>
<span id="cb61-1131"><a href="#cb61-1131"></a><span class="in">       y = TeX("V [$\\mu$M $g^{-1}_{dry}$ $h^{-1}$]")) +</span></span>
<span id="cb61-1132"><a href="#cb61-1132"></a><span class="in">  guides(linewidth = "none")</span></span>
<span id="cb61-1133"><a href="#cb61-1133"></a><span class="in">```</span></span>
<span id="cb61-1134"><a href="#cb61-1134"></a></span>
<span id="cb61-1135"><a href="#cb61-1135"></a><span class="fu">### The Perturbation Method (NLMM) {#sec-perturbation}</span></span>
<span id="cb61-1136"><a href="#cb61-1136"></a></span>
<span id="cb61-1139"><a href="#cb61-1139"></a><span class="in">```{r}</span></span>
<span id="cb61-1140"><a href="#cb61-1140"></a><span class="co">#| eval: TRUE</span></span>
<span id="cb61-1141"><a href="#cb61-1141"></a><span class="co">#| echo: FALSE</span></span>
<span id="cb61-1142"><a href="#cb61-1142"></a><span class="co">#| messages: false</span></span>
<span id="cb61-1143"><a href="#cb61-1143"></a><span class="co">#| warning: false</span></span>
<span id="cb61-1144"><a href="#cb61-1144"></a></span>
<span id="cb61-1145"><a href="#cb61-1145"></a>mm_data <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="st">"data/flow_rates.txt"</span>, <span class="at">sep =</span> <span class="st">""</span>)</span>
<span id="cb61-1146"><a href="#cb61-1146"></a></span>
<span id="cb61-1147"><a href="#cb61-1147"></a>mm_data <span class="ot">&lt;-</span> mm_data<span class="sc">|&gt;</span></span>
<span id="cb61-1148"><a href="#cb61-1148"></a>  <span class="fu">mutate</span>(<span class="at">flask =</span> <span class="fu">as.factor</span>(<span class="fu">rep</span>(<span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>), <span class="dv">44</span>)),</span>
<span id="cb61-1149"><a href="#cb61-1149"></a>         <span class="at">trt =</span> <span class="fu">as.factor</span>(trt))</span>
<span id="cb61-1150"><a href="#cb61-1150"></a><span class="in">```</span></span>
<span id="cb61-1151"><a href="#cb61-1151"></a></span>
<span id="cb61-1152"><a href="#cb61-1152"></a>The data for this example is by @smit2002nitrogen. A perturbation experiment was conducted to determine the nutrient uptake rate versus nutrient concentration of the red seaweed, \textit{Gracilaria} sp. The experiment involved flasks, initially enriched to approximately 55 Î¼M nitrate, sampled 16 times over approximately 2.5 hours. The uptake rates were measured under three rates of water movement (treatments): low, medium, and high. Each treatment had three replicate flasks (@tbl-mm1). The primary objective was to determine if the Michaelis-Menten parameters significantly differ among the three levels of water movement, and we must state a hypothesis similar to those in @sec-mm-comparison.</span>
<span id="cb61-1153"><a href="#cb61-1153"></a></span>
<span id="cb61-1156"><a href="#cb61-1156"></a><span class="in">```{r}</span></span>
<span id="cb61-1157"><a href="#cb61-1157"></a><span class="co">#| echo: false</span></span>
<span id="cb61-1158"><a href="#cb61-1158"></a><span class="co">#| messages: false</span></span>
<span id="cb61-1159"><a href="#cb61-1159"></a><span class="co">#| warning: false</span></span>
<span id="cb61-1160"><a href="#cb61-1160"></a><span class="co">#| tbl-cap: "Simulated data for a multiple flask experiment on an alga (showing only the top and bottom three rows)."</span></span>
<span id="cb61-1161"><a href="#cb61-1161"></a><span class="co">#| label: tbl-mm1</span></span>
<span id="cb61-1162"><a href="#cb61-1162"></a></span>
<span id="cb61-1163"><a href="#cb61-1163"></a>mm_data <span class="sc">|&gt;</span> </span>
<span id="cb61-1164"><a href="#cb61-1164"></a>  <span class="fu">filter</span>(<span class="fu">row_number</span>() <span class="sc">&lt;=</span> <span class="dv">3</span> <span class="sc">|</span> <span class="fu">row_number</span>() <span class="sc">&gt;</span> <span class="fu">n</span>() <span class="sc">-</span> <span class="dv">3</span>) <span class="sc">|&gt;</span> </span>
<span id="cb61-1165"><a href="#cb61-1165"></a>  <span class="fu">gt</span>() <span class="sc">|&gt;</span> </span>
<span id="cb61-1166"><a href="#cb61-1166"></a>  <span class="fu">cols_align</span>(</span>
<span id="cb61-1167"><a href="#cb61-1167"></a>    <span class="at">align =</span> <span class="st">"center"</span>,</span>
<span id="cb61-1168"><a href="#cb61-1168"></a>    <span class="at">columns =</span> <span class="fu">c</span>(<span class="st">"flask"</span>, <span class="st">"trt"</span>)) <span class="sc">|&gt;</span> </span>
<span id="cb61-1169"><a href="#cb61-1169"></a>  <span class="fu">cols_label</span>(<span class="at">flask =</span> <span class="fu">html</span>(<span class="st">"Replicate flask"</span>),</span>
<span id="cb61-1170"><a href="#cb61-1170"></a>             <span class="at">trt =</span> <span class="fu">html</span>(<span class="st">"Treatment"</span>),</span>
<span id="cb61-1171"><a href="#cb61-1171"></a>             <span class="at">V =</span> <span class="fu">html</span>(<span class="st">"V"</span>),</span>
<span id="cb61-1172"><a href="#cb61-1172"></a>             <span class="at">S =</span> <span class="fu">html</span>(<span class="st">"[S]"</span>))</span>
<span id="cb61-1173"><a href="#cb61-1173"></a><span class="in">```</span></span>
<span id="cb61-1174"><a href="#cb61-1174"></a></span>
<span id="cb61-1175"><a href="#cb61-1175"></a>For the reasons discussed in @sec-ex1, we will use a nonlinear mixed effects model, <span class="in">`nlme()`</span>, to analyse these data. Models such as these can be quite challenging to fit. There are several things we have to deal with. First and most obviously is the fact that the data are repeated measures, and the residuals may be correlated. Second, the flasks are nested within the treatment levels, and we need to account for this in the model. Finally, we need to account for the possibility that the Michaelis-Menten parameters may vary among the treatment levels---in fact, we want to test this! Here is the model:</span>
<span id="cb61-1176"><a href="#cb61-1176"></a></span>
<span id="cb61-1179"><a href="#cb61-1179"></a><span class="in">```{r}</span></span>
<span id="cb61-1180"><a href="#cb61-1180"></a><span class="co">#| echo: true</span></span>
<span id="cb61-1181"><a href="#cb61-1181"></a><span class="co">#| messages: false</span></span>
<span id="cb61-1182"><a href="#cb61-1182"></a><span class="co">#| warning: false</span></span>
<span id="cb61-1183"><a href="#cb61-1183"></a></span>
<span id="cb61-1184"><a href="#cb61-1184"></a><span class="co"># Determine the number of levels in the factor 'trt'</span></span>
<span id="cb61-1185"><a href="#cb61-1185"></a>num_levels <span class="ot">&lt;-</span> <span class="fu">length</span>(<span class="fu">levels</span>(mm_data<span class="sc">$</span>trt))</span>
<span id="cb61-1186"><a href="#cb61-1186"></a></span>
<span id="cb61-1187"><a href="#cb61-1187"></a><span class="co"># Starting values for the fixed parameters</span></span>
<span id="cb61-1188"><a href="#cb61-1188"></a><span class="co"># (one set for each level of 'trt')</span></span>
<span id="cb61-1189"><a href="#cb61-1189"></a>start_vals <span class="ot">&lt;-</span> <span class="fu">list</span>(<span class="at">fixed =</span> <span class="fu">c</span>(<span class="at">Vmax =</span> <span class="fu">rep</span>(<span class="fu">max</span>(mm_data<span class="sc">$</span>V), num_levels),</span>
<span id="cb61-1190"><a href="#cb61-1190"></a>                             <span class="at">Km =</span> <span class="fu">rep</span>(<span class="fu">median</span>(mm_data<span class="sc">$</span>S), num_levels)))</span>
<span id="cb61-1191"><a href="#cb61-1191"></a></span>
<span id="cb61-1192"><a href="#cb61-1192"></a>nlme_mod2 <span class="ot">&lt;-</span> <span class="fu">nlme</span>(V <span class="sc">~</span> <span class="fu">mm_fun</span>(S, Vmax, Km),</span>
<span id="cb61-1193"><a href="#cb61-1193"></a>                  <span class="at">data =</span> mm_data,</span>
<span id="cb61-1194"><a href="#cb61-1194"></a>                  <span class="at">fixed =</span> Vmax <span class="sc">+</span> Km <span class="sc">~</span> trt, <span class="co"># &lt;1&gt;</span></span>
<span id="cb61-1195"><a href="#cb61-1195"></a>                  <span class="at">random =</span> Vmax <span class="sc">+</span> Km <span class="sc">~</span> <span class="dv">1</span> <span class="sc">|</span> flask, <span class="co"># &lt;2&gt;</span></span>
<span id="cb61-1196"><a href="#cb61-1196"></a>                  <span class="at">start =</span> start_vals,</span>
<span id="cb61-1197"><a href="#cb61-1197"></a>                  <span class="at">method =</span> <span class="st">"REML"</span>)</span>
<span id="cb61-1198"><a href="#cb61-1198"></a><span class="in">```</span></span>
<span id="cb61-1199"><a href="#cb61-1199"></a></span>
<span id="cb61-1200"><a href="#cb61-1200"></a><span class="ss">1. </span>The <span class="in">`fixed`</span> argument specifies that the Michaelis-Menten parameters <span class="in">`Vmax`</span> and <span class="in">`Km`</span> are fixed effects that vary among the treatment levels, and a grouping variable (<span class="in">`trt`</span>) is used to specify the levels of the treatment factor.</span>
<span id="cb61-1201"><a href="#cb61-1201"></a><span class="ss">2. </span>The <span class="in">`random`</span> argument specifies that the Michaelis-Menten parameters <span class="in">`Vmax`</span> and <span class="in">`Km`</span> are random effects that vary among the replicate flasks.</span>
<span id="cb61-1202"><a href="#cb61-1202"></a></span>
<span id="cb61-1203"><a href="#cb61-1203"></a>This model brings us closer to our goal, but there are some notable omissions. The specification allows the Michaelis-Menten parameters to vary among the treatment levels, which is central to our hypothesis. We have also accounted for the replication structure of the data, recognising that random variations may arise not due to the treatment levels but due to the replicate flasks. </span>
<span id="cb61-1204"><a href="#cb61-1204"></a></span>
<span id="cb61-1205"><a href="#cb61-1205"></a>However, we have not accounted for the central feature of a perturbation experiment, which is the correlation structure of the residuals. We must deal with the fact that the residuals may be correlated due to the repeated measures nature of the data. Additionally, we have omitted the nesting of the flasks within the treatment levels. </span>
<span id="cb61-1206"><a href="#cb61-1206"></a></span>
<span id="cb61-1207"><a href="#cb61-1207"></a>Let's update our model accordingly:</span>
<span id="cb61-1208"><a href="#cb61-1208"></a></span>
<span id="cb61-1211"><a href="#cb61-1211"></a><span class="in">```{r}</span></span>
<span id="cb61-1212"><a href="#cb61-1212"></a><span class="co">#| echo: true</span></span>
<span id="cb61-1213"><a href="#cb61-1213"></a><span class="co">#| messages: false</span></span>
<span id="cb61-1214"><a href="#cb61-1214"></a><span class="co">#| warning: false</span></span>
<span id="cb61-1215"><a href="#cb61-1215"></a></span>
<span id="cb61-1216"><a href="#cb61-1216"></a>nlme_mod3 <span class="ot">&lt;-</span> <span class="fu">nlme</span>(V <span class="sc">~</span> <span class="fu">mm_fun</span>(S, Vmax, Km),</span>
<span id="cb61-1217"><a href="#cb61-1217"></a>                  <span class="at">data =</span> mm_data,</span>
<span id="cb61-1218"><a href="#cb61-1218"></a>                  <span class="at">fixed =</span> <span class="fu">list</span>(Vmax <span class="sc">~</span> trt, Km <span class="sc">~</span> trt),</span>
<span id="cb61-1219"><a href="#cb61-1219"></a>                  <span class="at">random =</span> Vmax <span class="sc">~</span> <span class="dv">1</span> <span class="sc">|</span> trt<span class="sc">/</span>flask, <span class="co"># &lt;1&gt;</span></span>
<span id="cb61-1220"><a href="#cb61-1220"></a>                  <span class="at">groups =</span> <span class="sc">~</span> trt<span class="sc">/</span>flask, <span class="co"># &lt;2&gt;</span></span>
<span id="cb61-1221"><a href="#cb61-1221"></a>                  <span class="at">correlation =</span> <span class="fu">corAR1</span>(<span class="at">form =</span> <span class="sc">~</span> <span class="dv">1</span> <span class="sc">|</span> trt<span class="sc">/</span>flask), <span class="co"># &lt;3&gt;</span></span>
<span id="cb61-1222"><a href="#cb61-1222"></a>                  <span class="at">start =</span> start_vals,</span>
<span id="cb61-1223"><a href="#cb61-1223"></a>                  <span class="at">method =</span> <span class="st">"REML"</span>)</span>
<span id="cb61-1224"><a href="#cb61-1224"></a><span class="in">```</span></span>
<span id="cb61-1225"><a href="#cb61-1225"></a><span class="ss">1. </span>The <span class="in">`random`</span> argument specifies that the Michaelis-Menten parameter <span class="in">`Vmax`</span> is a random effect that varies among the replicate flasks nested within the treatment levels.</span>
<span id="cb61-1226"><a href="#cb61-1226"></a><span class="ss">2. </span>The <span class="in">`groups`</span> argument specifies that the replicate flasks are nested within the treatment levels.</span>
<span id="cb61-1227"><a href="#cb61-1227"></a><span class="ss">3. </span>The <span class="in">`correlation`</span> argument specifies that the residuals have a first-order autoregressive correlation structure. This structure assumes that the correlation between residuals decreases exponentially with the time lag between observations.</span>
<span id="cb61-1228"><a href="#cb61-1228"></a></span>
<span id="cb61-1229"><a href="#cb61-1229"></a>If we are not convinced that <span class="in">`nlme_mod3`</span> is the best model, we can compare it to <span class="in">`nlme_mod2`</span> using a likelihood ratio test. It is used to compare the fit of two models, where one model is a special case of the other. The test statistic is the difference in the log-likelihoods of the two models, and the null hypothesis is that the simpler model is the best fit. </span>
<span id="cb61-1230"><a href="#cb61-1230"></a></span>
<span id="cb61-1233"><a href="#cb61-1233"></a><span class="in">```{r}</span></span>
<span id="cb61-1234"><a href="#cb61-1234"></a><span class="co">#| echo: true</span></span>
<span id="cb61-1235"><a href="#cb61-1235"></a><span class="co">#| messages: false</span></span>
<span id="cb61-1236"><a href="#cb61-1236"></a><span class="co">#| warning: false</span></span>
<span id="cb61-1237"><a href="#cb61-1237"></a><span class="co">#| eval: true</span></span>
<span id="cb61-1238"><a href="#cb61-1238"></a></span>
<span id="cb61-1239"><a href="#cb61-1239"></a><span class="fu">anova</span>(nlme_mod2, nlme_mod3)</span>
<span id="cb61-1240"><a href="#cb61-1240"></a></span>
<span id="cb61-1241"><a href="#cb61-1241"></a><span class="co"># Likelihood ratio test</span></span>
<span id="cb61-1242"><a href="#cb61-1242"></a>lrt_stat <span class="ot">&lt;-</span> <span class="sc">-</span><span class="dv">2</span> <span class="sc">*</span> (<span class="fu">logLik</span>(nlme_mod2) <span class="sc">-</span> <span class="fu">logLik</span>(nlme_mod3))</span>
<span id="cb61-1243"><a href="#cb61-1243"></a></span>
<span id="cb61-1244"><a href="#cb61-1244"></a><span class="co"># Determine degrees of freedom and p-value</span></span>
<span id="cb61-1245"><a href="#cb61-1245"></a>df_diff <span class="ot">&lt;-</span> <span class="fu">attr</span>(<span class="fu">logLik</span>(nlme_mod3), <span class="st">"df"</span>) <span class="sc">-</span> <span class="fu">attr</span>(<span class="fu">logLik</span>(nlme_mod2), <span class="st">"df"</span>) </span>
<span id="cb61-1246"><a href="#cb61-1246"></a>p_value <span class="ot">&lt;-</span> <span class="fu">pchisq</span>(lrt_stat, <span class="at">df =</span> df_diff, <span class="at">lower.tail =</span> <span class="cn">FALSE</span>) </span>
<span id="cb61-1247"><a href="#cb61-1247"></a></span>
<span id="cb61-1248"><a href="#cb61-1248"></a><span class="fu">print</span>(<span class="fu">paste</span>(<span class="st">"LRT statistic:"</span>, lrt_stat))</span>
<span id="cb61-1249"><a href="#cb61-1249"></a><span class="fu">print</span>(<span class="fu">paste</span>(<span class="st">"Degrees of freedom:"</span>, df_diff))</span>
<span id="cb61-1250"><a href="#cb61-1250"></a><span class="fu">print</span>(<span class="fu">paste</span>(<span class="st">"P-value:"</span>, p_value))</span>
<span id="cb61-1251"><a href="#cb61-1251"></a><span class="in">```</span></span>
<span id="cb61-1252"><a href="#cb61-1252"></a></span>
<span id="cb61-1253"><a href="#cb61-1253"></a>The likelihood ratio test indicates that <span class="in">`nlme_mod3`</span> is a better fit than <span class="in">`nlme_mod2`</span> (p &lt; 0.001). This result suggests that the Michaelis-Menten parameters vary among the treatment levels, and the residuals have a first-order autoregressive correlation structure.</span>
<span id="cb61-1254"><a href="#cb61-1254"></a></span>
<span id="cb61-1257"><a href="#cb61-1257"></a><span class="in">```{r}</span></span>
<span id="cb61-1258"><a href="#cb61-1258"></a><span class="fu">summary</span>(nlme_mod3)</span>
<span id="cb61-1259"><a href="#cb61-1259"></a><span class="in">```</span></span>
<span id="cb61-1260"><a href="#cb61-1260"></a></span>
<span id="cb61-1261"><a href="#cb61-1261"></a></span>
<span id="cb61-1262"><a href="#cb61-1262"></a><span class="fu">## Example: The Growth Rate of Fish (NLMM) {#sec-vonbertalanffy}</span></span>
<span id="cb61-1263"><a href="#cb61-1263"></a></span>
<span id="cb61-1264"><a href="#cb61-1264"></a>The von Bertalanffy model (@eq-vb) is used to describe the growth patterns of animals over time. For example, in a fish growth study, we measure the length of individual fish at regular intervals as the fish age. By fitting the von Bertalanffy model to these length-at-age data, we can estimate growth parameters specific to the fish species. </span>
<span id="cb61-1265"><a href="#cb61-1265"></a></span>
<span id="cb61-1266"><a href="#cb61-1266"></a>The model is given by:</span>
<span id="cb61-1267"><a href="#cb61-1267"></a></span>
<span id="cb61-1268"><a href="#cb61-1268"></a>$$L(t) = L_{\infty} \left(1 - e^{-k(t-t_0)}\right)$$ {#eq-vb}</span>
<span id="cb61-1269"><a href="#cb61-1269"></a></span>
<span id="cb61-1270"><a href="#cb61-1270"></a>Where:</span>
<span id="cb61-1271"><a href="#cb61-1271"></a></span>
<span id="cb61-1272"><a href="#cb61-1272"></a><span class="ss">- </span>$L(t)$ is the length of the fish at time $t$.</span>
<span id="cb61-1273"><a href="#cb61-1273"></a><span class="ss">- </span>$L_{\infty}$ is the asymptotic length, representing the theoretical maximum length that the individual would reach if it grew indefinitely.</span>
<span id="cb61-1274"><a href="#cb61-1274"></a><span class="ss">- </span>$k$ is the growth coefficient, indicating the rate at which the growth of the fish approaches its maximum size. A higher $k$ value means it reaches its asymptotic length more quickly.</span>
<span id="cb61-1275"><a href="#cb61-1275"></a><span class="ss">- </span>$t_0$ is the hypothetical age at which the individual's length would be zero according to the model.</span>
<span id="cb61-1276"><a href="#cb61-1276"></a></span>
<span id="cb61-1277"><a href="#cb61-1277"></a>$L_{\infty}$ (the asymptotic length) represents the length towards which the individual grows as time ($t$) approaches infinity. The concept behind $L_{\infty}$ is that as the fish ages, its growth rate slows down and eventually approaches zero, with its length nearing the asymptotic value $L_{\infty}$. $k$ (the growth rate coefficient) determines how quickly the fish reaches its asymptotic length. Physiologically, $k$ reflects the metabolic rates and general fitness of the fish, while ecologically, it can be influenced by environmental factors such as food availability and temperature. Lastly, $t_0$ (the theoretical age at zero length) is not directly observable in practice but provides a useful way to shift the growth curve along the time axis to provide a better fit to the data, especially in the early developmental stages.</span>
<span id="cb61-1278"><a href="#cb61-1278"></a></span>
<span id="cb61-1279"><a href="#cb61-1279"></a>Consider a study where the lengths of 30 Atlantic Cod, *Gadus morua*, in captivity are measured twice a year from hatching to 15 years. This creates a longitudinal dataset with repeated length measurements for each fish over time. In this experiment, we will focus on the growth patterns of individual fish, assuming they were raised under identical conditions. This allows us to attribute any growth differences to inherent biological variation among the fish. Apart from the repeated measures on individual fish, we will assume that the data are independent in all other respects.</span>
<span id="cb61-1280"><a href="#cb61-1280"></a></span>
<span id="cb61-1281"><a href="#cb61-1281"></a>The longitudinal nature of the data requires that we use appropriate statistical methods that account for the correlation among the repeated measures. We will use a nonlinear mixed-effects regression for the data in Table 1. </span>
<span id="cb61-1282"><a href="#cb61-1282"></a></span>
<span id="cb61-1285"><a href="#cb61-1285"></a><span class="in">```{r}</span></span>
<span id="cb61-1286"><a href="#cb61-1286"></a><span class="co">#| echo: false</span></span>
<span id="cb61-1287"><a href="#cb61-1287"></a><span class="co">#| messages: true</span></span>
<span id="cb61-1288"><a href="#cb61-1288"></a><span class="co">#| warning: true</span></span>
<span id="cb61-1289"><a href="#cb61-1289"></a></span>
<span id="cb61-1290"><a href="#cb61-1290"></a><span class="co"># Set up parameters for the von Bertalanffy growth model</span></span>
<span id="cb61-1291"><a href="#cb61-1291"></a><span class="fu">set.seed</span>(<span class="dv">13</span>)</span>
<span id="cb61-1292"><a href="#cb61-1292"></a></span>
<span id="cb61-1293"><a href="#cb61-1293"></a><span class="co"># Define parameters</span></span>
<span id="cb61-1294"><a href="#cb61-1294"></a>n_fish <span class="ot">&lt;-</span> <span class="dv">30</span></span>
<span id="cb61-1295"><a href="#cb61-1295"></a>n_years <span class="ot">&lt;-</span> <span class="dv">15</span></span>
<span id="cb61-1296"><a href="#cb61-1296"></a>n_measurements_per_year <span class="ot">&lt;-</span> <span class="dv">2</span></span>
<span id="cb61-1297"><a href="#cb61-1297"></a>total_measurements <span class="ot">&lt;-</span> n_years <span class="sc">*</span> n_measurements_per_year</span>
<span id="cb61-1298"><a href="#cb61-1298"></a>ages <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="dv">0</span>, n_years, <span class="at">by =</span> <span class="dv">1</span><span class="sc">/</span>n_measurements_per_year)</span>
<span id="cb61-1299"><a href="#cb61-1299"></a></span>
<span id="cb61-1300"><a href="#cb61-1300"></a><span class="co"># Initial lengths at hatching (small variation)</span></span>
<span id="cb61-1301"><a href="#cb61-1301"></a>initial_lengths <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(n_fish, <span class="at">mean =</span> <span class="dv">5</span>, <span class="at">sd =</span> <span class="fl">0.5</span>)</span>
<span id="cb61-1302"><a href="#cb61-1302"></a></span>
<span id="cb61-1303"><a href="#cb61-1303"></a><span class="co"># von Bertalanffy growth parameters</span></span>
<span id="cb61-1304"><a href="#cb61-1304"></a>L_inf <span class="ot">&lt;-</span> <span class="dv">120</span>  <span class="co"># Asymptotic length</span></span>
<span id="cb61-1305"><a href="#cb61-1305"></a>L_inf_sd <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb61-1306"><a href="#cb61-1306"></a>k_mean <span class="ot">&lt;-</span> <span class="fl">0.2</span></span>
<span id="cb61-1307"><a href="#cb61-1307"></a>k_sd <span class="ot">&lt;-</span> <span class="fl">0.01</span></span>
<span id="cb61-1308"><a href="#cb61-1308"></a></span>
<span id="cb61-1309"><a href="#cb61-1309"></a><span class="co"># Generate growth curves for each fish</span></span>
<span id="cb61-1310"><a href="#cb61-1310"></a>vb_data <span class="ot">&lt;-</span> <span class="fu">data.frame</span>()</span>
<span id="cb61-1311"><a href="#cb61-1311"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>n_fish) {</span>
<span id="cb61-1312"><a href="#cb61-1312"></a>  k <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(<span class="dv">1</span>, <span class="at">mean =</span> k_mean, <span class="at">sd =</span> k_sd)</span>
<span id="cb61-1313"><a href="#cb61-1313"></a>  L_inf <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(<span class="dv">1</span>, <span class="at">mean =</span> L_inf, <span class="at">sd =</span> L_inf_sd)</span>
<span id="cb61-1314"><a href="#cb61-1314"></a>  length_at_age <span class="ot">&lt;-</span> L_inf <span class="sc">*</span> (<span class="dv">1</span> <span class="sc">-</span> <span class="fu">exp</span>(<span class="sc">-</span>k <span class="sc">*</span> ages))</span>
<span id="cb61-1315"><a href="#cb61-1315"></a>  length_at_age <span class="ot">&lt;-</span> initial_lengths[i] <span class="sc">+</span> (length_at_age <span class="sc">-</span> <span class="fu">min</span>(length_at_age))</span>
<span id="cb61-1316"><a href="#cb61-1316"></a>  </span>
<span id="cb61-1317"><a href="#cb61-1317"></a>  fish_data <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb61-1318"><a href="#cb61-1318"></a>    <span class="at">Fish_ID =</span> <span class="fu">as.factor</span>(<span class="fu">rep</span>(i, <span class="fu">length</span>(ages))),</span>
<span id="cb61-1319"><a href="#cb61-1319"></a>    <span class="at">Age =</span> ages,</span>
<span id="cb61-1320"><a href="#cb61-1320"></a>    <span class="at">Length =</span> <span class="fu">round</span>(length_at_age, <span class="dv">1</span>)</span>
<span id="cb61-1321"><a href="#cb61-1321"></a>  )</span>
<span id="cb61-1322"><a href="#cb61-1322"></a>  </span>
<span id="cb61-1323"><a href="#cb61-1323"></a>  vb_data <span class="ot">&lt;-</span> <span class="fu">bind_rows</span>(vb_data, fish_data)</span>
<span id="cb61-1324"><a href="#cb61-1324"></a>}</span>
<span id="cb61-1325"><a href="#cb61-1325"></a><span class="in">```</span></span>
<span id="cb61-1326"><a href="#cb61-1326"></a></span>
<span id="cb61-1329"><a href="#cb61-1329"></a><span class="in">```{r}</span></span>
<span id="cb61-1330"><a href="#cb61-1330"></a><span class="co">#| echo: false</span></span>
<span id="cb61-1331"><a href="#cb61-1331"></a><span class="co">#| messages: false</span></span>
<span id="cb61-1332"><a href="#cb61-1332"></a><span class="co">#| warning: false</span></span>
<span id="cb61-1333"><a href="#cb61-1333"></a><span class="co">#| tbl-cap: "The Atlantic Cod data set with 30 fish and 15 years of growth data (showing only the top and bottom three rows)."</span></span>
<span id="cb61-1334"><a href="#cb61-1334"></a></span>
<span id="cb61-1335"><a href="#cb61-1335"></a>vb_data <span class="sc">|&gt;</span> </span>
<span id="cb61-1336"><a href="#cb61-1336"></a>  <span class="fu">filter</span>(<span class="fu">row_number</span>() <span class="sc">&lt;=</span> <span class="dv">3</span> <span class="sc">|</span> <span class="fu">row_number</span>() <span class="sc">&gt;</span> <span class="fu">n</span>() <span class="sc">-</span> <span class="dv">3</span>) <span class="sc">|&gt;</span> </span>
<span id="cb61-1337"><a href="#cb61-1337"></a>  <span class="fu">gt</span>() <span class="sc">|&gt;</span> </span>
<span id="cb61-1338"><a href="#cb61-1338"></a>    <span class="fu">cols_align</span>(</span>
<span id="cb61-1339"><a href="#cb61-1339"></a>    <span class="at">align =</span> <span class="st">"center"</span>,</span>
<span id="cb61-1340"><a href="#cb61-1340"></a>    <span class="at">columns =</span> <span class="fu">c</span>(<span class="st">"Age"</span>, <span class="st">"Length"</span>)) <span class="sc">|&gt;</span> </span>
<span id="cb61-1341"><a href="#cb61-1341"></a>  <span class="fu">cols_label</span>(</span>
<span id="cb61-1342"><a href="#cb61-1342"></a>    <span class="at">Fish_ID =</span> <span class="fu">html</span>(<span class="st">"Fish ID"</span>),</span>
<span id="cb61-1343"><a href="#cb61-1343"></a>    <span class="at">Age =</span> <span class="fu">html</span>(<span class="st">"Age (yr)"</span>),</span>
<span id="cb61-1344"><a href="#cb61-1344"></a>    <span class="at">Length =</span> <span class="fu">html</span>(<span class="st">"Length (cm)"</span>)</span>
<span id="cb61-1345"><a href="#cb61-1345"></a>  )</span>
<span id="cb61-1346"><a href="#cb61-1346"></a><span class="in">```</span></span>
<span id="cb61-1347"><a href="#cb61-1347"></a></span>
<span id="cb61-1348"><a href="#cb61-1348"></a>A plot of the data is shown in @fig-vb1; here, each line represents the growth trajectory of an individual fish over time.</span>
<span id="cb61-1349"><a href="#cb61-1349"></a></span>
<span id="cb61-1350"><a href="#cb61-1350"></a><span class="in">```{r, fig.width=c(6,5),fig.asp=0.65,out.width=c("80%","12cm")}</span></span>
<span id="cb61-1351"><a href="#cb61-1351"></a><span class="in">#| echo: false</span></span>
<span id="cb61-1352"><a href="#cb61-1352"></a><span class="in">#| messages: false</span></span>
<span id="cb61-1353"><a href="#cb61-1353"></a><span class="in">#| warning: false</span></span>
<span id="cb61-1354"><a href="#cb61-1354"></a><span class="in">#| fig.cap: "Plot of growth data measured in 30 Atlantic cod, *Gadus morua*."</span></span>
<span id="cb61-1355"><a href="#cb61-1355"></a><span class="in">#| label: fig-vb1</span></span>
<span id="cb61-1356"><a href="#cb61-1356"></a><span class="in">#| fig.align: center</span></span>
<span id="cb61-1357"><a href="#cb61-1357"></a></span>
<span id="cb61-1358"><a href="#cb61-1358"></a><span class="in"># Plot the simulated data</span></span>
<span id="cb61-1359"><a href="#cb61-1359"></a><span class="in">ggplot(vb_data, aes(x = Age, y = Length, group = Fish_ID)) +</span></span>
<span id="cb61-1360"><a href="#cb61-1360"></a><span class="in">  geom_jitter(alpha = 0.6, size = 2, shape = 1,</span></span>
<span id="cb61-1361"><a href="#cb61-1361"></a><span class="in">              colour = "royalblue2", width = 0.08) +</span></span>
<span id="cb61-1362"><a href="#cb61-1362"></a><span class="in">  geom_line(alpha = 0.2, linesize = 0.2, colour = "grey50") +</span></span>
<span id="cb61-1363"><a href="#cb61-1363"></a><span class="in">  labs(x = "Age (years)",</span></span>
<span id="cb61-1364"><a href="#cb61-1364"></a><span class="in">       y = "Length (cm)")</span></span>
<span id="cb61-1365"><a href="#cb61-1365"></a><span class="in">  theme(legend.position = "none")</span></span>
<span id="cb61-1366"><a href="#cb61-1366"></a><span class="in">```</span></span>
<span id="cb61-1367"><a href="#cb61-1367"></a></span>
<span id="cb61-1368"><a href="#cb61-1368"></a>We will fit the von Bertalanffy growth model to the data using <span class="in">`nlme::nlme()`</span> as follows, and the output is provided: </span>
<span id="cb61-1369"><a href="#cb61-1369"></a></span>
<span id="cb61-1372"><a href="#cb61-1372"></a><span class="in">```{r}</span></span>
<span id="cb61-1373"><a href="#cb61-1373"></a><span class="co">#| messages: false</span></span>
<span id="cb61-1374"><a href="#cb61-1374"></a><span class="co">#| warning: false</span></span>
<span id="cb61-1375"><a href="#cb61-1375"></a></span>
<span id="cb61-1376"><a href="#cb61-1376"></a><span class="co"># von Bertalanffy growth function</span></span>
<span id="cb61-1377"><a href="#cb61-1377"></a>vb_growth <span class="ot">&lt;-</span> <span class="cf">function</span>(age, L_inf, k, t0) {</span>
<span id="cb61-1378"><a href="#cb61-1378"></a>  L_inf <span class="sc">*</span> (<span class="dv">1</span> <span class="sc">-</span> <span class="fu">exp</span>(<span class="sc">-</span>k <span class="sc">*</span> (age <span class="sc">-</span> t0)))</span>
<span id="cb61-1379"><a href="#cb61-1379"></a>}</span>
<span id="cb61-1380"><a href="#cb61-1380"></a></span>
<span id="cb61-1381"><a href="#cb61-1381"></a><span class="co"># Define the nonlinear mixed-effects model</span></span>
<span id="cb61-1382"><a href="#cb61-1382"></a>nlme_model <span class="ot">&lt;-</span> <span class="fu">nlme</span>(Length <span class="sc">~</span> <span class="fu">vb_growth</span>(Age, L_inf, k, t0),</span>
<span id="cb61-1383"><a href="#cb61-1383"></a>                   <span class="at">data =</span> vb_data,</span>
<span id="cb61-1384"><a href="#cb61-1384"></a>                   <span class="at">fixed =</span> L_inf <span class="sc">+</span> k <span class="sc">+</span> t0 <span class="sc">~</span> <span class="dv">1</span>, <span class="co"># &lt;1&gt;</span></span>
<span id="cb61-1385"><a href="#cb61-1385"></a>                   <span class="at">random =</span> L_inf <span class="sc">+</span> k <span class="sc">~</span> <span class="dv">1</span> <span class="sc">|</span> Fish_ID, <span class="co"># &lt;2&gt;</span></span>
<span id="cb61-1386"><a href="#cb61-1386"></a>                   <span class="at">groups =</span> <span class="sc">~</span> Fish_ID, <span class="co"># &lt;3&gt;</span></span>
<span id="cb61-1387"><a href="#cb61-1387"></a>                   <span class="at">correlation =</span> <span class="fu">corAR1</span>(<span class="at">form =</span> <span class="sc">~</span> <span class="dv">1</span>), <span class="co"># &lt;4&gt;</span></span>
<span id="cb61-1388"><a href="#cb61-1388"></a>                   <span class="at">start =</span> <span class="fu">c</span>(<span class="at">L_inf =</span> <span class="dv">100</span>, <span class="at">k =</span> <span class="fl">0.2</span>, <span class="at">t0 =</span> <span class="sc">-</span><span class="fl">0.5</span>))</span>
<span id="cb61-1389"><a href="#cb61-1389"></a></span>
<span id="cb61-1390"><a href="#cb61-1390"></a><span class="co"># Print the summary of the model</span></span>
<span id="cb61-1391"><a href="#cb61-1391"></a><span class="fu">summary</span>(nlme_model)</span>
<span id="cb61-1392"><a href="#cb61-1392"></a><span class="in">```</span></span>
<span id="cb61-1393"><a href="#cb61-1393"></a><span class="ss">1. </span>The fixed effects are the parameters of the von Bertalanffy growth model which are invariant among fish.</span>
<span id="cb61-1394"><a href="#cb61-1394"></a><span class="ss">2. </span>The random effects are the asymptotic length and growth rate to account for the intrinsic differences among fish.</span>
<span id="cb61-1395"><a href="#cb61-1395"></a><span class="ss">3. </span>The grouping variable is the fish ID.</span>
<span id="cb61-1396"><a href="#cb61-1396"></a><span class="ss">4. </span>The correlation structure is autoregressive of order 1 to account for the correlation among repeated measures within the same fish, the <span class="in">`~ 1`</span> indicates that the order of the observations in the data must be used along which measurements are serially correlated, and since no grouping variable is provided, all fish will have the same correlation structure.</span>
<span id="cb61-1397"><a href="#cb61-1397"></a></span>
<span id="cb61-1398"><a href="#cb61-1398"></a></span>
<span id="cb61-1399"><a href="#cb61-1399"></a><span class="in">```{r, fig.width=c(6,5),fig.asp=0.65,out.width=c("80%","12cm")}</span></span>
<span id="cb61-1400"><a href="#cb61-1400"></a><span class="in">#| echo: false</span></span>
<span id="cb61-1401"><a href="#cb61-1401"></a><span class="in">#| messages: false</span></span>
<span id="cb61-1402"><a href="#cb61-1402"></a><span class="in">#| warning: false</span></span>
<span id="cb61-1403"><a href="#cb61-1403"></a><span class="in">#| fig.cap: "Fit of the von Bertalanffy model to experimental data obtained from 30 Atlantic Cod individuals."</span></span>
<span id="cb61-1404"><a href="#cb61-1404"></a><span class="in">#| label: fig-vb2</span></span>
<span id="cb61-1405"><a href="#cb61-1405"></a><span class="in">#| fig.align: center</span></span>
<span id="cb61-1406"><a href="#cb61-1406"></a></span>
<span id="cb61-1407"><a href="#cb61-1407"></a><span class="in"># Extract fixed effect coefficients</span></span>
<span id="cb61-1408"><a href="#cb61-1408"></a><span class="in">coef_fixed &lt;- fixed.effects(nlme_model)</span></span>
<span id="cb61-1409"><a href="#cb61-1409"></a></span>
<span id="cb61-1410"><a href="#cb61-1410"></a><span class="in"># Generate fitted values for the plot</span></span>
<span id="cb61-1411"><a href="#cb61-1411"></a><span class="in">vb_data$Fitted_Length &lt;- vb_growth(vb_data$Age, coef_fixed["L_inf"], coef_fixed["k"], coef_fixed["t0"])</span></span>
<span id="cb61-1412"><a href="#cb61-1412"></a></span>
<span id="cb61-1413"><a href="#cb61-1413"></a><span class="in"># Create the plot</span></span>
<span id="cb61-1414"><a href="#cb61-1414"></a><span class="in">ggplot(vb_data, aes(x = Age, y = Length, group = Fish_ID)) +</span></span>
<span id="cb61-1415"><a href="#cb61-1415"></a><span class="in">  geom_jitter(size = 2, shape = 1, colour = "royalblue2", alpha = 0.4, width = 0.08) +</span></span>
<span id="cb61-1416"><a href="#cb61-1416"></a><span class="in">  geom_line(aes(y = Fitted_Length), colour = "indianred2", linewidth = 0.8) +</span></span>
<span id="cb61-1417"><a href="#cb61-1417"></a><span class="in">  labs(x = "Age (years)",</span></span>
<span id="cb61-1418"><a href="#cb61-1418"></a><span class="in">       y = "Length (cm)")</span></span>
<span id="cb61-1419"><a href="#cb61-1419"></a><span class="in">```</span></span>
<span id="cb61-1420"><a href="#cb61-1420"></a></span>
<span id="cb61-1421"><a href="#cb61-1421"></a></span>
<span id="cb61-1422"><a href="#cb61-1422"></a><span class="fu">## Scrathpad</span></span>
<span id="cb61-1423"><a href="#cb61-1423"></a></span>
<span id="cb61-1424"><a href="#cb61-1424"></a><span class="fu">### To include in the article</span></span>
<span id="cb61-1425"><a href="#cb61-1425"></a></span>
<span id="cb61-1426"><a href="#cb61-1426"></a><span class="ss">-   </span>**Use Cases:** Mentioning use cases like trend analysis in time-series data or other applications where the relationship between variables might be expected to follow a polynomial form (e.g., growth rates, trajectories) can provide practical context.</span>
<span id="cb61-1427"><a href="#cb61-1427"></a><span class="ss">-   </span>**Assumptions:** Not necessary for simply estimating model parameters, but if the model is used for prediction or inference, it is important to state the assumptions of the model (e.g., linearity, homoscedasticity, independence of residuals) and test them.</span>
<span id="cb61-1428"><a href="#cb61-1428"></a><span class="ss">-   </span>**i.i.d.:** The residuals are assumed to be independent and identically distributed (i.i.d.), which is a common assumption in linear regression models.</span>
<span id="cb61-1429"><a href="#cb61-1429"></a><span class="ss">-   </span>**Homoscedasticity:**</span>
<span id="cb61-1430"><a href="#cb61-1430"></a><span class="ss">-   </span>**i.i.d:** The residuals are assumed to be independent and identically distributed (i.i.d.), which is a common assumption in linear regression models. For a normal distribution, this is written as $\epsilon_i \sim N(0, \sigma^2)$, where $\sigma^2$ is the variance of the residuals.</span>
<span id="cb61-1431"><a href="#cb61-1431"></a></span>
<span id="cb61-1432"><a href="#cb61-1432"></a></span>
<span id="cb61-1433"><a href="#cb61-1433"></a><span class="fu">### Contuinuing the MM model</span></span>
<span id="cb61-1434"><a href="#cb61-1434"></a></span>
<span id="cb61-1435"><a href="#cb61-1435"></a></span>
<span id="cb61-1436"><a href="#cb61-1436"></a></span>
<span id="cb61-1437"><a href="#cb61-1437"></a></span>
<span id="cb61-1438"><a href="#cb61-1438"></a></span>
<span id="cb61-1439"><a href="#cb61-1439"></a></span>
</code><button title="Copy to Clipboard" class="code-copy-button" data-in-quarto-modal=""><i class="bi"></i></button></pre></div>
</div></div></div></div></div>
</div> <!-- /content -->
<footer class="footer">
  <div class="nav-footer">
    <div class="nav-footer-left">
<p>Â© 2024, AJ Smit</p>
</div>   
    <div class="nav-footer-center">
      &nbsp;
    <div class="toc-actions d-sm-block d-md-none"><ul><li><a href="https://github.com/ajsmit/BCB_Stats/edit/main/non-linear_regression.qmd" class="toc-action"><i class="bi bi-github"></i>Edit this page</a></li></ul></div></div>
    <div class="nav-footer-right">
<p><span class="faux-block">Made with {{&lt; fa brands r-project &gt;}} and <a href="https://quarto.org/">Quarto</a></span><br> <span class="faux-block"><a href="?var:github-url">View the source at {{&lt; fa brands github &gt;}} GitHub</a></span></p>
</div>
  </div>
</footer>




<script src="site_libs/quarto-html/zenscroll-min.js"></script>
</body></html>