<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.6.4">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Albertus J. Smit">

<title>&lt;span id="sec-simple-linear-regression" class="quarto-section-identifier"&gt;&lt;span class="chapter-number"&gt;3&lt;/span&gt;&nbsp; &lt;span class="chapter-title"&gt;Linear Regression&lt;/span&gt;&lt;/span&gt; | Albertus J. Smit – The Biostatistics Book</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<link href="./polynomial_regression.html" rel="next">
<link href="./correlation.html" rel="prev">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<style>html{ scroll-behavior: smooth; }</style>
<script async="" src="https://hypothes.is/embed.js"></script>
<script>
  window.document.addEventListener("DOMContentLoaded", function (_event) {
    document.body.classList.add('hypothesis-enabled');
  });
</script>

  <script>window.backupDefine = window.define; window.define = undefined;</script><script src="https://cdn.jsdelivr.net/npm/katex@latest/dist/katex.min.js"></script>
  <script>document.addEventListener("DOMContentLoaded", function () {
 var mathElements = document.getElementsByClassName("math");
 var macros = [];
 for (var i = 0; i < mathElements.length; i++) {
  var texText = mathElements[i].firstChild;
  if (mathElements[i].tagName == "SPAN") {
   katex.render(texText.data, mathElements[i], {
    displayMode: mathElements[i].classList.contains('display'),
    throwOnError: false,
    macros: macros,
    fleqn: false
   });
}}});
  </script>
  <script>window.define = window.backupDefine; window.backupDefine = undefined;</script><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@latest/dist/katex.min.css">

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

</head>

<body class="nav-sidebar floating nav-fixed slimcontent">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a href="./index.html" class="navbar-brand navbar-brand-logo">
    <img src="./logo.png" alt="" class="navbar-logo">
    </a>
    <a class="navbar-brand" href="./index.html">
    <span class="navbar-title">The Biostatistics Book</span>
    </a>
  </div>
        <div class="quarto-navbar-tools tools-wide tools-end">
    <a href="https://github.com/ajsmit/BCB_Stats" title="Source Code" class="quarto-navigation-tool px-1" aria-label="Source Code"><i class="bi bi-github"></i></a>
    <div class="dropdown">
      <a href="" title="Download" id="quarto-navigation-tool-dropdown-0" class="quarto-navigation-tool dropdown-toggle px-1" data-bs-toggle="dropdown" aria-expanded="false" role="link" aria-label="Download"><i class="bi bi-download"></i></a>
      <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="quarto-navigation-tool-dropdown-0">
          <li>
            <a class="dropdown-item quarto-navbar-tools-item" href="./The-Biostatistics-Book.pdf">
              <i class="bi bi-file-pdf pe-1"></i>
            Download PDF
            </a>
          </li>
          <li>
            <a class="dropdown-item quarto-navbar-tools-item" href="./The-Biostatistics-Book.epub">
              <i class="bi bi-journal pe-1"></i>
            Download ePub
            </a>
          </li>
      </ul>
    </div>
    <div class="dropdown">
      <a href="" title="Share" id="quarto-navigation-tool-dropdown-1" class="quarto-navigation-tool dropdown-toggle px-1" data-bs-toggle="dropdown" aria-expanded="false" role="link" aria-label="Share"><i class="bi bi-share"></i></a>
      <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="quarto-navigation-tool-dropdown-1">
          <li>
            <a class="dropdown-item quarto-navbar-tools-item" href="https://twitter.com/intent/tweet?url=|url|">
              <i class="bi bi-twitter pe-1"></i>
            Twitter
            </a>
          </li>
          <li>
            <a class="dropdown-item quarto-navbar-tools-item" href="https://www.facebook.com/sharer/sharer.php?u=|url|">
              <i class="bi bi-facebook pe-1"></i>
            Facebook
            </a>
          </li>
      </ul>
    </div>
</div>
          <div id="quarto-search" class="" title="Search"></div>
      </div> <!-- /container-fluid -->
    </nav>
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" role="button" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./part_A.html">Parametric Methods</a></li><li class="breadcrumb-item"><a href="./simple_linear_regression.html"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Linear Regression</span></a></li></ol></nav>
        <a class="flex-grow-1" role="navigation" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation floating overflow-auto">
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Preface</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./intro.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Introduction</span></span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="./part_A.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Parametric Methods</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./correlation.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Correlation</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./simple_linear_regression.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Linear Regression</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./polynomial_regression.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Polynomial Regression</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./multiple_linear_regression.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Multiple Linear Regression</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./generalised_linear_models.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Generalised Linear Models (GLM)</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./non-linear_regression.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">Nonlinear Models</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./regularisation.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">Regularisation Techniques</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="./part_B.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Non-Parametric Methods</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./assumption_tests.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">9</span>&nbsp; <span class="chapter-title">Testing Assumptions</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./quantile_regression.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">10</span>&nbsp; <span class="chapter-title">Quantile Regression</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="./part_C.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Semi-Parametric Methods</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-3" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./generalised_additive_models.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">11</span>&nbsp; <span class="chapter-title">Generalised Additive Models</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./summary.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">12</span>&nbsp; <span class="chapter-title">Summary</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./references.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">References</span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" role="navigation" aria-expanded="true">
 <span class="menu-text">Appendices</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-4" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./appendix_1.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">A</span>&nbsp; <span class="chapter-title">Appendix A</span></span></a>
  </div>
</li>
      </ul>
  </li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul class="collapse">
  <li><a href="#sec-simple-linear-regression" id="toc-sec-simple-linear-regression" class="nav-link active" data-scroll-target="#sec-simple-linear-regression"><span class="header-section-number">3.1</span> Simple Linear Regression</a></li>
  <li><a href="#nature-of-the-data" id="toc-nature-of-the-data" class="nav-link" data-scroll-target="#nature-of-the-data"><span class="header-section-number">3.2</span> Nature of the Data</a></li>
  <li><a href="#sec-linear-model-assumptions" id="toc-sec-linear-model-assumptions" class="nav-link" data-scroll-target="#sec-linear-model-assumptions"><span class="header-section-number">3.3</span> Assumptions</a></li>
  <li><a href="#outliers-and-their-impact-on-simple-linear-regression" id="toc-outliers-and-their-impact-on-simple-linear-regression" class="nav-link" data-scroll-target="#outliers-and-their-impact-on-simple-linear-regression"><span class="header-section-number">3.4</span> Outliers and Their Impact on Simple Linear Regression</a></li>
  <li><a href="#r-function" id="toc-r-function" class="nav-link" data-scroll-target="#r-function"><span class="header-section-number">3.5</span> R Function</a></li>
  <li><a href="#example-the-penguin-dataset" id="toc-example-the-penguin-dataset" class="nav-link" data-scroll-target="#example-the-penguin-dataset"><span class="header-section-number">3.6</span> Example: The Penguin Dataset</a></li>
  <li><a href="#confidence-and-prediction-intervals" id="toc-confidence-and-prediction-intervals" class="nav-link" data-scroll-target="#confidence-and-prediction-intervals"><span class="header-section-number">3.7</span> Confidence and Prediction Intervals</a></li>
  <li><a href="#sec-assumption-fails" id="toc-sec-assumption-fails" class="nav-link" data-scroll-target="#sec-assumption-fails"><span class="header-section-number">3.8</span> What Do I Do When Some Assumptions Fail?</a></li>
  </ul>
<div class="toc-actions"><ul class="collapse"><li><a href="https://github.com/ajsmit/BCB_Stats/edit/main/simple_linear_regression.qmd" class="toc-action"><i class="bi bi-github"></i>Edit this page</a></li></ul></div></nav>
    </div>
<!-- main -->
<main class="content page-columns page-full" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default"><nav class="quarto-page-breadcrumbs quarto-title-breadcrumbs d-none d-lg-block" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./part_A.html">Parametric Methods</a></li><li class="breadcrumb-item"><a href="./simple_linear_regression.html"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Linear Regression</span></a></li></ol></nav>
<div class="quarto-title">
<div class="quarto-title-block"><div><h1 class="title"><span id="sec-simple-linear-regression" class="quarto-section-identifier"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Linear Regression</span></span></h1><button type="button" class="btn code-tools-button" id="quarto-code-tools-source"><i class="bi"></i> Code</button></div></div>
</div>


<div class="quarto-title-meta-author">
  <div class="quarto-title-meta-heading">Author</div>
  <div class="quarto-title-meta-heading">Affiliation</div>
  
    <div class="quarto-title-meta-contents">
    <p class="author"><a href="https://tangledbank.netlify.app">Albertus J. Smit</a> <a href="https://orcid.org/0000-0002-3799-6126" class="quarto-title-author-orcid"> <img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAA2ZpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuMC1jMDYwIDYxLjEzNDc3NywgMjAxMC8wMi8xMi0xNzozMjowMCAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wTU09Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9tbS8iIHhtbG5zOnN0UmVmPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvc1R5cGUvUmVzb3VyY2VSZWYjIiB4bWxuczp4bXA9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC8iIHhtcE1NOk9yaWdpbmFsRG9jdW1lbnRJRD0ieG1wLmRpZDo1N0NEMjA4MDI1MjA2ODExOTk0QzkzNTEzRjZEQTg1NyIgeG1wTU06RG9jdW1lbnRJRD0ieG1wLmRpZDozM0NDOEJGNEZGNTcxMUUxODdBOEVCODg2RjdCQ0QwOSIgeG1wTU06SW5zdGFuY2VJRD0ieG1wLmlpZDozM0NDOEJGM0ZGNTcxMUUxODdBOEVCODg2RjdCQ0QwOSIgeG1wOkNyZWF0b3JUb29sPSJBZG9iZSBQaG90b3Nob3AgQ1M1IE1hY2ludG9zaCI+IDx4bXBNTTpEZXJpdmVkRnJvbSBzdFJlZjppbnN0YW5jZUlEPSJ4bXAuaWlkOkZDN0YxMTc0MDcyMDY4MTE5NUZFRDc5MUM2MUUwNEREIiBzdFJlZjpkb2N1bWVudElEPSJ4bXAuZGlkOjU3Q0QyMDgwMjUyMDY4MTE5OTRDOTM1MTNGNkRBODU3Ii8+IDwvcmRmOkRlc2NyaXB0aW9uPiA8L3JkZjpSREY+IDwveDp4bXBtZXRhPiA8P3hwYWNrZXQgZW5kPSJyIj8+84NovQAAAR1JREFUeNpiZEADy85ZJgCpeCB2QJM6AMQLo4yOL0AWZETSqACk1gOxAQN+cAGIA4EGPQBxmJA0nwdpjjQ8xqArmczw5tMHXAaALDgP1QMxAGqzAAPxQACqh4ER6uf5MBlkm0X4EGayMfMw/Pr7Bd2gRBZogMFBrv01hisv5jLsv9nLAPIOMnjy8RDDyYctyAbFM2EJbRQw+aAWw/LzVgx7b+cwCHKqMhjJFCBLOzAR6+lXX84xnHjYyqAo5IUizkRCwIENQQckGSDGY4TVgAPEaraQr2a4/24bSuoExcJCfAEJihXkWDj3ZAKy9EJGaEo8T0QSxkjSwORsCAuDQCD+QILmD1A9kECEZgxDaEZhICIzGcIyEyOl2RkgwAAhkmC+eAm0TAAAAABJRU5ErkJggg=="></a></p>
  </div>
  <div class="quarto-title-meta-contents">
        <p class="affiliation">
            <a href="https://uwc.ac.za">
            University of the Western Cape
            </a>
          </p>
      </div>
  </div>

<div class="quarto-title-meta">

      
  
    
  </div>
  


</header>


<p>Linear models are frequently used statistical tools that all biologists should know. They describe and quantify relationships between variables and are widely employed to predict the value of a dependent variable (or response variable, <span class="math inline">Y</span>) based on the values of one or more independent variables (or predictor variables, <span class="math inline">X</span>). A linear model is an equation where the relationship between the dependent variable and the independent variables is linear in the parameters (though not necessarily in the variables themselves), allowing us to predict the dependent variable from the predictors. In statistics, models are mathematical representations or descriptions of real-world processes or systems. They offer idealised and simplified representations of reality and capture the essential features and relationships we find interesting.</p>
<p>Regression analysis is a statistical technique used to estimate the parameters of the model that best describes the relationship between a dependent variable and one or more independent variables. The primary goal of regression analysis is to fit the model to the observed data and offer insights into the strength and nature of the relationships between variables.</p>
<p>One of the simplest forms of linear models is the <strong>simple linear model</strong>, which is the topic of this chapter. A simple linear model estimates model parameters through the process of simple linear regression (SLR). SLR involves a single independent variable and is often applied when the independent variable is hypothesised to causally influence the dependent variable. However, a causal relationship is not a strict requirement. The primary goal of SLR may simply be to derive a formula (model) that predicts the values of the dependent variable based on the independent variable, regardless of whether a causal relationship exists between them.</p>
<p>SLR serves as a foundational regression technique that extends to more complex forms, including <strong>polynomial regression</strong> (<a href="polynomial_regression.html" class="quarto-xref"><span>Chapter 4</span></a>), <strong>multiple linear regression (MLR)</strong> (<a href="multiple_linear_regression.html" class="quarto-xref"><span>Chapter 5</span></a>), and <strong>generalised linear models (GLMs)</strong> (<a href="generalised_linear_models.html" class="quarto-xref"><span>Chapter 6</span></a>). Polynomial regression includes polynomial terms (higher powers of the independent variable, like <span class="math inline">X^2</span>, <span class="math inline">X^3</span>, etc.) to model curvilinear relationships, while MLR involves multiple independent variables to describe more complex relationships where the dependent variable is influenced by several predictors simultaneously. GLMs further extend these concepts to handle various types of dependent variables (besides responses drawn from the normal distribution) and relationships (e.g.&nbsp;logistic).</p>
<p>In cases where prediction is not the primary objective, and causation is neither expected nor implied, but one variable exhibits a systematic change with another, <strong>correlation analysis</strong> (<a href="correlation.html" class="quarto-xref"><span>Chapter 2</span></a>) is a more appropriate technique.</p>
<p>The terminology surrounding linear models and linear regression can sometimes be confusing because we often use terms like ‘linear model,’ ‘linear regression,’ and ‘least squares regression’ interchangeably. But ‘linear model’ is a broader term that encompasses various types of linear relationships, including simple linear models, multiple linear models, polynomial models, and GLMs. In this section, you will learn about simple linear models and regression analysis, which will provide you with the foundational knowledge to understand more complex linear models and regression techniques.</p>
<section id="sec-simple-linear-regression" class="level2" data-number="3.1">
<h2 data-number="3.1" class="anchored" data-anchor-id="sec-simple-linear-regression"><span class="header-section-number">3.1</span> Simple Linear Regression</h2>
<p>Linear models help us answer questions like:</p>
<ul>
<li>How does body mass change with age in a particular species?</li>
<li>Does the number of offspring depend on the amount of food available?</li>
<li>How does a species’ geographic distribution change with temperature?</li>
</ul>
<p>By assuming a linear relationship between variables, these models provide a clear and interpretable way to quantify and predict biological outcomes. For example, should a linear model describe the relationship between body mass (g) and age (years), we can predict the body mass of a particular species of fish would increase by 230 g for every additional year of age up to the age of five years (however, please see the von Bertalanffy model in Chapter <a href="non-linear_regression.html#sec-vonbertalanffy" class="quarto-xref"><span>7.6</span></a>).</p>
<p>The simple linear model is given by: <span id="eq-reg1"><span class="math display">Y_{i}=\beta \cdot X_{i}+\alpha+\epsilon \tag{3.1}</span></span> Where:</p>
<ul>
<li><span class="math inline">Y_{i}</span> is the <span class="math inline">i</span>-th measurement of the dependent variable,</li>
<li><span class="math inline">X_{i}</span> is the <span class="math inline">i</span>-th measurement of the independent variable,</li>
<li><span class="math inline">\alpha</span> is the intercept (the value of <span class="math inline">Y</span> when <span class="math inline">X=0</span>),</li>
<li><span class="math inline">\beta</span> is the slope (the change in <span class="math inline">Y</span> for a one-unit change in <span class="math inline">X</span>), and</li>
<li><span class="math inline">\epsilon</span> is the error term (residual; see box ‘The residuals, <span class="math inline">\epsilon_i</span>’).</li>
</ul>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
The residuals, <span class="math inline">\epsilon_i</span>
</div>
</div>
<div class="callout-body-container callout-body">
<p>In most regression models, such as linear regressions and those discussed in <a href="non-linear_regression.html" class="quarto-xref"><span>Chapter 7</span></a>, we assume that the residuals are <em>independent and identically distributed (i.i.d.)</em>. This implies that each residual <span class="math inline">\epsilon_i</span> is drawn from the same probability distribution and that they are mutually independent. When the residuals follow a normal distribution, this can be expressed as <span class="math inline">\epsilon_i \sim N(0, \sigma^2)</span>, where:</p>
<ul>
<li><span class="math inline">\epsilon_i</span> represents the residual for the <span class="math inline">i</span>-th observation,</li>
<li><span class="math inline">N(0, \sigma^2)</span> denotes a normal distribution with a mean of 0 and a variance of <span class="math inline">\sigma^2</span>.</li>
</ul>
<p>The requirement of a zero mean for residuals implies that, on average, the model’s predictions neither systematically overestimate nor underestimate the true values. The constant variance assumption ensures that the spread or dispersion of residuals around the mean remains consistent across all levels of the predictor variables. This ensures that the model’s accuracy is uniform across the range of data.</p>
<p>The requirement for independence indicates that the residual for any given observation is not influenced by or correlated with the residuals of other observations. It also means that the residual for an observation does not depend on the order in which the observations were collected (i.e.&nbsp;no serial correlation or auto-correlation). Independence ensures that each data point contributes unique information to the model and prevents any systematic patterns from influencing the estimates of the model’s parameters.</p>
<p>Violation of any of these assumptions could lead to biased or inefficient parameter estimates.</p>
</div>
</div>
</section>
<section id="nature-of-the-data" class="level2 page-columns page-full" data-number="3.2">
<h2 data-number="3.2" class="anchored" data-anchor-id="nature-of-the-data"><span class="header-section-number">3.2</span> Nature of the Data</h2>
<p>The experimenter must ensure the following key requirements for a simple linear regression:</p>
<ol type="1">
<li><p><strong>Causality:</strong> There should be a theoretical or philosophical basis for expecting a causal relationship, where the independent variable (<span class="math inline">X</span>) influences or determines the dependent variable (<span class="math inline">Y</span>).<a href="#fn1" class="footnote-ref" id="fnref1" role="doc-noteref"><sup>1</sup></a> It is assumed that changes in <span class="math inline">X</span> cause changes in <span class="math inline">Y</span>.</p></li>
<li><p><strong>Independence of Observations:</strong></p>
<ul>
<li>The observations or measured values of <span class="math inline">Y</span> must be independent of each other. For each value of <span class="math inline">X</span>, there should be only one corresponding value of <span class="math inline">Y</span>, or if there are replicate <span class="math inline">Y</span> values, they must be statistically independent and not influence each other.</li>
<li>The observations of <span class="math inline">Y</span> must also be independently across the range of <span class="math inline">X</span> values. This means that the value of <span class="math inline">Y</span> at one point should not influence the value of <span class="math inline">Y</span> at another point.<a href="#fn2" class="footnote-ref" id="fnref2" role="doc-noteref"><sup>2</sup></a></li>
</ul></li>
<li><p><strong>Independent Variable Scale:</strong> The independent variable (<span class="math inline">X</span>) should be measured on a continuous scale, such as integers, real numbers, intervals, or ratios.</p></li>
<li><p><strong>Dependent Variable Scale:</strong> Similarly, the dependent variable (<span class="math inline">Y</span>) should also be measured on a continuous scale, such as integers, real numbers, intervals, or ratios.<a href="#fn3" class="footnote-ref" id="fnref3" role="doc-noteref"><sup>3</sup></a></p></li>
</ol>
<div class="no-row-height column-margin column-container"><div id="fn1"><p><sup>1</sup>&nbsp;The independent and dependent variables are also called the predictor and response variables, respectively. The predictor is often under the experimenter’s control (in which case it is a fixed effects model), while the response is the variable predicted to respond in the manner hypothesised.</p></div><div id="fn2"><p><sup>2</sup>&nbsp;If <span class="math inline">Y</span> not independent across the range of <span class="math inline">X</span>, use a different type of regression model, such as a linear mixed-effects model.</p></div><div id="fn3"><p><sup>3</sup>&nbsp;The dependent variable can also be ordinal, but this is less common. If this is the case, use *ordinal (logistic) regression instead.</p></div></div><p>What if my data are not continuous?</p>
<ul>
<li>If the independent variable is ordinal, use <em>ordinal regression</em>.</li>
<li>If the dependent variable is ordinal, use <em>ordinal (logistic) regression</em>.</li>
</ul>
<p>What if I have more than one independent variable?</p>
<ul>
<li>Use <em>multiple linear regression</em>.</li>
</ul>
<p>Additional assumptions and requirements are discussed next in <a href="#sec-linear-model-assumptions" class="quarto-xref"><span>Section 3.3</span></a>.</p>
</section>
<section id="sec-linear-model-assumptions" class="level2" data-number="3.3">
<h2 data-number="3.3" class="anchored" data-anchor-id="sec-linear-model-assumptions"><span class="header-section-number">3.3</span> Assumptions</h2>
<p>The following assumptions are made when performing a simple linear regression; 1-3 must be tested <em>after</em> fitting the linear model:</p>
<ol type="1">
<li><strong>Normality:</strong> For each value of <span class="math inline">X</span>, there is a corresponding normal distribution of <span class="math inline">Y</span> values. Each value of <span class="math inline">Y</span> is randomly sampled from this normal distribution.</li>
<li><strong>Homoscedasticity:</strong> The variances of the <span class="math inline">Y</span> distributions corresponding to each <span class="math inline">X</span> value should be approximately equal.</li>
<li><strong>Linearity:</strong> There exists a linear relationship between the variables <span class="math inline">Y</span> and <span class="math inline">X</span>.</li>
<li><strong>Measurement Error:</strong> It is assumed that the measurements of <span class="math inline">X</span> are obtained without error. However, in practical scenarios, this is rarely the case. Therefore, we assume any measurement error in <span class="math inline">X</span> to be negligible.</li>
</ol>
<p>See <a href="#sec-assumption-fails" class="quarto-xref"><span>Section 3.8</span></a> for more information about how to proceed when assumptions 1-3 are violated.</p>
</section>
<section id="outliers-and-their-impact-on-simple-linear-regression" class="level2" data-number="3.4">
<h2 data-number="3.4" class="anchored" data-anchor-id="outliers-and-their-impact-on-simple-linear-regression"><span class="header-section-number">3.4</span> Outliers and Their Impact on Simple Linear Regression</h2>
<p>In simple linear regression, outliers can have significant detrimental effects on the analysis and the reliability of the results. Outliers are data points that deviate substantially from the overall pattern or trend observed in the data, and their presence can lead to biased parameter estimates, inflated standard errors, distorted confidence and prediction intervals, violation of assumptions, and masking of underlying patterns.</p>
<p>Specifically, they can greatly impact the estimation of the slope and intercept due to their influence on the process of minimising the sum of squared residuals. Their presence can increase the standard errors of the regression coefficients, making it harder to detect significant relationships between the independent and dependent variables. Furthermore, the inclusion of outliers in the dataset can distort the calculation of confidence and prediction intervals for individual observations, preventing accurate inference and prediction. Their presence may also lead to violations of the assumptions of linear regression, such as the normality of residuals and the constant variance of errors (homoscedasticity). Lastly, extreme outliers can mask underlying patterns or relationships in the data and hinder our ability to discern the true nature of the associations between variables.</p>
</section>
<section id="r-function" class="level2" data-number="3.5">
<h2 data-number="3.5" class="anchored" data-anchor-id="r-function"><span class="header-section-number">3.5</span> R Function</h2>
<p>The <code>lm()</code> function in R is used to fit linear models. It can be used to carry out simple linear regression, multiple linear regression, and more.</p>
<p>The general form of the function written in R is:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1"></a><span class="fu">lm</span>(formula, data, ...)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>where <code>formula</code> is a symbolic description of the model to be fitted, and <code>data</code> is the data frame containing the variables. The <code>...</code> argument is used to pass additional arguments to the function (consult <code>?lm</code>). For example:</p>
<div class="cell">
<div class="sourceCode cell-code" id="annotated-cell-2"><pre class="sourceCode numberSource r code-annotation-code number-lines code-with-copy code-annotated"><code class="sourceCode r"><a class="code-annotation-anchor" data-target-cell="annotated-cell-2" data-target-annotation="1" onclick="event.preventDefault();">1</a><span id="annotated-cell-2-1" class="code-annotation-target"><a href="#annotated-cell-2-1"></a><span class="fu">lm</span>(y <span class="sc">~</span> x, <span class="at">data =</span> df)</span><div class="code-annotation-gutter-bg"></div><div class="code-annotation-gutter"></div></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-annotation">
<dl class="code-annotation-container-grid">
<dt data-target-cell="annotated-cell-2" data-target-annotation="1">1</dt>
<dd>
<span data-code-cell="annotated-cell-2" data-code-lines="1" data-code-annotation="1">You can read the statement <code>y ~ x</code> as “y is modelled as a function of x.”</span>
</dd>
</dl>
</div>
</div>
<p>The above statement fits a simple linear regression model with <code>y</code> as the dependent variable and <code>x</code> as the independent variable. The data frame <code>df</code> contains the variables named <code>x</code> and <code>y</code>.</p>
</section>
<section id="example-the-penguin-dataset" class="level2 page-columns page-full" data-number="3.6">
<h2 data-number="3.6" class="anchored" data-anchor-id="example-the-penguin-dataset"><span class="header-section-number">3.6</span> Example: The Penguin Dataset</h2>
<p>The following example workflow uses the <code>penguin</code> dataset from the <code>palmerpenguins</code> package to demonstrate how to perform a simple linear regression in R. The data are in <a href="#tbl-penguins" class="quarto-xref">Table&nbsp;<span>3.1</span></a>.</p>
<p>Although we can also do a correlation here, we will use a simple linear regression because we want to develop a predictive model that can be used to estimate the bill length of Adelie penguins based on their body mass—this is a permissible application of a simple linear regression even though the two variables are not assumed to be causally related.</p>
<div class="cell page-columns page-full">
<div id="tbl-penguins" class="cell quarto-float quarto-figure quarto-figure-center anchored page-columns page-full">
<figure class="quarto-float quarto-float-tbl figure page-columns page-full">
<div aria-describedby="tbl-penguins-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="cell-output-display">
<div id="rpyphzjecz" style="padding-left:0px;padding-right:0px;padding-top:10px;padding-bottom:10px;overflow-x:auto;overflow-y:auto;width:auto;height:auto;">
<style>#rpyphzjecz table {
  font-family: system-ui, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol', 'Noto Color Emoji';
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
}

#rpyphzjecz thead, #rpyphzjecz tbody, #rpyphzjecz tfoot, #rpyphzjecz tr, #rpyphzjecz td, #rpyphzjecz th {
  border-style: none;
}

#rpyphzjecz p {
  margin: 0;
  padding: 0;
}

#rpyphzjecz .gt_table {
  display: table;
  border-collapse: collapse;
  line-height: normal;
  margin-left: auto;
  margin-right: auto;
  color: #333333;
  font-size: 16px;
  font-weight: normal;
  font-style: normal;
  background-color: #FFFFFF;
  width: auto;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #A8A8A8;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #A8A8A8;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
}

#rpyphzjecz .gt_caption {
  padding-top: 4px;
  padding-bottom: 4px;
}

#rpyphzjecz .gt_title {
  color: #333333;
  font-size: 125%;
  font-weight: initial;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-color: #FFFFFF;
  border-bottom-width: 0;
}

#rpyphzjecz .gt_subtitle {
  color: #333333;
  font-size: 85%;
  font-weight: initial;
  padding-top: 3px;
  padding-bottom: 5px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-color: #FFFFFF;
  border-top-width: 0;
}

#rpyphzjecz .gt_heading {
  background-color: #FFFFFF;
  text-align: center;
  border-bottom-color: #FFFFFF;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#rpyphzjecz .gt_bottom_border {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#rpyphzjecz .gt_col_headings {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#rpyphzjecz .gt_col_heading {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 6px;
  padding-left: 5px;
  padding-right: 5px;
  overflow-x: hidden;
}

#rpyphzjecz .gt_column_spanner_outer {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  padding-top: 0;
  padding-bottom: 0;
  padding-left: 4px;
  padding-right: 4px;
}

#rpyphzjecz .gt_column_spanner_outer:first-child {
  padding-left: 0;
}

#rpyphzjecz .gt_column_spanner_outer:last-child {
  padding-right: 0;
}

#rpyphzjecz .gt_column_spanner {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 5px;
  overflow-x: hidden;
  display: inline-block;
  width: 100%;
}

#rpyphzjecz .gt_spanner_row {
  border-bottom-style: hidden;
}

#rpyphzjecz .gt_group_heading {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  text-align: left;
}

#rpyphzjecz .gt_empty_group_heading {
  padding: 0.5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: middle;
}

#rpyphzjecz .gt_from_md > :first-child {
  margin-top: 0;
}

#rpyphzjecz .gt_from_md > :last-child {
  margin-bottom: 0;
}

#rpyphzjecz .gt_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  margin: 10px;
  border-top-style: solid;
  border-top-width: 1px;
  border-top-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  overflow-x: hidden;
}

#rpyphzjecz .gt_stub {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
}

#rpyphzjecz .gt_stub_row_group {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
  vertical-align: top;
}

#rpyphzjecz .gt_row_group_first td {
  border-top-width: 2px;
}

#rpyphzjecz .gt_row_group_first th {
  border-top-width: 2px;
}

#rpyphzjecz .gt_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#rpyphzjecz .gt_first_summary_row {
  border-top-style: solid;
  border-top-color: #D3D3D3;
}

#rpyphzjecz .gt_first_summary_row.thick {
  border-top-width: 2px;
}

#rpyphzjecz .gt_last_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#rpyphzjecz .gt_grand_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#rpyphzjecz .gt_first_grand_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: double;
  border-top-width: 6px;
  border-top-color: #D3D3D3;
}

#rpyphzjecz .gt_last_grand_summary_row_top {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: double;
  border-bottom-width: 6px;
  border-bottom-color: #D3D3D3;
}

#rpyphzjecz .gt_striped {
  background-color: rgba(128, 128, 128, 0.05);
}

#rpyphzjecz .gt_table_body {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#rpyphzjecz .gt_footnotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#rpyphzjecz .gt_footnote {
  margin: 0px;
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#rpyphzjecz .gt_sourcenotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#rpyphzjecz .gt_sourcenote {
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#rpyphzjecz .gt_left {
  text-align: left;
}

#rpyphzjecz .gt_center {
  text-align: center;
}

#rpyphzjecz .gt_right {
  text-align: right;
  font-variant-numeric: tabular-nums;
}

#rpyphzjecz .gt_font_normal {
  font-weight: normal;
}

#rpyphzjecz .gt_font_bold {
  font-weight: bold;
}

#rpyphzjecz .gt_font_italic {
  font-style: italic;
}

#rpyphzjecz .gt_super {
  font-size: 65%;
}

#rpyphzjecz .gt_footnote_marks {
  font-size: 75%;
  vertical-align: 0.4em;
  position: initial;
}

#rpyphzjecz .gt_asterisk {
  font-size: 100%;
  vertical-align: 0;
}

#rpyphzjecz .gt_indent_1 {
  text-indent: 5px;
}

#rpyphzjecz .gt_indent_2 {
  text-indent: 10px;
}

#rpyphzjecz .gt_indent_3 {
  text-indent: 15px;
}

#rpyphzjecz .gt_indent_4 {
  text-indent: 20px;
}

#rpyphzjecz .gt_indent_5 {
  text-indent: 25px;
}

#rpyphzjecz .katex-display {
  display: inline-flex !important;
  margin-bottom: 0.75em !important;
}

#rpyphzjecz div.Reactable > div.rt-table > div.rt-thead > div.rt-tr.rt-tr-group-header > div.rt-th-group:after {
  height: 0px !important;
}
</style>

<table class="gt_table do-not-create-environment cell table table-sm table-striped small" data-quarto-postprocess="true" data-quarto-disable-processing="false" data-quarto-bootstrap="false">
<thead>
<tr class="header gt_col_headings">
<th id="Bill length (mm)" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" scope="col">Bill length (mm)</th>
<th id="Body mass (g)" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" scope="col">Body mass (g)</th>
</tr>
</thead>
<tbody class="gt_table_body">
<tr class="odd">
<td class="gt_row gt_right" headers="bill_length_mm">39.1</td>
<td class="gt_row gt_right" headers="body_mass_g">3750</td>
</tr>
<tr class="even">
<td class="gt_row gt_right" headers="bill_length_mm">39.5</td>
<td class="gt_row gt_right" headers="body_mass_g">3800</td>
</tr>
<tr class="odd">
<td class="gt_row gt_right" headers="bill_length_mm">40.3</td>
<td class="gt_row gt_right" headers="body_mass_g">3250</td>
</tr>
<tr class="even">
<td class="gt_row gt_right" headers="bill_length_mm">36.7</td>
<td class="gt_row gt_right" headers="body_mass_g">3450</td>
</tr>
<tr class="odd">
<td class="gt_row gt_right" headers="bill_length_mm">39.3</td>
<td class="gt_row gt_right" headers="body_mass_g">3650</td>
</tr>
<tr class="even">
<td class="gt_row gt_right" headers="bill_length_mm">38.9</td>
<td class="gt_row gt_right" headers="body_mass_g">3625</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<figcaption class="quarto-float-caption-margin quarto-float-caption quarto-float-tbl margin-caption" id="tbl-penguins-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Table&nbsp;3.1: Size measurements for adult foraging Adelie penguins near Palmer Station, Antarctica.
</figcaption>
</figure>
</div>
</div>
<section id="do-an-exploratory-data-analysis-eda" class="level3">
<h3 class="anchored" data-anchor-id="do-an-exploratory-data-analysis-eda">Do an Exploratory Data Analysis (EDA)</h3>
<div class="cell" data-messages="false">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1"></a><span class="fu">dim</span>(Adelie)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 151   8</code></pre>
</div>
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1"></a><span class="fu">summary</span>(Adelie)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>      species          island   bill_length_mm  bill_depth_mm  
 Adelie   :151   Biscoe   :44   Min.   :32.10   Min.   :15.50  
 Chinstrap:  0   Dream    :56   1st Qu.:36.75   1st Qu.:17.50  
 Gentoo   :  0   Torgersen:51   Median :38.80   Median :18.40  
                                Mean   :38.79   Mean   :18.35  
                                3rd Qu.:40.75   3rd Qu.:19.00  
                                Max.   :46.00   Max.   :21.50  
 flipper_length_mm  body_mass_g       sex          year     
 Min.   :172       Min.   :2850   female:73   Min.   :2007  
 1st Qu.:186       1st Qu.:3350   male  :73   1st Qu.:2007  
 Median :190       Median :3700   NA's  : 5   Median :2008  
 Mean   :190       Mean   :3701               Mean   :2008  
 3rd Qu.:195       3rd Qu.:4000               3rd Qu.:2009  
 Max.   :210       Max.   :4775               Max.   :2009  </code></pre>
</div>
</div>
<p>We see that the dataset contains 344 observations of 8 variables. We shall focus on the <code>body_mass_g</code> and <code>bill_length_mm</code> variables for this example. Importantly, the two variables are continuous, which seems to satisfy the requirements for a simple linear regression. We will also restrict this analysis to the <code>Adelie</code> penguins (<span class="math inline">n = 152</span>). Is the relationship between the body mass and bill length of the penguins linear? Let’s find out.</p>
</section>
<section id="create-a-plot" class="level3 page-columns page-full">
<h3 class="anchored" data-anchor-id="create-a-plot">Create a Plot</h3>
<p>Construct a scatter plot of the data and include a best fit straight line:</p>
<div class="cell page-columns page-full" data-layout-align="center">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1"></a><span class="fu">ggplot</span>(Adelie,</span>
<span id="cb6-2"><a href="#cb6-2"></a>       <span class="fu">aes</span>(<span class="at">x =</span> body_mass_g, <span class="at">y =</span> bill_length_mm)) <span class="sc">+</span></span>
<span id="cb6-3"><a href="#cb6-3"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb6-4"><a href="#cb6-4"></a>  <span class="fu">geom_smooth</span>(<span class="at">method =</span> <span class="st">"lm"</span>, <span class="at">se =</span> <span class="cn">FALSE</span>) <span class="sc">+</span></span>
<span id="cb6-5"><a href="#cb6-5"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"Body mass (g)"</span>, <span class="at">y =</span> <span class="st">"Bill length (mm)"</span>) <span class="sc">+</span></span>
<span id="cb6-6"><a href="#cb6-6"></a>  <span class="fu">theme_minimal</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display page-columns page-full">
<div id="fig-lm" class="quarto-float quarto-figure quarto-figure-center anchored page-columns page-full" data-fig-align="center">
<figure class="quarto-float quarto-float-fig figure page-columns page-full">
<div aria-describedby="fig-lm-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="simple_linear_regression_files/figure-html/fig-lm-1.svg" class="img-fluid quarto-figure quarto-figure-center figure-img">
</div>
<figcaption class="quarto-float-caption-margin quarto-float-caption quarto-float-fig margin-caption" id="fig-lm-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;3.1: Scatter plot of the Palmer Station Adelie penguin data with a best fit line.
</figcaption>
</figure>
</div>
</div>
</div>
<p>Although there is some scatter in the data (<a href="#fig-lm" class="quarto-xref">Figure&nbsp;<span>3.1</span></a>), there appears to be a positive relationship between the body mass and bill length of the penguins. This relationship might be amenable for modelling with a linear relationship and we shall continue to explore this.</p>
</section>
<section id="state-the-hypothesis" class="level3">
<h3 class="anchored" data-anchor-id="state-the-hypothesis">State the Hypothesis</h3>
<ul>
<li>Null Hypothesis (<span class="math inline">H_0</span>): there is no relationship between the body mass of the penguins and their bill length.</li>
<li>Alternative Hypothesis (<span class="math inline">H_A</span>): there is a relationship between the two variables.</li>
</ul>
<p>This can be written as:</p>
<p><span id="eq-h0"><span class="math display">H_{0}:\beta = 0 \tag{3.2}</span></span></p>
<p>As seen above, this hypothesis concerns the slope of the regression line, <span class="math inline">\beta</span>. If the slope is zero, then there is no relationship between the two variables. Regression models also tests an hypothesis about the intercept, <span class="math inline">\alpha</span>, but this is less commonly reported.</p>
</section>
<section id="sec-fit-model" class="level3">
<h3 class="anchored" data-anchor-id="sec-fit-model">Fit the Model</h3>
<p>Since the assumptions of a linear regression can only be tested <em>after</em> fitting the model, we first fit the model and then test the assumptions.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1"></a>mod1 <span class="ot">&lt;-</span> <span class="fu">lm</span>(bill_length_mm <span class="sc">~</span> body_mass_g,</span>
<span id="cb7-2"><a href="#cb7-2"></a>           <span class="at">data =</span> Adelie)</span>
<span id="cb7-3"><a href="#cb7-3"></a><span class="fu">summary</span>(mod1)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
lm(formula = bill_length_mm ~ body_mass_g, data = Adelie)

Residuals:
    Min      1Q  Median      3Q     Max 
-6.4208 -1.3690  0.1874  1.4825  5.6168 

Coefficients:
             Estimate Std. Error t value Pr(&gt;|t|)    
(Intercept) 2.699e+01  1.483e+00  18.201  &lt; 2e-16 ***
body_mass_g 3.188e-03  3.977e-04   8.015 2.95e-13 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Residual standard error: 2.234 on 149 degrees of freedom
Multiple R-squared:  0.3013,    Adjusted R-squared:  0.2966 
F-statistic: 64.24 on 1 and 149 DF,  p-value: 2.955e-13</code></pre>
</div>
</div>
</section>
<section id="test-the-assumptions" class="level3 page-columns page-full">
<h3 class="anchored" data-anchor-id="test-the-assumptions">Test the Assumptions</h3>
<p>Assumptions of normality, homoscedasticity, and linearity must be tested (<a href="non-linear_regression.html#sec-assumptions" class="quarto-xref"><span>Section 7.3</span></a>).</p>
<p>We already noted that a linear model will probably be appropriate for the data (see <a href="#fig-lm" class="quarto-xref">Figure&nbsp;<span>3.1</span></a>), so we proceed with the other assumptions.</p>
<p>To facilitate the production of the diagnostic plots, we will use the <strong>broom</strong> package’s <code>augment()</code> function to add the residuals to the data within the original dataset (now appearing as the tidied dataset, <code>mod1_data</code>). This will allow us to create the diagnostic plots more easily, and later we can also use it to look for the presence of outliers (<a href="#sec-outlier-test" class="quarto-xref"><span>Section 3.6.6</span></a>).</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1"></a><span class="fu">library</span>(broom)</span>
<span id="cb9-2"><a href="#cb9-2"></a></span>
<span id="cb9-3"><a href="#cb9-3"></a>mod1_data <span class="ot">&lt;-</span> <span class="fu">augment</span>(mod1)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><strong>Normality</strong></p>
<p>I first check the normality assumption using one of several options (Options 1-3). Here I use the Shapiro-Wilk test, a Residual Q-Q plot, and a histogram of the residuals.</p>
<p><strong>Option 1</strong>: Perform the Shapiro-Wilk test on the residuals. The Shapiro-Wilk test is useful for detecting departures from normality in small sample sizes. The hypothesis is:</p>
<ul>
<li>H<sub>0</sub>: the residuals are normally distributed.</li>
<li>H<sub>A</sub>: the residuals are not normally distributed.</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1"></a><span class="fu">shapiro.test</span>(<span class="fu">residuals</span>(mod1))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
    Shapiro-Wilk normality test

data:  residuals(mod1)
W = 0.99613, p-value = 0.9637</code></pre>
</div>
</div>
<p>The <em>p</em>-value is greater than 0.05, so I reject the alternative hypothesis. I conclude that the residuals are normally distributed.</p>
<p><strong>Option 2</strong>: Create a Residual Q-Q plot to visually assess the normality of the residuals:</p>
<div class="cell page-columns page-full" data-layout-align="center">
<div class="cell-output-display page-columns page-full">
<div id="fig-assump-plots" class="quarto-float quarto-figure quarto-figure-center anchored page-columns page-full" data-fig-align="center">
<figure class="quarto-float quarto-float-fig figure page-columns page-full">
<div aria-describedby="fig-assump-plots-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="simple_linear_regression_files/figure-html/fig-assump-plots-1.svg" class="img-fluid quarto-figure quarto-figure-center figure-img">
</div>
<figcaption class="quarto-float-caption-margin quarto-float-caption quarto-float-fig margin-caption" id="fig-assump-plots-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;3.2: Diagnostics plots the linear regression, <code>mod1</code>, for assumption testing.
</figcaption>
</figure>
</div>
</div>
</div>
<p>The residuals are plotted against a theoretical normal distribution. The residuals fall along the line without major deviations, therefore the residuals are normally distributed (<a href="#fig-assump-plots" class="quarto-xref">Figure&nbsp;<span>3.2</span></a> A).</p>
<p><strong>Option 3</strong>: Create a histogram of the residuals to visually assess the normality of the residuals:</p>
<p>The histogram of the residuals appears to be normally distributed (<a href="#fig-assump-plots" class="quarto-xref">Figure&nbsp;<span>3.2</span></a> B).</p>
<p><strong>Homoscedasticity</strong></p>
<p>I now examine the homoscedasticity assumption. The residuals should be approximately equal across all values of the independent variable. There are several options.</p>
<p><strong>Option 1</strong>: I will use the Breusch-Pagan test to test for homoscedasticity.</p>
<p>The Breusch-Pagan test is used to assess the presence of heteroscedasticity (non-constant variance) in the residuals of a regression model.</p>
<p>The hypothesis is:</p>
<ul>
<li>H<sub>0</sub>: the residuals are homoscedastic.</li>
<li>H<sub>A</sub>: the residuals are heteroscedastic.</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1"></a><span class="fu">library</span>(lmtest)</span>
<span id="cb12-2"><a href="#cb12-2"></a><span class="fu">bptest</span>(mod1)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
    studentized Breusch-Pagan test

data:  mod1
BP = 1.6677, df = 1, p-value = 0.1966</code></pre>
</div>
</div>
<p>The <em>p</em>-value is greater than 0.05, so I reject the alternative hypothesis. I conclude that the residuals are homoscedastic.</p>
<p><strong>Option 2</strong>: Create a plot of the residuals against the fitted values to visually assess homoscedasticity:</p>
<p>The residuals are scattered evenly around zero from short through to long bill lengths, indicating that the residuals have constant variance (<a href="#fig-assump-plots" class="quarto-xref">Figure&nbsp;<span>3.2</span></a> C).</p>
<p><strong>Option 3</strong>: Create a plot of the standardised residuals against the independent variable to visually assess homoscedasticity:</p>
<p>The residuals are scattered evenly around zero from low through to high bill lenghts, indicating that the residuals have constant variance (<a href="#fig-assump-plots" class="quarto-xref">Figure&nbsp;<span>3.2</span></a> D).</p>
<p>Other tests for homoscedasticity include the Goldfeld-Quandt (<code>lmtest::gqtest</code>) test, Levene’s test (<code>car::leveneTest</code>), and others.</p>
</section>
<section id="sec-outlier-test" class="level3 page-columns page-full">
<h3 class="anchored" data-anchor-id="sec-outlier-test">Check for outliers</h3>
<p>How do we identify outliers in linear regression analysis? There are several approaches (see <a href="#fig-lm2-outliers1" class="quarto-xref">Figure&nbsp;<span>3.3</span></a>):</p>
<ol type="1">
<li><p><strong>Difference in Fits (DFFITS):</strong> DFFITS is a measure of the impact of each observation on the predicted values (fitted values) of the model. It quantifies how much the predicted values would change if an observation were removed from the analysis. DFFITS values &gt; <span class="math inline">\text{Threshold} = 2 \sqrt{\frac{p}{n}}</span> indicate observations that have a substantial impact on the predicted values and may be influential or outliers. Here, <span class="math inline">p</span> is the number of parameters in the model (including the intercept, i.e.&nbsp;2 in a simple linear regression) and <span class="math inline">n</span> is the number of observations.</p></li>
<li><p><strong>Cook’s Distance Plot:</strong> Cook’s distance is a measure of the influence of each observation on the estimated regression coefficients. The Cook’s distance plot shows the Cook’s distance values for each observation against the row numbers (or observation numbers). Points with large Cook’s distance values (typically greater than <span class="math inline">\frac{4}{n}</span>) indicate observations that are potentially influential and may have a significant impact on the regression results.</p></li>
<li><p><strong>Residuals vs Leverage Plot:</strong> This plot displays the standardised residuals against the leverage values (hat values) for each observation. Leverage values measure the influence of an observation on the fitted values (predicted values) of the model. The plot helps identify outliers and influential observations. Points with high leverage (typically greater than 2-3 times the average leverage) and large residuals are considered influential observations that may warrant further investigation or potential removal from the analysis.</p></li>
<li><p><strong>Cook’s Distance vs Lev./(1-Lev.) Plot:</strong> This plot combines information from Cook’s distance and leverage values. The <em>x</em>-axis represents the leverage values divided by (1 minus the leverage values), which is a transformation that spreads out the points for better visualisation. The <em>y</em>-axis shows the Cook’s distance values. This plot helps identify influential observations by considering both their impact on the regression coefficients (Cook’s distance) and their influence on the fitted values (leverage). Points in the top-right corner of the plot indicate observations that are potentially influential and may require further examination or removal.</p></li>
</ol>
<div class="cell" data-messages="false">
<div class="sourceCode cell-code" id="annotated-cell-10"><pre class="sourceCode numberSource r code-annotation-code number-lines code-with-copy code-annotated"><code class="sourceCode r"><a class="code-annotation-anchor" data-target-cell="annotated-cell-10" data-target-annotation="1" onclick="event.preventDefault();">1</a><span id="annotated-cell-10-1" class="code-annotation-target"><a href="#annotated-cell-10-1"></a>cooksd_thresh <span class="ot">&lt;-</span> <span class="dv">4</span> <span class="sc">/</span> <span class="fu">nrow</span>(mod1_data)</span>
<a class="code-annotation-anchor" data-target-cell="annotated-cell-10" data-target-annotation="2" onclick="event.preventDefault();">2</a><span id="annotated-cell-10-2" class="code-annotation-target"><a href="#annotated-cell-10-2"></a>dffits_threshold <span class="ot">&lt;-</span> <span class="dv">2</span> <span class="sc">*</span> <span class="fu">sqrt</span>(<span class="dv">2</span> <span class="sc">/</span> <span class="fu">nrow</span>(Adelie))</span>
<span id="annotated-cell-10-3"><a href="#annotated-cell-10-3"></a></span>
<span id="annotated-cell-10-4"><a href="#annotated-cell-10-4"></a>mod1_data <span class="ot">&lt;-</span> mod1_data <span class="sc">%&gt;%</span></span>
<span id="annotated-cell-10-5"><a href="#annotated-cell-10-5"></a>  <span class="fu">mutate</span>(<span class="at">index =</span> <span class="fu">row_number</span>(),</span>
<span id="annotated-cell-10-6"><a href="#annotated-cell-10-6"></a>         <span class="at">leverage =</span> <span class="fu">hatvalues</span>(mod1),</span>
<span id="annotated-cell-10-7"><a href="#annotated-cell-10-7"></a>         <span class="at">dffits =</span> <span class="fu">dffits</span>(mod1),</span>
<span id="annotated-cell-10-8"><a href="#annotated-cell-10-8"></a>         <span class="at">colour =</span> <span class="fu">ifelse</span>(.cooksd <span class="sc">&gt;</span> cooksd_thresh, <span class="st">"black"</span>, <span class="st">"pink"</span>))</span><div class="code-annotation-gutter-bg"></div><div class="code-annotation-gutter"></div></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-annotation">
<dl class="code-annotation-container-grid">
<dt data-target-cell="annotated-cell-10" data-target-annotation="1">1</dt>
<dd>
<span data-code-cell="annotated-cell-10" data-code-lines="1" data-code-annotation="1">Calculate thresholds for Cook’s distance.</span>
</dd>
<dt data-target-cell="annotated-cell-10" data-target-annotation="2">2</dt>
<dd>
<span data-code-cell="annotated-cell-10" data-code-lines="2" data-code-annotation="2">Calculate the threshold for DFFITS.</span>
</dd>
</dl>
</div>
</div>
<div class="cell page-columns page-full" data-layout-align="center" data-messages="false">
<div class="cell-output-display page-columns page-full">
<div id="fig-lm2-outliers1" class="quarto-float quarto-figure quarto-figure-center anchored page-columns page-full" data-fig-pos="h" data-fig-align="center">
<figure class="quarto-float quarto-float-fig figure page-columns page-full">
<div aria-describedby="fig-lm2-outliers1-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="simple_linear_regression_files/figure-html/fig-lm2-outliers1-1.svg" class="img-fluid quarto-figure quarto-figure-center figure-img" data-fig-pos="h">
</div>
<figcaption class="quarto-float-caption-margin quarto-float-caption quarto-float-fig margin-caption" id="fig-lm2-outliers1-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;3.3: Diagnostic plots for visual inspection of outliers in the pernguin data. A) Difference in Fits (DFFITS) for <code>mod1</code>. B) Cook’s distance. C) Residuals vs.&nbsp;leverage. D) Cook’s distance vs.&nbsp;Lev./(1-Lev.). Outliers are identified beyond the Cook’s distance threshold (4/<em>n</em>) and are plotted in black and their row numbers in dark red. The vertical dashed blue lines in C) and D) are positioned at 2 times the average leverage. The horizontal red dashed lines in B) and D) are located at the Cook’s distance threshold. A) to C) are custom <strong>ggplot2</strong> plots corresponding to <code>plot(mod1, which = c(4, 5, 6))</code>.
</figcaption>
</figure>
</div>
</div>
</div>
<!-- 1. Adds information about each observation in the dataset to the model output using the `augment()` function from the **broom** package. -->
<!-- 2. Adds an index column for the observation numbers and calculates the leverage values using the `hatvalues()` function. -->
<div class="cell page-columns page-full" data-layout-align="center" data-messages="false">
<div class="cell-output-display page-columns page-full">
<div id="fig-lm2-outliers2" class="quarto-float quarto-figure quarto-figure-center anchored page-columns page-full" data-fig-align="center">
<figure class="quarto-float quarto-float-fig figure page-columns page-full">
<div aria-describedby="fig-lm2-outliers2-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="simple_linear_regression_files/figure-html/fig-lm2-outliers2-1.svg" class="img-fluid quarto-figure quarto-figure-center figure-img">
</div>
<figcaption class="quarto-float-caption-margin quarto-float-caption quarto-float-fig margin-caption" id="fig-lm2-outliers2-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;3.4: Plot of the linear regression resulting from <code>mod1</code> with the outliers identified using Cook’s distance highlighted.
</figcaption>
</figure>
</div>
</div>
</div>
<p>Once we have found them (<a href="#fig-lm2-outliers2" class="quarto-xref">Figure&nbsp;<span>3.4</span></a>), what do we do with outliers? There are a few strategies:</p>
<ol type="1">
<li><p><strong>Remove them:</strong> If the outliers are due to data entry errors or other issues, it may be appropriate to remove them from the analysis. However, this should be done with caution, as outliers may be functionally important in the dataset if they represent rare, extreme events.</p></li>
<li><p><strong>Robust regression methods:</strong> When there is certainty that the outliers are part of the observed response and represent extreme but rare occurrences, robust regression techniques such as M-estimation or least trimmed squares, which are less sensitive to the presence of outliers, could be used.</p></li>
<li><p><strong>Transformation of variables:</strong> Applying appropriate transformations (e.g., logarithmic, square root) to the variables can sometimes reduce the impact of outliers.</p></li>
</ol>
</section>
<section id="interpret-the-results" class="level3">
<h3 class="anchored" data-anchor-id="interpret-the-results">Interpret the Results</h3>
<p>Now that we have tested the assumptions, we can interpret the results of the model fitted in <a href="#sec-fit-model" class="quarto-xref"><span>Section 3.6.4</span></a>. The slope of the regression line is 0.003188 mm/g, with a standard error of <span class="math inline">\pm</span> 0.0003977. The <em>p</em>-value is less than 0.001, so we reject the null hypothesis that the slope is zero. We conclude that there is a significant relationship between the body mass of the penguins and their bill length.</p>
<p>The fit of the model is given by the multiple <span class="math inline">R^2</span> value, which is 0.3013. This means that 30.13% of the variation in bill length can be explained by body mass. The remaining ~70% is due to other factors not included in the model. The intercept of the model is 26.99 mm, with a standard error of <span class="math inline">\pm</span> 0.0003977. The intercept is the value of the dependent variable when the independent variable is zero. In this case, it is the bill length of a penguin with a body mass of zero grams, which is not a meaningful value.</p>
<p>The significance of the overall fit of the model can be assessed using an analysis of variance (ANOVA) test. The <em>p</em>-value is less than 0.001, so we reject the null hypothesis that the model does not explain a significant amount of the variation in the data against an <em>F</em>-value of 64.25 on 1 and 149 degrees of freedom. We conclude that the model is a good fit for the data.</p>
</section>
<section id="reporting" class="level3 page-columns page-full">
<h3 class="anchored" data-anchor-id="reporting">Reporting</h3>
<p>I provide example Methods, Results, and Discussion sections in a format more-or-less suited for inclusion in a scientific manuscript. Feel free to use it as a template and edit it as necessary to describe your study.</p>
<p><strong>Methods</strong></p>
<p><em>Study data</em></p>
<p>The data analysed in this study were derived from the Palmer Penguins dataset, a comprehensive collection of measurements from three penguin species (Adelie, Chinstrap, and Gentoo) collected in the Palmer Archipelago, Antarctica. The dataset includes variables species, island, bill length, bill depth, flipper length, body mass, and sex of the penguins. This dataset has been made publicly available by Dr.&nbsp;Kristen Gorman and the Palmer Station, Antarctica LTER, a member of the Long Term Ecological Research Network.</p>
<p><em>Statistical analysis</em></p>
<p>The primary objective of our statistical analysis was to investigate the relationship between the penguins’ body mass and bill length. For this purpose, we employed a simple linear regression model to quantify the extent to which the independent variable predicts bill length.</p>
<p>We fitted a simple linear regression model using the <code>lm()</code> function in R version 4.4.0 (R Core Team, 2024). The model included bill length as the dependent variable, and body mass as continuous predictor. We ensured all assumptions for linear regression were assessed including linearity, independence, homoscedasticity, and normality of residuals.</p>
<p>After fitting the model, diagnostic plots were generated using the <code>plot()</code> function in R to visually assess the residuals for any patterns indicating potential violations of regression assumptions. Additionally, the Shapiro-Wilk test was conducted to confirm the normality of the residuals. The presence of heteroscedasticity was evaluated using the Breusch-Pagan test.</p>
<p>The adequacy of the model fit was judged based on the coefficient of determination (<em>R</em><sup>2</sup>), which provided insight into the variance in body mass explained by the predictors. The significance of the regression coefficients was determined using <em>t</em>-tests, and the overall model fit was evaluated by an <em>F</em>-test.</p>
<p><strong>Results</strong></p>
<div class="cell page-columns page-full" data-layout-align="center" data-messages="false">
<div class="cell-output-display page-columns page-full">
<div id="fig-lm2" class="quarto-float quarto-figure quarto-figure-center anchored page-columns page-full" data-fig-pos="t" data-fig-align="center">
<figure class="quarto-float quarto-float-fig figure page-columns page-full">
<div aria-describedby="fig-lm2-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="simple_linear_regression_files/figure-html/fig-lm2-1.svg" class="img-fluid quarto-figure quarto-figure-center figure-img" data-fig-pos="t">
</div>
<figcaption class="quarto-float-caption-margin quarto-float-caption quarto-float-fig margin-caption" id="fig-lm2-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;3.5: Plot of bill length as a function of body mass for Adelie penguins sampled at the Palmer Station. The straight line indicates the best fit regression line and the blue shading is the 95% confidence interval.
</figcaption>
</figure>
</div>
</div>
</div>
<p>The regression coefficient for bill length with respect to body mass was estimated to be approximately <span class="math inline">3.2 \times 10^{-3}</span> mm/g <span class="math inline">\pm</span> <span class="math inline">3.977 \times 10^{-4}</span> (mean slope <span class="math inline">\pm</span> SE) (<span class="math inline">p &lt; 0.001</span>, <span class="math inline">t = 8.015</span>), indicating a significant dependence of bill length on body mass (<a href="#fig-lm2" class="quarto-xref">Figure&nbsp;<span>3.5</span></a>).</p>
<p>The multiple <span class="math inline">R^2</span> value of the model was 0.3013, suggesting that approximately 30.13% of the variability in bill length can be accounted for by changes in body mass. This indicates that while bill length variation is notably influenced by body mass, about 69.87% of the variation is attributable to other factors not included in the model.</p>
<p>The overall fit of the model, assessed by an ANOVA, strongly supported the model’s validity (<span class="math inline">F = 64.25</span>, <span class="math inline">p &lt; 0.001</span>, d.f. = <span class="math inline">1, 149</span>) and confirms that a linear model provides adequate support for predicting penguin bill length from body mass.</p>
<p><strong>Discussion</strong></p>
<p>In conclusion, the statistical analysis confirms a significant relationship between body mass and bill length in penguins. Although the model explains a substantial portion of the variation, future studies should consider additional variables that could account for the remaining variability in bill length. This would enhance our understanding of the morphological adaptations of penguins in their natural habitat.</p>
</section>
</section>
<section id="confidence-and-prediction-intervals" class="level2 page-columns page-full" data-number="3.7">
<h2 data-number="3.7" class="anchored" data-anchor-id="confidence-and-prediction-intervals"><span class="header-section-number">3.7</span> Confidence and Prediction Intervals</h2>
<p>Confidence intervals estimate the range within which the true mean of the dependent variable (<span class="math inline">Y</span>) is likely to fall for a given value of the independent variable (<span class="math inline">X</span>). In other words, if you were to repeat your experiment many times and calculate the mean response at a specific <span class="math inline">X</span> value each time, the confidence interval would contain the true population mean a certain percentage of the time (e.g., 95%). Therefore, a 95% confidence interval means you can be 95% confident that the interval contains the true mean response for the population at that particular <span class="math inline">X</span> value. It’s about the average, not individual data points.</p>
<p>Prediction intervals, on the other hand, provide a range of <span class="math inline">Y</span> values that are likely to contain a single new observation of the dependent variable for a given value of the independent variable <span class="math inline">X</span>. These intervals account for the variability around individual observations and are generally wider than confidence intervals because they include both the variability of the estimated mean response and the variability of individual observations around that mean. Continuing with the Adelie penguin data, the confidence and prediction intervals are shown in <a href="#fig-lm2-conf" class="quarto-xref">Figure&nbsp;<span>3.6</span></a>.</p>
<div class="cell page-columns page-full" data-layout-align="center" data-messages="false">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1"></a><span class="co"># Predict values with confidence intervals</span></span>
<span id="cb14-2"><a href="#cb14-2"></a>pred_conf <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(<span class="fu">predict</span>(mod1,</span>
<span id="cb14-3"><a href="#cb14-3"></a>                                   <span class="at">newdata =</span> Adelie,</span>
<span id="cb14-4"><a href="#cb14-4"></a>                                   <span class="at">interval =</span> <span class="st">"confidence"</span>))</span>
<span id="cb14-5"><a href="#cb14-5"></a></span>
<span id="cb14-6"><a href="#cb14-6"></a><span class="co"># Predict values with prediction intervals</span></span>
<span id="cb14-7"><a href="#cb14-7"></a>pred_pred <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(<span class="fu">predict</span>(mod1,</span>
<span id="cb14-8"><a href="#cb14-8"></a>                                   <span class="at">newdata =</span> Adelie,</span>
<span id="cb14-9"><a href="#cb14-9"></a>                                   <span class="at">interval =</span> <span class="st">"prediction"</span>))</span>
<span id="cb14-10"><a href="#cb14-10"></a></span>
<span id="cb14-11"><a href="#cb14-11"></a><span class="co"># Add body mass to the data frame</span></span>
<span id="cb14-12"><a href="#cb14-12"></a>results <span class="ot">&lt;-</span> <span class="fu">cbind</span>(Adelie, pred_conf, pred_pred[,<span class="dv">2</span><span class="sc">:</span><span class="dv">3</span>])</span>
<span id="cb14-13"><a href="#cb14-13"></a></span>
<span id="cb14-14"><a href="#cb14-14"></a><span class="co"># Rename columns for clarity</span></span>
<span id="cb14-15"><a href="#cb14-15"></a><span class="fu">names</span>(results)[<span class="fu">c</span>(<span class="dv">9</span><span class="sc">:</span><span class="dv">13</span>)] <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"fit"</span>, <span class="st">"lwr_conf"</span>, <span class="st">"upr_conf"</span>,</span>
<span id="cb14-16"><a href="#cb14-16"></a>                             <span class="st">"lwr_pred"</span>, <span class="st">"upr_pred"</span>)</span>
<span id="cb14-17"><a href="#cb14-17"></a></span>
<span id="cb14-18"><a href="#cb14-18"></a><span class="fu">ggplot</span>(<span class="at">data =</span> results, <span class="fu">aes</span>(<span class="at">x =</span> body_mass_g, <span class="at">y =</span> fit)) <span class="sc">+</span></span>
<span id="cb14-19"><a href="#cb14-19"></a>  <span class="fu">geom_line</span>(<span class="at">linewidth =</span> <span class="fl">0.4</span>, <span class="at">colour =</span> <span class="st">"red"</span>) <span class="sc">+</span></span>
<span id="cb14-20"><a href="#cb14-20"></a>  <span class="fu">geom_ribbon</span>(<span class="fu">aes</span>(<span class="at">ymin =</span> lwr_pred, <span class="at">ymax =</span> upr_pred),</span>
<span id="cb14-21"><a href="#cb14-21"></a>              <span class="at">alpha =</span> <span class="fl">0.2</span>, <span class="at">fill =</span> <span class="st">"red"</span>) <span class="sc">+</span></span>
<span id="cb14-22"><a href="#cb14-22"></a>  <span class="fu">geom_ribbon</span>(<span class="fu">aes</span>(<span class="at">ymin =</span> lwr_conf, <span class="at">ymax =</span> upr_conf),</span>
<span id="cb14-23"><a href="#cb14-23"></a>              <span class="at">alpha =</span> <span class="fl">0.2</span>, <span class="at">fill =</span> <span class="st">"blue"</span>) <span class="sc">+</span></span>
<span id="cb14-24"><a href="#cb14-24"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">y =</span> bill_length_mm), <span class="at">shape =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb14-25"><a href="#cb14-25"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"Body mass (g)"</span>, <span class="at">y =</span> <span class="st">"Bill length (mm)"</span>) <span class="sc">+</span></span>
<span id="cb14-26"><a href="#cb14-26"></a>  <span class="fu">theme_bw</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display page-columns page-full">
<div id="fig-lm2-conf" class="quarto-float quarto-figure quarto-figure-center anchored page-columns page-full" data-fig-pos="t" data-fig-align="center">
<figure class="quarto-float quarto-float-fig figure page-columns page-full">
<div aria-describedby="fig-lm2-conf-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="simple_linear_regression_files/figure-html/fig-lm2-conf-1.svg" class="img-fluid quarto-figure quarto-figure-center figure-img" data-fig-pos="t">
</div>
<figcaption class="quarto-float-caption-margin quarto-float-caption quarto-float-fig margin-caption" id="fig-lm2-conf-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;3.6: Plot of pernguin data with the confidence interval (blue) and prediction interval (pink) around the fitted values.
</figcaption>
</figure>
</div>
</div>
</div>
<p>Confidence and prediction intervals are relevant for understanding the uncertainty associated with a linear regression model’s predictions. While confidence intervals focus on quantifying the uncertainty around the estimated mean response, prediction intervals comprehensively assess the variability that can be expected for individual observations. We can use both when interpreting the results of a linear regression analysis.</p>
<p>Confidence intervals are useful when the primary interest lies in making inferences about the mean response at specific values of the independent variable(s). For instance, in a study examining the relationship between soil nutrient levels and plant biomass, confidence intervals can help determine the range of mean biomass that can be expected for a given level of soil nutrients. This information may be valuable for crop management practices, such as designing fertilisation strategies or assessing the impact of nutrient depletion on plant productivity.</p>
<p>Prediction intervals, on the other hand, are more relevant when the goal is to predict the value of an individual observation or to assess the range of values that future observations might take. For example, in a study investigating the relationship between ambient temperature and the growth rate of a species of fish, prediction intervals provide a range of growth rates that an individual fish might exhibit based on the observed temperature. This information is invaluable in aquaculture, for instance, where predicting individual growth patterns can inform decisions about optimal stocking densities or feed management strategies.</p>
<p>The relative widths of confidence and prediction intervals can provide insights into the variability in the data. If the prediction intervals are substantially wider than the confidence intervals, it may indicate a high level of variability in individual observations around the mean response, which could suggest the presence of influential factors or sources of variation that are not accounted for by the current model, such as microhabitat differences or genetic variation within the studied population.</p>
</section>
<section id="sec-assumption-fails" class="level2 page-columns page-full" data-number="3.8">
<h2 data-number="3.8" class="anchored" data-anchor-id="sec-assumption-fails"><span class="header-section-number">3.8</span> What Do I Do When Some Assumptions Fail?</h2>
<section id="sec-assumption-fails2" class="level3 page-columns page-full">
<h3 class="anchored" data-anchor-id="sec-assumption-fails2">Failing Assumptions of Normality and Homoscedasticity</h3>
<p>I will use the sparrow data from Zar (1999) to demonstrate what to do when the assumptions of normality and homoscedasticity are violated. I will fit a linear model to the data and then check the assumptions.</p>
<div class="cell page-columns page-full" data-layout-align="center">
<div class="cell-output-display page-columns page-full">
<div id="fig-lm3" class="quarto-float quarto-figure quarto-figure-center anchored page-columns page-full" data-fig-pos="t" data-fig-align="center">
<figure class="quarto-float quarto-float-fig figure page-columns page-full">
<div aria-describedby="fig-lm3-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="simple_linear_regression_files/figure-html/fig-lm3-1.svg" class="img-fluid quarto-figure quarto-figure-center figure-img" data-fig-pos="t">
</div>
<figcaption class="quarto-float-caption-margin quarto-float-caption quarto-float-fig margin-caption" id="fig-lm3-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;3.7: Scatter plot of the sparrow dataset with a best fit line.
</figcaption>
</figure>
</div>
</div>
</div>
<p><a href="#fig-lm3" class="quarto-xref">Figure&nbsp;<span>3.7</span></a> is a scatter plot of the sparrow data with a best fit line. At first glance, the linear model seems to almost perfectly describe the relationship of wing length on age. I will fit a linear model to the data and then check the assumptions.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1"></a>mod2 <span class="ot">&lt;-</span> <span class="fu">lm</span>(wing <span class="sc">~</span> age, <span class="at">data =</span> sparrows)</span>
<span id="cb15-2"><a href="#cb15-2"></a><span class="fu">summary</span>(mod2)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
lm(formula = wing ~ age, data = sparrows)

Residuals:
     Min       1Q   Median       3Q      Max 
-0.30699 -0.21538  0.06553  0.16324  0.22507 

Coefficients:
            Estimate Std. Error t value Pr(&gt;|t|)    
(Intercept)  0.71309    0.14790   4.821 0.000535 ***
age          0.27023    0.01349  20.027 5.27e-10 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Residual standard error: 0.2184 on 11 degrees of freedom
Multiple R-squared:  0.9733,    Adjusted R-squared:  0.9709 
F-statistic: 401.1 on 1 and 11 DF,  p-value: 5.267e-10</code></pre>
</div>
</div>
<p>Check the assumption of normality of residuals using the Shapiro-Wilk test, a histogram, and a residual Q-Q plot.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1"></a><span class="fu">shapiro.test</span>(<span class="fu">residuals</span>(mod2))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
    Shapiro-Wilk normality test

data:  residuals(mod2)
W = 0.84542, p-value = 0.02487</code></pre>
</div>
</div>
<p>The <em>p</em>-value for the Shapiro-Wilk test is &lt; 0.05, indicating that the residuals are not normally distributed. The histogram and Q-Q plot of the residuals also show that the residuals are not normally distributed (<a href="#fig-hist2" class="quarto-xref">Figure&nbsp;<span>3.8</span></a> and <a href="#fig-QQ2" class="quarto-xref">Figure&nbsp;<span>3.9</span></a>). In the Residual Q-Q plot, the points deviate from the straight line, indicating non-normality—note the S-shaped curvature to the data.</p>
<div class="cell page-columns page-full" data-layout-align="center">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1"></a><span class="fu">hist</span>(<span class="fu">residuals</span>(mod2))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display page-columns page-full">
<div id="fig-hist2" class="quarto-float quarto-figure quarto-figure-center anchored page-columns page-full" data-fig-align="center">
<figure class="quarto-float quarto-float-fig figure page-columns page-full">
<div aria-describedby="fig-hist2-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="simple_linear_regression_files/figure-html/fig-hist2-1.svg" class="img-fluid quarto-figure quarto-figure-center figure-img">
</div>
<figcaption class="quarto-float-caption-margin quarto-float-caption quarto-float-fig margin-caption" id="fig-hist2-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;3.8: A histogram of the residual of the linear regression, <code>mod2</code>.
</figcaption>
</figure>
</div>
</div>
</div>
<div class="cell page-columns page-full" data-layout-align="center">
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1"></a><span class="fu">plot</span>(mod2, <span class="at">which =</span> <span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display page-columns page-full">
<div id="fig-QQ2" class="quarto-float quarto-figure quarto-figure-center anchored page-columns page-full" data-fig-align="center">
<figure class="quarto-float quarto-float-fig figure page-columns page-full">
<div aria-describedby="fig-QQ2-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="simple_linear_regression_files/figure-html/fig-QQ2-1.svg" class="img-fluid quarto-figure quarto-figure-center figure-img">
</div>
<figcaption class="quarto-float-caption-margin quarto-float-caption quarto-float-fig margin-caption" id="fig-QQ2-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;3.9: A Residual Q-Q plot of the linear regression, <code>mod2</code>.
</figcaption>
</figure>
</div>
</div>
</div>
<p>It is enough to know that the normality assumption is not met – I cannot proceed with a simple linear regression. However, let us for completeness also look at the homoscedasticity assumption. I will use the Breusch-Pagan test to check for homoscedasticity, followed by a plot of residuals against fitted values.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1"></a><span class="fu">bptest</span>(mod2)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
    studentized Breusch-Pagan test

data:  mod2
BP = 1.6349, df = 1, p-value = 0.201</code></pre>
</div>
</div>
<p>The <em>p</em>-value for the Breusch-Pagan test is &gt; 0.05, indicating that the residuals are homoscedastic. The plot of residuals against fitted values shows gives a slightly different impression (<a href="#fig-resid2" class="quarto-xref">Figure&nbsp;<span>3.10</span></a>).</p>
<div class="cell page-columns page-full" data-layout-align="center">
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1"></a><span class="fu">plot</span>(mod2, <span class="at">which =</span> <span class="dv">1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display page-columns page-full">
<div id="fig-resid2" class="quarto-float quarto-figure quarto-figure-center anchored page-columns page-full" data-fig-align="center">
<figure class="quarto-float quarto-float-fig figure page-columns page-full">
<div aria-describedby="fig-resid2-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="simple_linear_regression_files/figure-html/fig-resid2-1.svg" class="img-fluid quarto-figure quarto-figure-center figure-img">
</div>
<figcaption class="quarto-float-caption-margin quarto-float-caption quarto-float-fig margin-caption" id="fig-resid2-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;3.10: A plot of residuals against fitted values for the linear regression, <code>mod2</code>.
</figcaption>
</figure>
</div>
</div>
</div>
<p>The assumptions of normality and homoscedasticity are violated (it is sufficient that one or the other fails, not both). As already noted, I cannot proceed with the linear model. I will need to consider alternative models or transformations to address these issues.</p>
<p>When the assumptions of normality and homoscedasticity are violated, I have some options—these broadly group into transforming the data and using a non-parametric test.</p>
<p>Transforming the data can sometimes help attain normality and homoscedasticity. Common transformations include the logarithmic, square root, and inverse transformations. However, be cautious when interpreting the results of transformed data, as the transformed coefficients may not be directly interpretable.</p>
<p>I will show the Theil-Sen estimator (also known as Sen’s slope estimator) as a robust non-parametric replacement for a simple linear model. It calculates the median of the slopes of all pairs of sample points to determine the overall slope of the line.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1"></a><span class="fu">library</span>(mblm)</span>
<span id="cb24-2"><a href="#cb24-2"></a></span>
<span id="cb24-3"><a href="#cb24-3"></a>mod3 <span class="ot">&lt;-</span> <span class="fu">mblm</span>(wing <span class="sc">~</span> age, <span class="at">data =</span> sparrows)</span>
<span id="cb24-4"><a href="#cb24-4"></a><span class="fu">summary</span>(mod3)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
mblm(formula = wing ~ age, dataframe = sparrows)

Residuals:
     Min       1Q   Median       3Q      Max 
-0.44524 -0.31190 -0.00714  0.06905  0.14048 

Coefficients:
            Estimate     MAD V value Pr(&gt;|V|)    
(Intercept)  0.75000 0.18532      91 0.000244 ***
age          0.27619 0.00956      91 0.000244 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Residual standard error: 0.244 on 11 degrees of freedom</code></pre>
</div>
</div>
<p>The interpretation of the Theil-Sen estimator is similar to the simple linear regression. The Theil-Sen estimator provides a robust estimate of the slope of the relationship between age and wing length. The slope of the line is 0.28 (<span class="math inline">\pm</span> 0.19 mean absolute deviation) (<em>V</em> value = 91, <em>p</em> &lt; 0.001), indicating that for each additional day of age, the wing length increases by 0.28 cm. The intercept of the line is 0.75, indicating that the wing length is ~0.8 cm when the age is 0 days.</p>
</section>
<section id="my-data-do-not-display-a-linear-response" class="level3">
<h3 class="anchored" data-anchor-id="my-data-do-not-display-a-linear-response">My Data Do Not Display a Linear Response</h3>
<p>In simple linear regression, the dependent variable <span class="math inline">Y</span> is expected to exhibit a straight-line relationship with the independent variable <span class="math inline">X</span>. However, several factors can cause deviations from a linear pattern.</p>
<p>Statistical assumptions underlying linear regression can affect the appearance of a linear response. The normality assumption is important but primarily pertains to the residuals rather than the <span class="math inline">Y</span> vs.&nbsp;<span class="math inline">X</span> plot. A scatterplot of <span class="math inline">Y</span> vs.&nbsp;<span class="math inline">X</span> might deviate from a linear pattern due to the non-normality of the residuals or heteroscedasticity, where the variability of the residuals changes with the level of <span class="math inline">X</span>. Addressing these issues and then reassessing the linearity of the relationship is a logical first step. Refer to <a href="#sec-assumption-fails" class="quarto-xref"><span>Section 3.8</span></a> for more details on how to proceed.</p>
<p>Outliers in the data can significantly impact the regression line, leading to misleading results (<a href="#sec-outlier-test" class="quarto-xref"><span>Section 3.6.6</span></a>). Measurement errors in the independent variable can also lead to biased and inconsistent estimations, which may require revisiting the data collection process to address systemic problems. Variable bias, where excluding relevant variables distorts the observed relationship, could also explain seemingly nonlinear responses. Considering multiple predictor variables in a regression model (<a href="multiple_linear_regression.html" class="quarto-xref"><span>Chapter 5</span></a>) might be more appropriate in such situations.</p>
<p>It’s important to note that simple linear regression might not be suitable for all scenarios. For instance, the dependent variable <span class="math inline">Y</span> might inherently follow a different probability distribution, such as a Poisson or a binomial distribution, rather than a normal distribution. This is particularly relevant in count data or binary outcome scenarios. In such cases, other types of models like Poisson regression or logistic regression, accommodated by generalised linear models (GLM; <a href="generalised_linear_models.html" class="quarto-xref"><span>Chapter 6</span></a>), would be more appropriate.</p>
<p>Lastly, if the data do not exhibit a linear relationship even after addressing these issues, the relationship between the variables may really be nonlinear. This can occur when the underlying functional relationship between <span class="math inline">X</span> and <span class="math inline">Y</span> is better described by exponential, logarithmic, or other more complex mechanistic responses. In such cases, nonlinear regression (<a href="non-linear_regression.html" class="quarto-xref"><span>Chapter 7</span></a>) or generalised additive models (GAM; <a href="generalised_additive_models.html" class="quarto-xref"><span>Chapter 11</span></a>) might be necessary to describe the relationship between the variables accurately.</p>
<!-- Therefore, when the linear response is absent, do one of the following as appropriate: -->
<!-- -   If one or both of the assumptions of normality and homoscedasticity are violated, consider: -->
<!--     -   transforming the data to meet the assumptions of linear regression; -->
<!--     -   using a non-parametric regression model like the Theil-Sen estimator (@sec-assumption-fails2). -->
<!-- -   If the underlying functional relationship is truly not linear, consider: -->
<!--     -   using a non-linear regression model to capture the correct functional relationship; -->
<!--     -   exploring alternative approaches such as a Generalised Additive Model (GAM). -->
<!-- -   If the dependent variable does not follow a normal distribution, consider: -->
<!--     -   fitting an alternative model using a Generalised Linear Model (GLM) with the appropriate link function for count, binary data, or other data. -->


<!-- -->

</section>
</section>


</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    // For code content inside modals, clipBoardJS needs to be initialized with a container option
    // TODO: Check when it could be a function (https://github.com/zenorocha/clipboard.js/issues/860)
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
  const viewSource = window.document.getElementById('quarto-view-source') ||
                     window.document.getElementById('quarto-code-tools-source');
  if (viewSource) {
    const sourceUrl = viewSource.getAttribute("data-quarto-source-url");
    viewSource.addEventListener("click", function(e) {
      if (sourceUrl) {
        // rstudio viewer pane
        if (/\bcapabilities=\b/.test(window.location)) {
          window.open(sourceUrl);
        } else {
          window.location.href = sourceUrl;
        }
      } else {
        const modal = new bootstrap.Modal(document.getElementById('quarto-embedded-source-code-modal'));
        modal.show();
      }
      return false;
    });
  }
  function toggleCodeHandler(show) {
    return function(e) {
      const detailsSrc = window.document.querySelectorAll(".cell > details > .sourceCode");
      for (let i=0; i<detailsSrc.length; i++) {
        const details = detailsSrc[i].parentElement;
        if (show) {
          details.open = true;
        } else {
          details.removeAttribute("open");
        }
      }
      const cellCodeDivs = window.document.querySelectorAll(".cell > .sourceCode");
      const fromCls = show ? "hidden" : "unhidden";
      const toCls = show ? "unhidden" : "hidden";
      for (let i=0; i<cellCodeDivs.length; i++) {
        const codeDiv = cellCodeDivs[i];
        if (codeDiv.classList.contains(fromCls)) {
          codeDiv.classList.remove(fromCls);
          codeDiv.classList.add(toCls);
        } 
      }
      return false;
    }
  }
  const hideAllCode = window.document.getElementById("quarto-hide-all-code");
  if (hideAllCode) {
    hideAllCode.addEventListener("click", toggleCodeHandler(false));
  }
  const showAllCode = window.document.getElementById("quarto-show-all-code");
  if (showAllCode) {
    showAllCode.addEventListener("click", toggleCodeHandler(true));
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="./correlation.html" class="pagination-link" aria-label="Correlation">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Correlation</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="./polynomial_regression.html" class="pagination-link" aria-label="Polynomial Regression">
        <span class="nav-page-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Polynomial Regression</span></span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav><div class="modal fade" id="quarto-embedded-source-code-modal" tabindex="-1" aria-labelledby="quarto-embedded-source-code-modal-label" aria-hidden="true"><div class="modal-dialog modal-dialog-scrollable"><div class="modal-content"><div class="modal-header"><h5 class="modal-title" id="quarto-embedded-source-code-modal-label">Source Code</h5><button class="btn-close" data-bs-dismiss="modal"></button></div><div class="modal-body"><div class="">
<div class="sourceCode" id="cb26" data-shortcodes="false"><pre class="sourceCode numberSource markdown number-lines code-with-copy"><code class="sourceCode markdown"><span id="cb26-1"><a href="#cb26-1"></a><span class="fu"># Linear Regression {#sec-simple-linear-regression}</span></span>
<span id="cb26-2"><a href="#cb26-2"></a></span>
<span id="cb26-5"><a href="#cb26-5"></a><span class="in">```{r}</span></span>
<span id="cb26-6"><a href="#cb26-6"></a><span class="co">#| eval: TRUE</span></span>
<span id="cb26-7"><a href="#cb26-7"></a><span class="co">#| echo: FALSE</span></span>
<span id="cb26-8"><a href="#cb26-8"></a><span class="co">#| warning: FALSE</span></span>
<span id="cb26-9"><a href="#cb26-9"></a><span class="co">#| messages: FALSE</span></span>
<span id="cb26-10"><a href="#cb26-10"></a></span>
<span id="cb26-11"><a href="#cb26-11"></a><span class="co"># Function to convert base R plots to grobs</span></span>
<span id="cb26-12"><a href="#cb26-12"></a>plot_to_grob <span class="ot">&lt;-</span> <span class="cf">function</span>(plot_func) {</span>
<span id="cb26-13"><a href="#cb26-13"></a>  temp <span class="ot">&lt;-</span> <span class="fu">tempfile</span>()</span>
<span id="cb26-14"><a href="#cb26-14"></a>  <span class="fu">png</span>(temp, <span class="at">width =</span> <span class="dv">800</span>, <span class="at">height =</span> <span class="dv">600</span>)  <span class="co"># Set the width and height to match ggplot aspect ratio</span></span>
<span id="cb26-15"><a href="#cb26-15"></a>  <span class="fu">plot_func</span>()</span>
<span id="cb26-16"><a href="#cb26-16"></a>  <span class="fu">dev.off</span>()</span>
<span id="cb26-17"><a href="#cb26-17"></a>  grid<span class="sc">::</span><span class="fu">rasterGrob</span>(<span class="fu">readPNG</span>(temp), <span class="at">interpolate=</span><span class="cn">TRUE</span>)</span>
<span id="cb26-18"><a href="#cb26-18"></a>}</span>
<span id="cb26-19"><a href="#cb26-19"></a><span class="in">```</span></span>
<span id="cb26-20"><a href="#cb26-20"></a></span>
<span id="cb26-21"><a href="#cb26-21"></a>Linear models are frequently used statistical tools that all biologists should know. They describe and quantify relationships between variables and are widely employed to predict the value of a dependent variable (or response variable, $Y$) based on the values of one or more independent variables (or predictor variables, $X$). A linear model is an equation where the relationship between the dependent variable and the independent variables is linear in the parameters (though not necessarily in the variables themselves), allowing us to predict the dependent variable from the predictors. In statistics, models are mathematical representations or descriptions of real-world processes or systems. They offer idealised and simplified representations of reality and capture the essential features and relationships we find interesting. </span>
<span id="cb26-22"><a href="#cb26-22"></a></span>
<span id="cb26-23"><a href="#cb26-23"></a>Regression analysis is a statistical technique used to estimate the parameters of the model that best describes the relationship between a dependent variable and one or more independent variables. The primary goal of regression analysis is to fit the model to the observed data and offer insights into the strength and nature of the relationships between variables.</span>
<span id="cb26-24"><a href="#cb26-24"></a></span>
<span id="cb26-25"><a href="#cb26-25"></a>One of the simplest forms of linear models is the **simple linear model**, which is the topic of this chapter. A simple linear model estimates model parameters through the process of simple linear regression (SLR). SLR involves a single independent variable and is often applied when the independent variable is hypothesised to causally influence the dependent variable. However, a causal relationship is not a strict requirement. The primary goal of SLR may simply be to derive a formula (model) that predicts the values of the dependent variable based on the independent variable, regardless of whether a causal relationship exists between them.</span>
<span id="cb26-26"><a href="#cb26-26"></a></span>
<span id="cb26-27"><a href="#cb26-27"></a>SLR serves as a foundational regression technique that extends to more complex forms, including **polynomial regression** (@sec-polynomial-regression), **multiple linear regression (MLR)** (@sec-multiple-linear-regression), and **generalised linear models (GLMs)** (@sec-generalised-linear-model). Polynomial regression includes polynomial terms (higher powers of the independent variable, like $X^2$, $X^3$, etc.) to model curvilinear relationships, while MLR involves multiple independent variables to describe more complex relationships where the dependent variable is influenced by several predictors simultaneously. GLMs further extend these concepts to handle various types of dependent variables (besides responses drawn from the normal distribution) and relationships (e.g. logistic).</span>
<span id="cb26-28"><a href="#cb26-28"></a></span>
<span id="cb26-29"><a href="#cb26-29"></a>In cases where prediction is not the primary objective, and causation is neither expected nor implied, but one variable exhibits a systematic change with another, **correlation analysis** (@sec-correlation) is a more appropriate technique.</span>
<span id="cb26-30"><a href="#cb26-30"></a></span>
<span id="cb26-31"><a href="#cb26-31"></a>The terminology surrounding linear models and linear regression can sometimes be confusing because we often use terms like 'linear model,' 'linear regression,' and 'least squares regression' interchangeably. But 'linear model' is a broader term that encompasses various types of linear relationships, including simple linear models, multiple linear models, polynomial models, and GLMs. In this section, you will learn about simple linear models and regression analysis, which will provide you with the foundational knowledge to understand more complex linear models and regression techniques.</span>
<span id="cb26-32"><a href="#cb26-32"></a></span>
<span id="cb26-33"><a href="#cb26-33"></a><span class="fu">## Simple Linear Regression {#sec-simple-linear-regression}</span></span>
<span id="cb26-34"><a href="#cb26-34"></a></span>
<span id="cb26-35"><a href="#cb26-35"></a>Linear models help us answer questions like: </span>
<span id="cb26-36"><a href="#cb26-36"></a></span>
<span id="cb26-37"><a href="#cb26-37"></a><span class="ss">-   </span>How does body mass change with age in a particular species?</span>
<span id="cb26-38"><a href="#cb26-38"></a><span class="ss">-   </span>Does the number of offspring depend on the amount of food available?</span>
<span id="cb26-39"><a href="#cb26-39"></a><span class="ss">-   </span>How does a species' geographic distribution change with temperature?</span>
<span id="cb26-40"><a href="#cb26-40"></a></span>
<span id="cb26-41"><a href="#cb26-41"></a>By assuming a linear relationship between variables, these models provide a clear and interpretable way to quantify and predict biological outcomes. For example, should a linear model describe the relationship between body mass (g) and age (years), we can predict the body mass of a particular species of fish would increase by 230 g for every additional year of age up to the age of five years (however, please see the von Bertalanffy model in Chapter <span class="co">[</span><span class="ot">-@sec-vonbertalanffy</span><span class="co">]</span>).</span>
<span id="cb26-42"><a href="#cb26-42"></a></span>
<span id="cb26-43"><a href="#cb26-43"></a>The simple linear model is given by:</span>
<span id="cb26-44"><a href="#cb26-44"></a>$$Y_{i}=\beta \cdot X_{i}+\alpha+\epsilon$$ {#eq-reg1}</span>
<span id="cb26-45"><a href="#cb26-45"></a>Where:</span>
<span id="cb26-46"><a href="#cb26-46"></a></span>
<span id="cb26-47"><a href="#cb26-47"></a><span class="ss">-   </span>$Y_{i}$ is the $i$-th measurement of the dependent variable,</span>
<span id="cb26-48"><a href="#cb26-48"></a><span class="ss">-   </span>$X_{i}$ is the $i$-th measurement of the independent variable,</span>
<span id="cb26-49"><a href="#cb26-49"></a><span class="ss">-   </span>$\alpha$ is the intercept (the value of $Y$ when $X=0$),</span>
<span id="cb26-50"><a href="#cb26-50"></a><span class="ss">-   </span>$\beta$ is the slope (the change in $Y$ for a one-unit change in $X$), and</span>
<span id="cb26-51"><a href="#cb26-51"></a><span class="ss">-   </span>$\epsilon$ is the error term (residual; see box 'The residuals, $\epsilon_i$').</span>
<span id="cb26-52"><a href="#cb26-52"></a></span>
<span id="cb26-53"><a href="#cb26-53"></a>::: callout-note</span>
<span id="cb26-54"><a href="#cb26-54"></a><span class="fu">## The residuals, $\epsilon_i$</span></span>
<span id="cb26-55"><a href="#cb26-55"></a></span>
<span id="cb26-56"><a href="#cb26-56"></a>In most regression models, such as linear regressions and those discussed in @sec-nonlinear-regression, we assume that the residuals are *independent and identically distributed (i.i.d.)*. This implies that each residual $\epsilon_i$ is drawn from the same probability distribution and that they are mutually independent. When the residuals follow a normal distribution, this can be expressed as $\epsilon_i \sim N(0, \sigma^2)$, where:</span>
<span id="cb26-57"><a href="#cb26-57"></a></span>
<span id="cb26-58"><a href="#cb26-58"></a><span class="ss">- </span>$\epsilon_i$ represents the residual for the $i$-th observation,</span>
<span id="cb26-59"><a href="#cb26-59"></a><span class="ss">- </span>$N(0, \sigma^2)$ denotes a normal distribution with a mean of 0 and a variance of $\sigma^2$.</span>
<span id="cb26-60"><a href="#cb26-60"></a></span>
<span id="cb26-61"><a href="#cb26-61"></a>The requirement of a zero mean for residuals implies that, on average, the model's predictions neither systematically overestimate nor underestimate the true values. The constant variance assumption ensures that the spread or dispersion of residuals around the mean remains consistent across all levels of the predictor variables. This ensures that the model's accuracy is uniform across the range of data.</span>
<span id="cb26-62"><a href="#cb26-62"></a></span>
<span id="cb26-63"><a href="#cb26-63"></a>The requirement for independence indicates that the residual for any given observation is not influenced by or correlated with the residuals of other observations. It also means that the residual for an observation does not depend on the order in which the observations were collected (i.e. no serial correlation or auto-correlation). Independence ensures that each data point contributes unique information to the model and prevents any systematic patterns from influencing the estimates of the model's parameters.</span>
<span id="cb26-64"><a href="#cb26-64"></a></span>
<span id="cb26-65"><a href="#cb26-65"></a>Violation of any of these assumptions could lead to biased or inefficient parameter estimates.</span>
<span id="cb26-66"><a href="#cb26-66"></a>:::</span>
<span id="cb26-67"><a href="#cb26-67"></a></span>
<span id="cb26-68"><a href="#cb26-68"></a><span class="fu">## Nature of the Data</span></span>
<span id="cb26-69"><a href="#cb26-69"></a></span>
<span id="cb26-70"><a href="#cb26-70"></a>The experimenter must ensure the following key requirements for a simple linear regression:</span>
<span id="cb26-71"><a href="#cb26-71"></a></span>
<span id="cb26-72"><a href="#cb26-72"></a><span class="ss">1. </span>**Causality:** There should be a theoretical or philosophical basis for expecting a causal relationship, where the independent variable ($X$) influences or determines the dependent variable ($Y$).<span class="ot">[^3]</span> It is assumed that changes in $X$ cause changes in $Y$.</span>
<span id="cb26-73"><a href="#cb26-73"></a></span>
<span id="cb26-74"><a href="#cb26-74"></a><span class="ss">2. </span>**Independence of Observations:**</span>
<span id="cb26-75"><a href="#cb26-75"></a></span>
<span id="cb26-76"><a href="#cb26-76"></a><span class="ss">    -   </span>The observations or measured values of $Y$ must be independent of each other. For each value of $X$, there should be only one corresponding value of $Y$, or if there are replicate $Y$ values, they must be statistically independent and not influence each other.</span>
<span id="cb26-77"><a href="#cb26-77"></a><span class="ss">    -   </span>The observations of $Y$ must also be independently across the range of $X$ values. This means that the value of $Y$ at one point should not influence the value of $Y$ at another point.<span class="ot">[^4]</span></span>
<span id="cb26-78"><a href="#cb26-78"></a></span>
<span id="cb26-79"><a href="#cb26-79"></a><span class="ss">3. </span>**Independent Variable Scale:** The independent variable ($X$) should be measured on a continuous scale, such as integers, real numbers, intervals, or ratios.</span>
<span id="cb26-80"><a href="#cb26-80"></a></span>
<span id="cb26-81"><a href="#cb26-81"></a><span class="ss">4. </span>**Dependent Variable Scale:** Similarly, the dependent variable ($Y$) should also be measured on a continuous scale, such as integers, real numbers, intervals, or ratios.<span class="ot">[^5]</span></span>
<span id="cb26-82"><a href="#cb26-82"></a></span>
<span id="cb26-83"><a href="#cb26-83"></a><span class="ot">[^3]: </span>The independent and dependent variables are also called the predictor and response variables, respectively. The predictor is often under the experimenter's control (in which case it is a fixed effects model), while the response is the variable predicted to respond in the manner hypothesised.</span>
<span id="cb26-84"><a href="#cb26-84"></a></span>
<span id="cb26-85"><a href="#cb26-85"></a><span class="ot">[^4]: </span>If $Y$ not independent across the range of $X$, use a different type of regression model, such as a linear mixed-effects model.</span>
<span id="cb26-86"><a href="#cb26-86"></a></span>
<span id="cb26-87"><a href="#cb26-87"></a><span class="ot">[^5]: </span>The dependent variable can also be ordinal, but this is less common. If this is the case, use *ordinal (logistic) regression instead.</span>
<span id="cb26-88"><a href="#cb26-88"></a></span>
<span id="cb26-89"><a href="#cb26-89"></a>What if my data are not continuous?</span>
<span id="cb26-90"><a href="#cb26-90"></a></span>
<span id="cb26-91"><a href="#cb26-91"></a><span class="ss">-   </span>If the independent variable is ordinal, use *ordinal regression*.</span>
<span id="cb26-92"><a href="#cb26-92"></a><span class="ss">-   </span>If the dependent variable is ordinal, use *ordinal (logistic) regression*.</span>
<span id="cb26-93"><a href="#cb26-93"></a></span>
<span id="cb26-94"><a href="#cb26-94"></a>What if I have more than one independent variable?</span>
<span id="cb26-95"><a href="#cb26-95"></a></span>
<span id="cb26-96"><a href="#cb26-96"></a><span class="ss">-   </span>Use *multiple linear regression*.</span>
<span id="cb26-97"><a href="#cb26-97"></a></span>
<span id="cb26-98"><a href="#cb26-98"></a>Additional assumptions and requirements are discussed next in @sec-linear-model-assumptions.</span>
<span id="cb26-99"><a href="#cb26-99"></a></span>
<span id="cb26-100"><a href="#cb26-100"></a><span class="fu">## Assumptions {#sec-linear-model-assumptions}</span></span>
<span id="cb26-101"><a href="#cb26-101"></a></span>
<span id="cb26-102"><a href="#cb26-102"></a>The following assumptions are made when performing a simple linear regression; 1-3 must be tested *after* fitting the linear model:</span>
<span id="cb26-103"><a href="#cb26-103"></a></span>
<span id="cb26-104"><a href="#cb26-104"></a><span class="ss">1. </span>**Normality:** For each value of $X$, there is a corresponding normal distribution of $Y$ values. Each value of $Y$ is randomly sampled from this normal distribution.</span>
<span id="cb26-105"><a href="#cb26-105"></a><span class="ss">2. </span>**Homoscedasticity:** The variances of the $Y$ distributions corresponding to each $X$ value should be approximately equal.</span>
<span id="cb26-106"><a href="#cb26-106"></a><span class="ss">3. </span>**Linearity:** There exists a linear relationship between the variables $Y$ and $X$.</span>
<span id="cb26-107"><a href="#cb26-107"></a><span class="ss">4. </span>**Measurement Error:** It is assumed that the measurements of $X$ are obtained without error. However, in practical scenarios, this is rarely the case. Therefore, we assume any measurement error in $X$ to be negligible.</span>
<span id="cb26-108"><a href="#cb26-108"></a></span>
<span id="cb26-109"><a href="#cb26-109"></a>See @sec-assumption-fails for more information about how to proceed when assumptions 1-3 are violated.</span>
<span id="cb26-110"><a href="#cb26-110"></a></span>
<span id="cb26-111"><a href="#cb26-111"></a><span class="fu">## Outliers and Their Impact on Simple Linear Regression</span></span>
<span id="cb26-112"><a href="#cb26-112"></a></span>
<span id="cb26-113"><a href="#cb26-113"></a>In simple linear regression, outliers can have significant detrimental effects on the analysis and the reliability of the results. Outliers are data points that deviate substantially from the overall pattern or trend observed in the data, and their presence can lead to biased parameter estimates, inflated standard errors, distorted confidence and prediction intervals, violation of assumptions, and masking of underlying patterns.</span>
<span id="cb26-114"><a href="#cb26-114"></a></span>
<span id="cb26-115"><a href="#cb26-115"></a>Specifically, they can greatly impact the estimation of the slope and intercept due to their influence on the process of minimising the sum of squared residuals. Their presence can increase the standard errors of the regression coefficients, making it harder to detect significant relationships between the independent and dependent variables. Furthermore, the inclusion of outliers in the dataset can distort the calculation of confidence and prediction intervals for individual observations, preventing accurate inference and prediction. Their presence may also lead to violations of the assumptions of linear regression, such as the normality of residuals and the constant variance of errors (homoscedasticity). Lastly, extreme outliers can mask underlying patterns or relationships in the data and hinder our ability to discern the true nature of the associations between variables.</span>
<span id="cb26-116"><a href="#cb26-116"></a></span>
<span id="cb26-117"><a href="#cb26-117"></a><span class="fu">## R Function</span></span>
<span id="cb26-118"><a href="#cb26-118"></a></span>
<span id="cb26-119"><a href="#cb26-119"></a>The <span class="in">`lm()`</span> function in R is used to fit linear models. It can be used to carry out simple linear regression, multiple linear regression, and more.</span>
<span id="cb26-120"><a href="#cb26-120"></a></span>
<span id="cb26-121"><a href="#cb26-121"></a>The general form of the function written in R is:</span>
<span id="cb26-122"><a href="#cb26-122"></a></span>
<span id="cb26-125"><a href="#cb26-125"></a><span class="in">```{r}</span></span>
<span id="cb26-126"><a href="#cb26-126"></a><span class="co">#| eval: FALSE</span></span>
<span id="cb26-127"><a href="#cb26-127"></a><span class="co">#| echo: TRUE</span></span>
<span id="cb26-128"><a href="#cb26-128"></a></span>
<span id="cb26-129"><a href="#cb26-129"></a><span class="fu">lm</span>(formula, data, ...)</span>
<span id="cb26-130"><a href="#cb26-130"></a><span class="in">```</span></span>
<span id="cb26-131"><a href="#cb26-131"></a></span>
<span id="cb26-132"><a href="#cb26-132"></a>where <span class="in">`formula`</span> is a symbolic description of the model to be fitted, and <span class="in">`data`</span> is the data frame containing the variables. The <span class="in">`...`</span> argument is used to pass additional arguments to the function (consult <span class="in">`?lm`</span>). For example: </span>
<span id="cb26-133"><a href="#cb26-133"></a></span>
<span id="cb26-136"><a href="#cb26-136"></a><span class="in">```{r}</span></span>
<span id="cb26-137"><a href="#cb26-137"></a><span class="co">#| eval: FALSE</span></span>
<span id="cb26-138"><a href="#cb26-138"></a><span class="co">#| echo: TRUE</span></span>
<span id="cb26-139"><a href="#cb26-139"></a></span>
<span id="cb26-140"><a href="#cb26-140"></a><span class="fu">lm</span>(y <span class="sc">~</span> x, <span class="at">data =</span> df) <span class="co"># &lt;1&gt;</span></span>
<span id="cb26-141"><a href="#cb26-141"></a><span class="in">```</span></span>
<span id="cb26-142"><a href="#cb26-142"></a><span class="ss">1. </span>You can read the statement <span class="in">`y ~ x`</span> as "y is modelled as a function of x."</span>
<span id="cb26-143"><a href="#cb26-143"></a></span>
<span id="cb26-144"><a href="#cb26-144"></a>The above statement fits a simple linear regression model with <span class="in">`y`</span> as the dependent variable and <span class="in">`x`</span> as the independent variable. The data frame <span class="in">`df`</span> contains the variables named <span class="in">`x`</span> and <span class="in">`y`</span>.</span>
<span id="cb26-145"><a href="#cb26-145"></a></span>
<span id="cb26-146"><a href="#cb26-146"></a><span class="fu">## Example: The Penguin Dataset</span></span>
<span id="cb26-147"><a href="#cb26-147"></a></span>
<span id="cb26-148"><a href="#cb26-148"></a>The following example workflow uses the <span class="in">`penguin`</span> dataset from the <span class="in">`palmerpenguins`</span> package to demonstrate how to perform a simple linear regression in R. The data are in @tbl-penguins.</span>
<span id="cb26-149"><a href="#cb26-149"></a></span>
<span id="cb26-150"><a href="#cb26-150"></a>Although we can also do a correlation here, we will use a simple linear regression because we want to develop a predictive model that can be used to estimate the bill length of Adelie penguins based on their body mass---this is a permissible application of a simple linear regression even though the two variables are not assumed to be causally related.</span>
<span id="cb26-151"><a href="#cb26-151"></a></span>
<span id="cb26-152"><a href="#cb26-152"></a></span>
<span id="cb26-155"><a href="#cb26-155"></a><span class="in">```{r}</span></span>
<span id="cb26-156"><a href="#cb26-156"></a><span class="co">#| echo: false</span></span>
<span id="cb26-157"><a href="#cb26-157"></a><span class="co">#| messages: false</span></span>
<span id="cb26-158"><a href="#cb26-158"></a><span class="co">#| warning: false</span></span>
<span id="cb26-159"><a href="#cb26-159"></a></span>
<span id="cb26-160"><a href="#cb26-160"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb26-161"><a href="#cb26-161"></a><span class="fu">library</span>(palmerpenguins)</span>
<span id="cb26-162"><a href="#cb26-162"></a><span class="fu">library</span>(ggpubr)</span>
<span id="cb26-163"><a href="#cb26-163"></a><span class="fu">library</span>(gt)</span>
<span id="cb26-164"><a href="#cb26-164"></a><span class="in">```</span></span>
<span id="cb26-165"><a href="#cb26-165"></a></span>
<span id="cb26-168"><a href="#cb26-168"></a><span class="in">```{r}</span></span>
<span id="cb26-169"><a href="#cb26-169"></a><span class="co">#| echo: false</span></span>
<span id="cb26-170"><a href="#cb26-170"></a><span class="co">#| tbl-cap: "Size measurements for adult foraging Adelie penguins near Palmer Station, Antarctica."</span></span>
<span id="cb26-171"><a href="#cb26-171"></a><span class="co">#| label: tbl-penguins</span></span>
<span id="cb26-172"><a href="#cb26-172"></a></span>
<span id="cb26-173"><a href="#cb26-173"></a>Adelie <span class="ot">&lt;-</span> penguins[penguins<span class="sc">$</span>species <span class="sc">==</span> <span class="st">"Adelie"</span>,] </span>
<span id="cb26-174"><a href="#cb26-174"></a>Adelie <span class="ot">&lt;-</span> Adelie[<span class="sc">-</span><span class="dv">4</span>,] <span class="co"># drop the fourth case with NAs</span></span>
<span id="cb26-175"><a href="#cb26-175"></a></span>
<span id="cb26-176"><a href="#cb26-176"></a>Adelie <span class="sc">|&gt;</span> </span>
<span id="cb26-177"><a href="#cb26-177"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="sc">-</span>species, <span class="sc">-</span>island, <span class="sc">-</span>bill_depth_mm, <span class="sc">-</span>flipper_length_mm, <span class="sc">-</span>sex, <span class="sc">-</span>year) <span class="sc">|&gt;</span></span>
<span id="cb26-178"><a href="#cb26-178"></a>  <span class="fu">head</span>() <span class="sc">|&gt;</span> </span>
<span id="cb26-179"><a href="#cb26-179"></a>  <span class="fu">gt</span>() <span class="sc">|&gt;</span> </span>
<span id="cb26-180"><a href="#cb26-180"></a>  <span class="fu">cols_label</span>(</span>
<span id="cb26-181"><a href="#cb26-181"></a>    <span class="at">bill_length_mm =</span> <span class="fu">html</span>(<span class="st">"Bill length (mm)"</span>),</span>
<span id="cb26-182"><a href="#cb26-182"></a>    <span class="at">body_mass_g =</span> <span class="fu">html</span>(<span class="st">"Body mass (g)"</span>)</span>
<span id="cb26-183"><a href="#cb26-183"></a>  )</span>
<span id="cb26-184"><a href="#cb26-184"></a><span class="in">```</span></span>
<span id="cb26-185"><a href="#cb26-185"></a></span>
<span id="cb26-186"><a href="#cb26-186"></a><span class="fu">### Do an Exploratory Data Analysis (EDA)</span></span>
<span id="cb26-187"><a href="#cb26-187"></a></span>
<span id="cb26-190"><a href="#cb26-190"></a><span class="in">```{r}</span></span>
<span id="cb26-191"><a href="#cb26-191"></a><span class="co">#| echo: true</span></span>
<span id="cb26-192"><a href="#cb26-192"></a><span class="co">#| messages: false</span></span>
<span id="cb26-193"><a href="#cb26-193"></a><span class="co">#| warning: false</span></span>
<span id="cb26-194"><a href="#cb26-194"></a></span>
<span id="cb26-195"><a href="#cb26-195"></a><span class="fu">dim</span>(Adelie)</span>
<span id="cb26-196"><a href="#cb26-196"></a><span class="fu">summary</span>(Adelie)</span>
<span id="cb26-197"><a href="#cb26-197"></a><span class="in">```</span></span>
<span id="cb26-198"><a href="#cb26-198"></a></span>
<span id="cb26-199"><a href="#cb26-199"></a>We see that the dataset contains 344 observations of 8 variables. We shall focus on the <span class="in">`body_mass_g`</span> and <span class="in">`bill_length_mm`</span> variables for this example. Importantly, the two variables are continuous, which seems to satisfy the requirements for a simple linear regression. We will also restrict this analysis to the <span class="in">`Adelie`</span> penguins ($n = 152$). Is the relationship between the body mass and bill length of the penguins linear? Let's find out.</span>
<span id="cb26-200"><a href="#cb26-200"></a></span>
<span id="cb26-201"><a href="#cb26-201"></a><span class="fu">### Create a Plot</span></span>
<span id="cb26-202"><a href="#cb26-202"></a></span>
<span id="cb26-203"><a href="#cb26-203"></a>Construct a scatter plot of the data and include a best fit straight line:</span>
<span id="cb26-204"><a href="#cb26-204"></a></span>
<span id="cb26-207"><a href="#cb26-207"></a><span class="in">```{r}</span></span>
<span id="cb26-208"><a href="#cb26-208"></a><span class="co">#| echo: true</span></span>
<span id="cb26-209"><a href="#cb26-209"></a><span class="co">#| fig.cap: "Scatter plot of the Palmer Station Adelie penguin data with a best fit line."</span></span>
<span id="cb26-210"><a href="#cb26-210"></a><span class="co">#| label: fig-lm</span></span>
<span id="cb26-211"><a href="#cb26-211"></a><span class="co">#| fig.width: 4</span></span>
<span id="cb26-212"><a href="#cb26-212"></a><span class="co">#| fig.height: 2</span></span>
<span id="cb26-213"><a href="#cb26-213"></a><span class="co">#| fig.align: center</span></span>
<span id="cb26-214"><a href="#cb26-214"></a></span>
<span id="cb26-215"><a href="#cb26-215"></a><span class="fu">ggplot</span>(Adelie,</span>
<span id="cb26-216"><a href="#cb26-216"></a>       <span class="fu">aes</span>(<span class="at">x =</span> body_mass_g, <span class="at">y =</span> bill_length_mm)) <span class="sc">+</span></span>
<span id="cb26-217"><a href="#cb26-217"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb26-218"><a href="#cb26-218"></a>  <span class="fu">geom_smooth</span>(<span class="at">method =</span> <span class="st">"lm"</span>, <span class="at">se =</span> <span class="cn">FALSE</span>) <span class="sc">+</span></span>
<span id="cb26-219"><a href="#cb26-219"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"Body mass (g)"</span>, <span class="at">y =</span> <span class="st">"Bill length (mm)"</span>) <span class="sc">+</span></span>
<span id="cb26-220"><a href="#cb26-220"></a>  <span class="fu">theme_minimal</span>()</span>
<span id="cb26-221"><a href="#cb26-221"></a><span class="in">```</span></span>
<span id="cb26-222"><a href="#cb26-222"></a></span>
<span id="cb26-223"><a href="#cb26-223"></a>Although there is some scatter in the data (@fig-lm), there appears to be a positive relationship between the body mass and bill length of the penguins. This relationship might be amenable for modelling with a linear relationship and we shall continue to explore this.</span>
<span id="cb26-224"><a href="#cb26-224"></a></span>
<span id="cb26-225"><a href="#cb26-225"></a><span class="fu">### State the Hypothesis</span></span>
<span id="cb26-226"><a href="#cb26-226"></a></span>
<span id="cb26-227"><a href="#cb26-227"></a><span class="ss">-   </span>Null Hypothesis ($H_0$): there is no relationship between the body mass of the penguins and their bill length. </span>
<span id="cb26-228"><a href="#cb26-228"></a><span class="ss">-   </span>Alternative Hypothesis ($H_A$): there is a relationship between the two variables.</span>
<span id="cb26-229"><a href="#cb26-229"></a></span>
<span id="cb26-230"><a href="#cb26-230"></a>This can be written as:</span>
<span id="cb26-231"><a href="#cb26-231"></a></span>
<span id="cb26-232"><a href="#cb26-232"></a>$$H_{0}:\beta = 0$$ {#eq-h0}</span>
<span id="cb26-233"><a href="#cb26-233"></a></span>
<span id="cb26-234"><a href="#cb26-234"></a>As seen above, this hypothesis concerns the slope of the regression line, $\beta$. If the slope is zero, then there is no relationship between the two variables. Regression models also tests an hypothesis about the intercept, $\alpha$, but this is less commonly reported.</span>
<span id="cb26-235"><a href="#cb26-235"></a></span>
<span id="cb26-236"><a href="#cb26-236"></a><span class="fu">### Fit the Model {#sec-fit-model}</span></span>
<span id="cb26-237"><a href="#cb26-237"></a></span>
<span id="cb26-238"><a href="#cb26-238"></a>Since the assumptions of a linear regression can only be tested *after* fitting the model, we first fit the model and then test the assumptions.</span>
<span id="cb26-239"><a href="#cb26-239"></a></span>
<span id="cb26-242"><a href="#cb26-242"></a><span class="in">```{r}</span></span>
<span id="cb26-243"><a href="#cb26-243"></a><span class="co">#| echo: true</span></span>
<span id="cb26-244"><a href="#cb26-244"></a></span>
<span id="cb26-245"><a href="#cb26-245"></a>mod1 <span class="ot">&lt;-</span> <span class="fu">lm</span>(bill_length_mm <span class="sc">~</span> body_mass_g,</span>
<span id="cb26-246"><a href="#cb26-246"></a>           <span class="at">data =</span> Adelie)</span>
<span id="cb26-247"><a href="#cb26-247"></a><span class="fu">summary</span>(mod1)</span>
<span id="cb26-248"><a href="#cb26-248"></a><span class="in">```</span></span>
<span id="cb26-249"><a href="#cb26-249"></a></span>
<span id="cb26-250"><a href="#cb26-250"></a><span class="fu">### Test the Assumptions</span></span>
<span id="cb26-251"><a href="#cb26-251"></a></span>
<span id="cb26-252"><a href="#cb26-252"></a>Assumptions of normality, homoscedasticity, and linearity must be tested (@sec-assumptions). </span>
<span id="cb26-253"><a href="#cb26-253"></a></span>
<span id="cb26-254"><a href="#cb26-254"></a>We already noted that a linear model will probably be appropriate for the data (see @fig-lm), so we proceed with the other assumptions.</span>
<span id="cb26-255"><a href="#cb26-255"></a></span>
<span id="cb26-256"><a href="#cb26-256"></a>To facilitate the production of the diagnostic plots, we will use the **broom** package's <span class="in">`augment()`</span> function to add the residuals to the data within the original dataset (now appearing as the tidied dataset, <span class="in">`mod1_data`</span>). This will allow us to create the diagnostic plots more easily, and later we can also use it to look for the presence of outliers (@sec-outlier-test).</span>
<span id="cb26-257"><a href="#cb26-257"></a></span>
<span id="cb26-260"><a href="#cb26-260"></a><span class="in">```{r}</span></span>
<span id="cb26-261"><a href="#cb26-261"></a><span class="fu">library</span>(broom)</span>
<span id="cb26-262"><a href="#cb26-262"></a></span>
<span id="cb26-263"><a href="#cb26-263"></a>mod1_data <span class="ot">&lt;-</span> <span class="fu">augment</span>(mod1)</span>
<span id="cb26-264"><a href="#cb26-264"></a><span class="in">```</span></span>
<span id="cb26-265"><a href="#cb26-265"></a></span>
<span id="cb26-266"><a href="#cb26-266"></a>**Normality**</span>
<span id="cb26-267"><a href="#cb26-267"></a></span>
<span id="cb26-268"><a href="#cb26-268"></a>I first check the normality assumption using one of several options (Options 1-3). Here I use the Shapiro-Wilk test, a Residual Q-Q plot, and a histogram of the residuals. </span>
<span id="cb26-269"><a href="#cb26-269"></a></span>
<span id="cb26-270"><a href="#cb26-270"></a>**Option 1**: Perform the Shapiro-Wilk test on the residuals. The Shapiro-Wilk test is useful for detecting departures from normality in small sample sizes. The hypothesis is:</span>
<span id="cb26-271"><a href="#cb26-271"></a></span>
<span id="cb26-272"><a href="#cb26-272"></a><span class="ss">-   </span>H~0~: the residuals are normally distributed.</span>
<span id="cb26-273"><a href="#cb26-273"></a><span class="ss">-   </span>H~A~: the residuals are not normally distributed.</span>
<span id="cb26-274"><a href="#cb26-274"></a></span>
<span id="cb26-277"><a href="#cb26-277"></a><span class="in">```{r}</span></span>
<span id="cb26-278"><a href="#cb26-278"></a><span class="co">#| echo: true</span></span>
<span id="cb26-279"><a href="#cb26-279"></a></span>
<span id="cb26-280"><a href="#cb26-280"></a><span class="fu">shapiro.test</span>(<span class="fu">residuals</span>(mod1))</span>
<span id="cb26-281"><a href="#cb26-281"></a><span class="in">```</span></span>
<span id="cb26-282"><a href="#cb26-282"></a></span>
<span id="cb26-283"><a href="#cb26-283"></a>The *p*-value is greater than 0.05, so I reject the alternative hypothesis. I conclude that the residuals are normally distributed.</span>
<span id="cb26-284"><a href="#cb26-284"></a></span>
<span id="cb26-285"><a href="#cb26-285"></a>**Option 2**: Create a Residual Q-Q plot to visually assess the normality of the residuals:</span>
<span id="cb26-286"><a href="#cb26-286"></a></span>
<span id="cb26-289"><a href="#cb26-289"></a><span class="in">```{r}</span></span>
<span id="cb26-290"><a href="#cb26-290"></a><span class="co">#| echo: false</span></span>
<span id="cb26-291"><a href="#cb26-291"></a><span class="co">#| fig.cap: "Diagnostics plots the linear regression, `mod1`, for assumption testing."</span></span>
<span id="cb26-292"><a href="#cb26-292"></a><span class="co">#| label: fig-assump-plots</span></span>
<span id="cb26-293"><a href="#cb26-293"></a><span class="co">#| fig.width: 6</span></span>
<span id="cb26-294"><a href="#cb26-294"></a><span class="co">#| fig.height: 4</span></span>
<span id="cb26-295"><a href="#cb26-295"></a><span class="co">#| fig.align: center</span></span>
<span id="cb26-296"><a href="#cb26-296"></a></span>
<span id="cb26-297"><a href="#cb26-297"></a><span class="co"># Normal Q-Q ... plot(mod1, which = 2)</span></span>
<span id="cb26-298"><a href="#cb26-298"></a>p1 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(mod1_data, <span class="fu">aes</span>(<span class="at">sample =</span> .resid)) <span class="sc">+</span></span>
<span id="cb26-299"><a href="#cb26-299"></a>  <span class="fu">stat_qq</span>(<span class="at">shape =</span> <span class="dv">1</span>, <span class="at">colour =</span> <span class="st">"pink"</span>) <span class="sc">+</span></span>
<span id="cb26-300"><a href="#cb26-300"></a>  <span class="fu">stat_qq_line</span>(<span class="at">colour =</span> <span class="st">"steelblue4"</span>) <span class="sc">+</span></span>
<span id="cb26-301"><a href="#cb26-301"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Normal Q-Q"</span>, <span class="at">x =</span> <span class="st">"Theoretical Quantiles"</span>, <span class="at">y =</span> <span class="st">"Sample Quantiles"</span>) <span class="sc">+</span></span>
<span id="cb26-302"><a href="#cb26-302"></a>  <span class="fu">theme_minimal</span>()</span>
<span id="cb26-303"><a href="#cb26-303"></a></span>
<span id="cb26-304"><a href="#cb26-304"></a><span class="co"># Histogram of residuals ... hist(residuals(mod1))</span></span>
<span id="cb26-305"><a href="#cb26-305"></a>p2 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(mod1_data, <span class="fu">aes</span>(<span class="at">x =</span> .resid)) <span class="sc">+</span></span>
<span id="cb26-306"><a href="#cb26-306"></a>  <span class="fu">geom_histogram</span>(<span class="at">binwidth =</span> <span class="dv">1</span>, <span class="at">fill =</span> <span class="st">"pink"</span>, <span class="at">color =</span> <span class="st">"pink"</span>) <span class="sc">+</span></span>
<span id="cb26-307"><a href="#cb26-307"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Histogram of Residuals"</span>, <span class="at">x =</span> <span class="st">"Residuals"</span>, <span class="at">y =</span> <span class="st">"Frequency"</span>) <span class="sc">+</span></span>
<span id="cb26-308"><a href="#cb26-308"></a>  <span class="fu">theme_minimal</span>()</span>
<span id="cb26-309"><a href="#cb26-309"></a></span>
<span id="cb26-310"><a href="#cb26-310"></a><span class="co"># Residuals vs Fitted ... plot(mod1, which = 1)</span></span>
<span id="cb26-311"><a href="#cb26-311"></a>p3 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(mod1_data, <span class="fu">aes</span>(<span class="at">x =</span> .fitted, <span class="at">y =</span> .resid)) <span class="sc">+</span></span>
<span id="cb26-312"><a href="#cb26-312"></a>  <span class="fu">geom_point</span>(<span class="at">shape =</span> <span class="dv">1</span>, <span class="at">colour =</span> <span class="st">"pink"</span>) <span class="sc">+</span></span>
<span id="cb26-313"><a href="#cb26-313"></a>  <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="dv">0</span>, <span class="at">linetype =</span> <span class="st">"dashed"</span>) <span class="sc">+</span></span>
<span id="cb26-314"><a href="#cb26-314"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Residuals vs Fitted"</span>, <span class="at">x =</span> <span class="st">"Fitted values"</span>, <span class="at">y =</span> <span class="st">"Residuals"</span>) <span class="sc">+</span></span>
<span id="cb26-315"><a href="#cb26-315"></a>  <span class="fu">theme_minimal</span>()</span>
<span id="cb26-316"><a href="#cb26-316"></a></span>
<span id="cb26-317"><a href="#cb26-317"></a><span class="co"># Scale-Location ... plot(mod1, which = 3)</span></span>
<span id="cb26-318"><a href="#cb26-318"></a>p4 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(mod1_data, <span class="fu">aes</span>(<span class="at">x =</span> .fitted, <span class="at">y =</span> <span class="fu">sqrt</span>(<span class="fu">abs</span>(.resid)))) <span class="sc">+</span></span>
<span id="cb26-319"><a href="#cb26-319"></a>  <span class="fu">geom_point</span>(<span class="at">shape =</span> <span class="dv">1</span>, <span class="at">colour =</span> <span class="st">"pink"</span>) <span class="sc">+</span></span>
<span id="cb26-320"><a href="#cb26-320"></a>  <span class="fu">geom_smooth</span>(<span class="at">se =</span> <span class="cn">FALSE</span>, <span class="at">colour =</span> <span class="st">"steelblue4"</span>) <span class="sc">+</span></span>
<span id="cb26-321"><a href="#cb26-321"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Scale-Location"</span>, <span class="at">x =</span> <span class="st">"Fitted values"</span>, <span class="at">y =</span> <span class="st">"Sq. Root |Resid.|"</span>) <span class="sc">+</span></span>
<span id="cb26-322"><a href="#cb26-322"></a>  <span class="fu">theme_minimal</span>()</span>
<span id="cb26-323"><a href="#cb26-323"></a></span>
<span id="cb26-324"><a href="#cb26-324"></a><span class="co"># Arrange the plots</span></span>
<span id="cb26-325"><a href="#cb26-325"></a><span class="fu">ggarrange</span>(p1, p2, p3, p4, <span class="at">nrow =</span> <span class="dv">2</span>, <span class="at">ncol =</span> <span class="dv">2</span>, <span class="at">labels =</span> <span class="st">"AUTO"</span>)</span>
<span id="cb26-326"><a href="#cb26-326"></a><span class="in">```</span></span>
<span id="cb26-327"><a href="#cb26-327"></a></span>
<span id="cb26-328"><a href="#cb26-328"></a>The residuals are plotted against a theoretical normal distribution. The residuals fall along the line without major deviations, therefore the residuals are normally distributed (@fig-assump-plots A).</span>
<span id="cb26-329"><a href="#cb26-329"></a></span>
<span id="cb26-330"><a href="#cb26-330"></a>**Option 3**: Create a histogram of the residuals to visually assess the normality of the residuals:</span>
<span id="cb26-331"><a href="#cb26-331"></a></span>
<span id="cb26-332"><a href="#cb26-332"></a>The histogram of the residuals appears to be normally distributed (@fig-assump-plots B).</span>
<span id="cb26-333"><a href="#cb26-333"></a></span>
<span id="cb26-334"><a href="#cb26-334"></a>**Homoscedasticity**</span>
<span id="cb26-335"><a href="#cb26-335"></a></span>
<span id="cb26-336"><a href="#cb26-336"></a>I now examine the homoscedasticity assumption. The residuals should be approximately equal across all values of the independent variable. There are several options.</span>
<span id="cb26-337"><a href="#cb26-337"></a></span>
<span id="cb26-338"><a href="#cb26-338"></a>**Option 1**: I will use the Breusch-Pagan test to test for homoscedasticity.</span>
<span id="cb26-339"><a href="#cb26-339"></a></span>
<span id="cb26-340"><a href="#cb26-340"></a>The Breusch-Pagan test is used to assess the presence of heteroscedasticity (non-constant variance) in the residuals of a regression model.</span>
<span id="cb26-341"><a href="#cb26-341"></a></span>
<span id="cb26-342"><a href="#cb26-342"></a>The hypothesis is:</span>
<span id="cb26-343"><a href="#cb26-343"></a></span>
<span id="cb26-344"><a href="#cb26-344"></a><span class="ss">-   </span>H~0~: the residuals are homoscedastic.</span>
<span id="cb26-345"><a href="#cb26-345"></a><span class="ss">-   </span>H~A~: the residuals are heteroscedastic.</span>
<span id="cb26-346"><a href="#cb26-346"></a></span>
<span id="cb26-349"><a href="#cb26-349"></a><span class="in">```{r}</span></span>
<span id="cb26-350"><a href="#cb26-350"></a><span class="fu">library</span>(lmtest)</span>
<span id="cb26-351"><a href="#cb26-351"></a><span class="fu">bptest</span>(mod1)</span>
<span id="cb26-352"><a href="#cb26-352"></a><span class="in">```</span></span>
<span id="cb26-353"><a href="#cb26-353"></a></span>
<span id="cb26-354"><a href="#cb26-354"></a>The *p*-value is greater than 0.05, so I reject the alternative hypothesis. I conclude that the residuals are homoscedastic.</span>
<span id="cb26-355"><a href="#cb26-355"></a></span>
<span id="cb26-356"><a href="#cb26-356"></a>**Option 2**: Create a plot of the residuals against the fitted values to visually assess homoscedasticity:</span>
<span id="cb26-357"><a href="#cb26-357"></a></span>
<span id="cb26-358"><a href="#cb26-358"></a>The residuals are scattered evenly around zero from short through to long bill lengths, indicating that the residuals have constant variance (@fig-assump-plots C).</span>
<span id="cb26-359"><a href="#cb26-359"></a></span>
<span id="cb26-360"><a href="#cb26-360"></a>**Option 3**: Create a plot of the standardised residuals against the independent variable to visually assess homoscedasticity:</span>
<span id="cb26-361"><a href="#cb26-361"></a></span>
<span id="cb26-362"><a href="#cb26-362"></a>The residuals are scattered evenly around zero from low through to high bill lenghts, indicating that the residuals have constant variance (@fig-assump-plots D).</span>
<span id="cb26-363"><a href="#cb26-363"></a></span>
<span id="cb26-364"><a href="#cb26-364"></a>Other tests for homoscedasticity include the Goldfeld-Quandt (<span class="in">`lmtest::gqtest`</span>) test, Levene's test (<span class="in">`car::leveneTest`</span>), and others.</span>
<span id="cb26-365"><a href="#cb26-365"></a></span>
<span id="cb26-366"><a href="#cb26-366"></a><span class="fu">### Check for outliers {#sec-outlier-test}</span></span>
<span id="cb26-367"><a href="#cb26-367"></a></span>
<span id="cb26-368"><a href="#cb26-368"></a>How do we identify outliers in linear regression analysis? There are several approaches (see @fig-lm2-outliers1):</span>
<span id="cb26-369"><a href="#cb26-369"></a></span>
<span id="cb26-370"><a href="#cb26-370"></a><span class="ss">1. </span>**Difference in Fits (DFFITS):** DFFITS is a measure of the impact of each observation on the predicted values (fitted values) of the model. It quantifies how much the predicted values would change if an observation were removed from the analysis. DFFITS values &gt; $\text{Threshold} = 2 \sqrt{\frac{p}{n}}$ indicate observations that have a substantial impact on the predicted values and may be influential or outliers. Here, $p$ is the number of parameters in the model (including the intercept, i.e. 2 in a simple linear regression)  and $n$ is the number of observations. </span>
<span id="cb26-371"><a href="#cb26-371"></a></span>
<span id="cb26-372"><a href="#cb26-372"></a><span class="ss">2. </span>**Cook's Distance Plot:** Cook's distance is a measure of the influence of each observation on the estimated regression coefficients. The Cook's distance plot shows the Cook's distance values for each observation against the row numbers (or observation numbers). Points with large Cook's distance values (typically greater than $\frac{4}{n}$) indicate observations that are potentially influential and may have a significant impact on the regression results.</span>
<span id="cb26-373"><a href="#cb26-373"></a></span>
<span id="cb26-374"><a href="#cb26-374"></a><span class="ss">3. </span>**Residuals vs Leverage Plot:** This plot displays the standardised residuals against the leverage values (hat values) for each observation. Leverage values measure the influence of an observation on the fitted values (predicted values) of the model. The plot helps identify outliers and influential observations. Points with high leverage (typically greater than 2-3 times the average leverage) and large residuals are considered influential observations that may warrant further investigation or potential removal from the analysis.</span>
<span id="cb26-375"><a href="#cb26-375"></a></span>
<span id="cb26-376"><a href="#cb26-376"></a><span class="ss">4. </span>**Cook's Distance vs Lev./(1-Lev.) Plot:** This plot combines information from Cook's distance and leverage values. The *x*-axis represents the leverage values divided by (1 minus the leverage values), which is a transformation that spreads out the points for better visualisation. The *y*-axis shows the Cook's distance values. This plot helps identify influential observations by considering both their impact on the regression coefficients (Cook's distance) and their influence on the fitted values (leverage). Points in the top-right corner of the plot indicate observations that are potentially influential and may require further examination or removal.</span>
<span id="cb26-377"><a href="#cb26-377"></a></span>
<span id="cb26-380"><a href="#cb26-380"></a><span class="in">```{r}</span></span>
<span id="cb26-381"><a href="#cb26-381"></a><span class="co">#| echo: true</span></span>
<span id="cb26-382"><a href="#cb26-382"></a><span class="co">#| messages: false</span></span>
<span id="cb26-383"><a href="#cb26-383"></a><span class="co">#| warning: false</span></span>
<span id="cb26-384"><a href="#cb26-384"></a></span>
<span id="cb26-385"><a href="#cb26-385"></a>cooksd_thresh <span class="ot">&lt;-</span> <span class="dv">4</span> <span class="sc">/</span> <span class="fu">nrow</span>(mod1_data) <span class="co"># &lt;1&gt;</span></span>
<span id="cb26-386"><a href="#cb26-386"></a>dffits_threshold <span class="ot">&lt;-</span> <span class="dv">2</span> <span class="sc">*</span> <span class="fu">sqrt</span>(<span class="dv">2</span> <span class="sc">/</span> <span class="fu">nrow</span>(Adelie)) <span class="co"># &lt;2&gt;</span></span>
<span id="cb26-387"><a href="#cb26-387"></a></span>
<span id="cb26-388"><a href="#cb26-388"></a>mod1_data <span class="ot">&lt;-</span> mod1_data <span class="sc">%&gt;%</span></span>
<span id="cb26-389"><a href="#cb26-389"></a>  <span class="fu">mutate</span>(<span class="at">index =</span> <span class="fu">row_number</span>(),</span>
<span id="cb26-390"><a href="#cb26-390"></a>         <span class="at">leverage =</span> <span class="fu">hatvalues</span>(mod1),</span>
<span id="cb26-391"><a href="#cb26-391"></a>         <span class="at">dffits =</span> <span class="fu">dffits</span>(mod1),</span>
<span id="cb26-392"><a href="#cb26-392"></a>         <span class="at">colour =</span> <span class="fu">ifelse</span>(.cooksd <span class="sc">&gt;</span> cooksd_thresh, <span class="st">"black"</span>, <span class="st">"pink"</span>))</span>
<span id="cb26-393"><a href="#cb26-393"></a><span class="in">```</span></span>
<span id="cb26-394"><a href="#cb26-394"></a><span class="ss">1. </span>Calculate thresholds for Cook's distance.</span>
<span id="cb26-395"><a href="#cb26-395"></a><span class="ss">2. </span>Calculate the threshold for DFFITS.</span>
<span id="cb26-396"><a href="#cb26-396"></a></span>
<span id="cb26-399"><a href="#cb26-399"></a><span class="in">```{r}</span></span>
<span id="cb26-400"><a href="#cb26-400"></a><span class="co">#| echo: false</span></span>
<span id="cb26-401"><a href="#cb26-401"></a><span class="co">#| messages: false</span></span>
<span id="cb26-402"><a href="#cb26-402"></a><span class="co">#| warning: false</span></span>
<span id="cb26-403"><a href="#cb26-403"></a><span class="co">#| fig.cap: "Diagnostic plots for visual inspection of outliers in the pernguin data. A) Difference in Fits (DFFITS) for `mod1`. B) Cook's distance. C) Residuals vs. leverage. D) Cook's distance vs. Lev./(1-Lev.). Outliers are identified beyond the Cook's distance threshold (4/*n*) and are plotted in black and their row numbers in dark red. The vertical dashed blue lines in C) and D) are positioned at 2 times the average leverage. The horizontal red dashed lines in B) and D) are located at the Cook's distance threshold. A) to C) are custom **ggplot2** plots corresponding to `plot(mod1, which = c(4, 5, 6))`."</span></span>
<span id="cb26-404"><a href="#cb26-404"></a><span class="co">#| label: fig-lm2-outliers1</span></span>
<span id="cb26-405"><a href="#cb26-405"></a><span class="co">#| fig.width: 6</span></span>
<span id="cb26-406"><a href="#cb26-406"></a><span class="co">#| fig.height: 4</span></span>
<span id="cb26-407"><a href="#cb26-407"></a><span class="co">#| fig.align: center</span></span>
<span id="cb26-408"><a href="#cb26-408"></a><span class="co">#| fig-pos: "h"</span></span>
<span id="cb26-409"><a href="#cb26-409"></a></span>
<span id="cb26-410"><a href="#cb26-410"></a><span class="co"># Plot DFFITS values using ggplot2</span></span>
<span id="cb26-411"><a href="#cb26-411"></a>plt1 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(mod1_data, <span class="fu">aes</span>(<span class="at">x =</span> index, <span class="at">y =</span> dffits)) <span class="sc">+</span></span>
<span id="cb26-412"><a href="#cb26-412"></a>  <span class="fu">geom_bar</span>(<span class="at">stat =</span> <span class="st">"identity"</span>, <span class="at">fill =</span> <span class="fu">ifelse</span>(<span class="fu">abs</span>(mod1_data<span class="sc">$</span>dffits) <span class="sc">&gt;</span> dffits_threshold, <span class="st">"black"</span>, <span class="st">"pink"</span>)) <span class="sc">+</span></span>
<span id="cb26-413"><a href="#cb26-413"></a>  <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> dffits_threshold, <span class="at">linetype =</span> <span class="st">"dashed"</span>, <span class="at">colour =</span> <span class="st">"red"</span>) <span class="sc">+</span></span>
<span id="cb26-414"><a href="#cb26-414"></a>  <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="sc">-</span>dffits_threshold, <span class="at">linetype =</span> <span class="st">"dashed"</span>, <span class="at">colour =</span> <span class="st">"red"</span>) <span class="sc">+</span></span>
<span id="cb26-415"><a href="#cb26-415"></a>  <span class="fu">geom_text</span>(<span class="fu">aes</span>(<span class="at">label =</span> <span class="fu">ifelse</span>(<span class="fu">abs</span>(dffits) <span class="sc">&gt;</span> dffits_threshold, <span class="fu">as.character</span>(index), <span class="st">""</span>)),</span>
<span id="cb26-416"><a href="#cb26-416"></a>            <span class="at">hjust =</span> <span class="fl">1.0</span>, <span class="at">vjust =</span> <span class="fl">1.0</span>, <span class="at">colour =</span> <span class="st">"darkred"</span>) <span class="sc">+</span></span>
<span id="cb26-417"><a href="#cb26-417"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"Observation Index"</span>,</span>
<span id="cb26-418"><a href="#cb26-418"></a>       <span class="at">y =</span> <span class="st">"DFFITS"</span>) <span class="sc">+</span></span>
<span id="cb26-419"><a href="#cb26-419"></a>  <span class="fu">theme_minimal</span>()</span>
<span id="cb26-420"><a href="#cb26-420"></a></span>
<span id="cb26-421"><a href="#cb26-421"></a><span class="co"># Plot Cook's Distance using ggplot2</span></span>
<span id="cb26-422"><a href="#cb26-422"></a>plt2 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(mod1_data, <span class="fu">aes</span>(<span class="at">x =</span> index, <span class="at">y =</span> .cooksd, <span class="at">fill =</span> colour)) <span class="sc">+</span></span>
<span id="cb26-423"><a href="#cb26-423"></a>  <span class="fu">geom_bar</span>(<span class="at">stat =</span> <span class="st">"identity"</span>) <span class="sc">+</span></span>
<span id="cb26-424"><a href="#cb26-424"></a>  <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> cooksd_thresh, <span class="at">linetype =</span> <span class="st">"dashed"</span>, <span class="at">color =</span> <span class="st">"red"</span>) <span class="sc">+</span></span>
<span id="cb26-425"><a href="#cb26-425"></a>  <span class="fu">geom_text</span>(<span class="fu">aes</span>(<span class="at">label =</span> <span class="fu">ifelse</span>(.cooksd <span class="sc">&gt;</span> cooksd_thresh, <span class="fu">as.character</span>(index), <span class="st">""</span>)),</span>
<span id="cb26-426"><a href="#cb26-426"></a>            <span class="at">hjust =</span> <span class="fl">1.2</span>, <span class="at">vjust =</span> <span class="fl">1.0</span>, <span class="at">color =</span> <span class="st">"darkred"</span>) <span class="sc">+</span></span>
<span id="cb26-427"><a href="#cb26-427"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"Observation Index"</span>, <span class="at">y =</span> <span class="st">"Cook's Dist."</span>) <span class="sc">+</span></span>
<span id="cb26-428"><a href="#cb26-428"></a>  <span class="fu">scale_fill_identity</span>() <span class="sc">+</span></span>
<span id="cb26-429"><a href="#cb26-429"></a>  <span class="fu">theme_minimal</span>()</span>
<span id="cb26-430"><a href="#cb26-430"></a></span>
<span id="cb26-431"><a href="#cb26-431"></a><span class="co"># Plot Residuals vs Leverage using ggplot2</span></span>
<span id="cb26-432"><a href="#cb26-432"></a>plt3 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(mod1_data, <span class="fu">aes</span>(<span class="at">x =</span> .hat, <span class="at">y =</span> .std.resid)) <span class="sc">+</span></span>
<span id="cb26-433"><a href="#cb26-433"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">size =</span> .cooksd, <span class="at">colour =</span> colour), <span class="at">shape =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb26-434"><a href="#cb26-434"></a>  <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="dv">0</span>, <span class="at">linetype =</span> <span class="st">"dashed"</span>, <span class="at">colour =</span> <span class="st">"black"</span>) <span class="sc">+</span></span>
<span id="cb26-435"><a href="#cb26-435"></a>  <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> <span class="dv">2</span> <span class="sc">*</span> <span class="fu">mean</span>(mod1_data<span class="sc">$</span>.hat), <span class="at">linetype =</span> <span class="st">"dashed"</span>, <span class="at">colour =</span> <span class="st">"blue"</span>) <span class="sc">+</span></span>
<span id="cb26-436"><a href="#cb26-436"></a>  <span class="fu">geom_smooth</span>(<span class="at">method =</span> <span class="st">"loess"</span>, <span class="at">se =</span> <span class="cn">FALSE</span>, <span class="at">colour =</span> <span class="st">"steelblue4"</span>) <span class="sc">+</span></span>
<span id="cb26-437"><a href="#cb26-437"></a>  <span class="fu">geom_text</span>(<span class="fu">aes</span>(<span class="at">label =</span> <span class="fu">ifelse</span>(.cooksd <span class="sc">&gt;</span> cooksd_thresh, <span class="fu">as.character</span>(index), <span class="st">""</span>)),</span>
<span id="cb26-438"><a href="#cb26-438"></a>            <span class="at">hjust =</span> <span class="fl">1.0</span>, <span class="at">vjust =</span> <span class="fl">1.0</span>, <span class="at">colour =</span> <span class="st">"darkred"</span>) <span class="sc">+</span></span>
<span id="cb26-439"><a href="#cb26-439"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"Leverage"</span>,</span>
<span id="cb26-440"><a href="#cb26-440"></a>       <span class="at">y =</span> <span class="st">"Std. Resid."</span>,</span>
<span id="cb26-441"><a href="#cb26-441"></a>       <span class="at">size =</span> <span class="st">"Cook's Distance"</span>) <span class="sc">+</span></span>
<span id="cb26-442"><a href="#cb26-442"></a>  <span class="fu">scale_colour_identity</span>() <span class="sc">+</span></span>
<span id="cb26-443"><a href="#cb26-443"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb26-444"><a href="#cb26-444"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"bottom"</span>) <span class="sc">+</span></span>
<span id="cb26-445"><a href="#cb26-445"></a>  <span class="fu">guides</span>(<span class="at">size =</span> <span class="fu">guide_legend</span>(<span class="st">"Cook's Dist."</span>))</span>
<span id="cb26-446"><a href="#cb26-446"></a></span>
<span id="cb26-447"><a href="#cb26-447"></a><span class="co"># Plot Cook's Distance vs Leverage using ggplot2</span></span>
<span id="cb26-448"><a href="#cb26-448"></a>plt4 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(mod1_data, <span class="fu">aes</span>(<span class="at">x =</span> .hat, <span class="at">y =</span> .cooksd)) <span class="sc">+</span></span>
<span id="cb26-449"><a href="#cb26-449"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">size =</span> .cooksd, <span class="at">colour =</span> colour), <span class="at">shape =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb26-450"><a href="#cb26-450"></a>  <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> cooksd_thresh, <span class="at">linetype =</span> <span class="st">"dashed"</span>, <span class="at">colour =</span> <span class="st">"red"</span>) <span class="sc">+</span></span>
<span id="cb26-451"><a href="#cb26-451"></a>  <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> <span class="dv">2</span> <span class="sc">*</span> <span class="fu">mean</span>(mod1_data<span class="sc">$</span>.hat), <span class="at">linetype =</span> <span class="st">"dashed"</span>, <span class="at">colour =</span> <span class="st">"blue"</span>) <span class="sc">+</span></span>
<span id="cb26-452"><a href="#cb26-452"></a>  <span class="fu">geom_text</span>(<span class="fu">aes</span>(<span class="at">label =</span> <span class="fu">ifelse</span>(.cooksd <span class="sc">&gt;</span> cooksd_thresh, <span class="fu">as.character</span>(index), <span class="st">""</span>)),</span>
<span id="cb26-453"><a href="#cb26-453"></a>            <span class="at">hjust =</span> <span class="fl">1.0</span>, <span class="at">vjust =</span> <span class="fl">1.0</span>, <span class="at">colour =</span> <span class="st">"darkred"</span>) <span class="sc">+</span></span>
<span id="cb26-454"><a href="#cb26-454"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"Leverage"</span>,</span>
<span id="cb26-455"><a href="#cb26-455"></a>       <span class="at">y =</span> <span class="st">"Cook's Dist."</span>,</span>
<span id="cb26-456"><a href="#cb26-456"></a>       <span class="at">size =</span> <span class="st">"Cook's Distance"</span>) <span class="sc">+</span></span>
<span id="cb26-457"><a href="#cb26-457"></a>  <span class="fu">scale_colour_identity</span>() <span class="sc">+</span></span>
<span id="cb26-458"><a href="#cb26-458"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb26-459"><a href="#cb26-459"></a>  <span class="fu">guides</span>(<span class="at">size =</span> <span class="fu">guide_legend</span>(<span class="st">"Cook's Distance"</span>))</span>
<span id="cb26-460"><a href="#cb26-460"></a></span>
<span id="cb26-461"><a href="#cb26-461"></a><span class="fu">ggarrange</span>(plt1, plt2, plt3, plt4, <span class="at">nrow =</span> <span class="dv">2</span>, <span class="at">ncol =</span> <span class="dv">2</span>, <span class="at">labels =</span> <span class="st">"AUTO"</span>,</span>
<span id="cb26-462"><a href="#cb26-462"></a>          <span class="at">common.legend =</span> <span class="cn">TRUE</span>)</span>
<span id="cb26-463"><a href="#cb26-463"></a><span class="in">```</span></span>
<span id="cb26-464"><a href="#cb26-464"></a><span class="co">&lt;!-- 1. Adds information about each observation in the dataset to the model output using the `augment()` function from the **broom** package. --&gt;</span></span>
<span id="cb26-465"><a href="#cb26-465"></a><span class="co">&lt;!-- 2. Adds an index column for the observation numbers and calculates the leverage values using the `hatvalues()` function. --&gt;</span></span>
<span id="cb26-466"><a href="#cb26-466"></a></span>
<span id="cb26-469"><a href="#cb26-469"></a><span class="in">```{r}</span></span>
<span id="cb26-470"><a href="#cb26-470"></a><span class="co">#| echo: false</span></span>
<span id="cb26-471"><a href="#cb26-471"></a><span class="co">#| messages: false</span></span>
<span id="cb26-472"><a href="#cb26-472"></a><span class="co">#| warning: false</span></span>
<span id="cb26-473"><a href="#cb26-473"></a><span class="co">#| fig.cap: "Plot of the linear regression resulting from `mod1` with the outliers identified using Cook's distance highlighted."</span></span>
<span id="cb26-474"><a href="#cb26-474"></a><span class="co">#| label: fig-lm2-outliers2</span></span>
<span id="cb26-475"><a href="#cb26-475"></a><span class="co">#| fig.width: 4</span></span>
<span id="cb26-476"><a href="#cb26-476"></a><span class="co">#| fig.height: 2.75</span></span>
<span id="cb26-477"><a href="#cb26-477"></a><span class="co">#| fig.align: center</span></span>
<span id="cb26-478"><a href="#cb26-478"></a></span>
<span id="cb26-479"><a href="#cb26-479"></a><span class="co"># Plot the data with the identified points</span></span>
<span id="cb26-480"><a href="#cb26-480"></a><span class="fu">ggplot</span>(mod1_data, <span class="fu">aes</span>(<span class="at">x =</span> body_mass_g, <span class="at">y =</span> bill_length_mm)) <span class="sc">+</span></span>
<span id="cb26-481"><a href="#cb26-481"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">size =</span> .cooksd, <span class="at">colour =</span> colour), <span class="at">shape =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb26-482"><a href="#cb26-482"></a>  <span class="fu">geom_smooth</span>(<span class="at">method =</span> <span class="st">"lm"</span>, <span class="at">se =</span> <span class="cn">FALSE</span>, <span class="at">colour =</span> <span class="st">"steelblue4"</span>) <span class="sc">+</span></span>
<span id="cb26-483"><a href="#cb26-483"></a>  <span class="fu">geom_text</span>(<span class="fu">aes</span>(<span class="at">label =</span> <span class="fu">ifelse</span>(<span class="fu">abs</span>(.cooksd) <span class="sc">&gt;</span> cooksd_thresh, <span class="fu">rownames</span>(mod1_data), <span class="st">""</span>)),</span>
<span id="cb26-484"><a href="#cb26-484"></a>            <span class="at">hjust =</span> <span class="fl">1.0</span>, <span class="at">vjust =</span> <span class="fl">1.0</span>, <span class="at">colour =</span> <span class="st">"darkred"</span>) <span class="sc">+</span></span>
<span id="cb26-485"><a href="#cb26-485"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"Body mass (g)"</span>, <span class="at">y =</span> <span class="st">"Bill length (mm)"</span>) <span class="sc">+</span></span>
<span id="cb26-486"><a href="#cb26-486"></a>  <span class="fu">scale_colour_identity</span>() <span class="sc">+</span></span>
<span id="cb26-487"><a href="#cb26-487"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb26-488"><a href="#cb26-488"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"bottom"</span>) <span class="sc">+</span></span>
<span id="cb26-489"><a href="#cb26-489"></a>  <span class="fu">guides</span>(<span class="at">size =</span> <span class="fu">guide_legend</span>(<span class="st">"Cook's Distance"</span>))</span>
<span id="cb26-490"><a href="#cb26-490"></a><span class="in">```</span></span>
<span id="cb26-491"><a href="#cb26-491"></a></span>
<span id="cb26-492"><a href="#cb26-492"></a>Once we have found them (@fig-lm2-outliers2), what do we do with outliers? There are a few strategies:</span>
<span id="cb26-493"><a href="#cb26-493"></a></span>
<span id="cb26-494"><a href="#cb26-494"></a><span class="ss">1. </span>**Remove them:** If the outliers are due to data entry errors or other issues, it may be appropriate to remove them from the analysis. However, this should be done with caution, as outliers may be functionally important in the dataset if they represent rare, extreme events.</span>
<span id="cb26-495"><a href="#cb26-495"></a></span>
<span id="cb26-496"><a href="#cb26-496"></a><span class="ss">2. </span>**Robust regression methods:** When there is certainty that the outliers are part of the observed response and represent extreme but rare occurrences, robust regression techniques such as M-estimation or least trimmed squares, which are less sensitive to the presence of outliers, could be used.</span>
<span id="cb26-497"><a href="#cb26-497"></a></span>
<span id="cb26-498"><a href="#cb26-498"></a><span class="ss">3. </span>**Transformation of variables:** Applying appropriate transformations (e.g., logarithmic, square root) to the variables can sometimes reduce the impact of outliers.</span>
<span id="cb26-499"><a href="#cb26-499"></a></span>
<span id="cb26-502"><a href="#cb26-502"></a><span class="in">```{r}</span></span>
<span id="cb26-503"><a href="#cb26-503"></a><span class="co">#| eval: false</span></span>
<span id="cb26-504"><a href="#cb26-504"></a><span class="co">#| echo: false</span></span>
<span id="cb26-505"><a href="#cb26-505"></a><span class="co">#| messages: false</span></span>
<span id="cb26-506"><a href="#cb26-506"></a><span class="co">#| warning: false</span></span>
<span id="cb26-507"><a href="#cb26-507"></a></span>
<span id="cb26-508"><a href="#cb26-508"></a><span class="co"># Calculate residuals and leverage</span></span>
<span id="cb26-509"><a href="#cb26-509"></a>Adelie<span class="sc">$</span>residuals <span class="ot">&lt;-</span> <span class="fu">rstandard</span>(mod1)</span>
<span id="cb26-510"><a href="#cb26-510"></a>Adelie<span class="sc">$</span>leverage <span class="ot">&lt;-</span> <span class="fu">hatvalues</span>(mod1)</span>
<span id="cb26-511"><a href="#cb26-511"></a>Adelie<span class="sc">$</span>cooksd <span class="ot">&lt;-</span> <span class="fu">cooks.distance</span>(mod1)</span>
<span id="cb26-512"><a href="#cb26-512"></a>Adelie<span class="sc">$</span>studentised_residuals <span class="ot">&lt;-</span> <span class="fu">rstudent</span>(mod1)</span>
<span id="cb26-513"><a href="#cb26-513"></a><span class="in">```</span></span>
<span id="cb26-514"><a href="#cb26-514"></a></span>
<span id="cb26-517"><a href="#cb26-517"></a><span class="in">```{r}</span></span>
<span id="cb26-518"><a href="#cb26-518"></a><span class="co">#| eval: false</span></span>
<span id="cb26-519"><a href="#cb26-519"></a><span class="co">#| echo: false</span></span>
<span id="cb26-520"><a href="#cb26-520"></a><span class="co">#| messages: false</span></span>
<span id="cb26-521"><a href="#cb26-521"></a><span class="co">#| warning: false</span></span>
<span id="cb26-522"><a href="#cb26-522"></a></span>
<span id="cb26-523"><a href="#cb26-523"></a><span class="co"># Summary of potential outliers and influential points</span></span>
<span id="cb26-524"><a href="#cb26-524"></a>potential_outliers <span class="ot">&lt;-</span> <span class="fu">which</span>(<span class="fu">abs</span>(Adelie<span class="sc">$</span>residuals) <span class="sc">&gt;</span> <span class="dv">2</span>)</span>
<span id="cb26-525"><a href="#cb26-525"></a>high_leverage_points <span class="ot">&lt;-</span> <span class="fu">which</span>(Adelie<span class="sc">$</span>leverage <span class="sc">&gt;</span> <span class="dv">2</span><span class="sc">*</span><span class="fu">length</span>(<span class="fu">coef</span>(mod1))<span class="sc">/</span><span class="fu">nrow</span>(Adelie))</span>
<span id="cb26-526"><a href="#cb26-526"></a>influential_points <span class="ot">&lt;-</span> <span class="fu">which</span>(Adelie<span class="sc">$</span>cooksd <span class="sc">&gt;</span> <span class="dv">4</span><span class="sc">/</span><span class="fu">nrow</span>(Adelie))</span>
<span id="cb26-527"><a href="#cb26-527"></a></span>
<span id="cb26-528"><a href="#cb26-528"></a><span class="fu">list</span>(</span>
<span id="cb26-529"><a href="#cb26-529"></a>  <span class="at">Potential_Outliers =</span> potential_outliers,</span>
<span id="cb26-530"><a href="#cb26-530"></a>  <span class="at">High_Leverage_Points =</span> high_leverage_points,</span>
<span id="cb26-531"><a href="#cb26-531"></a>  <span class="at">Influential_Points =</span> influential_points</span>
<span id="cb26-532"><a href="#cb26-532"></a>)</span>
<span id="cb26-533"><a href="#cb26-533"></a><span class="in">```</span></span>
<span id="cb26-534"><a href="#cb26-534"></a></span>
<span id="cb26-535"><a href="#cb26-535"></a></span>
<span id="cb26-536"><a href="#cb26-536"></a><span class="fu">### Interpret the Results</span></span>
<span id="cb26-537"><a href="#cb26-537"></a></span>
<span id="cb26-538"><a href="#cb26-538"></a>Now that we have tested the assumptions, we can interpret the results of the model fitted in @sec-fit-model. The slope of the regression line is 0.003188 mm/g, with a standard error of $\pm$ 0.0003977. The *p*-value is less than 0.001, so we reject the null hypothesis that the slope is zero. We conclude that there is a significant relationship between the body mass of the penguins and their bill length.</span>
<span id="cb26-539"><a href="#cb26-539"></a></span>
<span id="cb26-540"><a href="#cb26-540"></a>The fit of the model is given by the multiple $R^2$ value, which is 0.3013. This means that 30.13% of the variation in bill length can be explained by body mass. The remaining ~70% is due to other factors not included in the model. The intercept of the model is 26.99 mm, with a standard error of $\pm$ 0.0003977. The intercept is the value of the dependent variable when the independent variable is zero. In this case, it is the bill length of a penguin with a body mass of zero grams, which is not a meaningful value. </span>
<span id="cb26-541"><a href="#cb26-541"></a></span>
<span id="cb26-542"><a href="#cb26-542"></a>The significance of the overall fit of the model can be assessed using an analysis of variance (ANOVA) test. The *p*-value is less than 0.001, so we reject the null hypothesis that the model does not explain a significant amount of the variation in the data against an *F*-value of 64.25 on 1 and 149 degrees of freedom. We conclude that the model is a good fit for the data.</span>
<span id="cb26-543"><a href="#cb26-543"></a></span>
<span id="cb26-544"><a href="#cb26-544"></a><span class="fu">### Reporting</span></span>
<span id="cb26-545"><a href="#cb26-545"></a></span>
<span id="cb26-546"><a href="#cb26-546"></a>I provide example Methods, Results, and Discussion sections in a format more-or-less suited for inclusion in a scientific manuscript. Feel free to use it as a template and edit it as necessary to describe your study. </span>
<span id="cb26-547"><a href="#cb26-547"></a></span>
<span id="cb26-548"><a href="#cb26-548"></a>**Methods**</span>
<span id="cb26-549"><a href="#cb26-549"></a></span>
<span id="cb26-550"><a href="#cb26-550"></a>*Study data*</span>
<span id="cb26-551"><a href="#cb26-551"></a></span>
<span id="cb26-552"><a href="#cb26-552"></a>The data analysed in this study were derived from the Palmer Penguins dataset, a comprehensive collection of measurements from three penguin species (Adelie, Chinstrap, and Gentoo) collected in the Palmer Archipelago, Antarctica. The dataset includes variables species, island, bill length, bill depth, flipper length, body mass, and sex of the penguins. This dataset has been made publicly available by Dr. Kristen Gorman and the Palmer Station, Antarctica LTER, a member of the Long Term Ecological Research Network.</span>
<span id="cb26-553"><a href="#cb26-553"></a></span>
<span id="cb26-554"><a href="#cb26-554"></a>*Statistical analysis*</span>
<span id="cb26-555"><a href="#cb26-555"></a></span>
<span id="cb26-556"><a href="#cb26-556"></a>The primary objective of our statistical analysis was to investigate the relationship between the penguins' body mass and bill length. For this purpose, we employed a simple linear regression model to quantify the extent to which the independent variable predicts bill length.</span>
<span id="cb26-557"><a href="#cb26-557"></a></span>
<span id="cb26-558"><a href="#cb26-558"></a>We fitted a simple linear regression model using the <span class="in">`lm()`</span> function in R version 4.4.0 (R Core Team, 2024). The model included bill length as the dependent variable, and body mass as continuous predictor. We ensured all assumptions for linear regression were assessed including linearity, independence, homoscedasticity, and normality of residuals.</span>
<span id="cb26-559"><a href="#cb26-559"></a></span>
<span id="cb26-560"><a href="#cb26-560"></a>After fitting the model, diagnostic plots were generated using the <span class="in">`plot()`</span> function in R to visually assess the residuals for any patterns indicating potential violations of regression assumptions. Additionally, the Shapiro-Wilk test was conducted to confirm the normality of the residuals. The presence of heteroscedasticity was evaluated using the Breusch-Pagan test.</span>
<span id="cb26-561"><a href="#cb26-561"></a></span>
<span id="cb26-562"><a href="#cb26-562"></a>The adequacy of the model fit was judged based on the coefficient of determination (*R*^2^), which provided insight into the variance in body mass explained by the predictors. The significance of the regression coefficients was determined using *t*-tests, and the overall model fit was evaluated by an *F*-test.</span>
<span id="cb26-563"><a href="#cb26-563"></a></span>
<span id="cb26-564"><a href="#cb26-564"></a>**Results**</span>
<span id="cb26-565"><a href="#cb26-565"></a></span>
<span id="cb26-568"><a href="#cb26-568"></a><span class="in">```{r}</span></span>
<span id="cb26-569"><a href="#cb26-569"></a><span class="co">#| echo: false</span></span>
<span id="cb26-570"><a href="#cb26-570"></a><span class="co">#| messages: false</span></span>
<span id="cb26-571"><a href="#cb26-571"></a><span class="co">#| warning: false</span></span>
<span id="cb26-572"><a href="#cb26-572"></a><span class="co">#| fig.cap: "Plot of bill length as a function of body mass for Adelie penguins sampled at the Palmer Station. The straight line indicates the best fit regression line and the blue shading is the 95% confidence interval."</span></span>
<span id="cb26-573"><a href="#cb26-573"></a><span class="co">#| label: fig-lm2</span></span>
<span id="cb26-574"><a href="#cb26-574"></a><span class="co">#| fig.width: 4</span></span>
<span id="cb26-575"><a href="#cb26-575"></a><span class="co">#| fig.height: 2</span></span>
<span id="cb26-576"><a href="#cb26-576"></a><span class="co">#| fig.align: center</span></span>
<span id="cb26-577"><a href="#cb26-577"></a><span class="co">#| fig-pos: "t"</span></span>
<span id="cb26-578"><a href="#cb26-578"></a></span>
<span id="cb26-579"><a href="#cb26-579"></a><span class="fu">ggplot</span>(Adelie,</span>
<span id="cb26-580"><a href="#cb26-580"></a>       <span class="fu">aes</span>(<span class="at">x =</span> body_mass_g, <span class="at">y =</span> bill_length_mm)) <span class="sc">+</span></span>
<span id="cb26-581"><a href="#cb26-581"></a>  <span class="fu">geom_point</span>(<span class="at">shape =</span> <span class="dv">1</span>, <span class="at">colour =</span> <span class="st">"pink"</span>) <span class="sc">+</span></span>
<span id="cb26-582"><a href="#cb26-582"></a>  <span class="fu">geom_smooth</span>(<span class="at">method =</span> <span class="st">"lm"</span>, <span class="at">linewidth =</span> <span class="fl">0.4</span>, <span class="at">alpha =</span> <span class="fl">0.2</span>,</span>
<span id="cb26-583"><a href="#cb26-583"></a>              <span class="at">colour =</span> <span class="st">"red"</span>, <span class="at">se =</span> <span class="cn">TRUE</span>, <span class="at">fill =</span> <span class="st">"blue"</span>) <span class="sc">+</span></span>
<span id="cb26-584"><a href="#cb26-584"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"Body mass (g)"</span>, <span class="at">y =</span> <span class="st">"Bill length (mm)"</span>) <span class="sc">+</span></span>
<span id="cb26-585"><a href="#cb26-585"></a>  <span class="fu">theme_bw</span>()</span>
<span id="cb26-586"><a href="#cb26-586"></a><span class="in">```</span></span>
<span id="cb26-587"><a href="#cb26-587"></a></span>
<span id="cb26-588"><a href="#cb26-588"></a>The regression coefficient for bill length with respect to body mass was estimated to be approximately $3.2 \times 10^{-3}$ mm/g $\pm$ $3.977 \times 10^{-4}$ (mean slope $\pm$ SE) ($p &lt; 0.001$, $t = 8.015$), indicating a significant dependence of bill length on body mass (@fig-lm2).</span>
<span id="cb26-589"><a href="#cb26-589"></a></span>
<span id="cb26-590"><a href="#cb26-590"></a>The multiple $R^2$ value of the model was 0.3013, suggesting that approximately 30.13% of the variability in bill length can be accounted for by changes in body mass. This indicates that while bill length variation is notably influenced by body mass, about 69.87% of the variation is attributable to other factors not included in the model.</span>
<span id="cb26-591"><a href="#cb26-591"></a></span>
<span id="cb26-592"><a href="#cb26-592"></a>The overall fit of the model, assessed by an ANOVA, strongly supported the model's validity ($F = 64.25$, $p &lt; 0.001$, d.f. = $1, 149$) and confirms that a linear model provides adequate support for predicting penguin bill length from body mass.</span>
<span id="cb26-593"><a href="#cb26-593"></a></span>
<span id="cb26-594"><a href="#cb26-594"></a>**Discussion**</span>
<span id="cb26-595"><a href="#cb26-595"></a></span>
<span id="cb26-596"><a href="#cb26-596"></a>In conclusion, the statistical analysis confirms a significant relationship between body mass and bill length in penguins. Although the model explains a substantial portion of the variation, future studies should consider additional variables that could account for the remaining variability in bill length. This would enhance our understanding of the morphological adaptations of penguins in their natural habitat.</span>
<span id="cb26-597"><a href="#cb26-597"></a></span>
<span id="cb26-598"><a href="#cb26-598"></a><span class="fu">## Confidence and Prediction Intervals</span></span>
<span id="cb26-599"><a href="#cb26-599"></a></span>
<span id="cb26-600"><a href="#cb26-600"></a>Confidence intervals estimate the range within which the true mean of the dependent variable ($Y$) is likely to fall for a given value of the independent variable ($X$). In other words, if you were to repeat your experiment many times and calculate the mean response at a specific $X$ value each time, the confidence interval would contain the true population mean a certain percentage of the time (e.g., 95%). Therefore, a 95% confidence interval means you can be 95% confident that the interval contains the true mean response for the population at that particular $X$ value. It's about the average, not individual data points.</span>
<span id="cb26-601"><a href="#cb26-601"></a></span>
<span id="cb26-602"><a href="#cb26-602"></a>Prediction intervals, on the other hand, provide a range of $Y$ values that are likely to contain a single new observation of the dependent variable for a given value of the independent variable $X$. These intervals account for the variability around individual observations and are generally wider than confidence intervals because they include both the variability of the estimated mean response and the variability of individual observations around that mean. Continuing with the Adelie penguin data, the confidence and prediction intervals are shown in @fig-lm2-conf.</span>
<span id="cb26-603"><a href="#cb26-603"></a></span>
<span id="cb26-606"><a href="#cb26-606"></a><span class="in">```{r}</span></span>
<span id="cb26-607"><a href="#cb26-607"></a><span class="co">#| echo: true</span></span>
<span id="cb26-608"><a href="#cb26-608"></a><span class="co">#| messages: false</span></span>
<span id="cb26-609"><a href="#cb26-609"></a><span class="co">#| warning: false</span></span>
<span id="cb26-610"><a href="#cb26-610"></a><span class="co">#| fig.cap: "Plot of pernguin data with the confidence interval (blue) and prediction interval (pink) around the fitted values."</span></span>
<span id="cb26-611"><a href="#cb26-611"></a><span class="co">#| label: fig-lm2-conf</span></span>
<span id="cb26-612"><a href="#cb26-612"></a><span class="co">#| fig.width: 4</span></span>
<span id="cb26-613"><a href="#cb26-613"></a><span class="co">#| fig.height: 2</span></span>
<span id="cb26-614"><a href="#cb26-614"></a><span class="co">#| fig.align: center</span></span>
<span id="cb26-615"><a href="#cb26-615"></a><span class="co">#| fig-pos: "t"</span></span>
<span id="cb26-616"><a href="#cb26-616"></a></span>
<span id="cb26-617"><a href="#cb26-617"></a><span class="co"># Predict values with confidence intervals</span></span>
<span id="cb26-618"><a href="#cb26-618"></a>pred_conf <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(<span class="fu">predict</span>(mod1,</span>
<span id="cb26-619"><a href="#cb26-619"></a>                                   <span class="at">newdata =</span> Adelie,</span>
<span id="cb26-620"><a href="#cb26-620"></a>                                   <span class="at">interval =</span> <span class="st">"confidence"</span>))</span>
<span id="cb26-621"><a href="#cb26-621"></a></span>
<span id="cb26-622"><a href="#cb26-622"></a><span class="co"># Predict values with prediction intervals</span></span>
<span id="cb26-623"><a href="#cb26-623"></a>pred_pred <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(<span class="fu">predict</span>(mod1,</span>
<span id="cb26-624"><a href="#cb26-624"></a>                                   <span class="at">newdata =</span> Adelie,</span>
<span id="cb26-625"><a href="#cb26-625"></a>                                   <span class="at">interval =</span> <span class="st">"prediction"</span>))</span>
<span id="cb26-626"><a href="#cb26-626"></a></span>
<span id="cb26-627"><a href="#cb26-627"></a><span class="co"># Add body mass to the data frame</span></span>
<span id="cb26-628"><a href="#cb26-628"></a>results <span class="ot">&lt;-</span> <span class="fu">cbind</span>(Adelie, pred_conf, pred_pred[,<span class="dv">2</span><span class="sc">:</span><span class="dv">3</span>])</span>
<span id="cb26-629"><a href="#cb26-629"></a></span>
<span id="cb26-630"><a href="#cb26-630"></a><span class="co"># Rename columns for clarity</span></span>
<span id="cb26-631"><a href="#cb26-631"></a><span class="fu">names</span>(results)[<span class="fu">c</span>(<span class="dv">9</span><span class="sc">:</span><span class="dv">13</span>)] <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"fit"</span>, <span class="st">"lwr_conf"</span>, <span class="st">"upr_conf"</span>,</span>
<span id="cb26-632"><a href="#cb26-632"></a>                             <span class="st">"lwr_pred"</span>, <span class="st">"upr_pred"</span>)</span>
<span id="cb26-633"><a href="#cb26-633"></a></span>
<span id="cb26-634"><a href="#cb26-634"></a><span class="fu">ggplot</span>(<span class="at">data =</span> results, <span class="fu">aes</span>(<span class="at">x =</span> body_mass_g, <span class="at">y =</span> fit)) <span class="sc">+</span></span>
<span id="cb26-635"><a href="#cb26-635"></a>  <span class="fu">geom_line</span>(<span class="at">linewidth =</span> <span class="fl">0.4</span>, <span class="at">colour =</span> <span class="st">"red"</span>) <span class="sc">+</span></span>
<span id="cb26-636"><a href="#cb26-636"></a>  <span class="fu">geom_ribbon</span>(<span class="fu">aes</span>(<span class="at">ymin =</span> lwr_pred, <span class="at">ymax =</span> upr_pred),</span>
<span id="cb26-637"><a href="#cb26-637"></a>              <span class="at">alpha =</span> <span class="fl">0.2</span>, <span class="at">fill =</span> <span class="st">"red"</span>) <span class="sc">+</span></span>
<span id="cb26-638"><a href="#cb26-638"></a>  <span class="fu">geom_ribbon</span>(<span class="fu">aes</span>(<span class="at">ymin =</span> lwr_conf, <span class="at">ymax =</span> upr_conf),</span>
<span id="cb26-639"><a href="#cb26-639"></a>              <span class="at">alpha =</span> <span class="fl">0.2</span>, <span class="at">fill =</span> <span class="st">"blue"</span>) <span class="sc">+</span></span>
<span id="cb26-640"><a href="#cb26-640"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">y =</span> bill_length_mm), <span class="at">shape =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb26-641"><a href="#cb26-641"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"Body mass (g)"</span>, <span class="at">y =</span> <span class="st">"Bill length (mm)"</span>) <span class="sc">+</span></span>
<span id="cb26-642"><a href="#cb26-642"></a>  <span class="fu">theme_bw</span>()</span>
<span id="cb26-643"><a href="#cb26-643"></a><span class="in">```</span></span>
<span id="cb26-644"><a href="#cb26-644"></a></span>
<span id="cb26-645"><a href="#cb26-645"></a>Confidence and prediction intervals are relevant for understanding the uncertainty associated with a linear regression model's predictions. While confidence intervals focus on quantifying the uncertainty around the estimated mean response, prediction intervals comprehensively assess the variability that can be expected for individual observations. We can use both when interpreting the results of a linear regression analysis.</span>
<span id="cb26-646"><a href="#cb26-646"></a></span>
<span id="cb26-647"><a href="#cb26-647"></a>Confidence intervals are useful when the primary interest lies in making inferences about the mean response at specific values of the independent variable(s). For instance, in a study examining the relationship between soil nutrient levels and plant biomass, confidence intervals can help determine the range of mean biomass that can be expected for a given level of soil nutrients. This information may be valuable for crop management practices, such as designing fertilisation strategies or assessing the impact of nutrient depletion on plant productivity.</span>
<span id="cb26-648"><a href="#cb26-648"></a></span>
<span id="cb26-649"><a href="#cb26-649"></a>Prediction intervals, on the other hand, are more relevant when the goal is to predict the value of an individual observation or to assess the range of values that future observations might take. For example, in a study investigating the relationship between ambient temperature and the growth rate of a species of fish, prediction intervals provide a range of growth rates that an individual fish might exhibit based on the observed temperature. This information is invaluable in aquaculture, for instance, where predicting individual growth patterns can inform decisions about optimal stocking densities or feed management strategies.</span>
<span id="cb26-650"><a href="#cb26-650"></a></span>
<span id="cb26-651"><a href="#cb26-651"></a>The relative widths of confidence and prediction intervals can provide insights into the variability in the data. If the prediction intervals are substantially wider than the confidence intervals, it may indicate a high level of variability in individual observations around the mean response, which could suggest the presence of influential factors or sources of variation that are not accounted for by the current model, such as microhabitat differences or genetic variation within the studied population.</span>
<span id="cb26-652"><a href="#cb26-652"></a></span>
<span id="cb26-653"><a href="#cb26-653"></a><span class="fu">## What Do I Do When Some Assumptions Fail? {#sec-assumption-fails}</span></span>
<span id="cb26-654"><a href="#cb26-654"></a></span>
<span id="cb26-655"><a href="#cb26-655"></a><span class="fu">### Failing Assumptions of Normality and Homoscedasticity {#sec-assumption-fails2}</span></span>
<span id="cb26-656"><a href="#cb26-656"></a></span>
<span id="cb26-657"><a href="#cb26-657"></a>I will use the sparrow data from Zar (1999) to demonstrate what to do when the assumptions of normality and homoscedasticity are violated. I will fit a linear model to the data and then check the assumptions.</span>
<span id="cb26-658"><a href="#cb26-658"></a></span>
<span id="cb26-661"><a href="#cb26-661"></a><span class="in">```{r}</span></span>
<span id="cb26-662"><a href="#cb26-662"></a><span class="co">#| echo: false</span></span>
<span id="cb26-663"><a href="#cb26-663"></a></span>
<span id="cb26-664"><a href="#cb26-664"></a>sparrows <span class="ot">&lt;-</span> <span class="fu">tibble</span>(<span class="at">age =</span> <span class="fu">c</span>(<span class="dv">3</span>, <span class="dv">4</span>, <span class="dv">5</span>, <span class="dv">6</span>, <span class="dv">8</span>, <span class="dv">9</span>, <span class="dv">10</span>, <span class="dv">11</span>, <span class="dv">12</span>, <span class="dv">14</span>, <span class="dv">15</span>, <span class="dv">16</span>, <span class="dv">17</span>),</span>
<span id="cb26-665"><a href="#cb26-665"></a>                   <span class="at">wing =</span> <span class="fu">c</span>(<span class="fl">1.4</span>, <span class="fl">1.5</span>, <span class="fl">2.2</span>, <span class="fl">2.4</span>, <span class="fl">3.1</span>, <span class="fl">3.2</span>, <span class="fl">3.2</span>, <span class="fl">3.9</span>, <span class="fl">4.1</span>, <span class="fl">4.7</span>, <span class="fl">4.5</span>, <span class="fl">5.2</span>, <span class="fl">5.0</span>))</span>
<span id="cb26-666"><a href="#cb26-666"></a><span class="in">```</span></span>
<span id="cb26-667"><a href="#cb26-667"></a></span>
<span id="cb26-670"><a href="#cb26-670"></a><span class="in">```{r}</span></span>
<span id="cb26-671"><a href="#cb26-671"></a><span class="co">#| echo: false</span></span>
<span id="cb26-672"><a href="#cb26-672"></a><span class="co">#| fig.cap: "Scatter plot of the sparrow dataset with a best fit line."</span></span>
<span id="cb26-673"><a href="#cb26-673"></a><span class="co">#| label: fig-lm3</span></span>
<span id="cb26-674"><a href="#cb26-674"></a><span class="co">#| fig.width: 4</span></span>
<span id="cb26-675"><a href="#cb26-675"></a><span class="co">#| fig.height: 2</span></span>
<span id="cb26-676"><a href="#cb26-676"></a><span class="co">#| fig.align: center</span></span>
<span id="cb26-677"><a href="#cb26-677"></a><span class="co">#| fig-pos: "t"</span></span>
<span id="cb26-678"><a href="#cb26-678"></a></span>
<span id="cb26-679"><a href="#cb26-679"></a><span class="fu">ggplot</span>(sparrows, <span class="fu">aes</span>(<span class="at">x =</span> age, <span class="at">y =</span> wing)) <span class="sc">+</span></span>
<span id="cb26-680"><a href="#cb26-680"></a>  <span class="fu">geom_smooth</span>(<span class="at">method =</span> <span class="st">"lm"</span>, <span class="at">se =</span> <span class="cn">FALSE</span>, <span class="at">colour =</span> <span class="st">"red3"</span>,</span>
<span id="cb26-681"><a href="#cb26-681"></a>              <span class="at">linewidth =</span> <span class="fl">0.4</span>) <span class="sc">+</span></span>
<span id="cb26-682"><a href="#cb26-682"></a>  <span class="fu">geom_point</span>(<span class="at">col =</span> <span class="st">"black"</span>, <span class="at">shape =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb26-683"><a href="#cb26-683"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"Age (days)"</span>, <span class="at">y =</span> <span class="st">"Wing length (cm)"</span>) <span class="sc">+</span></span>
<span id="cb26-684"><a href="#cb26-684"></a>  <span class="fu">theme_bw</span>()</span>
<span id="cb26-685"><a href="#cb26-685"></a><span class="in">```</span></span>
<span id="cb26-686"><a href="#cb26-686"></a></span>
<span id="cb26-687"><a href="#cb26-687"></a>@fig-lm3 is a scatter plot of the sparrow data with a best fit line. At first glance, the linear model seems to almost perfectly describe the relationship of wing length on age. I will fit a linear model to the data and then check the assumptions.</span>
<span id="cb26-688"><a href="#cb26-688"></a></span>
<span id="cb26-691"><a href="#cb26-691"></a><span class="in">```{r}</span></span>
<span id="cb26-692"><a href="#cb26-692"></a><span class="co">#| echo: true</span></span>
<span id="cb26-693"><a href="#cb26-693"></a></span>
<span id="cb26-694"><a href="#cb26-694"></a>mod2 <span class="ot">&lt;-</span> <span class="fu">lm</span>(wing <span class="sc">~</span> age, <span class="at">data =</span> sparrows)</span>
<span id="cb26-695"><a href="#cb26-695"></a><span class="fu">summary</span>(mod2)</span>
<span id="cb26-696"><a href="#cb26-696"></a><span class="in">```</span></span>
<span id="cb26-697"><a href="#cb26-697"></a></span>
<span id="cb26-698"><a href="#cb26-698"></a>Check the assumption of normality of residuals using the Shapiro-Wilk test, a histogram, and a residual Q-Q plot.</span>
<span id="cb26-699"><a href="#cb26-699"></a></span>
<span id="cb26-702"><a href="#cb26-702"></a><span class="in">```{r}</span></span>
<span id="cb26-703"><a href="#cb26-703"></a><span class="fu">shapiro.test</span>(<span class="fu">residuals</span>(mod2))</span>
<span id="cb26-704"><a href="#cb26-704"></a><span class="in">```</span></span>
<span id="cb26-705"><a href="#cb26-705"></a></span>
<span id="cb26-706"><a href="#cb26-706"></a>The *p*-value for the Shapiro-Wilk test is &lt; 0.05, indicating that the residuals are not normally distributed. The histogram and Q-Q plot of the residuals also show that the residuals are not normally distributed (@fig-hist2 and @fig-QQ2). In the Residual Q-Q plot, the points deviate from the straight line, indicating non-normality---note the S-shaped curvature to the data.</span>
<span id="cb26-707"><a href="#cb26-707"></a></span>
<span id="cb26-710"><a href="#cb26-710"></a><span class="in">```{r}</span></span>
<span id="cb26-711"><a href="#cb26-711"></a><span class="co">#| echo: true</span></span>
<span id="cb26-712"><a href="#cb26-712"></a><span class="co">#| fig.cap: "A histogram of the residual of the linear regression, `mod2`."</span></span>
<span id="cb26-713"><a href="#cb26-713"></a><span class="co">#| label: fig-hist2</span></span>
<span id="cb26-714"><a href="#cb26-714"></a><span class="co">#| fig.width: 4</span></span>
<span id="cb26-715"><a href="#cb26-715"></a><span class="co">#| fig.height: 3</span></span>
<span id="cb26-716"><a href="#cb26-716"></a><span class="co">#| fig.align: center</span></span>
<span id="cb26-717"><a href="#cb26-717"></a></span>
<span id="cb26-718"><a href="#cb26-718"></a><span class="fu">hist</span>(<span class="fu">residuals</span>(mod2))</span>
<span id="cb26-719"><a href="#cb26-719"></a><span class="in">```</span></span>
<span id="cb26-720"><a href="#cb26-720"></a></span>
<span id="cb26-723"><a href="#cb26-723"></a><span class="in">```{r}</span></span>
<span id="cb26-724"><a href="#cb26-724"></a><span class="co">#| echo: true</span></span>
<span id="cb26-725"><a href="#cb26-725"></a><span class="co">#| fig.cap: "A Residual Q-Q plot of the linear regression, `mod2`."</span></span>
<span id="cb26-726"><a href="#cb26-726"></a><span class="co">#| label: fig-QQ2</span></span>
<span id="cb26-727"><a href="#cb26-727"></a><span class="co">#| fig.width: 4</span></span>
<span id="cb26-728"><a href="#cb26-728"></a><span class="co">#| fig.height: 3</span></span>
<span id="cb26-729"><a href="#cb26-729"></a><span class="co">#| fig.align: center</span></span>
<span id="cb26-730"><a href="#cb26-730"></a></span>
<span id="cb26-731"><a href="#cb26-731"></a><span class="fu">plot</span>(mod2, <span class="at">which =</span> <span class="dv">2</span>)</span>
<span id="cb26-732"><a href="#cb26-732"></a><span class="in">```</span></span>
<span id="cb26-733"><a href="#cb26-733"></a></span>
<span id="cb26-734"><a href="#cb26-734"></a>It is enough to know that the normality assumption is not met -- I cannot proceed with a simple linear regression. However, let us for completeness also look at the homoscedasticity assumption. I will use the Breusch-Pagan test to check for homoscedasticity, followed by a plot of residuals against fitted values.</span>
<span id="cb26-735"><a href="#cb26-735"></a></span>
<span id="cb26-738"><a href="#cb26-738"></a><span class="in">```{r}</span></span>
<span id="cb26-739"><a href="#cb26-739"></a><span class="co">#| echo: true</span></span>
<span id="cb26-740"><a href="#cb26-740"></a></span>
<span id="cb26-741"><a href="#cb26-741"></a><span class="fu">bptest</span>(mod2)</span>
<span id="cb26-742"><a href="#cb26-742"></a><span class="in">```</span></span>
<span id="cb26-743"><a href="#cb26-743"></a></span>
<span id="cb26-744"><a href="#cb26-744"></a>The *p*-value for the Breusch-Pagan test is &gt; 0.05, indicating that the residuals are homoscedastic. The plot of residuals against fitted values shows gives a slightly different impression (@fig-resid2).</span>
<span id="cb26-745"><a href="#cb26-745"></a></span>
<span id="cb26-748"><a href="#cb26-748"></a><span class="in">```{r}</span></span>
<span id="cb26-749"><a href="#cb26-749"></a><span class="co">#| echo: true</span></span>
<span id="cb26-750"><a href="#cb26-750"></a><span class="co">#| fig.cap: "A plot of residuals against fitted values for the linear regression, `mod2`."</span></span>
<span id="cb26-751"><a href="#cb26-751"></a><span class="co">#| label: fig-resid2</span></span>
<span id="cb26-752"><a href="#cb26-752"></a><span class="co">#| fig.width: 4</span></span>
<span id="cb26-753"><a href="#cb26-753"></a><span class="co">#| fig.height: 3</span></span>
<span id="cb26-754"><a href="#cb26-754"></a><span class="co">#| fig.align: center</span></span>
<span id="cb26-755"><a href="#cb26-755"></a></span>
<span id="cb26-756"><a href="#cb26-756"></a><span class="fu">plot</span>(mod2, <span class="at">which =</span> <span class="dv">1</span>)</span>
<span id="cb26-757"><a href="#cb26-757"></a><span class="in">```</span></span>
<span id="cb26-758"><a href="#cb26-758"></a></span>
<span id="cb26-759"><a href="#cb26-759"></a>The assumptions of normality and homoscedasticity are violated (it is sufficient that one or the other fails, not both). As already noted, I cannot proceed with the linear model. I will need to consider alternative models or transformations to address these issues.</span>
<span id="cb26-760"><a href="#cb26-760"></a></span>
<span id="cb26-761"><a href="#cb26-761"></a>When the assumptions of normality and homoscedasticity are violated, I have some options---these broadly group into transforming the data and using a non-parametric test.</span>
<span id="cb26-762"><a href="#cb26-762"></a></span>
<span id="cb26-763"><a href="#cb26-763"></a>Transforming the data can sometimes help attain normality and homoscedasticity. Common transformations include the logarithmic, square root, and inverse transformations. However, be cautious when interpreting the results of transformed data, as the transformed coefficients may not be directly interpretable.</span>
<span id="cb26-764"><a href="#cb26-764"></a></span>
<span id="cb26-765"><a href="#cb26-765"></a>I will show the Theil-Sen estimator (also known as Sen's slope estimator) as a robust non-parametric replacement for a simple linear model. It calculates the median of the slopes of all pairs of sample points to determine the overall slope of the line.</span>
<span id="cb26-766"><a href="#cb26-766"></a></span>
<span id="cb26-769"><a href="#cb26-769"></a><span class="in">```{r}</span></span>
<span id="cb26-770"><a href="#cb26-770"></a><span class="co">#| echo: true</span></span>
<span id="cb26-771"><a href="#cb26-771"></a></span>
<span id="cb26-772"><a href="#cb26-772"></a><span class="fu">library</span>(mblm)</span>
<span id="cb26-773"><a href="#cb26-773"></a></span>
<span id="cb26-774"><a href="#cb26-774"></a>mod3 <span class="ot">&lt;-</span> <span class="fu">mblm</span>(wing <span class="sc">~</span> age, <span class="at">data =</span> sparrows)</span>
<span id="cb26-775"><a href="#cb26-775"></a><span class="fu">summary</span>(mod3)</span>
<span id="cb26-776"><a href="#cb26-776"></a><span class="in">```</span></span>
<span id="cb26-777"><a href="#cb26-777"></a></span>
<span id="cb26-778"><a href="#cb26-778"></a>The interpretation of the Theil-Sen estimator is similar to the simple linear regression. The Theil-Sen estimator provides a robust estimate of the slope of the relationship between age and wing length. The slope of the line is 0.28 ($\pm$ 0.19 mean absolute deviation) (*V* value = 91, *p* &lt; 0.001), indicating that for each additional day of age, the wing length increases by 0.28 cm. The intercept of the line is 0.75, indicating that the wing length is ~0.8 cm when the age is 0 days.</span>
<span id="cb26-779"><a href="#cb26-779"></a></span>
<span id="cb26-780"><a href="#cb26-780"></a><span class="fu">### My Data Do Not Display a Linear Response</span></span>
<span id="cb26-781"><a href="#cb26-781"></a></span>
<span id="cb26-782"><a href="#cb26-782"></a>In simple linear regression, the dependent variable $Y$ is expected to exhibit a straight-line relationship with the independent variable $X$. However, several factors can cause deviations from a linear pattern.</span>
<span id="cb26-783"><a href="#cb26-783"></a></span>
<span id="cb26-784"><a href="#cb26-784"></a>Statistical assumptions underlying linear regression can affect the appearance of a linear response. The normality assumption is important but primarily pertains to the residuals rather than the $Y$ vs. $X$ plot. A scatterplot of $Y$ vs. $X$ might deviate from a linear pattern due to the non-normality of the residuals or heteroscedasticity, where the variability of the residuals changes with the level of $X$. Addressing these issues and then reassessing the linearity of the relationship is a logical first step. Refer to @sec-assumption-fails for more details on how to proceed.</span>
<span id="cb26-785"><a href="#cb26-785"></a></span>
<span id="cb26-786"><a href="#cb26-786"></a>Outliers in the data can significantly impact the regression line, leading to misleading results (@sec-outlier-test). Measurement errors in the independent variable can also lead to biased and inconsistent estimations, which may require revisiting the data collection process to address systemic problems. Variable bias, where excluding relevant variables distorts the observed relationship, could also explain seemingly nonlinear responses. Considering multiple predictor variables in a regression model (@sec-multiple-linear-regression) might be more appropriate in such situations.</span>
<span id="cb26-787"><a href="#cb26-787"></a></span>
<span id="cb26-788"><a href="#cb26-788"></a>It's important to note that simple linear regression might not be suitable for all scenarios. For instance, the dependent variable $Y$ might inherently follow a different probability distribution, such as a Poisson or a binomial distribution, rather than a normal distribution. This is particularly relevant in count data or binary outcome scenarios. In such cases, other types of models like Poisson regression or logistic regression, accommodated by generalised linear models (GLM; @sec-generalised-linear-model), would be more appropriate.</span>
<span id="cb26-789"><a href="#cb26-789"></a></span>
<span id="cb26-790"><a href="#cb26-790"></a>Lastly, if the data do not exhibit a linear relationship even after addressing these issues, the relationship between the variables may really be nonlinear. This can occur when the underlying functional relationship between $X$ and $Y$ is better described by exponential, logarithmic, or other more complex mechanistic responses. In such cases, nonlinear regression (@sec-nonlinear-regression) or generalised additive models (GAM; @sec-generalised-additive-models) might be necessary to describe the relationship between the variables accurately.</span>
<span id="cb26-791"><a href="#cb26-791"></a></span>
<span id="cb26-792"><a href="#cb26-792"></a><span class="co">&lt;!-- Therefore, when the linear response is absent, do one of the following as appropriate: --&gt;</span></span>
<span id="cb26-793"><a href="#cb26-793"></a></span>
<span id="cb26-794"><a href="#cb26-794"></a><span class="co">&lt;!-- -   If one or both of the assumptions of normality and homoscedasticity are violated, consider: --&gt;</span></span>
<span id="cb26-795"><a href="#cb26-795"></a><span class="co">&lt;!--     -   transforming the data to meet the assumptions of linear regression; --&gt;</span></span>
<span id="cb26-796"><a href="#cb26-796"></a><span class="co">&lt;!--     -   using a non-parametric regression model like the Theil-Sen estimator (@sec-assumption-fails2). --&gt;</span></span>
<span id="cb26-797"><a href="#cb26-797"></a><span class="co">&lt;!-- -   If the underlying functional relationship is truly not linear, consider: --&gt;</span></span>
<span id="cb26-798"><a href="#cb26-798"></a><span class="co">&lt;!--     -   using a non-linear regression model to capture the correct functional relationship; --&gt;</span></span>
<span id="cb26-799"><a href="#cb26-799"></a><span class="co">&lt;!--     -   exploring alternative approaches such as a Generalised Additive Model (GAM). --&gt;</span></span>
<span id="cb26-800"><a href="#cb26-800"></a><span class="co">&lt;!-- -   If the dependent variable does not follow a normal distribution, consider: --&gt;</span></span>
<span id="cb26-801"><a href="#cb26-801"></a><span class="co">&lt;!--     -   fitting an alternative model using a Generalised Linear Model (GLM) with the appropriate link function for count, binary data, or other data. --&gt;</span></span>
</code><button title="Copy to Clipboard" class="code-copy-button" data-in-quarto-modal=""><i class="bi"></i></button></pre></div>
</div></div></div></div></div>
</div> <!-- /content -->




<footer class="footer"><div class="nav-footer"><div class="nav-footer-center"><div class="toc-actions d-sm-block d-md-none"><ul><li><a href="https://github.com/ajsmit/BCB_Stats/edit/main/simple_linear_regression.qmd" class="toc-action"><i class="bi bi-github"></i>Edit this page</a></li></ul></div></div></div></footer><script src="site_libs/quarto-html/zenscroll-min.js"></script>
</body></html>